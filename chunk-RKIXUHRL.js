import{a as Wi}from"./chunk-6XXL2P73.js";import{a as Hi,b as Ui,c as Qi,h as Ki,m as Yi}from"./chunk-RN275JER.js";import{b as Xi,c as Zi}from"./chunk-MGIPL4GQ.js";import{a as Ke,b as Ye}from"./chunk-HGHWDJ3Y.js";import{a as Ni,b as Vi,c as Li,d as Bi,e as $i,f as tt}from"./chunk-HXPSBJ7W.js";import{b as xi}from"./chunk-62JYEZTC.js";import{b as ti}from"./chunk-QFTYFRTT.js";import{a as wi}from"./chunk-U2FQBRAF.js";import{a as Ue,b as Ce}from"./chunk-KHLMMB7R.js";import{a as pi,b as ui,c as fi,d as gi,f as xe,h as _i,i as hi}from"./chunk-GKGNTNFJ.js";import{a as Gi}from"./chunk-L5RKD3O3.js";import{a as Pi}from"./chunk-SEKTGI6S.js";import{a as ki}from"./chunk-FHX7ZVQY.js";import{a as Fi,b as Ai,c as zi}from"./chunk-QPZUELQO.js";import"./chunk-WNYFH7QK.js";import{e as Je,i as Ii,k as et}from"./chunk-BRQ7VCIS.js";import{a as ji}from"./chunk-G7RI2PMQ.js";import{a as ci,b as di,c as We,d as je}from"./chunk-JIGZDOJQ.js";import"./chunk-OFJDRZ5L.js";import{a as Ei,b as Ri,c as Di,d as Ti,e as qi,f as Ze,g as Oi}from"./chunk-TQGVYNR7.js";import"./chunk-LAXWCL6A.js";import{a as Ge,b as ke,c as ie}from"./chunk-QEA2ESGG.js";import{a as ae,b as se,c as Ie,d as Xt,e as Zt,f as Jt,g as ei,h as le}from"./chunk-JG6HUHEY.js";import{c as Yt}from"./chunk-PWVAMWZ2.js";import"./chunk-GX2D2L2X.js";import"./chunk-O2OSWUJ6.js";import"./chunk-ULQGHXUB.js";import{b as Xe}from"./chunk-ERJX7L3L.js";import"./chunk-5XV7PTQI.js";import{a as ge,b as _e}from"./chunk-FFXGIJC7.js";import{b as He,d as mi,f as he}from"./chunk-7F4BNMQ6.js";import{a as ee,b as W}from"./chunk-HJ4PUJUU.js";import"./chunk-GW7MQSL6.js";import"./chunk-F4M4TAIC.js";import{f as Le,g as Be,h as $e,i as si,j as li,m as me,p as pe,q as ue,r as fe}from"./chunk-FGBSBVHW.js";import"./chunk-5R36QA5Q.js";import{a as Ci,b as yi,c as vi,d as bi,e as Si,f as Mi,h as Qe}from"./chunk-SJZ6P2DA.js";import"./chunk-SKMC2KSJ.js";import{P as Oe,R as U,S as N,T as ii,U as ce,W as bt,Z as te,_ as Fe,aa as ni,fa as Ae,ga as ze,ka as oi,na as ri,oa as Ne,ra as ai,sa as Ve,ta as K,ua as de}from"./chunk-YMB734HE.js";import{a as Ut,c as Qt,d as Kt}from"./chunk-HUJ7WYYJ.js";import{b as I,c as T}from"./chunk-M6LIKZVL.js";import{d as jt,o as Ht,s as G}from"./chunk-Q6UYEA4T.js";import{$b as O,Aa as X,Bb as P,Bc as s,Cc as y,Dc as b,E as kt,Ec as B,Fc as zt,Ga as M,Hb as Y,Ja as ne,Ka as Dt,L as wt,Ma as Z,Nc as Nt,Oc as H,P as Se,Rc as Vt,Sb as p,Sc as Lt,Tb as u,Tc as Bt,Ub as Tt,Uc as $t,V as Et,Vb as J,Wb as k,Xb as w,Y as De,Yb as f,Zb as r,Zc as S,_b as o,ac as Me,ad as j,bc as Pe,bd as A,cc as re,ga as Rt,gc as v,ha as Te,hd as Gt,kc as h,la as qe,lb as l,ld as Wt,ma as F,mc as m,qc as qt,rc as Ot,sa as x,sc as It,ta as C,v as Re,vb as oe,w as be,wc as Ft,yc as R,zc as At}from"./chunk-ZXFVGPYG.js";import{a as D,b as q}from"./chunk-RNQFGQA5.js";var sn=(n,t)=>t.carrierFqn;function ln(n,t){if(n&1){let e=v();r(0,"div",7)(1,"mat-checkbox",8),h("change",function(a){let c=x(e).$implicit,d=m();return C(d.onPlacedChange(c,a.checked))}),r(2,"div",9)(3,"span",10),s(4),o(),r(5,"span",11),s(6,"\u2192"),o(),r(7,"span",12),s(8),o()(),r(9,"div",13)(10,"span",14),s(11),o(),r(12,"span",15),s(13),o()()()()}if(n&2){let e=t.$implicit;R("completed",e.placed),l(),f("checked",e.placed),l(3),y(e.carrierName),l(4),b("Rail ",e.suggestedRails[0]||"\u2014"),l(3),B("",e.slotsNeeded,"/",e.slotsAvailable," slots"),l(2),b("(",e.carrierType,")")}}function cn(n,t){n&1&&(r(0,"div",5)(1,"mat-icon"),s(2,"check_circle"),o(),r(3,"span"),s(4,"No carriers required for this protocol"),o()())}var it=class n{carrierRequirements=A.required();carrierPlaced=j();placedCount=S(()=>this.carrierRequirements().filter(t=>t.placed).length);allPlaced=S(()=>this.carrierRequirements().length>0&&this.carrierRequirements().every(t=>t.placed));onPlacedChange(t,e){this.carrierPlaced.emit({carrierFqn:t.carrierFqn,placed:e})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-carrier-placement-step"]],inputs:{carrierRequirements:[1,"carrierRequirements"]},outputs:{carrierPlaced:"carrierPlaced"},decls:16,vars:6,consts:[[1,"step-content"],[1,"step-title"],[1,"instruction"],[1,"carrier-list"],[1,"carrier-item",3,"completed"],[1,"no-carriers"],[1,"progress-summary"],[1,"carrier-item"],[3,"change","checked"],[1,"carrier-info"],[1,"carrier-name"],[1,"carrier-arrow"],[1,"rail-position"],[1,"carrier-details"],[1,"slot-count"],[1,"carrier-type"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"h3",1)(2,"mat-icon"),s(3,"view_column"),o(),s(4," Step 1: Place Carriers on Deck "),o(),r(5,"p",2),s(6," Slide the following carriers into the indicated rail positions: "),o(),r(7,"div",3),k(8,ln,14,8,"div",4,sn),p(10,cn,5,0,"div",5),o(),r(11,"div",6)(12,"mat-icon"),s(13),o(),r(14,"span"),s(15),o()()()),e&2&&(l(8),w(i.carrierRequirements()),l(2),u(i.carrierRequirements().length===0?10:-1),l(2),R("complete",i.allPlaced()),l(),b(" ",i.allPlaced()?"check_circle":"pending"," "),l(2),B("",i.placedCount(),"/",i.carrierRequirements().length," carriers placed"))},dependencies:[K,Ce,Ue,T,I],styles:[".step-content[_ngcontent-%COMP%]{padding:16px}.step-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:0 0 8px;color:var(--sys-on-surface)}.instruction[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant);margin-bottom:16px}.carrier-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.carrier-item[_ngcontent-%COMP%]{padding:12px 16px;background:var(--sys-surface-container);border-radius:8px;border:1px solid var(--sys-outline-variant);transition:all .2s ease}.carrier-item.completed[_ngcontent-%COMP%]{background:var(--sys-primary-container);border-color:var(--sys-primary)}.carrier-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:500}.carrier-name[_ngcontent-%COMP%]{color:var(--sys-on-surface)}.carrier-arrow[_ngcontent-%COMP%]{color:var(--sys-primary)}.rail-position[_ngcontent-%COMP%]{color:var(--sys-primary);font-weight:600}.carrier-details[_ngcontent-%COMP%]{margin-top:4px;font-size:.875rem;color:var(--sys-on-surface-variant);margin-left:24px}.no-carriers[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:16px;background:var(--sys-secondary-container);border-radius:8px;color:var(--sys-on-secondary-container)}.progress-summary[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px;background:var(--sys-surface-container-high);border-radius:8px}.progress-summary[_ngcontent-%COMP%]   mat-icon.complete[_ngcontent-%COMP%]{color:var(--sys-primary)}"]})};var mn=(n,t)=>t.resource.name;function pn(n,t){n&1&&O(0,"div",17)}function un(n,t){if(n&1&&(r(0,"div",18),s(1),o()),n&2){let e=m().$implicit;l(),b(" ",e.resource.name," ")}}function fn(n,t){n&1&&(r(0,"mat-icon"),s(1,"check"),o())}function gn(n,t){if(n&1&&s(0),n&2){let e=m().$index;b(" ",e+1," ")}}function _n(n,t){if(n&1){let e=v();r(0,"button",19),h("click",function(){x(e);let a=m().$implicit,c=m();return C(c.onMarkPlaced(a))}),s(1," Done "),o()}}function hn(n,t){if(n&1&&(r(0,"div",8),Y(1,pn,1,0,"div",9)(2,un,2,1,"div",10),r(3,"div",11),p(4,fn,2,0,"mat-icon")(5,gn,1,1),o(),r(6,"div",12)(7,"span",13),s(8),o(),r(9,"mat-icon",14),s(10,"arrow_forward"),o(),r(11,"span",15),s(12),o()(),p(13,_n,2,0,"button",16),o()),n&2){let e=t.$implicit,i=t.$index,a=m();R("current",i===a.currentIndex())("completed",e.placed)("pending",!e.placed&&i>a.currentIndex()),f("cdkDragData",e)("cdkDragDisabled",e.placed),l(3),R("active",i===a.currentIndex()),l(),u(e.placed?4:5),l(4),y(e.resource.name),l(4),B(" ",e.carrier.name,", ",e.slot.name," "),l(),u(i===a.currentIndex()&&!e.placed?13:-1)}}function xn(n,t){n&1&&(r(0,"div",5)(1,"mat-icon"),s(2,"check_circle"),o(),r(3,"span"),s(4,"No resources to place"),o()())}function Cn(n,t){n&1&&(r(0,"div",6)(1,"mat-icon"),s(2,"info"),o(),r(3,"span"),s(4,"Resources are ordered by Z-axis for optimal placement (lowest first)"),o()())}var nt=class n{assignments=A.required();resourcePlaced=j();currentIndex=M(0);placedCount=S(()=>this.assignments().filter(t=>t.placed).length);allPlaced=S(()=>this.assignments().length>0&&this.assignments().every(t=>t.placed));showZAxisHint=S(()=>this.assignments().length>1);onMarkPlaced(t){this.resourcePlaced.emit({resourceName:t.resource.name,placed:!0});let e=this.assignments().findIndex((i,a)=>a>this.currentIndex()&&!i.placed);e!==-1&&this.currentIndex.set(e)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-resource-placement-step"]],inputs:{assignments:[1,"assignments"]},outputs:{resourcePlaced:"resourcePlaced"},decls:17,vars:7,consts:[[1,"step-content"],[1,"step-title"],[1,"instruction"],["cdkDropList","",1,"resource-list"],["cdkDrag","",1,"resource-item",3,"current","completed","pending","cdkDragData","cdkDragDisabled"],[1,"no-resources"],[1,"z-axis-hint"],[1,"progress-summary"],["cdkDrag","",1,"resource-item",3,"cdkDragData","cdkDragDisabled"],["class","drag-placeholder",4,"cdkDragPlaceholder"],["class","drag-preview",4,"cdkDragPreview"],[1,"order-badge"],[1,"resource-info"],[1,"resource-name"],[1,"arrow"],[1,"slot-location"],["mat-flat-button","","color","primary"],[1,"drag-placeholder"],[1,"drag-preview"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"h3",1)(2,"mat-icon"),s(3,"science"),o(),s(4," Step 2: Place Resources in Slots "),o(),r(5,"p",2),s(6," Place each resource in its designated slot. Follow the order below for optimal access. "),o(),r(7,"div",3),k(8,hn,14,15,"div",4,mn),p(10,xn,5,0,"div",5),o(),p(11,Cn,5,0,"div",6),r(12,"div",7)(13,"mat-icon"),s(14),o(),r(15,"span"),s(16),o()()()),e&2&&(l(8),w(i.assignments()),l(2),u(i.assignments().length===0?10:-1),l(),u(i.showZAxisHint()?11:-1),l(2),R("complete",i.allPlaced()),l(),b(" ",i.allPlaced()?"check_circle":"pending"," "),l(2),B("",i.placedCount(),"/",i.assignments().length," resources placed"))},dependencies:[T,I,N,U,Ze,Di,Ei,Ti,qi],styles:[".step-content[_ngcontent-%COMP%]{padding:16px}.step-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:0 0 8px;color:var(--sys-on-surface)}.instruction[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant);margin-bottom:16px}.resource-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-bottom:16px;max-height:300px;overflow-y:auto}.resource-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--sys-surface-container);border-radius:8px;border:1px solid var(--sys-outline-variant);transition:all .2s ease}.resource-item.current[_ngcontent-%COMP%]{background:var(--sys-tertiary-container);border-color:var(--sys-tertiary)}.resource-item.completed[_ngcontent-%COMP%]{background:var(--sys-primary-container);border-color:var(--sys-primary);opacity:.8}.resource-item.pending[_ngcontent-%COMP%]{opacity:.6}.order-badge[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;background:var(--sys-surface-container-high);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.875rem;flex-shrink:0}.order-badge.active[_ngcontent-%COMP%]{background:var(--sys-tertiary);color:var(--sys-on-tertiary)}.resource-item[_ngcontent-%COMP%]:not(.completed){cursor:grab}.resource-item[_ngcontent-%COMP%]:not(.completed):active{cursor:grabbing}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:8px;box-shadow:0 5px 15px #0000004d;background:var(--sys-surface-container);padding:12px 16px;color:var(--sys-on-surface);font-weight:500;border:1px solid var(--sys-primary);z-index:1000}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.resource-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .resource-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.resource-item.completed[_ngcontent-%COMP%]   .order-badge[_ngcontent-%COMP%]{background:var(--sys-primary);color:var(--sys-on-primary)}.resource-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex:1}.resource-name[_ngcontent-%COMP%]{font-weight:500;color:var(--sys-on-surface)}.arrow[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant);font-size:18px}.slot-location[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant)}.no-resources[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:16px;background:var(--sys-secondary-container);border-radius:8px;color:var(--sys-on-secondary-container)}.z-axis-hint[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px;background:var(--sys-tertiary-container);border-radius:8px;color:var(--sys-on-tertiary-container);font-size:.875rem;margin-bottom:16px}.progress-summary[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px;background:var(--sys-surface-container-high);border-radius:8px}.progress-summary[_ngcontent-%COMP%]   mat-icon.complete[_ngcontent-%COMP%]{color:var(--sys-primary)}"]})};var yn=(n,t)=>t.carrierFqn,vn=(n,t)=>t.resource.name;function bn(n,t){if(n&1&&(r(0,"div",5)(1,"mat-icon",7),s(2,"check_circle"),o(),r(3,"span"),s(4),o()()),n&2){let e=t.$implicit;l(4),B("",e.carrierName," on Rail ",e.suggestedRails[0])}}function Sn(n,t){if(n&1&&(r(0,"div",5)(1,"mat-icon",7),s(2,"check_circle"),o(),r(3,"span"),s(4),o()()),n&2){let e=t.$implicit;l(4),zt(" ",e.resource.name," in ",e.carrier.name,", ",e.slot.name," ")}}var ot=class n{carrierRequirements=A.required();slotAssignments=A.required();confirmed=j();totalItems=S(()=>this.carrierRequirements().length+this.slotAssignments().length);static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-verification-step"]],inputs:{carrierRequirements:[1,"carrierRequirements"],slotAssignments:[1,"slotAssignments"]},outputs:{confirmed:"confirmed"},decls:26,vars:2,consts:[[1,"step-content"],[1,"step-title"],[1,"instruction"],[1,"summary-section"],[1,"summary-list"],[1,"summary-item"],[1,"confirmation-warning"],[1,"check"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"h3",1)(2,"mat-icon"),s(3,"verified"),o(),s(4," Step 3: Verify Configuration "),o(),r(5,"p",2),s(6," Review your deck configuration and confirm it matches the physical setup. "),o(),r(7,"div",3)(8,"h4"),s(9),o(),r(10,"div",4),k(11,bn,5,2,"div",5,yn),o()(),r(13,"div",3)(14,"h4"),s(15),o(),r(16,"div",4),k(17,Sn,5,3,"div",5,vn),o()(),r(19,"div",6)(20,"mat-icon"),s(21,"warning"),o(),r(22,"div")(23,"strong"),s(24,"Important:"),o(),s(25," Ensure the physical deck matches this configuration before proceeding. Incorrect placement may cause protocol errors. "),o()()()),e&2&&(l(9),b("Carriers (",i.carrierRequirements().length,")"),l(2),w(i.carrierRequirements()),l(4),b("Resources (",i.slotAssignments().length,")"),l(2),w(i.slotAssignments()))},dependencies:[T,I,N],styles:[".step-content[_ngcontent-%COMP%]{padding:16px}.step-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:0 0 8px;color:var(--sys-on-surface)}.instruction[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant);margin-bottom:16px}.summary-section[_ngcontent-%COMP%]{margin-bottom:16px}.summary-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;color:var(--sys-on-surface);font-size:.875rem;text-transform:uppercase;letter-spacing:.05em}.summary-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:12px;background:var(--sys-surface-container);border-radius:8px;max-height:150px;overflow-y:auto}.summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:var(--sys-on-surface)}.summary-item[_ngcontent-%COMP%]   .check[_ngcontent-%COMP%]{color:var(--sys-primary);font-size:18px}.confirmation-warning[_ngcontent-%COMP%]{display:flex;gap:12px;padding:16px;background:var(--sys-error-container);border-radius:8px;color:var(--sys-on-error-container)}.confirmation-warning[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--sys-error);flex-shrink:0}"]})};var Pn=(n,t)=>t.message;function kn(n,t){if(n&1&&(r(0,"mat-chip",12),s(1),o()),n&2){let e=m().$implicit;f("highlighted",!1),l(),b(" Position ",e.position," ")}}function wn(n,t){if(n&1&&(r(0,"span",13),s(1),o()),n&2){let e=m().$implicit;l(),b(" ",e.resource_type," ")}}function En(n,t){if(n&1){let e=v();r(0,"div",8)(1,"mat-checkbox",9),h("change",function(){let a=x(e).$index,c=m(2);return C(c.toggleCheck(a))}),r(2,"span",10),s(3),o()(),r(4,"div",11),p(5,kn,2,2,"mat-chip",12),p(6,wn,2,1,"span",13),o()()}if(n&2){let e=t.$implicit,i=t.$index,a=m(2);R("required",e.severity==="required")("recommended",e.severity==="recommended")("info",e.severity==="info")("checked",a.checkedState()[i]),l(),f("checked",a.checkedState()[i])("color",a.getSeverityColor(e.severity)),l(2),y(e.message),l(2),u(e.position?5:-1),l(),u(e.resource_type?6:-1)}}function Rn(n,t){n&1&&(r(0,"div",7)(1,"span",14)(2,"mat-icon"),s(3,"priority_high"),o(),s(4," Required "),o(),r(5,"span",15)(6,"mat-icon"),s(7,"thumb_up"),o(),s(8," Recommended "),o(),r(9,"span",16)(10,"mat-icon"),s(11,"info"),o(),s(12," Info "),o()())}function Dn(n,t){if(n&1&&(r(0,"div",0)(1,"div",1)(2,"mat-icon",2),s(3,"checklist"),o(),r(4,"span",3),s(5,"Pre-Run Setup"),o(),r(6,"span",4),s(7),o()(),r(8,"div",5),k(9,En,7,13,"div",6,Pn),o(),p(11,Rn,13,0,"div",7),o()),n&2){let e=m();l(6),R("complete",e.isComplete()),l(),B(" ",e.checkedCount()," / ",e.instructions.length," completed "),l(2),w(e.instructions),l(2),u(e.showLegend?11:-1)}}var rt=class n{instructions=null;showLegend=!1;allRequiredChecked=new X;checkedStateChange=new X;checkedState=M([]);checkedCount=S(()=>this.checkedState().filter(Boolean).length);isComplete=S(()=>{let t=this.checkedState();return t.length>0&&t.every(Boolean)});allRequiredComplete=S(()=>{if(!this.instructions)return!0;let t=this.checkedState();return this.instructions.every((e,i)=>e.severity!=="required"||t[i])});ngOnChanges(){this.instructions&&this.checkedState.set(new Array(this.instructions.length).fill(!1))}toggleCheck(t){let i=[...this.checkedState()];i[t]=!i[t],this.checkedState.set(i),this.checkedStateChange.emit(i),this.allRequiredChecked.emit(this.allRequiredComplete())}getSeverityColor(t){switch(t){case"required":return"warn";case"recommended":return"primary";default:return"accent"}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-setup-instructions"]],inputs:{instructions:"instructions",showLegend:"showLegend"},outputs:{allRequiredChecked:"allRequiredChecked",checkedStateChange:"checkedStateChange"},features:[Z],decls:1,vars:1,consts:[[1,"setup-instructions-panel"],[1,"panel-header"],[1,"header-icon"],[1,"header-title"],[1,"completion-badge"],[1,"instructions-list"],[1,"instruction-item",3,"required","recommended","info","checked"],[1,"severity-legend"],[1,"instruction-item"],[3,"change","checked","color"],[1,"instruction-message"],[1,"instruction-badges"],[1,"position-badge",3,"highlighted"],[1,"resource-type-hint"],[1,"legend-item","required"],[1,"legend-item","recommended"],[1,"legend-item","info"]],template:function(e,i){e&1&&p(0,Dn,12,5,"div",0),e&2&&u(i.instructions&&i.instructions.length>0?0:-1)},dependencies:[K,Ce,Ue,T,I,W,he,He],styles:[".setup-instructions-panel[_ngcontent-%COMP%]{background:var(--surface-container-low, #f5f5f5);border-radius:12px;padding:16px;margin-bottom:16px}.panel-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:12px}.header-icon[_ngcontent-%COMP%]{color:var(--primary)}.header-title[_ngcontent-%COMP%]{font-weight:500;font-size:1rem;flex:1}.completion-badge[_ngcontent-%COMP%]{font-size:.85rem;color:var(--on-surface-variant);padding:4px 8px;border-radius:16px;background:var(--surface-container)}.completion-badge.complete[_ngcontent-%COMP%]{background:var(--primary-container);color:var(--on-primary-container)}.instructions-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.instruction-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;padding:8px 12px;border-radius:8px;background:var(--surface);border-left:3px solid transparent;transition:all .2s ease}.instruction-item.required[_ngcontent-%COMP%]{border-left-color:var(--error, #d32f2f)}.instruction-item.recommended[_ngcontent-%COMP%]{border-left-color:var(--primary, var(--status-info))}.instruction-item.info[_ngcontent-%COMP%]{border-left-color:var(--secondary, #9e9e9e)}.instruction-item.checked[_ngcontent-%COMP%]{opacity:.7}.instruction-item.checked[_ngcontent-%COMP%]   .instruction-message[_ngcontent-%COMP%]{text-decoration:line-through}.instruction-message[_ngcontent-%COMP%]{line-height:1.5}.instruction-badges[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-shrink:0}.position-badge[_ngcontent-%COMP%]{font-size:.75rem}.resource-type-hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--on-surface-variant);font-style:italic}.severity-legend[_ngcontent-%COMP%]{display:flex;gap:16px;margin-top:12px;padding-top:12px;border-top:1px solid var(--outline-variant);font-size:.75rem}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.legend-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.legend-item.required[_ngcontent-%COMP%]{color:var(--error, #d32f2f)}.legend-item.recommended[_ngcontent-%COMP%]{color:var(--primary, var(--status-info))}.legend-item.info[_ngcontent-%COMP%]{color:var(--secondary, #9e9e9e)}"]})};function Tn(n,t){n&1&&(r(0,"mat-icon",2),s(1,"check_circle"),o())}function qn(n,t){n&1&&(r(0,"mat-icon",3),s(1,"warning"),o())}function On(n,t){n&1&&(r(0,"mat-icon",4),s(1,"error"),o())}function In(n,t){if(n&1&&(r(0,"span",7),s(1),o()),n&2){let e=m();l(),y(e.details())}}var we=class n{status=A.required();isMet=S(()=>this.status().isMet);isWarning=S(()=>this.status().isWarning);label=S(()=>{let t=this.status().requirement;switch(t.requirement_type){case"resource_on_deck":return`${t.resource||"Resource"} must be placed on deck`;case"liquid_present":return`${t.resource||"Source"} must contain liquid`;case"tips_required":return"Tips must be available";default:return t.requirement_type.replace(/_/g," ")}});details=S(()=>{let e=this.status().requirement.details;if(!e||Object.keys(e).length===0)return this.status().message||"";if(e.before_operation)return`Required before: ${e.before_operation}`;if(e.wells){let i=e.wells;return`Wells: ${i.slice(0,5).join(", ")}${i.length>5?"...":""}`}return e.min_volume?`Minimum volume: ${e.min_volume}\xB5L`:this.status().message||""});tooltipText=S(()=>{let t=this.status().requirement,e=[`Type: ${t.requirement_type}`];return t.resource&&e.push(`Resource: ${t.resource}`),t.inferred_at_level&&e.push(`Detected at: ${t.inferred_at_level} level`),this.status().message&&e.push(this.status().message),e.join(`
`)});static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-requirement-indicator"]],inputs:{status:[1,"status"]},decls:9,vars:11,consts:[[1,"requirement-item",3,"matTooltip","matTooltipShowDelay"],[1,"status-icon"],[1,"icon-met"],[1,"icon-warning"],[1,"icon-unmet"],[1,"requirement-content"],[1,"requirement-label"],[1,"requirement-details"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1),p(2,Tn,2,0,"mat-icon",2)(3,qn,2,0,"mat-icon",3)(4,On,2,0,"mat-icon",4),o(),r(5,"div",5)(6,"span",6),s(7),o(),p(8,In,2,1,"span",7),o()()),e&2&&(R("met",i.isMet())("warning",i.isWarning())("unmet",!i.isMet()&&!i.isWarning()),f("matTooltip",i.tooltipText())("matTooltipShowDelay",600),l(2),u(i.isMet()&&!i.isWarning()?2:i.isWarning()?3:4),l(5),y(i.label()),l(),u(i.details()?8:-1))},dependencies:[T,I,W,ee],styles:[".requirement-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px;padding:12px 16px;border-radius:8px;background:var(--sys-surface-container);transition:all .2s ease}.requirement-item[_ngcontent-%COMP%]:hover{background:var(--sys-surface-container-high)}.requirement-item.met[_ngcontent-%COMP%]{border-left:3px solid var(--sys-primary)}.requirement-item.warning[_ngcontent-%COMP%]{border-left:3px solid var(--sys-tertiary);background:color-mix(in srgb,var(--sys-tertiary) 8%,var(--sys-surface-container))}.requirement-item.unmet[_ngcontent-%COMP%]{border-left:3px solid var(--sys-error);background:color-mix(in srgb,var(--sys-error) 8%,var(--sys-surface-container))}.status-icon[_ngcontent-%COMP%]{flex-shrink:0;display:flex;align-items:center;justify-content:center;width:24px;height:24px}.status-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.icon-met[_ngcontent-%COMP%]{color:var(--sys-primary)}.icon-warning[_ngcontent-%COMP%]{color:var(--sys-tertiary)}.icon-unmet[_ngcontent-%COMP%]{color:var(--sys-error)}.requirement-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;min-width:0}.requirement-label[_ngcontent-%COMP%]{font-weight:500;color:var(--sys-on-surface);font-size:.875rem}.requirement-details[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant)}"]})};var Fn=(n,t)=>t.requirement.requirement_type+t.requirement.resource;function An(n,t){n&1&&O(0,"mat-spinner",2)}function zn(n,t){if(n&1&&(r(0,"span",5),s(1),o()),n&2){let e=m();R("all-met",e.allMet()),l(),B(" ",e.metCount(),"/",e.requirements().length," ")}}function Nn(n,t){n&1&&(r(0,"div",4)(1,"mat-icon"),s(2,"info_outline"),o(),r(3,"span"),s(4,"No specific requirements detected"),o()())}function Vn(n,t){if(n&1&&O(0,"app-requirement-indicator",7),n&2){let e=t.$implicit;f("status",e)}}function Ln(n,t){n&1&&(r(0,"div",8)(1,"mat-icon"),s(2,"warning"),o(),r(3,"span"),s(4,"Some requirements are not met. Please complete deck setup to proceed."),o()())}function Bn(n,t){if(n&1&&(r(0,"div",6),k(1,Vn,1,1,"app-requirement-indicator",7,Fn),o(),p(3,Ln,5,0,"div",8)),n&2){let e=m();l(),w(e.requirementStatuses()),l(2),u(e.allMet()?-1:3)}}var Ee=class n{simulationService=F(ji);protocolId=A.required();deckState=A({placedResources:new Set,liquidConfirmed:new Set,hasTipRack:!1});isLoading=M(!1);requirements=M([]);requirementStatuses=S(()=>this.validateRequirements(this.requirements(),this.deckState()));metCount=S(()=>this.requirementStatuses().filter(t=>t.isMet||t.isWarning).length);allMet=S(()=>{let t=this.requirementStatuses();return t.length===0||t.every(e=>e.isMet||e.isWarning)});constructor(){ne(()=>{let t=this.protocolId();t&&this.loadRequirements(t)})}ngOnInit(){}loadRequirements(t){this.isLoading.set(!0),this.simulationService.getInferredRequirements(t).subscribe({next:e=>{this.requirements.set(e),this.isLoading.set(!1)},error:e=>{console.error("[RequirementsPanel] Failed to load requirements:",e),this.requirements.set([]),this.isLoading.set(!1)}})}validateRequirements(t,e){return t.map(i=>{let a=!1,c=!1,d="";switch(i.requirement_type){case"resource_on_deck":i.resource&&(a=e.placedResources.has(i.resource),d=a?"Resource is placed":"Resource needs to be placed on deck");break;case"liquid_present":i.resource&&(e.placedResources.has(i.resource)?e.liquidConfirmed.has(i.resource)?(a=!0,d="Liquid confirmed"):(c=!0,d="Verify liquid is present before running"):(a=!1,d="Resource not yet placed"));break;case"tips_required":a=e.hasTipRack,d=a?"Tip rack available":"Tip rack needed";break;default:c=!0,d="Cannot verify automatically"}return{requirement:i,isMet:a,isWarning:c,message:d}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-requirements-panel"]],inputs:{protocolId:[1,"protocolId"],deckState:[1,"deckState"]},decls:10,vars:2,consts:[[1,"requirements-panel"],[1,"panel-header"],["diameter","16"],[1,"status-badge",3,"all-met"],[1,"empty-state"],[1,"status-badge"],[1,"requirements-list"],[3,"status"],[1,"warning-banner"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"mat-icon"),s(3,"checklist"),o(),r(4,"h3"),s(5,"Requirements"),o(),p(6,An,1,0,"mat-spinner",2)(7,zn,2,4,"span",3),o(),p(8,Nn,5,0,"div",4)(9,Bn,4,1),o()),e&2&&(l(6),u(i.isLoading()?6:7),l(2),u(i.requirements().length===0&&!i.isLoading()?8:9))},dependencies:[T,I,_e,ge,xe,we],styles:[".requirements-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;padding:16px;background:var(--sys-surface-container-low);border-radius:12px;border:1px solid var(--sys-outline-variant)}.panel-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;flex:1;font-size:.875rem;font-weight:600;color:var(--sys-on-surface)}.panel-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--sys-primary);width:20px;height:20px;font-size:20px}.status-badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:12px;font-size:.75rem;font-weight:500;background:var(--sys-error-container);color:var(--sys-on-error-container)}.status-badge.all-met[_ngcontent-%COMP%]{background:var(--sys-primary-container);color:var(--sys-on-primary-container)}.empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:16px;color:var(--sys-on-surface-variant);font-size:.875rem}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{opacity:.6}.requirements-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.warning-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 16px;background:color-mix(in srgb,var(--sys-error) 10%,var(--sys-surface));border-radius:8px;font-size:.75rem;color:var(--sys-error)}.warning-banner[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}"]})};var Gn=()=>({});function Wn(n,t){if(n&1){let e=v();r(0,"app-setup-instructions",18),h("allRequiredChecked",function(a){x(e);let c=m();return C(c.onAllRequiredInstructionsChecked(a))}),o()}if(n&2){let e,i=m();f("instructions",((e=i.protocol())==null?null:e.setup_instructions)??null)("showLegend",!0)}}function jn(n,t){if(n&1&&O(0,"app-requirements-panel",6),n&2){let e=m();f("protocolId",e.protocol().accession_id)("deckState",e.deckValidationState())}}function Hn(n,t){if(n&1){let e=v();r(0,"app-carrier-placement-step",19),h("carrierPlaced",function(a){x(e);let c=m();return C(c.onCarrierPlaced(a))}),o()}if(n&2){let e=m();f("carrierRequirements",e.wizardState.carrierRequirements())}}function Un(n,t){if(n&1){let e=v();r(0,"app-resource-placement-step",20),h("resourcePlaced",function(a){x(e);let c=m();return C(c.onResourcePlaced(a))}),o()}if(n&2){let e=m();f("assignments",e.wizardState.slotAssignments())}}function Qn(n,t){if(n&1){let e=v();r(0,"app-verification-step",21),h("confirmed",function(){x(e);let a=m();return C(a.onConfirm())}),o()}if(n&2){let e=m();f("carrierRequirements",e.wizardState.carrierRequirements())("slotAssignments",e.wizardState.slotAssignments())}}function Kn(n,t){if(n&1){let e=v();r(0,"app-deck-view",22),h("itemDropped",function(a){x(e);let c=m();return C(c.onDropOnDeck(a))}),o()}if(n&2){let e=m();f("resource",e.deckResource())("state",H(2,Gn))}}function Yn(n,t){if(n&1){let e=v();r(0,"button",23),h("click",function(){x(e);let a=m();return C(a.onBack())}),r(1,"mat-icon"),s(2,"arrow_back"),o(),s(3," Back "),o()}}function Xn(n,t){if(n&1){let e=v();r(0,"button",24),h("click",function(){x(e);let a=m();return C(a.onNext())}),s(1," Next "),r(2,"mat-icon"),s(3,"arrow_forward"),o()()}if(n&2){let e=m();f("disabled",!e.canProceed())}}function Zn(n,t){if(n&1){let e=v();r(0,"button",25),h("click",function(){x(e);let a=m();return C(a.onConfirm())}),r(1,"mat-icon"),s(2,"check"),o(),s(3," Confirm & Continue "),o()}}var at=class n{data=A(null);protocol=M(null);deckResource=M(null);setupComplete=j();setupSkipped=j();wizardState=F(We);dialog=F(Ie);dialogRef=F(ae,{optional:!0});deckValidationState=S(()=>{let t=new Set,e=new Set,i=!1,a=this.wizardState.carrierRequirements();for(let d of a)d.placed&&t.add(d.carrierFqn);let c=this.wizardState.slotAssignments();for(let d of c)d.placed&&d.resource&&(t.add(d.resource.name),d.resource.name.toLowerCase().includes("tip")&&(i=!0));return{placedResources:t,liquidConfirmed:e,hasTipRack:i}});dialogData=F(se,{optional:!0});constructor(){this.dialogData&&(this.protocol.set(this.dialogData.protocol),this.deckResource.set(this.dialogData.deckResource))}canProceed=S(()=>{let t=this.wizardState.currentStep();return t==="carrier-placement"?this.wizardState.allCarriersPlaced():t==="resource-placement"?this.wizardState.allResourcesPlaced():!0});ngOnInit(){let t=this.data();t&&!this.protocol()&&(this.protocol.set(t.protocol),this.deckResource.set(t.deckResource));let e=this.protocol();if(e){let i=t?.assetMap||{},a=t?.deckType||"HamiltonSTARDeck";this.wizardState.initialize(e,a,i)}}onCarrierPlaced(t){this.wizardState.markCarrierPlaced(t.carrierFqn,t.placed)}onResourcePlaced(t){this.wizardState.markResourcePlaced(t.resourceName,t.placed)}onNext(){this.wizardState.nextStep()}onBack(){this.wizardState.previousStep()}onSkip(){this.wizardState.skip(),this.setupSkipped.emit(),this.dialogRef?.close()}onConfirm(){this.wizardState.complete(),this.setupComplete.emit();let t={assetMap:this.wizardState.getAssetMap()};this.dialogRef?.close(t)}onDropOnDeck(t){if(t&&t.item&&t.item.data){let e=t.item.data;e&&e.resource&&this.onResourcePlaced({resourceName:e.resource.name,placed:!0})}}allRequiredInstructionsCompleted=M(!0);onAllRequiredInstructionsChecked(t){this.allRequiredInstructionsCompleted.set(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-deck-setup-wizard"]],inputs:{data:[1,"data"]},outputs:{setupComplete:"setupComplete",setupSkipped:"setupSkipped"},decls:23,vars:7,consts:[["cdkDropListGroup","",1,"wizard-container"],[1,"wizard-header"],["mode","determinate",3,"value"],[3,"instructions","showLegend"],[1,"wizard-content"],[1,"step-panel"],[3,"protocolId","deckState"],[3,"carrierRequirements"],[3,"assignments"],[3,"carrierRequirements","slotAssignments"],[1,"deck-preview"],[3,"resource","state"],[1,"wizard-footer"],["mat-stroked-button","","color","warn",3,"click"],[1,"spacer"],["mat-stroked-button",""],["mat-flat-button","","color","primary",3,"disabled"],["mat-flat-button","","color","primary"],[3,"allRequiredChecked","instructions","showLegend"],[3,"carrierPlaced","carrierRequirements"],[3,"resourcePlaced","assignments"],[3,"confirmed","carrierRequirements","slotAssignments"],[3,"itemDropped","resource","state"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-flat-button","","color","primary",3,"click"]],template:function(e,i){if(e&1&&(r(0,"div",0)(1,"div",1)(2,"h2")(3,"mat-icon"),s(4,"dashboard_customize"),o(),s(5," Guided Deck Setup "),o(),O(6,"mat-progress-bar",2),o(),p(7,Wn,1,2,"app-setup-instructions",3),r(8,"div",4)(9,"div",5),p(10,jn,1,2,"app-requirements-panel",6),p(11,Hn,1,1,"app-carrier-placement-step",7)(12,Un,1,1,"app-resource-placement-step",8)(13,Qn,1,2,"app-verification-step",9),o(),r(14,"div",10),p(15,Kn,1,3,"app-deck-view",11),o()(),r(16,"div",12)(17,"button",13),h("click",function(){return i.onSkip()}),s(18," Skip Setup "),o(),O(19,"div",14),p(20,Yn,4,0,"button",15),p(21,Xn,4,1,"button",16)(22,Zn,4,0,"button",17),o()()),e&2){let a,c,d;l(6),f("value",i.wizardState.progress()),l(),u(!((a=i.protocol())==null||a.setup_instructions==null)&&a.setup_instructions.length?7:-1),l(3),u((c=i.protocol())!=null&&c.accession_id?10:-1),l(),u((d=i.wizardState.currentStep())==="carrier-placement"?11:d==="resource-placement"?12:d==="verification"?13:-1),l(4),u(i.deckResource()?15:-1),l(5),u(i.wizardState.currentStep()!=="carrier-placement"?20:-1),l(),u(i.wizardState.currentStep()!=="verification"?21:22)}},dependencies:[tt,N,U,T,I,Ye,Ke,le,Ze,Ri,it,nt,ot,Oi,rt,Ee],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:hidden}.wizard-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;min-height:0}.wizard-header[_ngcontent-%COMP%]{padding:16px 24px;border-bottom:1px solid var(--sys-outline-variant);flex-shrink:0}.wizard-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:0 0 12px;color:var(--sys-on-surface)}.wizard-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:minmax(0,1fr);gap:24px;flex:1;padding:24px;overflow:hidden;min-height:0}.step-panel[_ngcontent-%COMP%]{overflow-y:auto;min-height:0;padding-right:8px}.deck-preview[_ngcontent-%COMP%]{background:var(--sys-surface-container);border-radius:8px;padding:16px;overflow:auto;min-height:0}.wizard-footer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px 24px;border-top:1px solid var(--sys-outline-variant);flex-shrink:0;background:var(--sys-surface);z-index:10}.spacer[_ngcontent-%COMP%]{flex:1}@media(max-width:992px){.wizard-content[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:auto 1fr;overflow-y:auto}.step-panel[_ngcontent-%COMP%]{flex:none;overflow:visible;max-height:400px;overflow-y:auto}.deck-preview[_ngcontent-%COMP%]{min-height:300px;flex:1}}"]})};var eo=(n,t)=>t.label;function to(n,t){if(n&1){let e=v();r(0,"button",8),h("click",function(a){x(e);let c=m();return C(c.clearQuery(a))}),r(1,"mat-icon"),s(2,"close"),o()()}}function io(n,t){if(n&1&&(r(0,"mat-icon",10),s(1),o()),n&2){let e=m().$implicit;l(),y(e.icon)}}function no(n,t){if(n&1&&(r(0,"mat-option",6)(1,"div",9),p(2,io,2,1,"mat-icon",10),r(3,"span",11),s(4),o()()()),n&2){let e=t.$implicit;f("value",e.value)("disabled",e.disabled),l(2),u(e.icon?2:-1),l(2),y(e.label)}}function oo(n,t){n&1&&(r(0,"mat-option",7),s(1,"No matches found"),o())}var st=class n{label="";set options(t){this._options.set(t||[])}get options(){return this._options()}disabled=!1;placeholder="Search...";cdr=F(Gt);_options=M([]);_currentValue=M(null);query=M("");constructor(){ne(()=>{let t=this._currentValue(),e=this._options();Dt(()=>{if(t!=null){let i=e.find(a=>this.compareValues(a.value,t));i&&this.query()!==i.label&&(this.query.set(i.label),this.cdr.markForCheck())}else this.query()!==""&&(this.query.set(""),this.cdr.markForCheck())})})}onChange=()=>{};onTouched=()=>{};filteredOptions=S(()=>{let t=this.query().toLowerCase(),e=this._options();return t?e.filter(i=>i.label.toLowerCase().includes(t)):e});displayFn=t=>{if(t==null)return"";let e=this.options.find(i=>this.compareValues(i.value,t));return e?e.label:typeof t=="string"?t:""};onQueryChange(t){this.query.set(t)}onOptionSelected(t){let e=t.option.value;this._currentValue.set(e);let i=this.options.find(a=>this.compareValues(a.value,e));i&&this.query.set(i.label),this.onChange(e),this.onTouched(),this.cdr.markForCheck()}clearQuery(t){t.stopPropagation(),this.query.set(""),this._currentValue.set(null),this.onChange(null)}writeValue(t){if(this._currentValue.set(t),t!=null){let e=this.options.find(i=>this.compareValues(i.value,t));e&&this.query.set(e.label)}else this.query.set("");this.cdr.markForCheck()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}compareValues(t,e){if(t===e)return!0;if(typeof t=="object"&&t!==null&&typeof e=="object"&&e!==null){let i=t,a=e;if(i.accession_id&&a.accession_id)return i.accession_id===a.accession_id;if(i.id&&a.id)return i.id===a.id}return!1}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-praxis-autocomplete"]],inputs:{label:"label",options:"options",disabled:"disabled",placeholder:"placeholder"},features:[Nt([{provide:ii,useExisting:Rt(()=>n),multi:!0}])],decls:10,vars:7,consts:[["auto","matAutocomplete"],["appearance","outline","subscriptSizing","dynamic",1,"praxis-select-field"],["matPrefix","",1,"search-icon"],["matInput","",3,"ngModelChange","placeholder","matAutocomplete","ngModel","disabled"],["mat-icon-button","","matSuffix",""],["panelClass","praxis-select-panel",3,"optionSelected","displayWith"],[3,"value","disabled"],["disabled",""],["mat-icon-button","","matSuffix","",3,"click"],[1,"praxis-option-content"],[1,"option-icon"],[1,"option-label"]],template:function(e,i){if(e&1){let a=v();r(0,"mat-form-field",1)(1,"mat-icon",2),s(2,"search"),o(),r(3,"input",3),h("ngModelChange",function(d){return x(a),C(i.onQueryChange(d))}),o(),p(4,to,3,0,"button",4),r(5,"mat-autocomplete",5,0),h("optionSelected",function(d){return x(a),C(i.onOptionSelected(d))}),k(7,no,5,4,"mat-option",6,eo),p(9,oo,2,0,"mat-option",7),o()()}if(e&2){let a=Ft(6);l(3),f("placeholder",i.placeholder)("matAutocomplete",a)("ngModel",i.query())("disabled",i.disabled),l(),u(i.query()&&!i.disabled?4:-1),l(),f("displayWith",i.displayFn),l(2),w(i.filteredOptions()),l(2),u(i.filteredOptions().length===0&&i.query()?9:-1)}},dependencies:[G,K,ce,te,Ae,Qi,Hi,Je,Ui,fe,ue,me,si,li,pe,T,I,N,Oe],encapsulation:2,changeDetection:0})};var ao=()=>[],so=(n,t)=>t.accession_id;function lo(n,t){if(n&1&&(r(0,"h2",0),s(1),o()),n&2){let e=m();l(),b("Deck Setup: ",e.data==null||e.data.protocol==null?null:e.data.protocol.name)}}function co(n,t){n&1&&(r(0,"p",1),s(1," Please assign inventory items to the required assets for this protocol. We've auto-selected matches where possible. "),o())}function mo(n,t){n&1&&(r(0,"div",2)(1,"mat-icon",5),s(2,"sync"),o(),r(3,"span"),s(4,"Loading inventory..."),o()())}function po(n,t){n&1&&(r(0,"div",3)(1,"mat-icon"),s(2,"inventory_2"),o(),r(3,"span"),s(4,"No resources in inventory. Add resources from the Assets page first."),o()())}function uo(n,t){n&1&&(r(0,"mat-icon",15),s(1,"check"),o())}function fo(n,t){if(n&1&&s(0),n&2){let e=m().$index;b(" ",e+1," ")}}function go(n,t){n&1&&(r(0,"span",19)(1,"mat-icon",29),s(2,"auto_awesome"),o(),s(3," Auto "),o())}function _o(n,t){}function ho(n,t){n&1&&(r(0,"span",20),s(1,"Optional"),o())}function xo(n,t){if(n&1&&(r(0,"span",22),s(1),o()),n&2){let e=m().$implicit,i=m(2);l(),y(i.getShortFqn(e.fqn))}}function Co(n,t){n&1&&s(0," Select Item ")}function yo(n,t){n&1&&s(0," \xA0 ")}function vo(n,t){if(n&1){let e=v();r(0,"button",30),h("click",function(){x(e);let a=m().$implicit,c=m(2);return C(c.clearAsset(a))}),r(1,"mat-icon"),s(2,"cancel"),o()()}n&2&&f("matTooltipShowDelay",600)}function bo(n,t){}function So(n,t){if(n&1){let e=v();r(0,"div",13)(1,"div",14),p(2,uo,2,0,"mat-icon",15)(3,fo,1,1),o(),r(4,"div",16)(5,"div",17)(6,"span",18),s(7),o(),p(8,go,4,0,"span",19)(9,_o,0,0),p(10,ho,2,0,"span",20),o(),r(11,"span",21),s(12),o(),p(13,xo,2,1,"span",22),o(),r(14,"div",23)(15,"label",24),p(16,Co,1,0)(17,yo,1,0),o(),r(18,"div",25)(19,"app-praxis-autocomplete",26),h("ngModelChange",function(a){let c=x(e).$implicit,d=m(2);return C(d.updateSelection(c.accession_id,a))}),o(),r(20,"button",27),h("click",function(){let a=x(e).$implicit,c=m(2);return C(c.autoFillAsset(a))}),r(21,"mat-icon"),s(22,"auto_fix_high"),o()(),p(23,vo,3,1,"button",28),o(),p(24,bo,0,0),o()()}if(n&2){let e=t.$implicit,i=t.$index,a=m(2);R("current",i===a.currentIndex())("completed",a.selectedAssets()[e.accession_id])("autofilled",a.isAutofilled(e.accession_id))("pending",!a.selectedAssets()[e.accession_id]&&i>a.currentIndex()),f("matTooltip",a.getAssetTooltip(e))("matTooltipShowDelay",600),l(),R("active",i===a.currentIndex())("completed",a.selectedAssets()[e.accession_id]),l(),u(a.selectedAssets()[e.accession_id]?2:3),l(5),y(e.name),l(),u(a.isAutofilled(e.accession_id)?8:a.selectedAssets()[e.accession_id]?9:-1),l(2),u(e.optional?10:-1),l(2),y(e.type_hint_str||"Generic Resource"),l(),u(e.fqn?13:-1),l(3),u(i===a.currentIndex()&&!a.selectedAssets()[e.accession_id]?16:17),l(3),f("options",a.requirementsOptions()[e.accession_id]||H(27,ao))("ngModel",a.selectedAssets()[e.accession_id])("placeholder","Search inventory..."),l(),f("matTooltipShowDelay",600),l(3),u(a.selectedAssets()[e.accession_id]?23:-1),l(),u(!e.optional&&!a.selectedAssets()[e.accession_id]?24:-1)}}function Mo(n,t){if(n&1){let e=v();r(0,"div",6)(1,"button",7),h("click",function(){x(e);let a=m();return C(a.autoFillAll())}),r(2,"mat-icon"),s(3,"auto_fix_high"),o(),s(4," Auto-fill All "),o(),r(5,"button",8),h("click",function(){x(e);let a=m();return C(a.clearAll())}),r(6,"mat-icon"),s(7,"clear_all"),o(),s(8," Clear All "),o()(),r(9,"div",9),k(10,So,25,28,"div",10,so),o(),r(12,"div",11)(13,"div",12)(14,"mat-icon"),s(15,"auto_awesome"),o(),r(16,"span"),s(17),o()(),r(18,"div",12)(19,"mat-icon"),s(20),o(),r(21,"span"),s(22),o()()()}if(n&2){let e=m();l(5),f("disabled",!e.hasSelections()),l(5),w(e.requiredAssets),l(4),R("text-green",e.autofilledCount()>0),l(3),b("",e.autofilledCount()," auto-filled"),l(2),R("text-amber",e.unassignedCount()>0)("text-green",e.unassignedCount()===0),l(),b(" ",e.unassignedCount()===0?"check_circle":"warning"," "),l(2),b("",e.unassignedCount()," unassigned")}}function Po(n,t){if(n&1){let e=v();r(0,"mat-dialog-actions",4)(1,"button",31),s(2,"Cancel"),o(),r(3,"button",32),h("click",function(){x(e);let a=m();return C(a.confirm())}),s(4," Confirm Setup "),o()()}if(n&2){let e=m();l(3),f("disabled",!e.isValid())}}var lt=class n{constructor(t){this.data=t}assetService=F(ie);dialogRef=F(ae,{optional:!0});protocol=null;isInline=!1;initialSelections={};excludeAssetIds=[];selectionChange=new X;inventory=M([]);selectedAssets=M({});autofilledIds=M(new Set);isLoading=M(!0);currentIndex=M(0);get requiredAssets(){let e=(this.protocol||this.data?.protocol)?.assets||[];return this.excludeAssetIds.length>0?e.filter(i=>!this.excludeAssetIds.includes(i.accession_id)):e}requirementsOptions=S(()=>{let t={},e=this.inventory();return this.requiredAssets.forEach(i=>{t[i.accession_id]=this.generateOptionsForReq(i,e)}),t});autofilledCount=S(()=>{let t=0,e=this.autofilledIds(),i=this.selectedAssets();for(let a of e)i[a]&&t++;return t});unassignedCount=S(()=>this.requiredAssets.filter(t=>!t.optional&&!this.selectedAssets()[t.accession_id]).length);hasSelections=S(()=>Object.values(this.selectedAssets()).some(t=>!!t));ngOnInit(){this.initialSelections&&Object.keys(this.initialSelections).length>0&&this.selectedAssets.set(D({},this.initialSelections)),this.assetService.getResources().subscribe({next:t=>{this.inventory.set(t),this.autoSelect(),this.isLoading.set(!1)},error:t=>{console.error("Failed to load inventory:",t),this.isLoading.set(!1)}})}autoSelect(){let t=this.selectedAssets(),e=D({},t),i=new Set(this.autofilledIds()),a=new Set;Object.values(t).forEach(d=>{d&&a.add(d.accession_id)}),this.requiredAssets.forEach(d=>{if(e[d.accession_id])return;let _=this.getBestMatch(d,a);_?(e[d.accession_id]=_,a.add(_.accession_id),i.add(d.accession_id)):e[d.accession_id]=null}),this.selectedAssets.set(e),this.autofilledIds.set(i);let c=this.requiredAssets.findIndex(d=>!e[d.accession_id]);c!==-1?this.currentIndex.set(c):this.currentIndex.set(this.requiredAssets.length),this.isInline&&this.isValid()&&this.selectionChange.emit(e)}getBestMatch(t,e){let i=this.getCompatibleResources(t);return[...i.filter(d=>this.isExactMatch(t,d)),...i.filter(d=>!this.isExactMatch(t,d))].find(d=>!e.has(d.accession_id))||null}getCompatibleResources(t){let e=(t.fqn||"").toLowerCase(),i=(t.type_hint_str||"").toLowerCase(),a=this.getClassName(e);return this.inventory().filter(c=>{let d=(c.fqn||"").toLowerCase(),_=this.getClassName(d);return this.getResourceCategory(c)==="Carrier"&&t.required_plr_category&&t.required_plr_category!=="Carrier"?!1:!!(d&&e&&d===e||_&&a&&_===a||i&&_&&_.includes(i)||this.matchesByCategory(t,c))})}getClassName(t){if(!t)return"";let e=t.split(".");return e[e.length-1]||""}getResourceCategory(t){if(t.plr_definition&&typeof t.plr_definition=="object"){let i=t.plr_definition.category;if(i&&typeof i=="string")return i}if(!t.fqn)return null;let e=t.fqn.toLowerCase();return e.includes("plate")&&!e.includes("carrier")&&!e.includes("reader")?"Plate":e.includes("tiprack")||e.includes("tip")&&e.includes("rack")?"TipRack":e.includes("trough")||e.includes("reservoir")?"Trough":e.includes("carrier")?"Carrier":e.includes("tube")&&!e.includes("rack")?"Tube":e.includes("tuberack")||e.includes("tube")&&e.includes("rack")?"TubeRack":null}matchesByCategory(t,e){if(t.required_plr_category){let i=this.getResourceCategory(e);return i?i.toLowerCase()===t.required_plr_category.toLowerCase():!1}return!1}isExactMatch(t,e){let i=(t.fqn||"").toLowerCase(),a=(e.fqn||"").toLowerCase();if(a&&i&&a===i)return!0;let c=this.getClassName(i),d=this.getClassName(a);return!!(d&&c&&d===c)}getExactMatches(t){return this.getCompatibleResources(t).filter(e=>this.isExactMatch(t,e))}getOtherCompatible(t){return this.getCompatibleResources(t).filter(e=>!this.isExactMatch(t,e))}isAutofilled(t){return this.autofilledIds().has(t)&&!!this.selectedAssets()[t]}getShortFqn(t){return t?t.split(".").slice(-2).join("."):""}getAssetTooltip(t){let e=this.selectedAssets()[t.accession_id],i=`Requirement: ${t.name}`;return i+=`
Type: ${t.type_hint_str||"Generic Resource"}`,t.fqn&&(i+=`
FQN: ${t.fqn}`),e?(i+=`

--- Selection ---`,i+=`
Name: ${e.name}`,e.fqn&&(i+=`
FQN: ${e.fqn}`),i+=`
Status: ${this.isAutofilled(t.accession_id)?"Auto-matched":"Confirmed"}`):i+=`

Status: Unassigned`,i}generateOptionsForReq(t,e){let i=this.getCompatibleResourcesForInventory(t,e),a=[],c=[];i.forEach(_=>{this.isExactMatch(t,_)?a.push(_):c.push(_)});let d=[];return a.forEach(_=>d.push({label:`${_.name} (${_.accession_id.substring(0,6)})`,value:_,icon:"recommend"})),c.forEach(_=>d.push({label:`${_.name} (${_.accession_id.substring(0,6)})`,value:_})),d}getCompatibleResourcesForInventory(t,e){let i=(t.fqn||"").toLowerCase(),a=(t.type_hint_str||"").toLowerCase(),c=this.getClassName(i);return e.filter(d=>{let _=(d.fqn||"").toLowerCase(),g=this.getClassName(_);return _.includes("carrier")||g.toLowerCase().includes("carrier")?!1:!!(_&&i&&_===i||g&&c&&g===c||a&&g&&g.includes(a)||this.matchesByCategory(t,d))})}updateSelection(t,e){if(this.selectedAssets.update(i=>q(D({},i),{[t]:e})),this.isInline&&this.selectionChange.emit(this.selectedAssets()),this.autofilledIds().has(t)&&this.autofilledIds.update(i=>{let a=new Set(i);return a.delete(t),a}),e){let i=this.requiredAssets.findIndex(a=>a.accession_id===t);if(i===this.currentIndex()){let a=this.requiredAssets.findIndex((c,d)=>d>i&&!this.selectedAssets()[c.accession_id]);a!==-1&&this.currentIndex.set(a)}}}isValid(){return this.requiredAssets.every(t=>t.optional?!0:!!this.selectedAssets()[t.accession_id])}confirm(){let t={assetMap:this.selectedAssets()};this.selectionChange.emit(t.assetMap),this.dialogRef&&this.dialogRef.close(t)}clearAsset(t){this.updateSelection(t.accession_id,null)}autoFillAll(){this.autoSelect()}clearAll(){let t={};this.requiredAssets.forEach(e=>{t[e.accession_id]=null}),this.selectedAssets.set(t),this.autofilledIds.set(new Set),this.isInline&&this.selectionChange.emit(t)}autoFillAsset(t){let e=this.selectedAssets(),i=new Set;Object.values(e).forEach(c=>{c&&i.add(c.accession_id)});let a=this.getBestMatch(t,i);a&&(this.updateSelection(t.accession_id,a),this.autofilledIds.update(c=>{let d=new Set(c);return d.add(t.accession_id),d}))}compareResources(t,e){return t&&e?t.accession_id===e.accession_id:t===e}static \u0275fac=function(e){return new(e||n)(oe(se,8))};static \u0275cmp=P({type:n,selectors:[["app-guided-setup"]],inputs:{protocol:"protocol",isInline:[2,"isInline","isInline",Wt],initialSelections:"initialSelections",excludeAssetIds:"excludeAssetIds"},outputs:{selectionChange:"selectionChange"},decls:7,vars:6,consts:[["mat-dialog-title",""],[1,"description"],[1,"loading-state"],[1,"empty-state"],["align","end"],[1,"animate-spin"],[1,"list-actions"],["mat-stroked-button","",3,"click"],["mat-button","",3,"click","disabled"],[1,"requirements-list"],[1,"requirement-item",3,"matTooltip","matTooltipShowDelay","current","completed","autofilled","pending"],[1,"summary"],[1,"summary-item"],[1,"requirement-item",3,"matTooltip","matTooltipShowDelay"],[1,"order-badge"],[2,"font-size","18px","width","18px","height","18px"],[1,"req-info"],[1,"req-header"],[1,"req-name"],[1,"autofill-badge"],[1,"optional-badge"],[1,"req-type"],[1,"req-fqn"],[1,"resource-select"],[1,"text-xs","font-medium","text-gray-500","mb-1","block"],[1,"resource-select-field"],[3,"ngModelChange","options","ngModel","placeholder"],["mat-icon-button","","matTooltip","Auto-select matching item",1,"autofill-btn",3,"click","matTooltipShowDelay"],["mat-icon-button","","matTooltip","Clear selection",1,"clear-asset-btn",3,"matTooltipShowDelay"],[1,"autofill-icon"],["mat-icon-button","","matTooltip","Clear selection",1,"clear-asset-btn",3,"click","matTooltipShowDelay"],["mat-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(e,i){e&1&&(p(0,lo,2,1,"h2",0),r(1,"mat-dialog-content"),p(2,co,2,0,"p",1),p(3,mo,5,0,"div",2)(4,po,5,0,"div",3)(5,Mo,23,10),o(),p(6,Po,5,1,"mat-dialog-actions",4)),e&2&&(u(i.isInline?-1:0),l(),R("inline-content",i.isInline),l(),u(i.isInline?-1:2),l(),u(i.isLoading()?3:i.inventory().length===0?4:5),l(3),u(i.isInline?-1:6))},dependencies:[le,Xt,Zt,ei,Jt,N,U,Oe,et,T,I,W,ee,he,K,te,Ae,st],styles:[".description[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant);margin-bottom:24px}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;gap:16px;color:var(--sys-on-surface-variant)}.inline-content[_ngcontent-%COMP%]{padding:0!important;max-height:none!important;overflow:visible!important}.loading-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.requirements-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.list-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px;margin-bottom:12px;padding-right:4px}.requirement-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr 240px;gap:16px;align-items:center;padding:12px 16px;background:var(--sys-surface-container);border-radius:12px;border:2px solid transparent;transition:all .2s ease}.requirement-item.autofilled[_ngcontent-%COMP%]{border-color:var(--theme-status-success-border);background:var(--theme-status-success-muted)}.requirement-item.assigned[_ngcontent-%COMP%]{border-color:var(--theme-status-info-border);background:var(--theme-status-info-muted)}.requirement-item.unassigned[_ngcontent-%COMP%]{border-color:var(--theme-status-warning-border);background:var(--theme-status-warning-muted)}.req-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.req-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.req-name[_ngcontent-%COMP%]{font-weight:600;font-size:1rem}.autofill-badge[_ngcontent-%COMP%], .set-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;font-size:.7rem;font-weight:600;text-transform:uppercase;padding:2px 8px;border-radius:12px}.autofill-badge[_ngcontent-%COMP%]{background:var(--theme-status-success-muted);color:var(--theme-status-success)}.set-badge[_ngcontent-%COMP%]{background:var(--theme-status-info-muted);color:var(--theme-status-info)}.autofill-icon[_ngcontent-%COMP%], .set-icon[_ngcontent-%COMP%]{font-size:14px!important;width:14px!important;height:14px!important}.requirement-item.current[_ngcontent-%COMP%]{background:var(--sys-tertiary-container);border-color:var(--sys-tertiary);transform:scale(1.01);box-shadow:0 4px 12px #0000001a}.requirement-item.completed[_ngcontent-%COMP%]{background:var(--sys-surface-container-low);border-color:var(--sys-outline-variant);opacity:.9}.requirement-item.completed.autofilled[_ngcontent-%COMP%]{background:var(--theme-status-success-muted);border-color:var(--theme-status-success-border)}.requirement-item.pending[_ngcontent-%COMP%]{opacity:.7}.order-badge[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;background:var(--sys-surface-container-high);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.875rem;flex-shrink:0;transition:all .2s ease}.order-badge.active[_ngcontent-%COMP%]{background:var(--sys-tertiary);color:var(--sys-on-tertiary)}.order-badge.completed[_ngcontent-%COMP%]{background:var(--sys-primary);color:var(--sys-on-primary)}.requirement-item.autofilled[_ngcontent-%COMP%]   .order-badge.completed[_ngcontent-%COMP%]{background:var(--sys-green);background:#22c55e}.optional-badge[_ngcontent-%COMP%]{font-size:.7rem;font-weight:500;text-transform:uppercase;padding:2px 8px;border-radius:12px;background:var(--sys-surface-variant);color:var(--sys-on-surface-variant)}.req-type[_ngcontent-%COMP%]{font-size:.85em;color:var(--sys-on-surface-variant)}.req-fqn[_ngcontent-%COMP%]{font-size:.75em;color:var(--sys-outline);font-family:monospace}.resource-select[_ngcontent-%COMP%]{min-width:240px}.resource-select-field[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.resource-select-field[_ngcontent-%COMP%]   app-praxis-autocomplete[_ngcontent-%COMP%]{flex:1}.autofill-btn[_ngcontent-%COMP%]{color:#22c55e;opacity:.7;transition:all .2s ease}.autofill-btn[_ngcontent-%COMP%]:hover{opacity:1;background:var(--theme-status-success-muted)}.clear-asset-btn[_ngcontent-%COMP%]{color:var(--sys-outline);opacity:.7;transition:all .2s ease}.clear-asset-btn[_ngcontent-%COMP%]:hover{opacity:1;color:var(--sys-error);background:var(--sys-error-container)}mat-form-field[_ngcontent-%COMP%]{margin-bottom:-1.25em}.option-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.option-name[_ngcontent-%COMP%]{flex:1}.option-id[_ngcontent-%COMP%]{font-size:.8em;opacity:.6}.match-icon[_ngcontent-%COMP%]{font-size:16px!important;width:16px!important;height:16px!important;color:#22c55e}.suggested-icon[_ngcontent-%COMP%]{font-size:16px!important;width:16px!important;height:16px!important;color:#fbbf24;margin-right:4px}  .suggested-group .mat-mdc-optgroup-label{color:#22c55e!important;font-weight:600}  .suggested-option{background:var(--theme-status-success-muted)!important}.summary[_ngcontent-%COMP%]{display:flex;gap:24px;justify-content:center;margin-top:24px;padding-top:16px;border-top:1px solid var(--sys-outline-variant)}.summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9rem;color:var(--sys-on-surface-variant)}.summary-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.text-green[_ngcontent-%COMP%]{color:var(--theme-status-success)!important}.text-amber[_ngcontent-%COMP%]{color:var(--theme-status-warning)!important}  .mat-mdc-tooltip .mdc-tooltip__body{white-space:pre-line!important;padding:8px 12px!important;line-height:1.4!important}"]})};var wo=(n,t,e)=>({"bg-blue-400/20 border-blue-400/40 text-blue-400":n,"bg-green-400/20 border-green-400/40 text-green-400":t,"bg-purple-400/20 border-purple-400/40 text-purple-400":e}),ct=class n{isSimulated=A(!1);isTemplate=A(!1);static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-hardware-badge"]],inputs:{isSimulated:[1,"isSimulated"],isTemplate:[1,"isTemplate"]},decls:4,vars:7,consts:[[1,"flex","items-center","gap-1.5","px-3","py-1.5","rounded-full","border","text-[11px]","font-extrabold","uppercase","tracking-widest","w-fit","select-none","backdrop-blur-md","shadow-sm",3,"ngClass"],[1,"!w-3","!h-3","!text-[12px]"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"mat-icon",1),s(2),o(),s(3),o()),e&2&&(f("ngClass",Vt(3,wo,i.isSimulated()&&!i.isTemplate(),!i.isSimulated(),i.isTemplate())),l(2),b(" ",i.isTemplate()?"auto_awesome":i.isSimulated()?"vibration":"precision_manufacturing"," "),l(),b(" ",i.isTemplate()?"Template":i.isSimulated()?"Simulated":"Physical"," "))},dependencies:[G,jt,T,I],encapsulation:2,changeDetection:0})};var Eo=(n,t)=>t.capability_name;function Ro(n,t){if(n&1&&(r(0,"li"),s(1),o()),n&2){let e=t.$implicit;l(),b("Missing: ",e.capability_name)}}function Do(n,t){if(n&1&&(r(0,"div",9)(1,"p",11),s(2,"Incompatible"),o(),r(3,"ul",12),k(4,Ro,2,1,"li",null,Eo),o()()),n&2){let e=m(2);l(4),w(e.machineCompatibility().compatibility.missing_capabilities)}}function To(n,t){if(n&1&&(r(0,"li"),s(1),o()),n&2){let e=t.$implicit;l(),y(e)}}function qo(n,t){if(n&1&&(r(0,"div",10)(1,"p",13),s(2,"Warnings"),o(),r(3,"ul",14),k(4,To,2,1,"li",null,J),o()()),n&2){let e=m(2);l(4),w(e.machineCompatibility().compatibility.warnings)}}function Oo(n,t){if(n&1&&p(0,Do,6,0,"div",9)(1,qo,6,0,"div",10),n&2){let e,i=m();u(!((e=i.machineCompatibility())==null||e.compatibility==null)&&e.compatibility.is_compatible?i.machineCompatibility().compatibility.warnings.length>0?1:-1:0)}}function Io(n,t){n&1&&(r(0,"div",9)(1,"p",15),s(2,"Not available for Physical mode"),o()())}var dt=class n{machine=A(null);machineCompatibility=A(null);selected=A(!1);isPhysicalMode=A(!1);cardClick=j();getMachine(){if(this.machine())return this.machine();if(this.machineCompatibility())return this.machineCompatibility().machine;throw new Error("MachineCard must provide either machine or machineCompatibility input")}isSimulated(){let t=this.getMachine();if(!t)return!1;let i=((t.connection_info||{}).backend||"").toString(),a=t.type||"";return t.is_simulation_override===!0||t.is_simulated===!0||i.includes("Simulator")||i.includes("Simulation")||a.toLowerCase().includes("simulator")}isTemplate(){return this.getMachine().is_template===!0}onClick(){this.cardClick.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-machine-card"]],inputs:{machine:[1,"machine"],machineCompatibility:[1,"machineCompatibility"],selected:[1,"selected"],isPhysicalMode:[1,"isPhysicalMode"]},outputs:{cardClick:"cardClick"},decls:14,vars:20,consts:[[1,"machine-card","relative","border-[1.5px]","rounded-2xl","p-6","cursor-pointer","transition-all","duration-300","group","hover:-translate-y-1.5","hover:shadow-2xl","hover:shadow-primary/10","h-full","backdrop-blur-xl","flex","flex-col",3,"click"],[1,"machine-card-header","mb-3"],[1,"status-indicator"],[3,"isSimulated","isTemplate"],[1,"card-content","flex-grow"],[1,"text-lg","font-bold","text-sys-text-primary","group-hover:text-primary","transition-colors"],[1,"text-[10px]","font-bold","uppercase","tracking-widest","text-sys-text-tertiary","block","mt-1"],[1,"text-xs","text-sys-text-secondary","block","mt-0.5","opacity-60"],[1,"card-actions","mt-auto"],[1,"mt-4","p-3","bg-red-400/10","rounded-lg","border","border-red-400/20"],[1,"mt-4","p-3","bg-amber-400/10","rounded-lg","border","border-amber-400/20"],[1,"text-sm","text-red-400","font-medium","mb-1"],[1,"text-xs","text-red-400/70","list-disc","pl-4","space-y-1"],[1,"text-sm","text-amber-500","font-medium","mb-1"],[1,"text-xs","text-amber-600/70","list-disc","pl-4","space-y-1"],[1,"text-sm","text-red-400","font-medium"]],template:function(e,i){if(e&1&&(r(0,"div",0),h("click",function(){return i.onClick()}),r(1,"div",1)(2,"div",2),O(3,"app-hardware-badge",3),o()(),r(4,"div",4)(5,"h3",5),s(6),o(),r(7,"span",6),s(8),o(),r(9,"span",7),s(10),o()(),r(11,"div",8),p(12,Oo,2,1),p(13,Io,3,0,"div",9),o()()),e&2){let a;R("border-outline",!i.selected())("border-primary",i.selected())("selected-bg",i.selected())("opacity-60",i.machineCompatibility()&&!(!((a=i.machineCompatibility())==null||a.compatibility==null)&&a.compatibility.is_compatible))("opacity-40",i.isPhysicalMode()&&i.isSimulated())("grayscale",i.isPhysicalMode()&&i.isSimulated()),l(3),f("isSimulated",i.isSimulated())("isTemplate",i.isTemplate()),l(3),y(i.getMachine().name),l(2),y(i.getMachine().machine_category||"Laboratory Machine"),l(2),B("",i.getMachine().manufacturer," ",i.getMachine().model),l(2),u(i.machineCompatibility()?12:-1),l(),u(i.isPhysicalMode()&&i.isSimulated()?13:-1)}},dependencies:[G,T,N,W,ct],styles:['.machine-card[_ngcontent-%COMP%]{min-height:160px;border-color:var(--mat-sys-outline-variant);background:linear-gradient(135deg,var(--mat-sys-surface) 0%,var(--mat-sys-surface-container-low) 100%);position:relative;overflow:hidden}.machine-card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at center,var(--mat-sys-primary-container) 0%,transparent 70%);opacity:.05;pointer-events:none;transition:opacity .3s ease}.machine-card[_ngcontent-%COMP%]:hover:before{opacity:.1}.machine-card.border-outline[_ngcontent-%COMP%]{border-color:var(--mat-sys-outline-variant)}.machine-card.border-primary[_ngcontent-%COMP%]{border-color:var(--mat-sys-primary);box-shadow:0 0 15px -5px var(--mat-sys-primary)}.machine-card.selected-bg[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--mat-sys-primary-container) 0%,var(--mat-sys-surface-container-low) 100%)}.machine-card-header[_ngcontent-%COMP%]{display:flex;align-items:center;min-height:32px}.status-indicator[_ngcontent-%COMP%]{flex-shrink:0;margin-right:8px;display:flex;align-items:center}.border-primary[_ngcontent-%COMP%]{border-color:var(--sys-primary, #6366f1)}'],changeDetection:0})};var Fo=(n,t)=>t.machine.accession_id;function Ao(n,t){if(n&1){let e=v();r(0,"app-machine-card",3),h("cardClick",function(){let a=x(e).$implicit,c=m();return C(c.selectMachine(a))}),o()}if(n&2){let e,i=t.$implicit,a=m();f("machineCompatibility",i)("selected",((e=a.selected())==null||e.machine==null?null:e.machine.accession_id)===i.machine.accession_id)("isPhysicalMode",a.isPhysicalMode())}}function zo(n,t){n&1&&(r(0,"div",2)(1,"mat-icon",4),s(2,"desktop_access_disabled"),o(),r(3,"p"),s(4,"No machines found."),o()())}var mt=class n{machines=A([]);selected=A(null);isPhysicalMode=A(!1);select=j();selectMachine(t){if(t.compatibility.is_compatible){if(this.isPhysicalMode()&&this.isSimulated(t.machine))return;this.select.emit(t)}}isSimulated(t){if(t.backend_definition?.backend_type==="simulator")return!0;let i=((t.connection_info||{}).backend||"").toString();return t.is_simulation_override===!0||t.is_simulated===!0||i.includes("Simulator")||i.includes("simulation")||i.includes("Chatterbox")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-machine-selection"]],inputs:{machines:[1,"machines"],selected:[1,"selected"],isPhysicalMode:[1,"isPhysicalMode"]},outputs:{select:"select"},decls:4,vars:1,consts:[[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[3,"machineCompatibility","selected","isPhysicalMode"],[1,"flex","flex-col","items-center","justify-center","py-12","opacity-50","text-sys-text-tertiary"],[3,"cardClick","machineCompatibility","selected","isPhysicalMode"],[1,"!w-12","!h-12","!text-[48px]","mb-4"]],template:function(e,i){e&1&&(r(0,"div",0),k(1,Ao,1,3,"app-machine-card",1,Fo),o(),p(3,zo,5,0,"div",2)),e&2&&(l(),w(i.machines()),l(2),u(i.machines().length===0?3:-1))},dependencies:[N,T,I,W,Qe,dt],encapsulation:2,changeDetection:0})};var No=(n,t)=>t.requirement.accession_id,tn=(n,t)=>t.accession_id;function Vo(n,t){n&1&&(r(0,"mat-icon"),s(1,"check_circle"),o())}function Lo(n,t){n&1&&(r(0,"mat-icon"),s(1,"error"),o())}function Bo(n,t){n&1&&(r(0,"mat-icon"),s(1,"radio_button_unchecked"),o())}function $o(n,t){n&1&&(r(0,"span",13),s(1,"Simulated"),o())}function Go(n,t){if(n&1&&(r(0,"span",10),s(1),p(2,$o,2,0,"span",13),o()),n&2){let e=m().$implicit,i=m();l(),b(" ",(e.selection==null||e.selection.selectedMachine==null?null:e.selection.selectedMachine.name)||i.getBackendDisplayName(e.selection==null?null:e.selection.selectedBackend)," "),l(),u((e.selection==null||e.selection.selectedBackend==null?null:e.selection.selectedBackend.backend_type)==="simulator"?2:-1)}}function Wo(n,t){n&1&&(r(0,"div",12),O(1,"mat-spinner",14),r(2,"span"),s(3,"Loading options..."),o()())}function jo(n,t){n&1&&(r(0,"span",25),s(1,"Sim"),o())}function Ho(n,t){n&1&&(r(0,"span",26),s(1,"Real"),o())}function Uo(n,t){if(n&1&&(r(0,"span",27),s(1," Mismatch "),o()),n&2){let e=m().$implicit;f("matTooltip","Available in "+(e.is_simulation_override?"simulation":"hardware")+" mode only")}}function Qo(n,t){if(n&1){let e=v();r(0,"div",20),h("click",function(){let a=x(e).$implicit,c=m(3).$implicit,d=m();return C(d.isMachineCompatible(a)&&d.selectMachine(c,a))}),r(1,"div",21)(2,"mat-icon"),s(3,"precision_manufacturing"),o()(),r(4,"div",22)(5,"span",23),s(6),o(),r(7,"span",24),s(8),o()(),p(9,jo,2,0,"span",25)(10,Ho,2,0,"span",26),p(11,Uo,2,1,"span",27),o()}if(n&2){let e=t.$implicit,i=m(3).$implicit,a=m();R("selected",(i.selection==null||i.selection.selectedMachine==null?null:i.selection.selectedMachine.accession_id)===e.accession_id)("disabled",!a.isMachineCompatible(e)),l(6),y(e.name),l(2),y(e.machine_category),l(),u(e.is_simulation_override?9:10),l(2),u(a.isMachineCompatible(e)?-1:11)}}function Ko(n,t){if(n&1&&(r(0,"div",15)(1,"h4",17)(2,"mat-icon"),s(3,"inventory"),o(),s(4," Existing Machines "),o(),r(5,"div",18),k(6,Qo,12,8,"div",19,tn),o()()),n&2){let e=m(2).$implicit,i=m();l(6),w(i.getFilteredMachines(e))}}function Yo(n,t){n&1&&(r(0,"span",25),s(1,"Sim"),o())}function Xo(n,t){n&1&&(r(0,"span",26),s(1,"Hardware"),o())}function Zo(n,t){if(n&1&&(r(0,"span",27),s(1," Mismatch "),o()),n&2){let e=m().$implicit;f("matTooltip","Available in "+(e.backend_type==="simulator"?"simulation":"hardware")+" mode only")}}function Jo(n,t){if(n&1){let e=v();r(0,"div",29),h("click",function(){let a=x(e).$implicit,c=m(3).$implicit,d=m();return C(d.isBackendCompatible(a)&&d.selectBackend(c,a))}),r(1,"div",21)(2,"mat-icon"),s(3),o()(),r(4,"div",22)(5,"span",23),s(6),o(),r(7,"span",24),s(8),o()(),p(9,Yo,2,0,"span",25)(10,Xo,2,0,"span",26),p(11,Zo,2,1,"span",27),o()}if(n&2){let e=t.$implicit,i=m(3).$implicit,a=m();R("selected",(i.selection==null||i.selection.selectedBackend==null?null:i.selection.selectedBackend.accession_id)===e.accession_id)("disabled",!a.isBackendCompatible(e)),l(),R("sim",e.backend_type==="simulator"),l(2),y(e.backend_type==="simulator"?"science":"cable"),l(3),y(a.getBackendDisplayName(e)),l(2),y(e.manufacturer||"PyLabRobot"),l(),u(e.backend_type==="simulator"?9:10),l(2),u(a.isBackendCompatible(e)?-1:11)}}function er(n,t){if(n&1&&(r(0,"div",15)(1,"h4",17)(2,"mat-icon"),s(3,"add_circle"),o(),s(4),o(),r(5,"div",18),k(6,Jo,12,11,"div",28,tn),o()()),n&2){let e=m(2).$implicit,i=m();l(4),b(" ",i.simulationMode?"Simulation Backends":"Hardware Drivers"," "),l(2),w(i.getFilteredBackends(e))}}function tr(n,t){if(n&1&&(r(0,"div",16)(1,"mat-icon"),s(2,"search_off"),o(),r(3,"p"),s(4),o(),r(5,"p",30),s(6,"Try switching the execution mode toggle"),o()()),n&2){let e=m(2).$implicit,i=m();l(4),B("No ",i.simulationMode?"simulated":"real"," options available for ",(e.frontend==null?null:e.frontend.name)||"this machine type")}}function ir(n,t){if(n&1&&(p(0,Ko,8,0,"div",15),p(1,er,8,1,"div",15),p(2,tr,7,2,"div",16)),n&2){let e=m().$implicit,i=m();u(i.getFilteredMachines(e).length>0?0:-1),l(),u(i.getFilteredBackends(e).length>0?1:-1),l(),u(i.getFilteredMachines(e).length===0&&i.getFilteredBackends(e).length===0?2:-1)}}function nr(n,t){if(n&1){let e=v();r(0,"div",3)(1,"mat-expansion-panel",4),h("expandedChange",function(a){let c=x(e).$implicit,d=m();return C(d.toggleExpansion(c,a))}),r(2,"mat-expansion-panel-header")(3,"mat-panel-title")(4,"div",5)(5,"div",6),p(6,Vo,2,0,"mat-icon")(7,Lo,2,0,"mat-icon")(8,Bo,2,0,"mat-icon"),o(),r(9,"div",7)(10,"span",8),s(11),o(),r(12,"span",9),s(13),o()()()(),r(14,"mat-panel-description"),p(15,Go,3,2,"span",10),o()(),r(16,"div",11),p(17,Wo,4,0,"div",12)(18,ir,3,3),o()()()}if(n&2){let e=t.$implicit,i=m();R("error",e.showError&&!(e.selection!=null&&e.selection.isValid))("complete",e.selection==null?null:e.selection.isValid),l(),f("expanded",e.isExpanded),l(4),R("complete",e.selection==null?null:e.selection.isValid)("error",e.showError&&!(e.selection!=null&&e.selection.isValid)),l(),u(e.selection!=null&&e.selection.isValid?6:e.showError?7:8),l(5),y(i.getArgumentDisplayName(e.requirement)),l(2),y((e.frontend==null?null:e.frontend.name)||e.requirement.type_hint_str||"Machine"),l(2),u(e.selection!=null&&e.selection.isValid?15:-1),l(2),u(e.isLoading?17:18)}}function or(n,t){n&1&&(r(0,"div",2)(1,"mat-icon"),s(2,"check_circle"),o(),r(3,"p"),s(4,"This protocol has no machine requirements"),o()())}var pt=class n{assetService=F(ie);requirements=[];simulationMode=!0;selectionsChange=new X;validChange=new X;machineRequirements=M([]);frontendsCache=[];backendsCache=[];machinesCache=[];async ngOnInit(){await this.loadCaches()}async ngOnChanges(t){t.requirements&&(await this.loadCaches(),this.buildRequirements()),t.simulationMode&&(this.validateSelectionsAgainstMode(),this.emitSelections())}validateSelectionsAgainstMode(){let t=this.machineRequirements(),e=!1,i=t.map(a=>{let c=a.selection;if(!c)return a;let d=!0;return(c.selectedMachine&&!this.isMachineCompatible(c.selectedMachine)||c.selectedBackend&&!this.isBackendCompatible(c.selectedBackend))&&(d=!1),d?a:(e=!0,q(D({},a),{selection:null}))});e&&this.machineRequirements.set(i)}async loadCaches(){try{this.frontendsCache=await Re(this.assetService.getMachineFrontendDefinitions()),this.backendsCache=await Re(this.assetService.getMachineBackendDefinitions()),this.machinesCache=await Re(this.assetService.getMachines())}catch(t){console.error("[MachineArgSelector] Failed to load caches:",t)}}buildRequirements(){let e=this.requirements.filter(i=>this.isMachineRequirement(i)).map(i=>{let a=this.findFrontendForRequirement(i),c=a?this.backendsCache.filter(g=>g.frontend_definition_accession_id===a.accession_id):[],d=c.some(g=>g.backend_type==="simulator");if(a&&!d){let g=this.backendsCache.filter(E=>E.backend_type==="simulator"&&(E.name?.toLowerCase().includes(a.machine_category?.toLowerCase()||"")||E.fqn.toLowerCase().includes(a.machine_category?.split(/[_\s]/)[0].toLowerCase()||"")));c=[...c,...g]}let _=this.machinesCache.filter(g=>this.machineMatchesRequirement(g,i,a));return{requirement:i,frontend:a,availableBackends:c,existingMachines:_,isLoading:!1,isExpanded:!0,selection:null,showError:!1}});this.machineRequirements.set(e),this.emitSelections()}isMachineRequirement(t){let e=t.required_plr_category||"",i=(t.type_hint_str||"").toLowerCase(),a=(t.fqn||"").toLowerCase();if(ke.has(e))return!0;let c=e.toLowerCase();return c.includes("plate")||c.includes("tip")||c.includes("trough")||c.includes("reservoir")||c.includes("carrier")||c.includes("tube")?!1:!!(Array.from(ke).some(_=>{let g=_.toLowerCase();return i.includes(g)||a.includes(g)})||i.includes("shaker")||i.includes("centrifuge")||i.includes("incubator")||i.includes("heater")||i.includes("scara"))}findFrontendForRequirement(t){let e=(t.type_hint_str||"").toLowerCase(),i=(t.required_plr_category||"").toLowerCase(),a=this.frontendsCache.find(c=>e.includes(c.fqn.toLowerCase()));return a||(a=this.frontendsCache.find(c=>(c.machine_category||"").toLowerCase()===i||(c.machine_category||"").toLowerCase().includes(i.replace("handler","").replace("reader",""))),a)?a:(e.includes("liquidhandler")||i.includes("liquid")?a=this.frontendsCache.find(c=>c.fqn.toLowerCase().includes("liquidhandler")):e.includes("platereader")||i.includes("reader")?a=this.frontendsCache.find(c=>c.fqn.toLowerCase().includes("platereader")):(e.includes("shaker")||i.includes("shaker"))&&(a=this.frontendsCache.find(c=>c.fqn.toLowerCase().includes("shaker"))),a||null)}machineMatchesRequirement(t,e,i){if(!i)return!1;let a=(t.machine_category||"").toLowerCase(),c=(i.machine_category||"").toLowerCase();return a===c||a.includes(c.split(/[_\s]/)[0])}getArgumentDisplayName(t){return t.name?t.name.replace(/_/g," ").replace(/^\w/,i=>i.toUpperCase()):(t.accession_id||"unknown").replace(/_/g," ").replace(/^\w/,i=>i.toUpperCase())}getBackendDisplayName(t){if(!t)return"Unknown";let e=t.name||t.fqn.split(".").pop()||"Unknown";return e.toLowerCase().includes("chatterbox")?"Simulated":e.replace(/Backend$/,"")}getFilteredMachines(t){return t.existingMachines}getFilteredBackends(t){return t.availableBackends}toggleExpansion(t,e){let i=this.machineRequirements(),a=i.findIndex(c=>c.requirement.accession_id===t.requirement.accession_id);a>=0&&(i[a]=q(D({},i[a]),{isExpanded:e}),this.machineRequirements.set([...i]))}selectMachine(t,e){let i=this.machineRequirements(),a=i.findIndex(c=>c.requirement.accession_id===t.requirement.accession_id);a>=0&&(i[a]=q(D({},i[a]),{selection:{argumentId:t.requirement.accession_id||"",argumentName:this.getArgumentDisplayName(t.requirement),frontendId:t.frontend?.accession_id||"",selectedMachine:e,selectedBackend:void 0,isValid:!0}}),this.machineRequirements.set([...i]),this.emitSelections())}selectBackend(t,e){let i=this.machineRequirements(),a=i.findIndex(c=>c.requirement.accession_id===t.requirement.accession_id);a>=0&&(i[a]=q(D({},i[a]),{selection:{argumentId:t.requirement.accession_id||"",argumentName:this.getArgumentDisplayName(t.requirement),frontendId:t.frontend?.accession_id||"",selectedMachine:void 0,selectedBackend:e,isValid:!0}}),this.machineRequirements.set([...i]),this.emitSelections())}showValidationErrors(){let e=this.machineRequirements().map(i=>q(D({},i),{showError:!i.selection?.isValid}));this.machineRequirements.set(e)}emitSelections(){let t=this.machineRequirements(),e=t.filter(a=>a.selection).map(a=>a.selection);this.selectionsChange.emit(e);let i=t.length===0||t.every(a=>a.selection?.isValid);this.validChange.emit(i)}isMachineCompatible(t){let e=t.is_simulation_override||!1;return this.simulationMode?e:!e}isBackendCompatible(t){let e=t.backend_type==="simulator";return this.simulationMode?e:!e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-machine-argument-selector"]],inputs:{requirements:"requirements",simulationMode:"simulationMode"},outputs:{selectionsChange:"selectionsChange",validChange:"validChange"},features:[Z],decls:4,vars:1,consts:[[1,"machine-args-container"],[1,"machine-arg-section",3,"error","complete"],[1,"no-machines-state"],[1,"machine-arg-section"],[3,"expandedChange","expanded"],[1,"panel-title-content"],[1,"status-indicator"],[1,"title-text"],[1,"arg-name"],[1,"arg-type"],[1,"selection-summary"],[1,"panel-content"],[1,"loading-state"],[1,"sim-badge"],["diameter","32"],[1,"options-section"],[1,"empty-state"],[1,"section-title"],[1,"options-grid"],[1,"option-card",3,"selected","disabled"],[1,"option-card",3,"click"],[1,"option-icon"],[1,"option-info"],[1,"option-name"],[1,"option-meta"],[1,"type-badge","sim"],[1,"type-badge","real"],[1,"incompatible-badge",3,"matTooltip"],[1,"option-card","backend-card",3,"selected","disabled"],[1,"option-card","backend-card",3,"click"],[1,"hint"]],template:function(e,i){e&1&&(r(0,"div",0),k(1,nr,19,14,"div",1,No),p(3,or,5,0,"div",2),o()),e&2&&(l(),w(i.machineRequirements()),l(2),u(i.machineRequirements().length===0?3:-1))},dependencies:[G,T,I,N,xe,pi,ui,gi,fi,_e,ge,W,ee],styles:[".machine-args-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-md)}.machine-arg-section[_ngcontent-%COMP%]{border-radius:16px;overflow:hidden;transition:all .2s ease}.machine-arg-section.error[_ngcontent-%COMP%]{box-shadow:0 0 0 2px var(--mat-sys-error)}.machine-arg-section.complete[_ngcontent-%COMP%]{box-shadow:0 0 0 2px var(--mat-sys-primary)}  .mat-expansion-panel{background:var(--mat-sys-surface-container)!important;border-radius:16px!important}  .mat-expansion-panel-header{padding:16px 24px!important}.panel-title-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.status-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--mat-sys-outline)}.status-indicator.complete[_ngcontent-%COMP%]{color:var(--mat-sys-primary)}.status-indicator.error[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.status-indicator[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.title-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.arg-name[_ngcontent-%COMP%]{font-weight:600;color:var(--mat-sys-on-surface)}.arg-type[_ngcontent-%COMP%]{font-size:12px;color:var(--mat-sys-on-surface-variant)}.selection-summary[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:14px;color:var(--mat-sys-primary)}.sim-badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:999px;font-size:10px;font-weight:600;text-transform:uppercase;background:var(--mat-sys-tertiary-container);color:var(--mat-sys-tertiary)}.panel-content[_ngcontent-%COMP%]{padding:0 24px 24px}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:32px;color:var(--mat-sys-on-surface-variant)}.options-section[_ngcontent-%COMP%]{margin-bottom:20px}.options-section[_ngcontent-%COMP%]:last-child{margin-bottom:0}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--mat-sys-on-surface-variant);margin:0 0 12px}.section-title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.options-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}.option-card[_ngcontent-%COMP%]{display:flex;gap:12px;padding:16px 20px;border-radius:12px;background:var(--mat-sys-surface-container-high);border:1px solid var(--mat-sys-outline-variant);cursor:pointer;min-height:72px;align-items:center;transition:all .2s ease}.option-card[_ngcontent-%COMP%]:hover{background:var(--mat-sys-surface-container-highest);border-color:var(--mat-sys-primary);transform:translateY(-2px)}.option-card.selected[_ngcontent-%COMP%]{background:var(--mat-sys-primary-container);border-color:var(--mat-sys-primary);box-shadow:0 0 0 2px var(--mat-sys-primary)}.option-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:var(--mat-sys-primary-container);color:var(--mat-sys-primary);flex-shrink:0}.option-icon.sim[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary-container);color:var(--mat-sys-tertiary)}.option-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.option-info[_ngcontent-%COMP%]{flex:1;min-width:0;display:flex;flex-direction:column;gap:2px}.option-name[_ngcontent-%COMP%]{font-weight:500;color:var(--mat-sys-on-surface);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.option-meta[_ngcontent-%COMP%]{font-size:11px;color:var(--mat-sys-on-surface-variant)}.type-badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:999px;font-size:10px;font-weight:600;text-transform:uppercase;flex-shrink:0}.type-badge.sim[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary-container);color:var(--mat-sys-tertiary)}.type-badge.real[_ngcontent-%COMP%]{background:var(--mat-sys-primary-container);color:var(--mat-sys-primary)}.empty-state[_ngcontent-%COMP%], .no-machines-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:32px;text-align:center;color:var(--mat-sys-on-surface-variant)}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .no-machines-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5;margin-bottom:12px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .no-machines-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.empty-state[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%], .no-machines-state[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{font-size:12px;opacity:.7;margin-top:8px}.no-machines-state[_ngcontent-%COMP%]{background:var(--mat-sys-surface-container);border-radius:16px}.no-machines-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--mat-sys-primary);opacity:1}.option-card.disabled[_ngcontent-%COMP%]{opacity:.6;background:var(--mat-sys-surface-container);border-style:dashed;pointer-events:none}.option-card.disabled[_ngcontent-%COMP%]   .option-icon[_ngcontent-%COMP%]{filter:grayscale(1);background:var(--mat-sys-outline-variant);color:var(--mat-sys-outline)}.option-card.disabled[_ngcontent-%COMP%]   .type-badge[_ngcontent-%COMP%]{background:var(--mat-sys-outline-variant);color:var(--mat-sys-outline)}.incompatible-badge[_ngcontent-%COMP%]{margin-left:auto;font-size:10px;color:var(--mat-sys-error);font-weight:500;padding:2px 6px;background:var(--mat-sys-error-container);border-radius:4px}"]})};function rr(n,t){if(n&1&&(r(0,"section",2)(1,"h3"),s(2,"Parameters"),o(),r(3,"p",3),s(4,"Configure the protocol execution parameters"),o()(),O(5,"formly-form",4)),n&2){let e=m();l(5),f("form",e.formGroup)("fields",e.paramFields())("model",e.model)}}function ar(n,t){n&1&&(r(0,"div",1)(1,"p"),s(2,"This protocol has no configurable parameters."),o()())}var ut=class n{protocol=null;formGroup=new ni({});model={};paramFields=M([]);hasParameters=M(!1);ngOnChanges(t){t.protocol&&this.protocol&&this.buildForm(this.protocol)}buildForm(t){let e=(t.parameters||[]).filter(c=>c.is_deck_param||c.name==="state"||this.isAssetParameter(c,t)?!1:["itemized-selector","index_selector","dict-input"].includes(c.field_type||"")?!0:!this.isWellParameter(c)),i=[],a=new Set;for(let c of e)if(!a.has(c.name)){if(c.linked_to){let d=e.find(_=>_.name===c.linked_to);if(d&&!a.has(d.name)){let _=`_unlink_${c.name}_${d.name}`,g=this.createParamField(c),E=this.createParamField(d);g.expressionProperties={"props.linkedTo":z=>z[_]?null:d.name},E.expressionProperties={"props.linkedTo":z=>z[_]?null:c.name},i.push({fieldGroupClassName:"linked-parameter-row",fieldGroup:[q(D({},g),{className:"flex-grow"}),{key:_,type:"checkbox",defaultValue:!1,className:"unlink-toggle",props:{label:"Unlink",attributes:{title:"Unlink these parameters to select independently"}}},q(D({},E),{className:"flex-grow"})]}),a.add(c.name),a.add(d.name);continue}}i.push(this.createParamField(c)),a.add(c.name)}this.paramFields.set(i),this.hasParameters.set(i.length>0),t.parameters?.forEach(c=>{if(c.default_value_repr&&c.default_value_repr!=="None")try{this.model[c.name]=JSON.parse(c.default_value_repr)}catch{this.model[c.name]=c.default_value_repr}})}createParamField(t){let e={key:t.name,props:{label:this.formatLabel(t.name),required:!t.optional,description:t.description}};if(t.field_type==="dict-input")return q(D({},e),{type:"dict-input"});if((t.field_type==="index_selector"||t.field_type==="itemized-selector")&&t.itemized_spec)return q(D({},e),{type:"index-selector",props:q(D({},e.props),{itemsX:t.itemized_spec.items_x,itemsY:t.itemized_spec.items_y,linkedTo:t.linked_to,mode:t.field_type==="itemized-selector"?"multiple":"single"})});let i=t.type_hint.toLowerCase();return i.includes("float")||i.includes("int")?q(D({},e),{type:"input",props:q(D({},e.props),{type:"number",min:t.constraints.min_value,max:t.constraints.max_value})}):i.includes("bool")?q(D({},e),{type:"checkbox"}):t.constraints.options&&t.constraints.options.length>0?q(D({},e),{type:"select",props:q(D({},e.props),{options:t.constraints.options.map(a=>({label:String(a),value:a}))})}):q(D({},e),{type:"input",props:q(D({},e.props),{type:"text"})})}formatLabel(t){return t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}isAssetParameter(t,e){let i=e.assets?.map(g=>g.name)||[],a=e.assets?.map(g=>g.fqn)||[];if(i.includes(t.name)||a.includes(t.fqn))return!0;let c=["pylabrobot.machines","pylabrobot.liquid_handling","LiquidHandler","Machine"],d=["pylabrobot.resources","Plate","TipRack","Carrier","Deck"],_=t.type_hint||"";return c.some(g=>_.includes(g))||d.some(g=>_.includes(g))}isWellParameter(t){let e=(t.name||"").toLowerCase();return!!(["well","wells","source_wells","target_wells","well_ids","indices"].some(a=>e.includes(a))||t.ui_hint?.type==="well_selector")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-parameter-config"]],inputs:{protocol:"protocol",formGroup:"formGroup"},features:[Z],decls:3,vars:2,consts:[[1,"parameter-config-container"],[1,"empty-state"],[1,"section-header"],[1,"section-subtitle"],[3,"form","fields","model"]],template:function(e,i){e&1&&(r(0,"div",0),p(1,rr,6,3),p(2,ar,3,0,"div",1),o()),e&2&&(l(),u(i.hasParameters()?1:-1),l(),u(i.hasParameters()?-1:2))},dependencies:[de,Yi,Ki,Xe],styles:[".parameter-config-container[_ngcontent-%COMP%]{padding:16px 0}.section-header[_ngcontent-%COMP%]{margin-bottom:16px}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:1.1rem}.section-subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant);font-size:.9rem}mat-divider[_ngcontent-%COMP%]{margin:24px 0}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:32px;color:var(--sys-on-surface-variant)}  .linked-parameter-row{display:flex;gap:16px;align-items:center}  .linked-parameter-row>.flex-grow{flex:1;width:0}  .unlink-toggle{margin-top:16px;min-width:80px}"],changeDetection:0})};function sr(n,t){n&1&&re(0,"div",6)}function lr(n,t){n&1&&(Me(0,"div",7),re(1,"div",8)(2,"div",9),Pe(),Me(3,"div",10)(4,"div",11),re(5,"div",12)(6,"div",12),Pe()())}var ft=class n{compact=!1;static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-protocol-card-skeleton"]],inputs:{compact:"compact"},decls:8,vars:4,consts:[[1,"praxis-card"],[1,"card-header"],[1,"flex","items-center","gap-3","w-full"],[1,"skeleton-avatar"],[1,"flex-1"],[1,"skeleton-title"],[1,"skeleton-subtitle"],[1,"card-content"],[1,"skeleton-line"],[1,"skeleton-line","short"],[1,"card-actions"],[1,"flex","gap-2"],[1,"skeleton-chip"]],template:function(e,i){e&1&&(Me(0,"div",0)(1,"div",1)(2,"div",2),re(3,"div",3),Me(4,"div",4),re(5,"div",5),p(6,sr,1,0,"div",6),Pe()()(),p(7,lr,7,0),Pe()),e&2&&(R("praxis-card-min",i.compact),l(6),u(i.compact?-1:6),l(),u(i.compact?-1:7))},styles:["@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:-200% 0}to{background-position:200% 0}}.praxis-card-min[_ngcontent-%COMP%]{min-width:180px;max-width:220px}.skeleton-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px}.skeleton-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:linear-gradient(90deg,var(--mat-sys-surface-container) 25%,var(--mat-sys-surface-container-high) 50%,var(--mat-sys-surface-container) 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite}.skeleton-title-area[_ngcontent-%COMP%]{flex:1}.skeleton-title[_ngcontent-%COMP%]{height:20px;width:60%;border-radius:4px;background:linear-gradient(90deg,var(--mat-sys-surface-container) 25%,var(--mat-sys-surface-container-high) 50%,var(--mat-sys-surface-container) 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite;margin-bottom:8px}.skeleton-subtitle[_ngcontent-%COMP%]{height:14px;width:40%;border-radius:4px;background:linear-gradient(90deg,var(--mat-sys-surface-container) 25%,var(--mat-sys-surface-container-high) 50%,var(--mat-sys-surface-container) 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite}.skeleton-content[_ngcontent-%COMP%]{margin-bottom:16px}.skeleton-line[_ngcontent-%COMP%]{height:14px;width:100%;border-radius:4px;background:linear-gradient(90deg,var(--mat-sys-surface-container) 25%,var(--mat-sys-surface-container-high) 50%,var(--mat-sys-surface-container) 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite;margin-bottom:8px}.skeleton-line.short[_ngcontent-%COMP%]{width:70%}.skeleton-chips[_ngcontent-%COMP%]{display:flex;gap:8px}.skeleton-chip[_ngcontent-%COMP%]{height:24px;width:60px;border-radius:12px;background:linear-gradient(90deg,var(--mat-sys-surface-container) 25%,var(--mat-sys-surface-container-high) 50%,var(--mat-sys-surface-container) 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.5s infinite}"],changeDetection:0})};var ve={plate:{size_x:127.76,size_y:85.48,size_z:14.5},tipRack:{size_x:127.76,size_y:85.48,size_z:60},trough:{size_x:127.76,size_y:85.48,size_z:40},carrier:{size_x:135,size_y:497,size_z:10}},gt=class n{constructor(t,e,i){this.deckCatalog=t;this.assetService=e;this.carrierInference=i}async getResourceDimensions(t,e){try{let c=await this.assetService.getResourceDefinition(e,t);if(c&&c.size_x_mm&&c.size_y_mm&&c.size_z_mm)return{size_x:c.size_x_mm,size_y:c.size_y_mm,size_z:c.size_z_mm,num_items_x:c.num_items?12:void 0,num_items_y:c.num_items?Math.floor(c.num_items/12):void 0}}catch(c){console.debug("Could not fetch PLR dimensions, using defaults:",c)}let i=this.getTypeKey(t),a=ve[i]||ve.plate;return{size_x:a.size_x,size_y:a.size_y,size_z:a.size_z}}getTypeKey(t){let e=t.toLowerCase();return e.includes("tip")?"tipRack":e.includes("trough")||e.includes("reservoir")?"trough":e.includes("carrier")?"carrier":"plate"}generateDeckForProtocol(t,e,i){if(i?.plr_state)return{resource:i.plr_state,state:{}};if(i?.plr_definition)return{resource:i.plr_definition,state:{}};let a=this.detectDeckType(i),c=this.deckCatalog.getDeckDefinition(a);return c?c.layoutType==="slot-based"?this.generateSlotBasedDeck(c,t,e):this.generateHamiltonDeck(t,e):(console.warn(`No deck definition found for ${a}, falling back to Hamilton STAR`),this.generateHamiltonDeck(t,e))}detectDeckType(t){if(!t)return"HamiltonSTARDeck";let e=t.backend_definition?.name?.toLowerCase()||"",i=t.backend_definition?.fqn?.toLowerCase()||"";return e.includes("ot-2")||e.includes("ot2")||i.includes("opentrons.ot2")||e.includes("flex")||i.includes("opentrons.flex")||t.machine_category?.includes("OT-2")||t.machine_type?.includes("OT-2")||t.model?.includes("OT-2")?"OT2Deck":"HamiltonSTARDeck"}generateSlotBasedDeck(t,e,i){let a={name:"deck",type:t.fqn||"OT2Deck",location:{x:0,y:0,z:0,type:"Coordinate"},size_x:t.dimensions.width,size_y:t.dimensions.height,size_z:t.dimensions.depth,children:[]},d=(t.slots||[]).find(_=>_.slotType==="trash");return d&&a.children.push({name:"Trash",type:"Trash",location:{x:d.position.x,y:d.position.y,z:d.position.z,type:"Coordinate"},size_x:d.dimensions.width,size_y:d.dimensions.height,size_z:100,children:[],slot_id:d.slotNumber}),e.assets&&i&&this.carrierInference.createDeckSetup(e,t.fqn).slotAssignments.forEach(g=>{let E=e.assets?.find(Q=>Q.name===g.resource.name),z=E?i[E.accession_id]:null;z&&a.children.push(q(D({},g.resource),{is_ghost:!z.physically_placed,location:q(D({},g.resource.location),{type:"Coordinate"})}))}),{resource:a,state:{}}}generateHamiltonDeck(t,e){let i={name:"deck",type:"HamiltonSTARDeck",location:{x:0,y:0,z:0,type:"Coordinate"},size_x:1200,size_y:653.5,size_z:500,num_rails:30,children:[]};if(t&&e){let a=this.carrierInference.createDeckSetup(t,"HamiltonSTARDeck"),c=new Map;a.slotAssignments.forEach(d=>{let _=t.assets?.find(E=>E.name===d.resource.name),g=_?e[_.accession_id]:null;if(g){let E=c.get(d.carrier.id);E||(E={name:d.carrier.name,type:d.carrier.fqn.split(".").pop()||"Carrier",is_ghost:!g.physically_placed,location:{x:100+d.carrier.railPosition*22.5,y:63,z:0,type:"Coordinate"},size_x:d.carrier.dimensions.width,size_y:d.carrier.dimensions.height,size_z:d.carrier.dimensions.depth,children:[]},i.children.push(E),c.set(d.carrier.id,E)),E.children.push(q(D({},d.resource),{is_ghost:!g.physically_placed,location:q(D({},d.resource.location),{type:"Coordinate"})}))}})}return{resource:i,state:{}}}async generateDeckForProtocolAsync(t,e){let i=await this.getResourceDimensions("HamiltonSTARDeck"),a={name:"deck",type:"HamiltonSTARDeck",location:{x:0,y:0,z:0,type:"Coordinate"},size_x:i.size_x||1200,size_y:i.size_y||653.5,size_z:i.size_z||500,num_rails:30,children:[]},d=this.deckCatalog.getHamiltonSTARSpec().railPositions,_=await this.getResourceDimensions("carrier");return{resource:a,state:{}}}createCarrier(t,e,i){return this.createCarrierWithDims(t,e,i,ve.carrier)}createCarrierWithDims(t,e,i,a){return{name:t,type:e,location:{x:i,y:63,z:0,type:"Coordinate"},size_x:a.size_x,size_y:a.size_y,size_z:a.size_z,children:[]}}createPlate(t){return this.createPlateWithDims(t,q(D({},ve.plate),{num_items_x:12,num_items_y:8}))}createPlateWithDims(t,e){let i={name:t,type:"Plate",location:{x:10,y:0,z:0,type:"Coordinate"},size_x:e.size_x,size_y:e.size_y,size_z:e.size_z,num_items_x:e.num_items_x||12,num_items_y:e.num_items_y||8,children:[]};return i.children=this.generateWells(t,i.num_items_x,i.num_items_y,"circle"),i}createTipRack(t){return this.createTipRackWithDims(t,q(D({},ve.tipRack),{num_items_x:12,num_items_y:8}))}createTipRackWithDims(t,e){let i={name:t,type:"TipRack",location:{x:10,y:0,z:0,type:"Coordinate"},size_x:e.size_x,size_y:e.size_y,size_z:e.size_z,num_items_x:e.num_items_x||12,num_items_y:e.num_items_y||8,children:[]};return i.children=this.generateWells(t,i.num_items_x,i.num_items_y,"circle"),i}createTrough(t){return this.createTroughWithDims(t,q(D({},ve.trough),{num_items_x:12,num_items_y:1}))}createTroughWithDims(t,e){let i={name:t,type:"Plate",location:{x:10,y:0,z:0,type:"Coordinate"},size_x:e.size_x,size_y:e.size_y,size_z:e.size_z,num_items_x:e.num_items_x||12,num_items_y:e.num_items_y||1,children:[]};return i.children=this.generateWells(t,i.num_items_x,i.num_items_y,"rect"),i}generateWells(t,e,i,a){let c=[];for(let g=0;g<e;g++)for(let E=0;E<i;E++)c.push({name:`${t}_well_${g}_${E}`,type:"Well",location:{x:14+g*9,y:11+E*9,z:2,type:"Coordinate"},size_x:7,size_y:7,size_z:10,max_volume:300,volume:0,cross_section_type:a,children:[]});return c}static \u0275fac=function(e){return new(e||n)(qe(Ge),qe(ie),qe(di))};static \u0275prov=Te({token:n,factory:n.\u0275fac,providedIn:"root"})};var nn=(n,t)=>t.key,cr=(n,t)=>t.id;function dr(n,t){if(n&1&&(r(0,"div",1)(1,"div",13)(2,"div",14)(3,"mat-icon",15),s(4,"description"),o()(),r(5,"div",16)(6,"h3",17),s(7),o(),r(8,"span",18),s(9),o()()(),r(10,"div",19)(11,"span",20),s(12,"Read Only Review"),o()()()),n&2){let e=m();l(7),y(e.protocol.name),l(2),b("Version ",e.protocol.version||"1.0.0")}}function mr(n,t){if(n&1&&(r(0,"div",7)(1,"span",21),s(2),o(),r(3,"span",22),s(4),o()()),n&2){let e=t.$implicit,i=m();l(2),y(i.formatLabel(e.key)),l(2),y(i.formatValue(e.value))}}function pr(n,t){n&1&&(r(0,"p",8),s(1,"No parameters configured"),o())}function ur(n,t){if(n&1&&(r(0,"div",10)(1,"div",23)(2,"mat-icon",24),s(3,"inventory"),o(),r(4,"div",16)(5,"span",22),s(6),o(),r(7,"span",18),s(8),o()()(),r(9,"span",25),s(10,"Allocated"),o()()),n&2){let e=t.$implicit;l(6),y(e.name),l(2),y(e.id)}}function fr(n,t){n&1&&(r(0,"p",8),s(1,"No specific assets required"),o())}function gr(n,t){if(n&1&&(r(0,"span",29),s(1),o()),n&2){let e=t.$implicit;l(),y(e)}}function _r(n,t){if(n&1&&(r(0,"span",30),s(1),o()),n&2){let e=m().$implicit;l(),b("...and ",e.wells.length-12," more")}}function hr(n,t){if(n&1&&(r(0,"div",12)(1,"div",26)(2,"span",18),s(3),o(),r(4,"span",27),s(5),o()(),r(6,"div",28),k(7,gr,2,1,"span",29,J),p(9,_r,2,1,"span",30),o()()),n&2){let e=t.$implicit,i=m();l(3),y(i.formatLabel(e.key)),l(2),b("",e.wells.length," Wells"),l(2),w(e.wells.slice(0,12)),l(2),u(e.wells.length>12?9:-1)}}function xr(n,t){n&1&&(r(0,"p",31),s(1,"No wells selected (required)"),o())}function Cr(n,t){n&1&&(r(0,"p",8),s(1,"No well selection required"),o())}function yr(n,t){if(n&1&&p(0,xr,2,0,"p",31)(1,Cr,2,0,"p",8),n&2){let e=m();u(e.wellSelectionRequired?0:1)}}var _t=class n{protocol=null;parameters={};assets={};wellSelections={};wellSelectionRequired=!1;get displayParameters(){return Object.entries(this.parameters).filter(([t])=>!this.isWellParameterName(t)&&!this.isAssetKey(t)).map(([t,e])=>({key:t,value:e}))}get displayAssets(){return Object.entries(this.assets).map(([t,e])=>({id:t,name:e?.name||t}))}get displayWellSelections(){return Object.entries(this.wellSelections).map(([t,e])=>({key:t,wells:e}))}formatLabel(t){return t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}formatValue(t){return t==null?"None":typeof t=="boolean"?t?"Yes":"No":String(t)}isWellParameterName(t){let e=t.toLowerCase();return["well","wells","source_wells","target_wells","well_ids"].some(i=>e.includes(i))}isAssetKey(t){return!!this.assets[t]}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-protocol-summary"]],inputs:{protocol:"protocol",parameters:"parameters",assets:"assets",wellSelections:"wellSelections",wellSelectionRequired:"wellSelectionRequired"},decls:30,vars:4,consts:[[1,"summary-container","space-y-6"],[1,"p-4","bg-primary/5","rounded-2xl","border","border-primary/20","flex","items-center","justify-between"],[1,"grid","grid-cols-1","gap-6"],[1,"summary-section"],[1,"text-sm","font-bold","text-sys-text-tertiary","uppercase","tracking-wider","mb-3","flex","items-center","gap-2"],[1,"!w-4","!h-4","!text-[16px]"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[1,"flex","flex-col","p-3","bg-surface-variant/50","rounded-xl","border","border-[var(--theme-border)]"],[1,"text-sm","text-sys-text-tertiary","italic"],[1,"space-y-2"],[1,"flex","items-center","justify-between","p-3","bg-surface-variant/50","rounded-xl","border","border-[var(--theme-border)]"],[1,"space-y-3"],[1,"p-3","bg-surface-variant/50","rounded-xl","border","border-[var(--theme-border)]"],[1,"flex","items-center","gap-4"],[1,"w-10","h-10","rounded-xl","bg-primary/10","flex","items-center","justify-center"],[1,"text-primary"],[1,"flex","flex-col"],[1,"text-lg","font-bold","text-sys-text-primary","leading-none","mb-1"],[1,"text-xs","text-sys-text-tertiary"],[1,"px-3","py-1","bg-surface-variant","rounded-lg","border","border-[var(--theme-border)]"],[1,"text-[10px]","font-bold","text-sys-text-tertiary","uppercase","tracking-widest"],[1,"text-xs","text-sys-text-tertiary","mb-1"],[1,"text-sm","font-medium","text-sys-text-primary"],[1,"flex","items-center","gap-3"],[1,"text-primary/70"],[1,"px-2","py-0.5","rounded","text-[10px]","font-bold","uppercase","tracking-tighter","bg-green-500/10","text-green-500","border","border-green-500/20"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xs","font-bold","text-primary"],[1,"flex","flex-wrap","gap-1"],[1,"px-1.5","py-0.5","bg-primary/10","text-primary","text-[10px]","rounded","border","border-primary/20"],[1,"text-[10px]","text-sys-text-tertiary","px-1"],[1,"text-sm","text-red-500","italic"]],template:function(e,i){e&1&&(r(0,"div",0),p(1,dr,13,2,"div",1),r(2,"div",2)(3,"section",3)(4,"h4",4)(5,"mat-icon",5),s(6,"tune"),o(),s(7," Parameters "),o(),r(8,"div",6),k(9,mr,5,2,"div",7,nn,!1,pr,2,0,"p",8),o()(),r(12,"section",3)(13,"h4",4)(14,"mat-icon",5),s(15,"inventory_2"),o(),s(16," Required Assets "),o(),r(17,"div",9),k(18,ur,11,2,"div",10,cr,!1,fr,2,0,"p",8),o()(),r(21,"section",3)(22,"h4",4)(23,"mat-icon",5),s(24,"grid_on"),o(),s(25," Well Selections "),o(),r(26,"div",11),k(27,hr,10,3,"div",12,nn,!1,yr,2,1),o()()()()),e&2&&(l(),u(i.protocol?1:-1),l(8),w(i.displayParameters),l(9),w(i.displayAssets),l(9),w(i.displayWellSelections))},dependencies:[G,T,I,Xe],styles:["[_nghost-%COMP%]{display:block;width:100%}"],changeDetection:0})};function vr(n,t){n&1&&(r(0,"mat-error"),s(1,"Name is required"),o())}function br(n,t){if(n&1&&(r(0,"mat-option",10),s(1),o()),n&2){let e=t.$implicit;f("value",e),l(),y(e)}}function Sr(n,t){n&1&&(r(0,"mat-error"),s(1,"Backend selection is required"),o())}var ht=class n{constructor(t,e,i){this.fb=t;this.dialogRef=e;this.data=i;this.backends=i.definition.available_simulation_backends||["Chatterbox","Simulator"],this.form=this.fb.group({name:[`${i.definition.name} (Sim)`,bt.required],simulation_backend_name:[this.backends[0],bt.required]})}form;backends=[];cancel(){this.dialogRef.close()}confirm(){this.form.valid&&this.dialogRef.close(this.form.value)}static \u0275fac=function(e){return new(e||n)(oe(Ve),oe(ae),oe(se))};static \u0275cmp=P({type:n,selectors:[["app-simulation-config-dialog"]],decls:30,vars:5,consts:[[1,"p-6","min-w-[400px]"],[1,"flex","items-center","gap-3","mb-6"],[1,"w-12","h-12","rounded-2xl","bg-primary/10","flex","items-center","justify-center","text-primary"],[1,"!w-6","!h-6","!text-[24px]"],[1,"text-xl","font-bold","text-sys-text-primary","mb-1"],[1,"text-sys-text-secondary","text-sm"],[1,"flex","flex-col","gap-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","e.g. Hamilton STAR (Sim)"],["formControlName","simulation_backend_name"],[3,"value"],[1,"flex","justify-end","gap-3","mt-8"],["mat-button","",1,"!rounded-xl","!px-6",3,"click"],["mat-flat-button","","color","primary",1,"!rounded-xl","!px-8","shadow-lg","shadow-primary/20",3,"click","disabled"]],template:function(e,i){if(e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),s(4,"precision_manufacturing"),o()(),r(5,"div")(6,"h2",4),s(7,"Configure Simulation"),o(),r(8,"p",5),s(9),o()()(),r(10,"form",6)(11,"mat-form-field",7)(12,"mat-label"),s(13,"Instance Name"),o(),O(14,"input",8),p(15,vr,2,0,"mat-error"),o(),r(16,"mat-form-field",7)(17,"mat-label"),s(18,"Simulation Backend"),o(),r(19,"mat-select",9),k(20,br,2,2,"mat-option",10,J),o(),r(22,"mat-hint"),s(23,"Choose the driver for simulated interaction"),o(),p(24,Sr,2,0,"mat-error"),o()(),r(25,"div",11)(26,"button",12),h("click",function(){return i.cancel()}),s(27,"Cancel"),o(),r(28,"button",13),h("click",function(){return i.confirm()}),s(29," Create Simulation "),o()()()),e&2){let a,c;l(9),b("",i.data.definition.name," template"),l(),f("formGroup",i.form),l(5),u((a=i.form.get("name"))!=null&&a.hasError("required")?15:-1),l(5),w(i.backends),l(4),u((c=i.form.get("simulation_backend_name"))!=null&&c.hasError("required")?24:-1),l(4),f("disabled",i.form.invalid)}},dependencies:[G,de,ze,ce,te,Fe,Ne,ri,le,N,U,pe,me,Le,$e,Be,fe,ue,et,Ii,Je,T,I],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};var Mr=["stepper"],Pt=()=>({}),Pr=()=>[1,2,3,4,5,6],kr=()=>[],wr=(n,t,e,i)=>({protocol:n,deckResource:t,assetMap:e,deckType:i}),Er=(n,t)=>t.key,Rr=(n,t)=>t.value,rn=(n,t)=>t.accession_id,Dr=(n,t)=>t.name;function Tr(n,t){n&1&&(r(0,"span",58),s(1,"Select Protocol"),o())}function qr(n,t){if(n&1){let e=v();r(0,"div",13)(1,"div",59)(2,"button",60),h("click",function(){x(e);let a=m();return C(a.clearProtocol())}),r(3,"mat-icon"),s(4,"arrow_back"),o(),s(5," Back to Selection "),o(),r(6,"button",61),s(7," Continue "),r(8,"mat-icon"),s(9,"arrow_forward"),o()()(),r(10,"div",62),O(11,"div",63),r(12,"div",64)(13,"div",65)(14,"mat-icon",66),s(15,"science"),o()(),r(16,"h2",67),s(17),o(),r(18,"div",68)(19,"p",69),s(20),o()(),r(21,"div",70)(22,"span",71)(23,"mat-icon",72),s(24,"category"),o(),s(25),o(),r(26,"span",71)(27,"mat-icon",72),s(28,"tag"),o(),s(29),o()()()()()}if(n&2){let e,i,a,c,d=m();l(17),y((e=d.selectedProtocol())==null?null:e.name),l(3),y((i=d.selectedProtocol())==null?null:i.description),l(5),b(" ",((a=d.selectedProtocol())==null?null:a.category)||"General"," "),l(4),b(" ",(c=d.selectedProtocol())==null?null:c.version," ")}}function Or(n,t){if(n&1){let e=v();r(0,"button",88),h("click",function(){x(e);let a=m(2);return C(a.clearSearch())}),r(1,"mat-icon",89),s(2,"close"),o()()}}function Ir(n,t){if(n&1){let e=v();r(0,"button",92),h("click",function(){let a=x(e).$implicit,c=m().$implicit,d=m(2);return C(d.toggleFilter(c.key,a.value))}),r(1,"span"),s(2),o(),r(3,"span",93),s(4),o()()}if(n&2){let e=t.$implicit;R("bg-primary-10",e.selected)("text-primary",e.selected)("text-sys-text-secondary",!e.selected),l(2),y(e.value),l(2),y(e.count)}}function Fr(n,t){if(n&1&&(r(0,"div",80)(1,"h4",90),s(2),o(),k(3,Ir,5,8,"button",91,Rr),o()),n&2){let e=t.$implicit;l(2),y(e.label),l(),w(e.options)}}function Ar(n,t){if(n&1){let e=v();r(0,"app-protocol-card",95),h("select",function(a){x(e);let c=m(3);return C(c.selectProtocol(a))}),o()}if(n&2){let e=t.$implicit;f("protocol",e)("compact",!0)}}function zr(n,t){if(n&1&&(r(0,"div",82)(1,"h3",83)(2,"mat-icon",84),s(3,"history"),o(),s(4," Recently Used "),o(),r(5,"div",85),k(6,Ar,1,2,"app-protocol-card",94,rn),o()()),n&2){let e=m(2);l(6),w(e.recentProtocols())}}function Nr(n,t){n&1&&O(0,"app-protocol-card-skeleton")}function Vr(n,t){n&1&&(r(0,"div",85),k(1,Nr,1,0,"app-protocol-card-skeleton",null,J),o()),n&2&&(l(),w(H(0,Pr)))}function Lr(n,t){if(n&1){let e=v();r(0,"div",86)(1,"mat-icon",96),s(2,"search_off"),o(),r(3,"p",97),s(4,"No protocols found matching your criteria"),o(),r(5,"button",98),h("click",function(){x(e);let a=m(2);return C(a.clearSearch())}),s(6,"Clear Filters"),o()()}}function Br(n,t){if(n&1){let e=v();r(0,"app-protocol-card",100),h("select",function(a){x(e);let c=m(3);return C(c.selectProtocol(a))}),o()}if(n&2){let e=t.$implicit;f("protocol",e)}}function $r(n,t){if(n&1&&(r(0,"div",87),k(1,Br,1,1,"app-protocol-card",99,rn),o()),n&2){let e=m(2);l(),w(e.filteredProtocols())}}function Gr(n,t){if(n&1){let e=v();r(0,"div",14)(1,"aside",73)(2,"div",74)(3,"div",75)(4,"mat-icon",76),s(5,"search"),o(),r(6,"input",77),h("input",function(a){x(e);let c=m();return C(c.onSearchChange(a))}),o(),p(7,Or,3,0,"button",78),o(),r(8,"div",79),k(9,Fr,5,1,"div",80,Er),o()()(),r(11,"div",81),p(12,zr,8,0,"div",82),r(13,"div")(14,"h3",83)(15,"mat-icon",84),s(16,"grid_view"),o(),s(17," All Protocols "),o(),p(18,Vr,3,1,"div",85)(19,Lr,7,0,"div",86)(20,$r,3,0,"div",87),o()()()}if(n&2){let e=m();l(6),f("value",e.searchQuery()),l(),u(e.searchQuery()?7:-1),l(2),w(e.filterCategories()),l(3),u(e.recentProtocols().length>0&&!e.searchQuery()?12:-1),l(6),u(e.isLoading()?18:e.filteredProtocols().length===0?19:20)}}function Wr(n,t){n&1&&(r(0,"span",101),s(1,"Configure Parameters"),o())}function jr(n,t){n&1&&(r(0,"span",102),s(1,"Select Machines"),o())}function Hr(n,t){n&1&&(r(0,"div",27)(1,"mat-icon",103),s(2,"error_outline"),o(),r(3,"div")(4,"p",104),s(5,"Physical execution requires real machines."),o(),r(6,"p",105),s(7,"Some selected machines are simulated. Switch to Simulation mode or select physical machines."),o()()())}function Ur(n,t){n&1&&(r(0,"div",28),O(1,"mat-spinner",106),r(2,"p",107),s(3,"Loading machine options..."),o()())}function Qr(n,t){if(n&1){let e=v();r(0,"app-machine-selection",110),h("select",function(a){x(e);let c=m(2);return C(c.onMachineSelect(a))}),o()}if(n&2){let e=m(2);f("machines",e.compatibilityData())("selected",e.selectedMachine())("isPhysicalMode",!e.store.simulationMode())}}function Kr(n,t){if(n&1){let e=v();r(0,"app-machine-argument-selector",108),h("selectionsChange",function(a){x(e);let c=m();return C(c.machineSelections.set(a))})("validChange",function(a){let c;x(e);let d=m();return d.machineSelectionsValid.set(a),C((c=d.machineFormGroup.get("machineId"))==null?null:c.setValue(a?"valid":""))}),o(),p(1,Qr,1,3,"app-machine-selection",109)}if(n&2){let e,i=m();f("requirements",((e=i.selectedProtocol())==null?null:e.assets)||H(3,kr))("simulationMode",i.store.simulationMode()),l(),u(-1)}}function Yr(n,t){n&1&&(r(0,"span",111),s(1,"Select Assets"),o())}function Xr(n,t){if(n&1){let e=v();r(0,"app-guided-setup",112),h("selectionChange",function(a){x(e);let c=m();return C(c.onAssetSelectionChange(a))}),o()}if(n&2){let e=m();f("protocol",e.selectedProtocol())("isInline",!0)("excludeAssetIds",e.excludedMachineAssetIds())("initialSelections",e.configuredAssets()||H(4,Pt))}}function Zr(n,t){n&1&&(r(0,"span",116),s(1,"Select Wells"),o())}function Jr(n,t){if(n&1){let e=v();r(0,"div",115)(1,"div",117)(2,"span",118),s(3),o(),r(4,"span",119),s(5),o()(),r(6,"button",120),h("click",function(){let a=x(e).$implicit,c=m(2);return C(c.openWellSelector(a))}),r(7,"mat-icon",121),s(8,"grid_on"),o(),s(9),o()()}if(n&2){let e=t.$implicit,i=m(2);l(3),y(e.name),l(2),y(e.description),l(4),b(" ",i.getWellSelectionLabel(e.name)," ")}}function ea(n,t){if(n&1&&(r(0,"mat-step",10),Y(1,Zr,2,0,"ng-template",11),r(2,"div",113)(3,"div",25)(4,"h3",18)(5,"div",19)(6,"mat-icon"),s(7,"grid_on"),o()(),s(8," Well Selection "),o(),r(9,"p",114),s(10," This protocol requires you to specify which wells to use. Click each parameter below to select wells. "),o(),k(11,Jr,10,3,"div",115,Dr),o(),r(13,"div",21)(14,"button",22),s(15,"Back"),o(),r(16,"button",23),s(17," Continue "),o()()()()),n&2){let e=m();f("stepControl",e.wellsFormGroup),l(11),w(e.getWellParameters()),l(5),f("disabled",!e.areWellSelectionsValid())}}function ta(n,t){n&1&&(r(0,"span",122),s(1,"Deck Setup"),o())}function ia(n,t){n&1&&(r(0,"div",33)(1,"div",123)(2,"mat-icon",124),s(3,"check_circle"),o()(),r(4,"h3",125),s(5,"No Deck Setup Required"),o(),r(6,"p",126),s(7," This protocol operates on standalone machines and does not require deck configuration. "),o(),r(8,"div",127)(9,"button",128),s(10,"Back"),o(),r(11,"button",61),s(12,"Continue to Review"),o()()())}function na(n,t){if(n&1){let e=v();r(0,"app-deck-setup-wizard",129),h("setupComplete",function(){x(e);let a=m();return C(a.onDeckSetupComplete())})("setupSkipped",function(){x(e);let a=m();return C(a.onDeckSetupSkipped())}),o()}if(n&2){let e,i=m();f("data",Lt(2,wr,i.selectedProtocol(),((e=i.deckData())==null?null:e.resource)||null,i.configuredAssets()||H(1,Pt),i.selectedDeckType()||"HamiltonSTARDeck"))}}function oa(n,t){n&1&&(r(0,"div",33)(1,"mat-icon",96),s(2,"build"),o(),r(3,"p"),s(4,"Select a protocol first to configure the deck."),o()())}function ra(n,t){n&1&&(r(0,"mat-error"),s(1,"Run name is required"),o())}function aa(n,t){n&1&&(O(0,"mat-spinner",130),s(1," Initializing... "))}function sa(n,t){n&1&&(r(0,"div",56)(1,"mat-icon"),s(2,"play_circle"),o(),s(3," Start Execution "),o())}var on="praxis_recent_protocols",la=5,xt=class n{stepper;_formBuilder=F(Ve);route=F(Ut);router=F(Qt);protocolService=F(ki);executionService=F(je);deckGenerator=F(gt);dialog=F(Ie);modeService=F(Yt);assetService=F(ie);snackBar=F(_i);protocols=M([]);selectedProtocol=M(null);selectedMachine=M(null);machineSelections=M([]);compatibilityData=M([]);isLoadingCompatibility=M(!1);machineSelectionsValid=M(!1);isLoading=M(!0);isStartingRun=M(!1);searchQuery=M("");activeFilters=M({});configuredAssets=M(null);protocolFormGroup=this._formBuilder.group({protocolId:["",{validators:t=>t.value?null:{required:!0}}]});machineFormGroup=this._formBuilder.group({machineId:["",{validators:t=>t.value&&!this.showMachineError()?null:{required:!0}}]});parametersFormGroup=this._formBuilder.group({});assetsFormGroup=this._formBuilder.group({valid:[!1,{validators:t=>t.value?null:{required:!0}}]});wellsFormGroup=this._formBuilder.group({valid:[!0]});deckFormGroup=this._formBuilder.group({valid:[!1,{validators:t=>t.value||this.selectedProtocol()?.requires_deck===!1?null:{required:!0}}]});readyFormGroup=this._formBuilder.group({ready:[!0]});runNameControl=this._formBuilder.control("",{validators:t=>t.value?null:{required:!0}});runNotesControl=this._formBuilder.control("");wellSelectionRequired=S(()=>this.selectedProtocol()?.parameters?.some(e=>this.isWellSelectionParameter(e))??!1);wellSelections=M({});excludedMachineAssetIds=S(()=>{let t=this.selectedProtocol();return!t||!t.assets?[]:t.assets.filter(e=>{let i=e.required_plr_category||"",a=(e.type_hint_str||"").toLowerCase();if(ke.has(i))return!0;let c=i.toLowerCase();return c.includes("plate")||c.includes("tip")||c.includes("trough")||c.includes("reservoir")||c.includes("carrier")||c.includes("tube")?!1:a.includes("liquidhandler")||a.includes("platereader")||a.includes("shaker")||a.includes("centrifuge")||a.includes("incubator")||a.includes("heater")||a.includes("scara")}).map(e=>e.accession_id||"")});constructor(){ne(()=>{let t=this.showMachineError(),e=this.machineSelectionsValid(),i=this.stepper?.selectedIndex;(t||!e)&&i>2&&setTimeout(()=>{this.stepper&&(this.stepper.selectedIndex=2,this.snackBar.open("Environment mode changed. Please re-verify machines.","OK",{duration:5e3}))},100)})}isMachineSimulated=S(()=>{let t=this.selectedMachine();if(!t)return!1;let e=t.machine;if(e.backend_definition?.backend_type==="simulator")return!0;let a=((e.connection_info||{}).backend||"").toString();return e.is_simulation_override===!0||e.is_simulated===!0||a.includes("Simulator")||a.includes("simulation")||a.includes("Chatterbox")});showMachineError=S(()=>{if(this.store.simulationMode())return!1;let t=this.machineSelections();return!t||t.length===0?!1:t.some(e=>{if(e.selectedBackend)return e.selectedBackend.backend_type==="simulator";if(e.selectedMachine){let i=e.selectedMachine;if(i.backend_definition?.backend_type==="simulator")return!0;let c=((i.connection_info||{}).backend||"").toString().toLowerCase();return c.includes("chatterbox")||c.includes("simulation")}return!1})});onAssetSelectionChange(t){this.configuredAssets.set(t);let e=this.canProceedFromAssetSelection();this.assetsFormGroup.patchValue({valid:e})}canProceedFromAssetSelection(){let t=this.selectedProtocol();if(!t||!t.assets)return!0;let e=this.configuredAssets()||{};return t.assets.every(i=>i.optional||!!e[i.accession_id])}deckData=S(()=>{let t=this.selectedProtocol(),e=this.selectedMachine();return t?this.deckGenerator.generateDeckForProtocol(t,this.configuredAssets()||void 0,e?.machine):null});isBrowserModeActive(){if(this.modeService.isBrowserMode()||typeof window<"u"&&new URLSearchParams(window.location.search).get("mode")==="browser")return!0;try{if(localStorage.getItem("praxis_mode_override")==="browser")return!0}catch{}return!1}store=F(ti);wizardState=F(We);deckCatalog=F(Ge);selectedDeckType=S(()=>{let t=this.selectedMachine()?.machine;return this.deckCatalog.getDeckTypeForMachine(t)});onDeckSetupComplete(){let t=this.wizardState.getAssetMap();this.configuredAssets.set(t),this.deckFormGroup.patchValue({valid:!0}),setTimeout(()=>{this.stepper.next()},0)}onDeckSetupSkipped(){this.configuredAssets.set({}),this.deckFormGroup.patchValue({valid:!0}),setTimeout(()=>{this.stepper.next()},0)}recentProtocols=S(()=>{let t=this.getRecentIds(),e=this.protocols();return t.map(i=>e.find(a=>a.accession_id===i)).filter(i=>i!==void 0)});filterCategories=S(()=>{let t=this.protocols(),e=this.activeFilters(),i=new Map;t.forEach(g=>{let E=g.category||"Uncategorized";i.set(E,(i.get(E)||0)+1)});let a=Array.from(i.entries()).map(([g,E])=>({value:g,count:E,selected:e.category?.has(g)||!1})).sort((g,E)=>E.count-g.count),c=t.filter(g=>g.is_top_level).length,d=t.length-c,_=[{value:"Top Level",count:c,selected:e.type?.has("Top Level")||!1},{value:"Sub-Protocol",count:d,selected:e.type?.has("Sub-Protocol")||!1}].filter(g=>g.count>0);return[{key:"category",label:"Category",options:a,expanded:!0},{key:"type",label:"Type",options:_,expanded:!1}].filter(g=>g.options.length>0)});filteredProtocols=S(()=>{let t=this.protocols(),e=this.searchQuery().toLowerCase().trim(),i=this.activeFilters();return e&&(t=t.filter(a=>a.name.toLowerCase().includes(e)||a.description?.toLowerCase().includes(e)||a.category?.toLowerCase().includes(e))),i.category?.size&&(t=t.filter(a=>i.category.has(a.category||"Uncategorized"))),i.type?.size&&(t=t.filter(a=>{let c=i.type.has("Top Level")&&a.is_top_level,d=i.type.has("Sub-Protocol")&&!a.is_top_level;return c||d})),t});ngOnInit(){this.loadProtocols(),this.route.queryParams.subscribe(t=>{let e=t.protocolId;e&&this.protocols().length>0&&this.loadProtocolById(e)})}loadProtocols(){this.protocolService.getProtocols().pipe(Se(()=>this.isLoading.set(!1))).subscribe({next:t=>{this.protocols.set(t);let e=this.route.snapshot.queryParams.protocolId;e&&this.loadProtocolById(e)},error:t=>console.error("Failed to load protocols",t)})}loadProtocolById(t){let e=this.protocols().find(i=>i.accession_id===t);e&&this.selectProtocol(e)}selectProtocol(t){this.selectedProtocol.set(t),this.configuredAssets.set(null),this.parametersFormGroup=this._formBuilder.group({});let e=new Date().toISOString().split("T")[0],i=`${t.name} - ${e}`;this.runNameControl.setValue(i),t.parameters,this.protocolFormGroup.patchValue({protocolId:t.accession_id}),this.assetsFormGroup.patchValue({valid:!1}),this.deckFormGroup.patchValue({valid:t.requires_deck===!1}),this.loadCompatibility(t.accession_id)}loadCompatibility(t){this.isLoadingCompatibility.set(!0),this.executionService.getCompatibility(t).pipe(De(e=>this.assetService.getMachineDefinitions().pipe(be(i=>{let a=new Set(e.map(d=>d.machine.machine_definition_accession_id)),c=i.filter(d=>!a.has(d.accession_id)).map(d=>({machine:{accession_id:`template-${d.accession_id}`,name:d.name,machine_category:d.machine_category,is_simulation_override:!0,simulation_backend_name:d.available_simulation_backends?.[0]||"Chatterbox",description:d.description,machine_definition_accession_id:d.accession_id,is_template:!0},compatibility:{is_compatible:!0,missing_capabilities:[],matched_capabilities:[],warnings:[]}}));return[...e,...c]}))),Se(()=>this.isLoadingCompatibility.set(!1))).subscribe({next:e=>{let i=e,a=this.selectedProtocol();if(a){console.log("[RunProtocol] Debug Machine Filtering:",{protocolName:a.name,requiresDeck:a.requires_deck,assets:a.assets,allCompatLength:i.length});let d=new Set;(a.assets?.filter(g=>g.required_plr_category&&!g.required_plr_category.includes("plate")&&!g.required_plr_category.includes("tip_rack"))||[]).forEach(g=>{g.required_plr_category&&d.add(g.required_plr_category.toLowerCase()),g.type_hint_str?.includes("LiquidHandler")&&d.add("liquidhandler"),g.type_hint_str?.includes("PlateReader")&&d.add("platereader")}),console.log("[RunProtocol] Required Categories:",Array.from(d)),d.size===0&&a.requires_deck!==!1&&(console.log("[RunProtocol] Defaulting to LiquidHandler (deck required, no specific machine categories)"),d.add("liquidhandler")),d.size>0&&(i=i.filter(g=>{let z=(g.machine.machine_category||"").toLowerCase().replace(/[_\-\s]/g,"");return d.has(z)||d.has("liquidhandler")&&(z==="liquidhandler"||z.includes("hamilton")||z.includes("opentrons")||z.includes("tecan"))||d.has("platereader")&&(z==="platereader"||z.includes("bmg")||z.includes("clario"))}),console.log("[RunProtocol] After category filter:",i.length))}a?.requires_deck===!1&&(console.log("[RunProtocol] Deck not required, explicitly filtering out LiquidHandlers"),i=i.filter(d=>d.machine.machine_category!=="LiquidHandler"&&d.machine.machine_category!=="HamiltonSTAR"),console.log("[RunProtocol] After deck=false filter:",i.length)),this.compatibilityData.set(i);let c=i.filter(d=>d.compatibility.is_compatible&&!d.machine.is_template);c.length===1&&this.onMachineSelect(c[0])},error:e=>console.error("Failed to load compatibility/definitions",e)})}onMachineSelect(t){let e=t.machine;if(e.is_template){this.configureSimulationTemplate(t);return}this.selectedMachine.set(t);let i=e.accession_id;this.machineFormGroup.patchValue({machineId:i}),this.machineFormGroup.get("machineId")?.updateValueAndValidity()}configureSimulationTemplate(t){this.assetService.getMachineDefinitions().pipe(wt(1)).subscribe(e=>{let i=e.find(c=>c.accession_id===t.machine.machine_definition_accession_id);if(!i)return;this.dialog.open(ht,{data:{definition:i},disableClose:!0}).afterClosed().subscribe(c=>{c&&(this.isStartingRun.set(!0),this.assetService.getMachineFrontendDefinitions().pipe(De(d=>{let g=d.find(E=>E.fqn===i.frontend_fqn||E.fqn===i.fqn)?.accession_id||i.accession_id;return this.assetService.getBackendsForFrontend(g).pipe(be(E=>{let z=E.find(Q=>Q.backend_type==="simulator"&&(Q.name===c.simulation_backend_name||Q.fqn===c.simulation_backend_name));if(z||(z=E.find(Q=>Q.backend_type==="simulator"),z&&console.warn(`[RunProtocol] Specific simulator backend '${c.simulation_backend_name}' not found, falling back to: ${z.name}`)),!z){let Q=`No compatible simulator backend found for ${i.name}`;console.error(`[RunProtocol] ${Q}`),this.snackBar.open(Q,"OK",{duration:5e3})}return z||console.error(`[RunProtocol] No compatible backend found for frontend '${g}'`),{frontendId:g,backendId:z?.accession_id}}))}),De(d=>this.assetService.createMachine({name:c.name,frontend_definition_accession_id:d.frontendId,backend_definition_accession_id:d.backendId,backend_config:{},is_simulation_override:!0,simulation_backend_name:c.simulation_backend_name,connection_info:{backend:c.simulation_backend_name,plr_backend:i.fqn||""}})),Se(()=>this.isStartingRun.set(!1))).subscribe({next:d=>{let _={machine:q(D({},d),{machine_category:i.machine_category,is_simulation_override:!0}),compatibility:{is_compatible:!0,missing_capabilities:[],matched_capabilities:[],warnings:[]}};this.compatibilityData.update(g=>[_,...g]),this.onMachineSelect(_)},error:d=>{console.error("Failed to create simulation machine",d),this.snackBar.open("Failed to create simulation machine. Check console for details.","Close",{duration:5e3,panelClass:["error-snackbar"]})}}))})})}clearProtocol(){this.selectedProtocol.set(null),this.selectedMachine.set(null),this.compatibilityData.set([]),this.protocolFormGroup.reset(),this.machineFormGroup.reset(),this.router.navigate([],{relativeTo:this.route,queryParams:{protocolId:null},queryParamsHandling:"merge"})}getRecentIds(){try{let t=localStorage.getItem(on);return t?JSON.parse(t):[]}catch{return[]}}addToRecents(t){let e=this.getRecentIds().filter(i=>i!==t);e.unshift(t),localStorage.setItem(on,JSON.stringify(e.slice(0,la)))}onSearchChange(t){let e=t.target;this.searchQuery.set(e.value)}clearSearch(){this.searchQuery.set("")}toggleFilter(t,e){let i=this.activeFilters(),a=new Set(i[t]||[]);a.has(e)?a.delete(e):a.add(e),this.activeFilters.set(q(D({},i),{[t]:a}))}getSelectedCount(t){return t.options.filter(e=>e.selected).length}startRun(){let t=this.selectedProtocol();if(t&&this.parametersFormGroup.valid&&!this.isStartingRun()&&this.configuredAssets()){this.isStartingRun.set(!0);let e=this.runNameControl.value?.trim()||`${t.name} - ${new Date().toLocaleString()}`,i=this.runNotesControl.value?.trim()||"",a=this.wellSelections(),c=D(D({},this.parametersFormGroup.value),this.configuredAssets());Object.entries(a).forEach(([_,g])=>{let E=Array.isArray(g)?g.join(","):g;c[_]=E});let d=this.machineSelections();for(let _ of d)_.selectedMachine?c[_.argumentName]=_.selectedMachine.accession_id:_.selectedBackend&&(c[_.argumentName]={_create_from_backend:!0,backend_accession_id:_.selectedBackend.accession_id,frontend_accession_id:_.frontendId,is_simulated:_.selectedBackend.backend_type==="simulator",simulation_backend_name:_.selectedBackend.fqn});this.executionService.startRun(t.accession_id,e,c,this.store.simulationMode(),i).pipe(Se(()=>this.isStartingRun.set(!1))).subscribe({next:()=>{this.router.navigate(["live"],{relativeTo:this.route})},error:_=>console.error("[RunProtocol] Failed to start run:",_)})}}isWellSelectionParameter(t){let e=(t.name||"").toLowerCase();if(["well","wells","source_wells","target_wells","well_ids","indices"].some(c=>e.includes(c)))return!0;let a=t.ui_hint;return a==="well_selector"||a?.type==="well_selector"}getWellParameters(){return this.selectedProtocol()?.parameters?.filter(t=>this.isWellSelectionParameter(t))||[]}openWellSelector(t){let e=this.wellSelections()[t.name]||[],i=this.detectPlateType(),a={plateType:i,initialSelection:e,mode:"multi",title:`Select Wells: ${t.name}`,plateLabel:t.description||t.name};this.dialog.open(Wi,{data:a,width:i==="384"?"900px":"700px"}).afterClosed().subscribe(c=>{c?.confirmed&&(this.wellSelections.update(d=>q(D({},d),{[t.name]:c.wells})),this.validateWellSelections())})}detectPlateType(){let t=this.configuredAssets();if(t)for(let[,e]of Object.entries(t)){let i=e;if(i?.fqn?.toLowerCase().includes("384")||i?.name?.includes("384"))return"384"}return"96"}getWellSelectionLabel(t){let e=this.wellSelections()[t]||[];return e.length===0?"Click to select wells...":e.length<=5?e.join(", "):`${e.length} wells selected`}areWellSelectionsValid(){let t=this.getWellParameters(),e=this.wellSelections();return t.every(i=>i.optional?!0:(e[i.name]?.length||0)>0)}validateWellSelections(){this.wellsFormGroup.get("valid")?.setValue(this.areWellSelectionsValid())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-run-protocol"]],viewQuery:function(e,i){if(e&1&&qt(Mr,5),e&2){let a;Ot(a=It())&&(i.stepper=a.first)}},decls:124,vars:48,consts:[["stepper",""],[1,"h-full","flex","flex-col","p-6","max-w-screen-2xl","mx-auto"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-3xl","font-bold","text-sys-text-primary","mb-1"],[1,"text-sys-text-secondary"],[1,"flex","items-center","gap-3"],["hideSingleSelectionIndicator","",1,"!rounded-full","!border-[var(--theme-border)]","!bg-[var(--mat-sys-surface-variant)]","!overflow-hidden",3,"change","value"],[1,"!px-4","!text-sm","!font-medium",3,"value"],[1,"bg-surface","border","border-[var(--theme-border)]","rounded-3xl","overflow-y-auto","overflow-x-hidden","backdrop-blur-xl","flex-1","min-h-0","shadow-xl","flex","flex-col"],[1,"!bg-transparent","h-full","flex","flex-col",3,"linear"],[3,"stepControl"],["matStepLabel",""],["data-tour-id","run-step-protocol",1,"h-full","flex","flex-col","p-6",3,"formGroup"],[1,"flex","flex-col","h-full","overflow-y-auto","px-6","pb-6"],[1,"flex","h-full","gap-6"],["data-tour-id","run-step-params",1,"h-full","flex","flex-col","p-6",3,"formGroup"],[1,"flex-1","overflow-y-auto","max-w-3xl","mx-auto","w-full"],[1,"bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","rounded-2xl","p-8"],[1,"text-xl","font-bold","text-sys-text-primary","mb-6","flex","items-center","gap-3"],[1,"w-8","h-8","rounded-lg","bg-primary/20","flex","items-center","justify-center","text-primary"],[3,"protocol","formGroup"],[1,"wizard-footer","mt-6","flex","justify-between"],["mat-button","","matStepperPrevious","",1,"!text-sys-text-secondary"],["mat-flat-button","","color","primary","matStepperNext","",1,"!rounded-xl","!px-8","!py-6",3,"disabled"],["data-tour-id","run-step-machine",1,"h-full","flex","flex-col","p-6"],[1,"flex-1","overflow-y-auto"],[1,"flex-1"],[1,"mb-6","p-4","bg-red-500/10","border","border-red-500/20","rounded-2xl","flex","items-start","gap-3","animate-in","fade-in","slide-in-from-top-2","duration-300"],[1,"flex","flex-col","items-center","justify-center","py-12"],["data-tour-id","run-step-assets",1,"h-full","flex","flex-col","p-6"],[3,"protocol","isInline","excludeAssetIds","initialSelections"],[3,"stepControl","optional"],["data-tour-id","run-step-deck",1,"h-full","flex","flex-col"],[1,"flex","flex-col","items-center","justify-center","h-full","text-sys-text-tertiary"],[3,"data"],["label","Review & Run",3,"stepControl"],[1,"h-full","flex","flex-col","items-center","p-6","text-center","max-w-2xl","mx-auto","overflow-y-auto"],[1,"my-auto","w-full"],[1,"w-24","h-24","rounded-full","bg-primary/20","flex","items-center","justify-center","text-primary","mb-6","shadow-[0_0_30px_rgba(237,122,155,0.3)]"],[1,"!w-12","!h-12","!text-[48px]"],[1,"text-4xl","font-bold","text-sys-text-primary","mb-2"],[1,"text-xl","text-sys-text-secondary","mb-12"],[1,"grid","grid-cols-2","gap-4","w-full","mb-8"],[1,"bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","rounded-2xl","p-6","flex","flex-col","items-center"],[1,"text-sys-text-tertiary","text-sm","uppercase","tracking-wider","font-bold","mb-2"],["data-testid","review-protocol-name",1,"text-sys-text-primary","text-lg","font-medium"],[1,"text-lg","font-medium"],[1,"w-full","mb-8","text-left"],[3,"protocol","parameters","assets","wellSelections","wellSelectionRequired"],[1,"w-full","max-w-2xl","mb-8","space-y-4"],["appearance","outline",1,"w-full"],["matInput","","placeholder","e.g., Pilot Study - Batch 3","required","",3,"formControl"],["matInput","","rows","3","placeholder","Document experimental conditions, operator notes, etc.",3,"formControl"],[1,"wizard-footer","flex","gap-4","w-full","justify-center","mt-auto"],["mat-button","","matStepperPrevious","",1,"!border-[var(--theme-border)]","!text-sys-text-secondary","!rounded-xl","!px-8","!py-6","w-40","border"],["mat-stroked-button","","color","primary","matTooltipPosition","above",1,"!rounded-xl","!px-6","!py-6","!font-bold","!text-lg","w-48","!border-primary/50",3,"disabled","matTooltip","matTooltipShowDelay"],[1,"flex","items-center","gap-2"],["mat-raised-button","",1,"!bg-gradient-to-r","!from-green-500","!to-emerald-600","!text-white","!rounded-xl","!px-8","!py-6","!font-bold","!text-lg","w-64","shadow-lg","shadow-green-500/20","hover:shadow-green-500/40","hover:-translate-y-0.5","transition-all",3,"click","disabled"],["data-tour-id","run-step-label-protocol"],[1,"flex","justify-between","mb-6","sticky","top-0","bg-surface","z-10","py-4"],["mat-button","",1,"!text-sys-text-secondary",3,"click"],["mat-flat-button","","color","primary","matStepperNext","",1,"!rounded-xl","!px-8","!py-6"],[1,"max-w-2xl","w-full","mx-auto","bg-surface-elevated","border","border-primary/30","rounded-3xl","p-8","relative","overflow-hidden","group","shadow-2xl"],[1,"absolute","inset-0","bg-gradient-to-br","from-primary/10","to-transparent","opacity-50"],[1,"relative","z-10","flex","flex-col","items-center","text-center","gap-4"],[1,"w-16","h-16","rounded-2xl","bg-gradient-to-br","from-primary","to-primary-dark","flex","items-center","justify-center","shadow-lg","shadow-primary/30","mb-2"],[1,"!w-8","!h-8","!text-[32px]","text-white"],[1,"text-3xl","font-bold","text-sys-text-primary","mb-0"],[1,"description-container","w-full","max-w-lg"],[1,"text-lg","text-sys-text-secondary"],[1,"flex","gap-2","mt-2"],[1,"px-3","py-1","rounded-full","bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","text-sys-text-secondary","text-sm","flex","items-center","gap-2"],[1,"!w-4","!h-4","!text-[16px]"],[1,"w-72","flex-shrink-0","flex","flex-col","gap-6"],[1,"bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","rounded-2xl","p-4"],[1,"relative","mb-4"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-sys-text-tertiary"],["placeholder","Search protocols...",1,"w-full","bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","rounded-xl","py-3","pl-10","pr-10","text-sys-text-primary","placeholder-sys-text-tertiary","focus:outline-none","focus:border-primary/50","transition-colors",3,"input","value"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-sys-text-tertiary","hover:text-sys-text-primary"],[1,"flex","flex-col","gap-4"],[1,"flex","flex-col","gap-2"],[1,"flex-1","overflow-auto","pr-2"],[1,"mb-8"],[1,"text-sys-text-primary","text-lg","font-medium","mb-4","flex","items-center","gap-2"],[1,"text-primary/70"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"flex","flex-col","items-center","justify-center","py-20","text-sys-text-tertiary"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","pb-8"],[1,"absolute","right-3","top-1/2","-translate-y-1/2","text-sys-text-tertiary","hover:text-sys-text-primary",3,"click"],[1,"!w-5","!h-5","!text-[20px]"],[1,"text-xs","font-bold","text-sys-text-tertiary","uppercase","tracking-wider","px-2"],[1,"flex","items-center","justify-between","w-full","px-3","py-2","rounded-lg","text-sm","transition-all","hover:bg-[var(--mat-sys-surface-variant)]","text-left",3,"bg-primary-10","text-primary","text-sys-text-secondary"],[1,"flex","items-center","justify-between","w-full","px-3","py-2","rounded-lg","text-sm","transition-all","hover:bg-[var(--mat-sys-surface-variant)]","text-left",3,"click"],[1,"bg-[var(--mat-sys-surface-variant)]","px-1.5","py-0.5","rounded","text-xs","opacity-60"],[1,"transform","hover:-translate-y-1","transition-transform","duration-300",3,"protocol","compact"],[1,"transform","hover:-translate-y-1","transition-transform","duration-300",3,"select","protocol","compact"],[1,"!w-16","!h-16","!text-[64px]","opacity-20","mb-4"],[1,"text-lg"],["mat-button","",1,"mt-4","!text-primary",3,"click"],[1,"transform","hover:-translate-y-1","transition-transform","duration-300",3,"protocol"],[1,"transform","hover:-translate-y-1","transition-transform","duration-300",3,"select","protocol"],["data-tour-id","run-step-label-params"],["data-tour-id","run-step-label-machine"],[1,"text-red-400","mt-0.5"],[1,"text-red-400","font-bold"],[1,"text-red-400/80","text-sm"],["diameter","40"],[1,"mt-4","text-sys-text-tertiary"],[3,"selectionsChange","validChange","requirements","simulationMode"],[3,"machines","selected","isPhysicalMode"],[3,"select","machines","selected","isPhysicalMode"],["data-tour-id","run-step-label-assets"],[3,"selectionChange","protocol","isInline","excludeAssetIds","initialSelections"],["data-tour-id","run-step-wells",1,"h-full","flex","flex-col","p-6"],[1,"text-sys-text-secondary","mb-6"],[1,"mb-6","p-4","bg-surface-variant","rounded-xl"],["data-tour-id","run-step-label-wells"],[1,"flex","items-center","justify-between","mb-2"],[1,"font-medium"],[1,"text-sm","text-sys-text-tertiary"],["mat-stroked-button","",1,"w-full","!justify-start",3,"click"],[1,"mr-2"],["data-tour-id","run-step-label-deck"],[1,"w-16","h-16","rounded-full","bg-green-500/20","flex","items-center","justify-center","mb-4"],[1,"!w-8","!h-8","!text-[32px]","text-green-500"],[1,"text-lg","font-medium","text-sys-text-primary","mb-2"],[1,"text-sys-text-secondary","mb-6","max-w-md","text-center"],[1,"flex","gap-4"],["mat-button","","matStepperPrevious","",1,"!border-[var(--theme-border)]","!rounded-xl","!px-6","!py-6"],[3,"setupComplete","setupSkipped","data"],["diameter","24",1,"mr-2"]],template:function(e,i){if(e&1){let a=v();r(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),s(4,"Execute Protocol"),o(),r(5,"p",4),s(6,"Configure and run experimental procedures"),o()(),r(7,"div",5)(8,"mat-button-toggle-group",6),h("change",function(d){return x(a),C(i.store.setSimulationMode(d.value))}),r(9,"mat-button-toggle",7),s(10,"Physical"),o(),r(11,"mat-button-toggle",7),s(12,"Simulation"),o()()()(),r(13,"div",8)(14,"mat-stepper",9,0)(16,"mat-step",10),Y(17,Tr,2,0,"ng-template",11),r(18,"form",12),p(19,qr,30,4,"div",13)(20,Gr,21,4,"div",14),o()(),r(21,"mat-step",10),Y(22,Wr,2,0,"ng-template",11),r(23,"form",15)(24,"div",16)(25,"div",17)(26,"h3",18)(27,"div",19)(28,"mat-icon"),s(29,"tune"),o()(),s(30," Protocol Parameters "),o(),O(31,"app-parameter-config",20),o()(),r(32,"div",21)(33,"button",22),s(34,"Back"),o(),r(35,"button",23),s(36,"Continue"),o()()()(),r(37,"mat-step",10),Y(38,jr,2,0,"ng-template",11),r(39,"div",24)(40,"div",25)(41,"h3",18)(42,"div",19)(43,"mat-icon"),s(44,"precision_manufacturing"),o()(),s(45," Select Execution Machines "),O(46,"span",26)(47,"app-hardware-discovery-button"),o(),p(48,Hr,8,0,"div",27),p(49,Ur,4,0,"div",28)(50,Kr,2,4),o(),r(51,"div",21)(52,"button",22),s(53,"Back"),o(),r(54,"button",23),s(55,"Continue"),o()()()(),r(56,"mat-step",10),Y(57,Yr,2,0,"ng-template",11),r(58,"div",29)(59,"div",25)(60,"h3",18)(61,"div",19)(62,"mat-icon"),s(63,"inventory_2"),o()(),s(64," Asset Selection "),o(),p(65,Xr,1,5,"app-guided-setup",30),o(),r(66,"div",21)(67,"button",22),s(68,"Back"),o(),r(69,"button",23),s(70,"Continue"),o()()()(),p(71,ea,18,2,"mat-step",10),r(72,"mat-step",31),Y(73,ta,2,0,"ng-template",11),r(74,"div",32),p(75,ia,13,0,"div",33)(76,na,1,7,"app-deck-setup-wizard",34)(77,oa,5,0,"div",33),o()(),r(78,"mat-step",35)(79,"div",36)(80,"div",37)(81,"div",38)(82,"mat-icon",39),s(83,"rocket_launch"),o()(),r(84,"h2",40),s(85,"Ready to Launch"),o(),r(86,"p",41),s(87,"Confirm execution parameters before starting"),o(),r(88,"div",42)(89,"div",43)(90,"span",44),s(91,"Protocol"),o(),r(92,"span",45),s(93),o()(),r(94,"div",43)(95,"span",44),s(96,"Mode"),o(),r(97,"span",46),s(98),o()()(),r(99,"div",47),O(100,"app-protocol-summary",48),o(),r(101,"div",49)(102,"mat-form-field",50)(103,"mat-label"),s(104,"Run Name"),o(),O(105,"input",51),r(106,"mat-hint"),s(107,"Give this run a descriptive name"),o(),p(108,ra,2,0,"mat-error"),o(),r(109,"mat-form-field",50)(110,"mat-label"),s(111,"Notes (Optional)"),o(),O(112,"textarea",52),o()(),r(113,"div",53)(114,"button",54),s(115,"Back"),o(),r(116,"button",55)(117,"div",56)(118,"mat-icon"),s(119,"calendar_today"),o(),s(120," Schedule "),o()(),r(121,"button",57),h("click",function(){return x(a),C(i.startRun())}),p(122,aa,2,0)(123,sa,4,0,"div",56),o()()()()()()()()}if(e&2){let a,c,d;l(8),f("value",i.store.simulationMode()),l(),R("!text-sys-text-primary",!i.store.simulationMode()),f("value",!1),l(2),R("!text-primary",i.store.simulationMode()),f("value",!0),l(3),f("linear",!0),l(2),f("stepControl",i.protocolFormGroup),l(2),f("formGroup",i.protocolFormGroup),l(),u(i.selectedProtocol()?19:20),l(2),f("stepControl",i.parametersFormGroup),l(2),f("formGroup",i.parametersFormGroup),l(8),f("protocol",i.selectedProtocol())("formGroup",i.parametersFormGroup),l(4),f("disabled",i.parametersFormGroup.invalid),l(2),f("stepControl",i.machineFormGroup),l(11),u(i.showMachineError()?48:-1),l(),u(i.isLoadingCompatibility()?49:50),l(5),f("disabled",!i.machineSelectionsValid()||i.showMachineError()),l(2),f("stepControl",i.assetsFormGroup),l(9),u(i.selectedProtocol()?65:-1),l(4),f("disabled",i.assetsFormGroup.invalid),l(2),u(i.wellSelectionRequired()?71:-1),l(),f("stepControl",i.deckFormGroup)("optional",((a=i.selectedProtocol())==null?null:a.requires_deck)===!1),l(3),u(((c=i.selectedProtocol())==null?null:c.requires_deck)===!1?75:i.selectedProtocol()?76:77),l(3),f("stepControl",i.readyFormGroup),l(15),y((d=i.selectedProtocol())==null?null:d.name),l(4),R("text-primary",i.store.simulationMode())("text-blue-400",!i.store.simulationMode()),l(),b(" ",i.store.simulationMode()?"Simulation":"Physical Run"," "),l(2),f("protocol",i.selectedProtocol())("parameters",i.parametersFormGroup.value)("assets",i.configuredAssets()||H(47,Pt))("wellSelections",i.wellSelections())("wellSelectionRequired",i.wellSelectionRequired()),l(5),f("formControl",i.runNameControl),l(3),u(i.runNameControl.hasError("required")?108:-1),l(4),f("formControl",i.runNotesControl),l(4),f("disabled",i.modeService.isBrowserMode()||i.isStartingRun()||i.executionService.isRunning())("matTooltip",i.modeService.isBrowserMode()?"Scheduling is not supported in browser mode":"Schedule this protocol for later")("matTooltipShowDelay",600),l(5),f("disabled",i.isStartingRun()||i.executionService.isRunning()||!i.configuredAssets()||!i.machineSelectionsValid()||i.showMachineError()),l(),u(i.isStartingRun()?122:123)}},dependencies:[tt,Vi,Ni,Li,Bi,$i,N,U,T,I,K,ze,ce,te,Fe,ai,de,oi,Ne,pe,me,Le,$e,Be,fe,ue,xe,Ce,Pi,_e,ge,xi,zi,Fi,Ai,W,ee,ut,Gi,ft,mt,pt,wi,at,_t,lt,hi],styles:["[_nghost-%COMP%]{display:block;height:100%}.bg-primary-10[_ngcontent-%COMP%]{background-color:rgba(var(--primary-color-rgb),.1)}.text-white-70[_ngcontent-%COMP%]{color:var(--theme-text-secondary)}.border-green-500-30[_ngcontent-%COMP%]{border-color:#4ade804d!important}.bg-green-500-05[_ngcontent-%COMP%]{background-color:#4ade800d!important}.description-container[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto;margin:16px 0;padding-right:8px}  .mat-horizontal-stepper-wrapper{flex:1 1 auto;display:flex;flex-direction:column;height:100%;min-height:0}  .mat-horizontal-content-container{flex:1 1 auto;height:100%;min-height:0;padding:0!important;overflow:hidden!important}  .mat-horizontal-stepper-content.mat-horizontal-stepper-content-current{height:100%!important;display:flex!important;flex-direction:column!important;min-height:0!important;overflow:hidden!important;visibility:visible!important}  .mat-horizontal-stepper-content:not(.mat-horizontal-stepper-content-current){height:0!important;overflow:hidden!important;visibility:hidden!important;display:none!important}  .mat-step-header{border-radius:12px;transition:background .2s;padding:12px 24px!important}  .mat-step-header:hover{background:var(--mat-sys-surface-variant)}  .mat-step-label{color:var(--theme-text-secondary)!important;font-size:.85rem!important;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important;line-height:1.3!important}.wizard-footer[_ngcontent-%COMP%]{position:sticky;bottom:0;background:var(--mat-sys-surface);border-top:1px solid var(--mat-sys-outline-variant);padding:16px;z-index:20}  .mat-mdc-form-field.mat-focused .mdc-notched-outline__leading,   .mat-mdc-form-field.mat-focused .mdc-notched-outline__notch,   .mat-mdc-form-field.mat-focused .mdc-notched-outline__trailing{border-color:var(--mat-sys-primary)!important;border-width:2px!important}  .mat-step-label-selected{color:var(--theme-text-primary)!important;font-weight:600!important}  .mat-step-icon{background-color:var(--mat-sys-surface-variant)!important;color:var(--theme-text-secondary)!important}  .mat-step-icon-selected{background-color:var(--primary-color)!important;color:#fff!important}  .mat-step-icon-content{color:inherit!important}"],changeDetection:0})};var Ct=class n{constructor(){}getTemperatureStream(){return kt(1e3).pipe(be(()=>({timestamp:Date.now(),value:20+Math.random()*20,label:"Temperature (\xB0C)"})),Et(1))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=Te({token:n,factory:n.\u0275fac,providedIn:"root"})};var ca=()=>({position:"relative",width:"100%",height:"100%"}),yt=class n{xData=[];yData=[];title="Telemetry Data";yAxisTitle="Value";graph={data:[{x:[],y:[],type:"scatter",mode:"lines+markers",marker:{color:"#00e5ff"},line:{shape:"spline",color:"#00e5ff"},name:"Live Data"}],layout:{title:{text:this.title,font:{color:"#ffffff",size:18}},paper_bgcolor:"transparent",plot_bgcolor:"transparent",xaxis:{gridcolor:"rgba(255,255,255,0.1)",tickfont:{color:"#ffffff"},title:{text:"Time",font:{color:"#ffffff"}}},yaxis:{gridcolor:"rgba(255,255,255,0.1)",tickfont:{color:"#ffffff"},title:{text:this.yAxisTitle,font:{color:"#ffffff"}}},margin:{t:50,r:30,l:60,b:50},autosize:!0},config:{displayModeBar:!1,responsive:!0}};ngOnChanges(t){(t.xData||t.yData)&&(this.graph.data[0].x=[...this.xData],this.graph.data[0].y=[...this.yData]),t.title&&(this.graph.layout.title.text=this.title),t.yAxisTitle&&(this.graph.layout.yaxis.title.text=this.yAxisTitle)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-telemetry-chart"]],inputs:{xData:"xData",yData:"yData",title:"title",yAxisTitle:"yAxisTitle"},features:[Z],decls:2,vars:7,consts:[[1,"chart-container"],[3,"data","layout","config","useResizeHandler"]],template:function(e,i){e&1&&(r(0,"div",0),O(1,"plotly-plot",1),o()),e&2&&(l(),At(H(6,ca)),f("data",i.graph.data)("layout",i.graph.layout)("config",i.graph.config)("useResizeHandler",!0))},dependencies:[Zi,Xi],styles:[".chart-container[_ngcontent-%COMP%]{width:100%;height:400px;background:#ffffff0d;border-radius:8px;padding:16px;box-sizing:border-box}"]})};function da(n,t){if(n&1&&(r(0,"p",4)(1,"span",19),s(2,"Current Step:"),o(),s(3),o()),n&2){let e=m();l(3),b(" ",e.currentStep," ")}}function ma(n,t){if(n&1&&(r(0,"div",18),s(1),o()),n&2){let e=t.$implicit;l(),y(e)}}function pa(n,t){n&1&&(r(0,"div",19),s(1,"Waiting for log output..."),o())}function ua(n,t){n&1&&(r(0,"div",22)(1,"button",23)(2,"mat-icon"),s(3,"replay"),o(),s(4," Run Another "),o(),r(5,"button",24)(6,"mat-icon"),s(7,"home"),o(),s(8," Dashboard "),o()())}function fa(n,t){if(n&1){let e=v();r(0,"div",6)(1,"mat-card",7)(2,"mat-card-header")(3,"mat-card-title"),s(4),o(),r(5,"mat-card-subtitle"),s(6),o()(),r(7,"mat-card-content",8)(8,"div",9)(9,"mat-chip-set")(10,"mat-chip",10),s(11),Bt(12,"uppercase"),o()()(),r(13,"div",11)(14,"p",12),s(15),o(),O(16,"mat-progress-bar",13),o(),p(17,da,4,1,"p",4),o(),r(18,"mat-card-actions")(19,"button",14),h("click",function(){x(e);let a=m();return C(a.stopRun())}),r(20,"mat-icon"),s(21,"stop"),o(),s(22," Stop "),o(),r(23,"button",15),h("click",function(){x(e);let a=m();return C(a.pauseRun())}),r(24,"mat-icon"),s(25,"pause"),o(),s(26," Pause "),o(),r(27,"button",15),h("click",function(){x(e);let a=m();return C(a.resumeRun())}),r(28,"mat-icon"),s(29,"play_arrow"),o(),s(30," Resume "),o()()(),r(31,"mat-card",16)(32,"mat-card-header")(33,"mat-card-title"),s(34,"Execution Log"),o()(),r(35,"mat-card-content",8)(36,"div",17),k(37,ma,2,1,"div",18,Tt,!1,pa,2,0,"div",19),o()()()(),r(40,"div",20)(41,"mat-card",7)(42,"mat-card-header")(43,"mat-card-title"),s(44,"Live Telemetry"),o()(),r(45,"mat-card-content",8),O(46,"app-telemetry-chart",21),o()()(),p(47,ua,9,0,"div",22)}if(n&2){let e=t,i=m();l(4),y(e.protocolName),l(2),b("Run ID: ",e.runId),l(4),R("bg-green-100",e.status===i.ExecutionStatus.COMPLETED)("bg-red-100",e.status===i.ExecutionStatus.FAILED),f("highlighted",e.status===i.ExecutionStatus.RUNNING),l(),b(" ",$t(12,18,e.status)," "),l(4),b("Progress: ",e.progress,"%"),l(),f("value",e.progress),l(),u(e.currentStep?17:-1),l(2),f("disabled",e.status!==i.ExecutionStatus.RUNNING&&e.status!==i.ExecutionStatus.PAUSED),l(4),f("disabled",e.status!==i.ExecutionStatus.RUNNING),l(4),f("disabled",e.status!==i.ExecutionStatus.PAUSED),l(10),w(e.logs),l(9),f("xData",i.telemetryX)("yData",i.telemetryY),l(),u(e.status===i.ExecutionStatus.COMPLETED||e.status===i.ExecutionStatus.FAILED?47:-1)}}function ga(n,t){n&1&&(r(0,"mat-card",5)(1,"mat-icon",25),s(2,"play_disabled"),o(),r(3,"p",19),s(4,"No active execution"),o(),r(5,"button",26),s(6," Start New Run "),o()())}var vt=class n{executionService=F(je);telemetryService=F(Ct);ExecutionStatus=ci;telemetryX=[];telemetryY=[];telemetrySubscription;constructor(){this.startTelemetry()}startTelemetry(){this.telemetrySubscription=this.telemetryService.getTemperatureStream().subscribe(t=>{let e=new Date(t.timestamp).toLocaleTimeString();this.telemetryX=[...this.telemetryX,e],this.telemetryY=[...this.telemetryY,t.value],this.telemetryX.length>30&&(this.telemetryX.shift(),this.telemetryY.shift())})}stopRun(){this.executionService.stopRun().subscribe()}pauseRun(){this.executionService.pauseRun().subscribe()}resumeRun(){this.executionService.resumeRun().subscribe()}ngOnDestroy(){this.telemetrySubscription?.unsubscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-live-dashboard"]],decls:11,vars:7,consts:[[1,"p-6"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-bold"],[1,"flex","items-center","gap-2"],[1,"text-sm"],[1,"glass-panel","text-center","py-12"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"glass-panel"],[1,"pt-4"],[1,"flex","items-center","gap-2","mb-4"],[3,"highlighted"],[1,"mb-4"],[1,"text-sm","text-gray-600","mb-1"],["mode","determinate",3,"value"],["mat-button","","color","warn",3,"click","disabled"],["mat-button","","color","primary",3,"click","disabled"],[1,"glass-panel","lg:col-span-2"],[1,"bg-gray-900","text-green-400","font-mono","text-sm","p-4","rounded-lg","h-64","overflow-y-auto"],[1,"mb-1"],[1,"text-gray-500"],[1,"mt-6"],["title","Temperature Over Time","yAxisTitle","Temperature (\xB0C)",3,"xData","yData"],[1,"mt-6","flex","gap-2"],["mat-flat-button","","color","primary","routerLink","/run"],["mat-stroked-button","","routerLink","/home"],[1,"text-6xl","text-gray-300","mb-4"],["mat-flat-button","","color","primary","routerLink","/run",1,"mt-4"]],template:function(e,i){if(e&1&&(r(0,"div",0)(1,"div",1)(2,"h1",2),s(3,"Execution Monitor"),o(),r(4,"div",3)(5,"span",4)(6,"mat-icon",4),s(7),o(),s(8),o()()(),p(9,fa,48,20)(10,ga,7,0,"mat-card",5),o()),e&2){let a;l(5),R("text-green-600",i.executionService.isConnected())("text-gray-400",!i.executionService.isConnected()),l(2),y(i.executionService.isConnected()?"wifi":"wifi_off"),l(),b(" ",i.executionService.isConnected()?"Connected":"Disconnected"," "),l(),u((a=i.executionService.currentRun())?9:10,a)}},dependencies:[G,Qe,Ci,Si,vi,Mi,bi,yi,Ye,Ke,N,U,T,I,he,He,mi,Kt,yt,Ht],encapsulation:2})};var em=[{path:"",component:xt},{path:"live",component:vt}];export{em as RUN_PROTOCOL_ROUTES};
