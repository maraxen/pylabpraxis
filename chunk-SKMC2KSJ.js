import{$ as An,L as Nn,V as In,ha as Fn,l as qt,q as xn,w as D}from"./chunk-ZXFVGPYG.js";import{a as M,b as z,c as Wr,f as Rt,i as Ur}from"./chunk-RNQFGQA5.js";var Mn=Rt(()=>{"use strict"});var Bn=Rt(()=>{"use strict"});var $n=Rt((Xe,Se)=>{"use strict";var Ge=void 0,Ye=function(p){return Ge||(Ge=new Promise(function(r,s){var l=typeof p<"u"?p:{},c=l.onAbort;l.onAbort=function(e){s(new Error(e)),c&&c(e)},l.postRun=l.postRun||[],l.postRun.push(function(){r(l)}),Se=void 0;var o;o||=typeof l<"u"?l:{};var m=typeof window=="object",y=typeof WorkerGlobalScope<"u",R=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";o.onRuntimeInitialized=function(){function e(u,_){switch(typeof _){case"boolean":$r(u,_?1:0);break;case"number":Fr(u,_);break;case"string":Mr(u,_,-1,-1);break;case"object":if(_===null)Pn(u);else if(_.length!=null){var g=ze(_,Qe);Br(u,g,_.length,-1),Ve(g)}else Je(u,"Wrong API use : tried to return a value of an unknown type ("+_+").",-1);break;default:Pn(u)}}function t(u,_){for(var g=[],w=0;w<u;w+=1){var E=ie(_+4*w,"i32"),C=jr(E);if(C===1||C===2)E=Ar(E);else if(C===3)E=Nr(E);else if(C===4){C=E,E=xr(C),C=Ir(C);for(var K=new Uint8Array(E),Y=0;Y<E;Y+=1)K[Y]=B[C+Y];E=K}else E=null;g.push(E)}return g}function n(u,_){this.Qa=u,this.db=_,this.Oa=1,this.lb=[]}function i(u,_){if(this.db=_,_=Pe(u)+1,this.eb=St(_),this.eb===null)throw Error("Unable to allocate memory for the SQL string");oe(u,P,this.eb,_),this.kb=this.eb,this.Za=this.pb=null}function a(u){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),u!=null){var _=this.filename,g="/",w=_;if(g&&(g=typeof g=="string"?g:lt(g),w=_?ot(g+"/"+_):g),_=nn(!0,!0),w=cr(w,_),u){if(typeof u=="string"){g=Array(u.length);for(var E=0,C=u.length;E<C;++E)g[E]=u.charCodeAt(E);u=g}$e(w,_|146),g=qe(w,577),Sn(g,u,0,u.length,0),_t(g),$e(w,_)}}this.handleError(v(this.filename,d)),this.db=ie(d,"i32"),Ln(this.db),this.fb={},this.Sa={}}var d=_e(4),f=o.cwrap,v=f("sqlite3_open","number",["string","number"]),T=f("sqlite3_close_v2","number",["number"]),O=f("sqlite3_exec","number",["number","string","number","number","number"]),A=f("sqlite3_changes","number",["number"]),Q=f("sqlite3_prepare_v2","number",["number","string","number","number","number"]),En=f("sqlite3_sql","string",["number"]),hr=f("sqlite3_normalized_sql","string",["number"]),kn=f("sqlite3_prepare_v2","number",["number","number","number","number","number"]),br=f("sqlite3_bind_text","number",["number","number","number","number","number"]),On=f("sqlite3_bind_blob","number",["number","number","number","number","number"]),yr=f("sqlite3_bind_double","number",["number","number","number"]),gr=f("sqlite3_bind_int","number",["number","number","number"]),Sr=f("sqlite3_bind_parameter_index","number",["number","string"]),vr=f("sqlite3_step","number",["number"]),wr=f("sqlite3_errmsg","string",["number"]),Rr=f("sqlite3_column_count","number",["number"]),qr=f("sqlite3_data_count","number",["number"]),Er=f("sqlite3_column_double","number",["number","number"]),Tn=f("sqlite3_column_text","string",["number","number"]),kr=f("sqlite3_column_blob","number",["number","number"]),Or=f("sqlite3_column_bytes","number",["number","number"]),Tr=f("sqlite3_column_type","number",["number","number"]),Dr=f("sqlite3_column_name","string",["number","number"]),Pr=f("sqlite3_reset","number",["number"]),Cr=f("sqlite3_clear_bindings","number",["number"]),Lr=f("sqlite3_finalize","number",["number"]),Dn=f("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),jr=f("sqlite3_value_type","number",["number"]),xr=f("sqlite3_value_bytes","number",["number"]),Nr=f("sqlite3_value_text","string",["number"]),Ir=f("sqlite3_value_blob","number",["number"]),Ar=f("sqlite3_value_double","number",["number"]),Fr=f("sqlite3_result_double","",["number","number"]),Pn=f("sqlite3_result_null","",["number"]),Mr=f("sqlite3_result_text","",["number","string","number","number"]),Br=f("sqlite3_result_blob","",["number","number","number","number"]),$r=f("sqlite3_result_int","",["number","number"]),Je=f("sqlite3_result_error","",["number","string","number"]),Cn=f("sqlite3_aggregate_context","number",["number","number"]),Ln=f("RegisterExtensionFunctions","number",["number"]),jn=f("sqlite3_update_hook","number",["number","number","number"]);n.prototype.bind=function(u){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(u)?this.Cb(u):u!=null&&typeof u=="object"?this.Db(u):!0},n.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var u=vr(this.Qa);switch(u){case 100:return!0;case 101:return!1;default:throw this.db.handleError(u)}},n.prototype.wb=function(u){return u==null&&(u=this.Oa,this.Oa+=1),Er(this.Qa,u)},n.prototype.Gb=function(u){if(u==null&&(u=this.Oa,this.Oa+=1),u=Tn(this.Qa,u),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(u)},n.prototype.Hb=function(u){return u==null&&(u=this.Oa,this.Oa+=1),Tn(this.Qa,u)},n.prototype.getBlob=function(u){u==null&&(u=this.Oa,this.Oa+=1);var _=Or(this.Qa,u);u=kr(this.Qa,u);for(var g=new Uint8Array(_),w=0;w<_;w+=1)g[w]=B[u+w];return g},n.prototype.get=function(u,_){_=_||{},u!=null&&this.bind(u)&&this.step(),u=[];for(var g=qr(this.Qa),w=0;w<g;w+=1)switch(Tr(this.Qa,w)){case 1:var E=_.useBigInt?this.Gb(w):this.wb(w);u.push(E);break;case 2:u.push(this.wb(w));break;case 3:u.push(this.Hb(w));break;case 4:u.push(this.getBlob(w));break;default:u.push(null)}return u},n.prototype.getColumnNames=function(){for(var u=[],_=Rr(this.Qa),g=0;g<_;g+=1)u.push(Dr(this.Qa,g));return u},n.prototype.getAsObject=function(u,_){u=this.get(u,_),_=this.getColumnNames();for(var g={},w=0;w<_.length;w+=1)g[_[w]]=u[w];return g},n.prototype.getSQL=function(){return En(this.Qa)},n.prototype.getNormalizedSQL=function(){return hr(this.Qa)},n.prototype.run=function(u){return u!=null&&this.bind(u),this.step(),this.reset()},n.prototype.sb=function(u,_){_==null&&(_=this.Oa,this.Oa+=1),u=Zt(u);var g=ze(u,Qe);this.lb.push(g),this.db.handleError(br(this.Qa,_,g,u.length-1,0))},n.prototype.Bb=function(u,_){_==null&&(_=this.Oa,this.Oa+=1);var g=ze(u,Qe);this.lb.push(g),this.db.handleError(On(this.Qa,_,g,u.length,0))},n.prototype.rb=function(u,_){_==null&&(_=this.Oa,this.Oa+=1),this.db.handleError((u===(u|0)?gr:yr)(this.Qa,_,u))},n.prototype.Eb=function(u){u==null&&(u=this.Oa,this.Oa+=1),On(this.Qa,u,0,0,0)},n.prototype.tb=function(u,_){switch(_==null&&(_=this.Oa,this.Oa+=1),typeof u){case"string":this.sb(u,_);return;case"number":this.rb(u,_);return;case"bigint":this.sb(u.toString(),_);return;case"boolean":this.rb(u+0,_);return;case"object":if(u===null){this.Eb(_);return}if(u.length!=null){this.Bb(u,_);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+u+")."},n.prototype.Db=function(u){var _=this;return Object.keys(u).forEach(function(g){var w=Sr(_.Qa,g);w!==0&&_.tb(u[g],w)}),!0},n.prototype.Cb=function(u){for(var _=0;_<u.length;_+=1)this.tb(u[_],_+1);return!0},n.prototype.reset=function(){return this.freemem(),Cr(this.Qa)===0&&Pr(this.Qa)===0},n.prototype.freemem=function(){for(var u;(u=this.lb.pop())!==void 0;)Ve(u)},n.prototype.free=function(){this.freemem();var u=Lr(this.Qa)===0;return delete this.db.fb[this.Qa],this.Qa=0,u},i.prototype.next=function(){if(this.eb===null)return{done:!0};if(this.Za!==null&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var u=Ne(),_=_e(4);De(d),De(_);try{this.db.handleError(kn(this.db.db,this.kb,-1,d,_)),this.kb=ie(_,"i32");var g=ie(d,"i32");return g===0?(this.mb(),{done:!0}):(this.Za=new n(g,this.db),this.db.fb[g]=this.Za,{value:this.Za,done:!1})}catch(w){throw this.pb=it(this.kb),this.mb(),w}finally{xe(u)}},i.prototype.mb=function(){Ve(this.eb),this.eb=null},i.prototype.getRemainingSQL=function(){return this.pb!==null?this.pb:it(this.kb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(i.prototype[Symbol.iterator]=function(){return this}),a.prototype.run=function(u,_){if(!this.db)throw"Database closed";if(_){u=this.prepare(u,_);try{u.step()}finally{u.free()}}else this.handleError(O(this.db,u,0,0,d));return this},a.prototype.exec=function(u,_,g){if(!this.db)throw"Database closed";var w=Ne(),E=null;try{var C=yt(u),K=_e(4);for(u=[];ie(C,"i8")!==0;){De(d),De(K),this.handleError(kn(this.db,C,-1,d,K));var Y=ie(d,"i32");if(C=ie(K,"i32"),Y!==0){var V=null;for(E=new n(Y,this),_!=null&&E.bind(_);E.step();)V===null&&(V={columns:E.getColumnNames(),values:[]},u.push(V)),V.values.push(E.get(null,g));E.free()}}return u}catch(Z){throw E&&E.free(),Z}finally{xe(w)}},a.prototype.each=function(u,_,g,w,E){typeof _=="function"&&(w=g,g=_,_=void 0),u=this.prepare(u,_);try{for(;u.step();)g(u.getAsObject(null,E))}finally{u.free()}if(typeof w=="function")return w()},a.prototype.prepare=function(u,_){if(De(d),this.handleError(Q(this.db,u,-1,d,0)),u=ie(d,"i32"),u===0)throw"Nothing to prepare";var g=new n(u,this);return _!=null&&g.bind(_),this.fb[u]=g},a.prototype.iterateStatements=function(u){return new i(u,this)},a.prototype.export=function(){Object.values(this.fb).forEach(function(_){_.free()}),Object.values(this.Sa).forEach(pe),this.Sa={},this.handleError(T(this.db));var u=ur(this.filename);return this.handleError(v(this.filename,d)),this.db=ie(d,"i32"),Ln(this.db),u},a.prototype.close=function(){this.db!==null&&(Object.values(this.fb).forEach(function(u){u.free()}),Object.values(this.Sa).forEach(pe),this.Sa={},this.Ya&&(pe(this.Ya),this.Ya=void 0),this.handleError(T(this.db)),mn("/"+this.filename),this.db=null)},a.prototype.handleError=function(u){if(u===0)return null;throw u=wr(this.db),Error(u)},a.prototype.getRowsModified=function(){return A(this.db)},a.prototype.create_function=function(u,_){Object.prototype.hasOwnProperty.call(this.Sa,u)&&(pe(this.Sa[u]),delete this.Sa[u]);var g=je(function(w,E,C){E=t(E,C);try{var K=_.apply(null,E)}catch(Y){Je(w,Y,-1);return}e(w,K)},"viii");return this.Sa[u]=g,this.handleError(Dn(this.db,u,_.length,1,0,g,0,0,0)),this},a.prototype.create_aggregate=function(u,_){var g=_.init||function(){return null},w=_.finalize||function(V){return V},E=_.step;if(!E)throw"An aggregate function must have a step function in "+u;var C={};Object.hasOwnProperty.call(this.Sa,u)&&(pe(this.Sa[u]),delete this.Sa[u]),_=u+"__finalize",Object.hasOwnProperty.call(this.Sa,_)&&(pe(this.Sa[_]),delete this.Sa[_]);var K=je(function(V,Z,wt){var ge=Cn(V,1);Object.hasOwnProperty.call(C,ge)||(C[ge]=g()),Z=t(Z,wt),Z=[C[ge]].concat(Z);try{C[ge]=E.apply(null,Z)}catch(Hr){delete C[ge],Je(V,Hr,-1)}},"viii"),Y=je(function(V){var Z=Cn(V,1);try{var wt=w(C[Z])}catch(ge){delete C[Z],Je(V,ge,-1);return}e(V,wt),delete C[Z]},"vi");return this.Sa[u]=K,this.Sa[_]=Y,this.handleError(Dn(this.db,u,E.length-1,1,0,0,K,Y,0)),this},a.prototype.updateHook=function(u){this.Ya&&(jn(this.db,0,0),pe(this.Ya),this.Ya=void 0),u&&(this.Ya=je(function(_,g,w,E,C){switch(g){case 18:_="insert";break;case 23:_="update";break;case 9:_="delete";break;default:throw"unknown operationCode in updateHook callback: "+g}if(w=w?I(P,w):"",E=E?I(P,E):"",C>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";u(_,w,E,Number(C))},"viiiij"),jn(this.db,this.Ya,0))},o.Database=a};var q=M({},o),h="./this.program",N=(e,t)=>{throw t},j="",ee,ae;if(R){var le=Mn();Bn(),j=__dirname+"/",ae=e=>(e=Ie(e)?new URL(e):e,le.readFileSync(e)),ee=async e=>(e=Ie(e)?new URL(e):e,le.readFileSync(e,void 0)),!o.thisProgram&&1<process.argv.length&&(h=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),typeof Se<"u"&&(Se.exports=o),N=(e,t)=>{throw process.exitCode=e,t}}else(m||y)&&(y?j=self.location.href:typeof document<"u"&&document.currentScript&&(j=document.currentScript.src),j=j.startsWith("blob:")?"":j.slice(0,j.replace(/[?#].*/,"").lastIndexOf("/")+1),y&&(ae=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),ee=async e=>{if(Ie(e))return new Promise((n,i)=>{var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=()=>{a.status==200||a.status==0&&a.response?n(a.response):i(a.status)},a.onerror=i,a.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)});var $=o.print||console.log.bind(console),ne=o.printErr||console.error.bind(console);Object.assign(o,q),q=null,o.thisProgram&&(h=o.thisProgram);var ce=o.wasmBinary,J,re=!1,ue,B,P,Oe,L,F,Ze,X,et,Ie=e=>e.startsWith("file://");function Qt(){var e=J.buffer;o.HEAP8=B=new Int8Array(e),o.HEAP16=Oe=new Int16Array(e),o.HEAPU8=P=new Uint8Array(e),o.HEAPU16=new Uint16Array(e),o.HEAP32=L=new Int32Array(e),o.HEAPU32=F=new Uint32Array(e),o.HEAPF32=Ze=new Float32Array(e),o.HEAPF64=et=new Float64Array(e),o.HEAP64=X=new BigInt64Array(e),o.HEAPU64=new BigUint64Array(e)}var me=0,Te=null;function ve(e){throw o.onAbort?.(e),e="Aborted("+e+")",ne(e),re=!0,new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info.")}var tt;async function Gn(e){if(!ce)try{var t=await ee(e);return new Uint8Array(t)}catch{}if(e==tt&&ce)e=new Uint8Array(ce);else if(ae)e=ae(e);else throw"both async and sync fetching of the wasm failed";return e}async function Yn(e,t){try{var n=await Gn(e);return await WebAssembly.instantiate(n,t)}catch(i){ne(`failed to asynchronously prepare wasm: ${i}`),ve(i)}}async function Xn(e){var t=tt;if(!ce&&typeof WebAssembly.instantiateStreaming=="function"&&!Ie(t)&&!R)try{var n=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(n,e)}catch(i){ne(`wasm streaming compile failed: ${i}`),ne("falling back to ArrayBuffer instantiation")}return Yn(t,e)}class nt{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var zt=e=>{for(;0<e.length;)e.shift()(o)},Vt=[],Jt=[],Kn=()=>{var e=o.preRun.shift();Jt.unshift(e)};function ie(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":return B[e];case"i8":return B[e];case"i16":return Oe[e>>1];case"i32":return L[e>>2];case"i64":return X[e>>3];case"float":return Ze[e>>2];case"double":return et[e>>3];case"*":return F[e>>2];default:ve(`invalid type for getValue: ${t}`)}}var rt=o.noExitRuntime||!0;function De(e){var t="i32";switch(t.endsWith("*")&&(t="*"),t){case"i1":B[e]=0;break;case"i8":B[e]=0;break;case"i16":Oe[e>>1]=0;break;case"i32":L[e>>2]=0;break;case"i64":X[e>>3]=BigInt(0);break;case"float":Ze[e>>2]=0;break;case"double":et[e>>3]=0;break;case"*":F[e>>2]=0;break;default:ve(`invalid type for setValue: ${t}`)}}var Gt=typeof TextDecoder<"u"?new TextDecoder:void 0,I=(e,t=0,n=NaN)=>{var i=t+n;for(n=t;e[n]&&!(n>=i);)++n;if(16<n-t&&e.buffer&&Gt)return Gt.decode(e.subarray(t,n));for(i="";t<n;){var a=e[t++];if(a&128){var d=e[t++]&63;if((a&224)==192)i+=String.fromCharCode((a&31)<<6|d);else{var f=e[t++]&63;a=(a&240)==224?(a&15)<<12|d<<6|f:(a&7)<<18|d<<12|f<<6|e[t++]&63,65536>a?i+=String.fromCharCode(a):(a-=65536,i+=String.fromCharCode(55296|a>>10,56320|a&1023))}}else i+=String.fromCharCode(a)}return i},it=(e,t)=>e?I(P,e,t):"",Yt=(e,t)=>{for(var n=0,i=e.length-1;0<=i;i--){var a=e[i];a==="."?e.splice(i,1):a===".."?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n;n--)e.unshift("..");return e},ot=e=>{var t=e.charAt(0)==="/",n=e.slice(-1)==="/";return(e=Yt(e.split("/").filter(i=>!!i),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e},Xt=e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],!e&&!t?".":(t&&=t.slice(0,-1),e+t)},Ae=e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],Zn=()=>{if(R){var e=Wr("crypto");return t=>e.randomFillSync(t)}return t=>crypto.getRandomValues(t)},Kt=e=>{(Kt=Zn())(e)},er=(...e)=>{for(var t="",n=!1,i=e.length-1;-1<=i&&!n;i--){if(n=0<=i?e[i]:"/",typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,n=n.charAt(0)==="/"}return t=Yt(t.split("/").filter(a=>!!a),!n).join("/"),(n?"/":"")+t||"."},st=[],Pe=e=>{for(var t=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);127>=i?t++:2047>=i?t+=2:55296<=i&&57343>=i?(t+=4,++n):t+=3}return t},oe=(e,t,n,i)=>{if(!(0<i))return 0;var a=n;i=n+i-1;for(var d=0;d<e.length;++d){var f=e.charCodeAt(d);if(55296<=f&&57343>=f){var v=e.charCodeAt(++d);f=65536+((f&1023)<<10)|v&1023}if(127>=f){if(n>=i)break;t[n++]=f}else{if(2047>=f){if(n+1>=i)break;t[n++]=192|f>>6}else{if(65535>=f){if(n+2>=i)break;t[n++]=224|f>>12}else{if(n+3>=i)break;t[n++]=240|f>>18,t[n++]=128|f>>12&63}t[n++]=128|f>>6&63}t[n++]=128|f&63}}return t[n]=0,n-a},Zt=(e,t)=>{var n=Array(Pe(e)+1);return e=oe(e,n,0,n.length),t&&(n.length=e),n},en=[];function tn(e,t){en[e]={input:[],output:[],cb:t},ft(e,tr)}var tr={open(e){var t=en[e.node.rdev];if(!t)throw new b(43);e.tty=t,e.seekable=!1},close(e){e.tty.cb.fsync(e.tty)},fsync(e){e.tty.cb.fsync(e.tty)},read(e,t,n,i){if(!e.tty||!e.tty.cb.xb)throw new b(60);for(var a=0,d=0;d<i;d++){try{var f=e.tty.cb.xb(e.tty)}catch{throw new b(29)}if(f===void 0&&a===0)throw new b(6);if(f==null)break;a++,t[n+d]=f}return a&&(e.node.atime=Date.now()),a},write(e,t,n,i){if(!e.tty||!e.tty.cb.qb)throw new b(60);try{for(var a=0;a<i;a++)e.tty.cb.qb(e.tty,t[n+a])}catch{throw new b(29)}return i&&(e.node.mtime=e.node.ctime=Date.now()),a}},nr={xb(){e:{if(!st.length){var e=null;if(R){var t=Buffer.alloc(256),n=0,i=process.stdin.fd;try{n=le.readSync(i,t,0,256)}catch(a){if(a.toString().includes("EOF"))n=0;else throw a}0<n&&(e=t.slice(0,n).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(e=window.prompt("Input: "),e!==null&&(e+=`
`));if(!e){e=null;break e}st=Zt(e,!0)}e=st.shift()}return e},qb(e,t){t===null||t===10?($(I(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){0<e.output?.length&&($(I(e.output)),e.output=[])},Tb(){return{Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Ub(){return 0},Vb(){return[24,80]}},rr={qb(e,t){t===null||t===10?(ne(I(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){0<e.output?.length&&(ne(I(e.output)),e.output=[])}},k={Wa:null,Xa(){return k.createNode(null,"/",16895,0)},createNode(e,t,n,i){if((n&61440)===24576||(n&61440)===4096)throw new b(63);return k.Wa||(k.Wa={dir:{node:{Ta:k.La.Ta,Ua:k.La.Ua,lookup:k.La.lookup,hb:k.La.hb,rename:k.La.rename,unlink:k.La.unlink,rmdir:k.La.rmdir,readdir:k.La.readdir,symlink:k.La.symlink},stream:{Va:k.Ma.Va}},file:{node:{Ta:k.La.Ta,Ua:k.La.Ua},stream:{Va:k.Ma.Va,read:k.Ma.read,write:k.Ma.write,ib:k.Ma.ib,jb:k.Ma.jb}},link:{node:{Ta:k.La.Ta,Ua:k.La.Ua,readlink:k.La.readlink},stream:{}},ub:{node:{Ta:k.La.Ta,Ua:k.La.Ua},stream:lr}}),n=ln(e,t,n,i),U(n.mode)?(n.La=k.Wa.dir.node,n.Ma=k.Wa.dir.stream,n.Na={}):(n.mode&61440)===32768?(n.La=k.Wa.file.node,n.Ma=k.Wa.file.stream,n.Ra=0,n.Na=null):(n.mode&61440)===40960?(n.La=k.Wa.link.node,n.Ma=k.Wa.link.stream):(n.mode&61440)===8192&&(n.La=k.Wa.ub.node,n.Ma=k.Wa.ub.stream),n.atime=n.mtime=n.ctime=Date.now(),e&&(e.Na[t]=n,e.atime=e.mtime=e.ctime=n.atime),n},Sb(e){return e.Na?e.Na.subarray?e.Na.subarray(0,e.Ra):new Uint8Array(e.Na):new Uint8Array(0)},La:{Ta(e){var t={};return t.dev=(e.mode&61440)===8192?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,U(e.mode)?t.size=4096:(e.mode&61440)===32768?t.size=e.Ra:(e.mode&61440)===40960?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},Ua(e,t){for(var n of["mode","atime","mtime","ctime"])t[n]!=null&&(e[n]=t[n]);t.size!==void 0&&(t=t.size,e.Ra!=t&&(t==0?(e.Na=null,e.Ra=0):(n=e.Na,e.Na=new Uint8Array(t),n&&e.Na.set(n.subarray(0,Math.min(t,e.Ra))),e.Ra=t)))},lookup(){throw k.vb},hb(e,t,n,i){return k.createNode(e,t,n,i)},rename(e,t,n){try{var i=he(t,n)}catch{}if(i){if(U(e.mode))for(var a in i.Na)throw new b(55);ut(i)}delete e.parent.Na[e.name],t.Na[n]=e,e.name=n,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.Na[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){var n=he(e,t),i;for(i in n.Na)throw new b(55);delete e.Na[t],e.ctime=e.mtime=Date.now()},readdir(e){return[".","..",...Object.keys(e.Na)]},symlink(e,t,n){return e=k.createNode(e,t,41471,0),e.link=n,e},readlink(e){if((e.mode&61440)!==40960)throw new b(28);return e.link}},Ma:{read(e,t,n,i,a){var d=e.node.Na;if(a>=e.node.Ra)return 0;if(e=Math.min(e.node.Ra-a,i),8<e&&d.subarray)t.set(d.subarray(a,a+e),n);else for(i=0;i<e;i++)t[n+i]=d[a+i];return e},write(e,t,n,i,a,d){if(t.buffer===B.buffer&&(d=!1),!i)return 0;if(e=e.node,e.mtime=e.ctime=Date.now(),t.subarray&&(!e.Na||e.Na.subarray)){if(d)return e.Na=t.subarray(n,n+i),e.Ra=i;if(e.Ra===0&&a===0)return e.Na=t.slice(n,n+i),e.Ra=i;if(a+i<=e.Ra)return e.Na.set(t.subarray(n,n+i),a),i}d=a+i;var f=e.Na?e.Na.length:0;if(f>=d||(d=Math.max(d,f*(1048576>f?2:1.125)>>>0),f!=0&&(d=Math.max(d,256)),f=e.Na,e.Na=new Uint8Array(d),0<e.Ra&&e.Na.set(f.subarray(0,e.Ra),0)),e.Na.subarray&&t.subarray)e.Na.set(t.subarray(n,n+i),a);else for(d=0;d<i;d++)e.Na[a+d]=t[n+d];return e.Ra=Math.max(e.Ra,a+i),i},Va(e,t,n){if(n===1?t+=e.position:n===2&&(e.node.mode&61440)===32768&&(t+=e.node.Ra),0>t)throw new b(28);return t},ib(e,t,n,i,a){if((e.node.mode&61440)!==32768)throw new b(43);if(e=e.node.Na,a&2||!e||e.buffer!==B.buffer){a=!0,i=65536*Math.ceil(t/65536);var d=Rn(65536,i);if(d&&P.fill(0,d,d+i),i=d,!i)throw new b(48);e&&((0<n||n+t<e.length)&&(e.subarray?e=e.subarray(n,n+t):e=Array.prototype.slice.call(e,n,n+t)),B.set(e,i))}else a=!1,i=e.byteOffset;return{Kb:i,Ab:a}},jb(e,t,n,i){return k.Ma.write(e,t,0,i,n,!1),0}}},nn=(e,t)=>{var n=0;return e&&(n|=365),t&&(n|=146),n},at=null,rn={},we=[],ir=1,de=null,on=!1,sn=!0,an={},b=class{name="ErrnoError";constructor(e){this.Pa=e}},or=class{gb={};node=null;get flags(){return this.gb.flags}set flags(e){this.gb.flags=e}get position(){return this.gb.position}set position(e){this.gb.position=e}},sr=class{La={};Ma={};ab=null;constructor(e,t,n,i){e||=this,this.parent=e,this.Xa=e.Xa,this.id=ir++,this.name=t,this.mode=n,this.rdev=i,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&365)===365}set read(e){e?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(e){e?this.mode|=146:this.mode&=-147}};function G(e,t={}){if(!e)throw new b(44);t.nb??(t.nb=!0),e.charAt(0)==="/"||(e="//"+e);var n=0;e:for(;40>n;n++){e=e.split("/").filter(v=>!!v);for(var i=at,a="/",d=0;d<e.length;d++){var f=d===e.length-1;if(f&&t.parent)break;if(e[d]!==".")if(e[d]==="..")a=Xt(a),i=i.parent;else{a=ot(a+"/"+e[d]);try{i=he(i,e[d])}catch(v){if(v?.Pa===44&&f&&t.Jb)return{path:a};throw v}if(!i.ab||f&&!t.nb||(i=i.ab.root),(i.mode&61440)===40960&&(!f||t.$a)){if(!i.La.readlink)throw new b(52);i=i.La.readlink(i),i.charAt(0)==="/"||(i=Xt(a)+"/"+i),e=i+"/"+e.slice(d+1).join("/");continue e}}}return{path:a,node:i}}throw new b(32)}function lt(e){for(var t;;){if(e===e.parent)return e=e.Xa.zb,t?e[e.length-1]!=="/"?`${e}/${t}`:e+t:e;t=t?`${e.name}/${t}`:e.name,e=e.parent}}function ct(e,t){for(var n=0,i=0;i<t.length;i++)n=(n<<5)-n+t.charCodeAt(i)|0;return(e+n>>>0)%de.length}function ut(e){var t=ct(e.parent.id,e.name);if(de[t]===e)de[t]=e.bb;else for(t=de[t];t;){if(t.bb===e){t.bb=e.bb;break}t=t.bb}}function he(e,t){var n=U(e.mode)?(n=Re(e,"x"))?n:e.La.lookup?0:2:54;if(n)throw new b(n);for(n=de[ct(e.id,t)];n;n=n.bb){var i=n.name;if(n.parent.id===e.id&&i===t)return n}return e.La.lookup(e,t)}function ln(e,t,n,i){return e=new sr(e,t,n,i),t=ct(e.parent.id,e.name),e.bb=de[t],de[t]=e}function U(e){return(e&61440)===16384}function cn(e){var t=["r","w","rw"][e&3];return e&512&&(t+="w"),t}function Re(e,t){if(sn)return 0;if(!t.includes("r")||e.mode&292){if(t.includes("w")&&!(e.mode&146)||t.includes("x")&&!(e.mode&73))return 2}else return 2;return 0}function un(e,t){if(!U(e.mode))return 54;try{return he(e,t),20}catch{}return Re(e,"wx")}function dn(e,t,n){try{var i=he(e,t)}catch(a){return a.Pa}if(e=Re(e,"wx"))return e;if(n){if(!U(i.mode))return 54;if(i===i.parent||lt(i)==="/")return 10}else if(U(i.mode))return 31;return 0}function Fe(e){if(!e)throw new b(63);return e}function W(e){if(e=we[e],!e)throw new b(8);return e}function fn(e,t=-1){if(e=Object.assign(new or,e),t==-1)e:{for(t=0;4096>=t;t++)if(!we[t])break e;throw new b(33)}return e.fd=t,we[t]=e}function ar(e,t=-1){return e=fn(e,t),e.Ma?.Rb?.(e),e}function dt(e,t,n){var i=e?.Ma.Ua;e=i?e:t,i??=t.La.Ua,Fe(i),i(e,n)}var lr={open(e){e.Ma=rn[e.node.rdev].Ma,e.Ma.open?.(e)},Va(){throw new b(70)}};function ft(e,t){rn[e]={Ma:t}}function pn(e,t){var n=t==="/";if(n&&at)throw new b(10);if(!n&&t){var i=G(t,{nb:!1});if(t=i.path,i=i.node,i.ab)throw new b(10);if(!U(i.mode))throw new b(54)}t={type:e,Wb:{},zb:t,Ib:[]},e=e.Xa(t),e.Xa=t,t.root=e,n?at=e:i&&(i.ab=t,i.Xa&&i.Xa.Ib.push(t))}function Me(e,t,n){var i=G(e,{parent:!0}).node;if(e=Ae(e),!e)throw new b(28);if(e==="."||e==="..")throw new b(20);var a=un(i,e);if(a)throw new b(a);if(!i.La.hb)throw new b(63);return i.La.hb(i,e,t,n)}function cr(e,t=438){return Me(e,t&4095|32768,0)}function te(e,t=511){return Me(e,t&1023|16384,0)}function Be(e,t,n){typeof n>"u"&&(n=t,t=438),Me(e,t|8192,n)}function pt(e,t){if(!er(e))throw new b(44);var n=G(t,{parent:!0}).node;if(!n)throw new b(44);t=Ae(t);var i=un(n,t);if(i)throw new b(i);if(!n.La.symlink)throw new b(63);n.La.symlink(n,t,e)}function _n(e){var t=G(e,{parent:!0}).node;e=Ae(e);var n=he(t,e),i=dn(t,e,!0);if(i)throw new b(i);if(!t.La.rmdir)throw new b(63);if(n.ab)throw new b(10);t.La.rmdir(t,e),ut(n)}function mn(e){var t=G(e,{parent:!0}).node;if(!t)throw new b(44);e=Ae(e);var n=he(t,e),i=dn(t,e,!1);if(i)throw new b(i);if(!t.La.unlink)throw new b(63);if(n.ab)throw new b(10);t.La.unlink(t,e),ut(n)}function Ce(e,t){return e=G(e,{$a:!t}).node,Fe(e.La.Ta)(e)}function hn(e,t,n,i){dt(e,t,{mode:n&4095|t.mode&-4096,ctime:Date.now(),Fb:i})}function $e(e,t){e=typeof e=="string"?G(e,{$a:!0}).node:e,hn(null,e,t)}function bn(e,t,n){if(U(t.mode))throw new b(31);if((t.mode&61440)!==32768)throw new b(28);var i=Re(t,"w");if(i)throw new b(i);dt(e,t,{size:n,timestamp:Date.now()})}function qe(e,t,n=438){if(e==="")throw new b(44);if(typeof t=="string"){var i={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[t];if(typeof i>"u")throw Error(`Unknown file open mode: ${t}`);t=i}if(n=t&64?n&4095|32768:0,typeof e=="object")i=e;else{var a=e.endsWith("/");e=G(e,{$a:!(t&131072),Jb:!0}),i=e.node,e=e.path}var d=!1;if(t&64)if(i){if(t&128)throw new b(20)}else{if(a)throw new b(31);i=Me(e,n|511,0),d=!0}if(!i)throw new b(44);if((i.mode&61440)===8192&&(t&=-513),t&65536&&!U(i.mode))throw new b(54);if(!d&&(a=i?(i.mode&61440)===40960?32:U(i.mode)&&(cn(t)!=="r"||t&576)?31:Re(i,cn(t)):44))throw new b(a);return t&512&&!d&&(a=i,a=typeof a=="string"?G(a,{$a:!0}).node:a,bn(null,a,0)),t&=-131713,a=fn({node:i,path:lt(i),flags:t,seekable:!0,position:0,Ma:i.Ma,Lb:[],error:!1}),a.Ma.open&&a.Ma.open(a),d&&$e(i,n&511),!o.logReadFiles||t&1||e in an||(an[e]=1),a}function _t(e){if(e.fd===null)throw new b(8);e.ob&&(e.ob=null);try{e.Ma.close&&e.Ma.close(e)}catch(t){throw t}finally{we[e.fd]=null}e.fd=null}function yn(e,t,n){if(e.fd===null)throw new b(8);if(!e.seekable||!e.Ma.Va)throw new b(70);if(n!=0&&n!=1&&n!=2)throw new b(28);e.position=e.Ma.Va(e,t,n),e.Lb=[]}function gn(e,t,n,i,a){if(0>i||0>a)throw new b(28);if(e.fd===null)throw new b(8);if((e.flags&2097155)===1)throw new b(8);if(U(e.node.mode))throw new b(31);if(!e.Ma.read)throw new b(28);var d=typeof a<"u";if(!d)a=e.position;else if(!e.seekable)throw new b(70);return t=e.Ma.read(e,t,n,i,a),d||(e.position+=t),t}function Sn(e,t,n,i,a){if(0>i||0>a)throw new b(28);if(e.fd===null)throw new b(8);if((e.flags&2097155)===0)throw new b(8);if(U(e.node.mode))throw new b(31);if(!e.Ma.write)throw new b(28);e.seekable&&e.flags&1024&&yn(e,0,2);var d=typeof a<"u";if(!d)a=e.position;else if(!e.seekable)throw new b(70);return t=e.Ma.write(e,t,n,i,a,void 0),d||(e.position+=t),t}function ur(e){var t="binary";if(t!=="utf8"&&t!=="binary")throw Error(`Invalid encoding type "${t}"`);var n,i=qe(e,i||0);e=Ce(e).size;var a=new Uint8Array(e);return gn(i,a,0,e,0),t==="utf8"?n=I(a):t==="binary"&&(n=a),_t(i),n}function fe(e,t,n){e=ot("/dev/"+e);var i=nn(!!t,!!n);fe.yb??(fe.yb=64);var a=fe.yb++<<8|0;ft(a,{open(d){d.seekable=!1},close(){n?.buffer?.length&&n(10)},read(d,f,v,T){for(var O=0,A=0;A<T;A++){try{var Q=t()}catch{throw new b(29)}if(Q===void 0&&O===0)throw new b(6);if(Q==null)break;O++,f[v+A]=Q}return O&&(d.node.atime=Date.now()),O},write(d,f,v,T){for(var O=0;O<T;O++)try{n(f[v+O])}catch{throw new b(29)}return T&&(d.node.mtime=d.node.ctime=Date.now()),O}}),Be(e,i,a)}var x={};function be(e,t,n){if(t.charAt(0)==="/")return t;if(e=e===-100?"/":W(e).path,t.length==0){if(!n)throw new b(44);return e}return e+"/"+t}function He(e,t){L[e>>2]=t.dev,L[e+4>>2]=t.mode,F[e+8>>2]=t.nlink,L[e+12>>2]=t.uid,L[e+16>>2]=t.gid,L[e+20>>2]=t.rdev,X[e+24>>3]=BigInt(t.size),L[e+32>>2]=4096,L[e+36>>2]=t.blocks;var n=t.atime.getTime(),i=t.mtime.getTime(),a=t.ctime.getTime();return X[e+40>>3]=BigInt(Math.floor(n/1e3)),F[e+48>>2]=n%1e3*1e6,X[e+56>>3]=BigInt(Math.floor(i/1e3)),F[e+64>>2]=i%1e3*1e6,X[e+72>>3]=BigInt(Math.floor(a/1e3)),F[e+80>>2]=a%1e3*1e6,X[e+88>>3]=BigInt(t.ino),0}var We=void 0,Ue=()=>{var e=L[+We>>2];return We+=4,e},mt=0,dr=[0,31,60,91,121,152,182,213,244,274,305,335],fr=[0,31,59,90,120,151,181,212,243,273,304,334],Le={},vn=e=>{ue=e,rt||0<mt||(o.onExit?.(e),re=!0),N(e,new nt(e))},pr=e=>{if(!re)try{if(e(),!(rt||0<mt))try{ue=e=ue,vn(e)}catch(t){t instanceof nt||t=="unwind"||N(1,t)}}catch(t){t instanceof nt||t=="unwind"||N(1,t)}},ht={},wn=()=>{if(!bt){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:h||"./this.program"},t;for(t in ht)ht[t]===void 0?delete e[t]:e[t]=ht[t];var n=[];for(t in e)n.push(`${t}=${e[t]}`);bt=n}return bt},bt,yt=e=>{var t=Pe(e)+1,n=_e(t);return oe(e,P,n,t),n},_r=(e,t,n,i)=>{var a={string:O=>{var A=0;return O!=null&&O!==0&&(A=yt(O)),A},array:O=>{var A=_e(O.length);return B.set(O,A),A}};e=o["_"+e];var d=[],f=0;if(i)for(var v=0;v<i.length;v++){var T=a[n[v]];T?(f===0&&(f=Ne()),d[v]=T(i[v])):d[v]=i[v]}return n=e(...d),n=(function(O){return f!==0&&xe(f),t==="string"?O?I(P,O):"":t==="boolean"?!!O:O})(n)},Qe=0,ze=(e,t)=>(t=t==1?_e(e.length):St(e.length),e.subarray||e.slice||(e=new Uint8Array(e)),P.set(e,t),t),ye,gt=[],se,pe=e=>{ye.delete(se.get(e)),se.set(e,null),gt.push(e)},je=(e,t)=>{if(!ye){ye=new WeakMap;var n=se.length;if(ye)for(var i=0;i<0+n;i++){var a=se.get(i);a&&ye.set(a,i)}}if(n=ye.get(e)||0)return n;if(gt.length)n=gt.pop();else{try{se.grow(1)}catch(T){throw T instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":T}n=se.length-1}try{se.set(n,e)}catch(T){if(!(T instanceof TypeError))throw T;if(typeof WebAssembly.Function=="function"){var d=WebAssembly.Function;i={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},a={parameters:[],results:t[0]=="v"?[]:[i[t[0]]]};for(var f=1;f<t.length;++f)a.parameters.push(i[t[f]]);t=new d(a,e)}else{i=[1],a=t.slice(0,1),t=t.slice(1),f={i:127,p:127,j:126,f:125,d:124,e:111},i.push(96);var v=t.length;128>v?i.push(v):i.push(v%128|128,v>>7);for(d of t)i.push(f[d]);a=="v"?i.push(0):i.push(1,f[a]),t=[0,97,115,109,1,0,0,0,1],d=i.length,128>d?t.push(d):t.push(d%128|128,d>>7),t.push(...i),t.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),t=new WebAssembly.Module(new Uint8Array(t)),t=new WebAssembly.Instance(t,{e:{f:e}}).exports.f}se.set(n,t)}return ye.set(e,n),n};de=Array(4096),pn(k,"/"),te("/tmp"),te("/home"),te("/home/web_user"),(function(){te("/dev"),ft(259,{read:()=>0,write:(i,a,d,f)=>f,Va:()=>0}),Be("/dev/null",259),tn(1280,nr),tn(1536,rr),Be("/dev/tty",1280),Be("/dev/tty1",1536);var e=new Uint8Array(1024),t=0,n=()=>(t===0&&(Kt(e),t=e.byteLength),e[--t]);fe("random",n),fe("urandom",n),te("/dev/shm"),te("/dev/shm/tmp")})(),(function(){te("/proc");var e=te("/proc/self");te("/proc/self/fd"),pn({Xa(){var t=ln(e,"fd",16895,73);return t.Ma={Va:k.Ma.Va},t.La={lookup(n,i){n=+i;var a=W(n);return n={parent:null,Xa:{zb:"fake"},La:{readlink:()=>a.path},id:n+1},n.parent=n},readdir(){return Array.from(we.entries()).filter(([,n])=>n).map(([n])=>n.toString())}},t}},"/proc/self/fd")})(),k.vb=new b(44),k.vb.stack="<generic error, no stack>";var mr={a:(e,t,n,i)=>ve(`Assertion failed: ${e?I(P,e):""}, at: `+[t?t?I(P,t):"":"unknown filename",n,i?i?I(P,i):"":"unknown function"]),i:function(e,t){try{return e=e?I(P,e):"",$e(e,t),0}catch(n){if(typeof x>"u"||n.name!=="ErrnoError")throw n;return-n.Pa}},L:function(e,t,n){try{if(t=t?I(P,t):"",t=be(e,t),n&-8)return-28;var i=G(t,{$a:!0}).node;return i?(e="",n&4&&(e+="r"),n&2&&(e+="w"),n&1&&(e+="x"),e&&Re(i,e)?-2:0):-44}catch(a){if(typeof x>"u"||a.name!=="ErrnoError")throw a;return-a.Pa}},j:function(e,t){try{var n=W(e);return hn(n,n.node,t,!1),0}catch(i){if(typeof x>"u"||i.name!=="ErrnoError")throw i;return-i.Pa}},h:function(e){try{var t=W(e);return dt(t,t.node,{timestamp:Date.now(),Fb:!1}),0}catch(n){if(typeof x>"u"||n.name!=="ErrnoError")throw n;return-n.Pa}},b:function(e,t,n){We=n;try{var i=W(e);switch(t){case 0:var a=Ue();if(0>a)break;for(;we[a];)a++;return ar(i,a).fd;case 1:case 2:return 0;case 3:return i.flags;case 4:return a=Ue(),i.flags|=a,0;case 12:return a=Ue(),Oe[a+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(d){if(typeof x>"u"||d.name!=="ErrnoError")throw d;return-d.Pa}},g:function(e,t){try{var n=W(e),i=n.node,a=n.Ma.Ta;e=a?n:i,a??=i.La.Ta,Fe(a);var d=a(e);return He(t,d)}catch(f){if(typeof x>"u"||f.name!=="ErrnoError")throw f;return-f.Pa}},H:function(e,t){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var n=W(e);if(0>t||(n.flags&2097155)===0)throw new b(28);return bn(n,n.node,t),0}catch(i){if(typeof x>"u"||i.name!=="ErrnoError")throw i;return-i.Pa}},G:function(e,t){try{if(t===0)return-28;var n=Pe("/")+1;return t<n?-68:(oe("/",P,e,t),n)}catch(i){if(typeof x>"u"||i.name!=="ErrnoError")throw i;return-i.Pa}},K:function(e,t){try{return e=e?I(P,e):"",He(t,Ce(e,!0))}catch(n){if(typeof x>"u"||n.name!=="ErrnoError")throw n;return-n.Pa}},C:function(e,t,n){try{return t=t?I(P,t):"",t=be(e,t),te(t,n),0}catch(i){if(typeof x>"u"||i.name!=="ErrnoError")throw i;return-i.Pa}},J:function(e,t,n,i){try{t=t?I(P,t):"";var a=i&256;return t=be(e,t,i&4096),He(n,a?Ce(t,!0):Ce(t))}catch(d){if(typeof x>"u"||d.name!=="ErrnoError")throw d;return-d.Pa}},x:function(e,t,n,i){We=i;try{t=t?I(P,t):"",t=be(e,t);var a=i?Ue():0;return qe(t,n,a).fd}catch(d){if(typeof x>"u"||d.name!=="ErrnoError")throw d;return-d.Pa}},v:function(e,t,n,i){try{if(t=t?I(P,t):"",t=be(e,t),0>=i)return-28;var a=G(t).node;if(!a)throw new b(44);if(!a.La.readlink)throw new b(28);var d=a.La.readlink(a),f=Math.min(i,Pe(d)),v=B[n+f];return oe(d,P,n,i+1),B[n+f]=v,f}catch(T){if(typeof x>"u"||T.name!=="ErrnoError")throw T;return-T.Pa}},u:function(e){try{return e=e?I(P,e):"",_n(e),0}catch(t){if(typeof x>"u"||t.name!=="ErrnoError")throw t;return-t.Pa}},f:function(e,t){try{return e=e?I(P,e):"",He(t,Ce(e))}catch(n){if(typeof x>"u"||n.name!=="ErrnoError")throw n;return-n.Pa}},r:function(e,t,n){try{return t=t?I(P,t):"",t=be(e,t),n===0?mn(t):n===512?_n(t):ve("Invalid flags passed to unlinkat"),0}catch(i){if(typeof x>"u"||i.name!=="ErrnoError")throw i;return-i.Pa}},q:function(e,t,n){try{t=t?I(P,t):"",t=be(e,t,!0);var i=Date.now(),a,d;if(n){var f=F[n>>2]+4294967296*L[n+4>>2],v=L[n+8>>2];v==1073741823?a=i:v==1073741822?a=null:a=1e3*f+v/1e6,n+=16,f=F[n>>2]+4294967296*L[n+4>>2],v=L[n+8>>2],v==1073741823?d=i:v==1073741822?d=null:d=1e3*f+v/1e6}else d=a=i;if((d??a)!==null){e=a;var T=G(t,{$a:!0}).node;Fe(T.La.Ua)(T,{atime:e,mtime:d})}return 0}catch(O){if(typeof x>"u"||O.name!=="ErrnoError")throw O;return-O.Pa}},m:()=>ve(""),l:()=>{rt=!1,mt=0},A:function(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),e=new Date(1e3*e),L[t>>2]=e.getSeconds(),L[t+4>>2]=e.getMinutes(),L[t+8>>2]=e.getHours(),L[t+12>>2]=e.getDate(),L[t+16>>2]=e.getMonth(),L[t+20>>2]=e.getFullYear()-1900,L[t+24>>2]=e.getDay();var n=e.getFullYear();L[t+28>>2]=(n%4!==0||n%100===0&&n%400!==0?fr:dr)[e.getMonth()]+e.getDate()-1|0,L[t+36>>2]=-(60*e.getTimezoneOffset()),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var i=new Date(e.getFullYear(),0,1).getTimezoneOffset();L[t+32>>2]=(n!=i&&e.getTimezoneOffset()==Math.min(i,n))|0},y:function(e,t,n,i,a,d,f){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{if(isNaN(a))return 61;var v=W(i);if((t&2)!==0&&(n&2)===0&&(v.flags&2097155)!==2)throw new b(2);if((v.flags&2097155)===1)throw new b(2);if(!v.Ma.ib)throw new b(43);if(!e)throw new b(28);var T=v.Ma.ib(v,e,a,t,n),O=T.Kb;return L[d>>2]=T.Ab,F[f>>2]=O,0}catch(A){if(typeof x>"u"||A.name!=="ErrnoError")throw A;return-A.Pa}},z:function(e,t,n,i,a,d){d=-9007199254740992>d||9007199254740992<d?NaN:Number(d);try{var f=W(a);if(n&2){if(n=d,(f.node.mode&61440)!==32768)throw new b(43);if(!(i&2)){var v=P.slice(e,e+t);f.Ma.jb&&f.Ma.jb(f,v,n,t,i)}}}catch(T){if(typeof x>"u"||T.name!=="ErrnoError")throw T;return-T.Pa}},n:(e,t)=>{if(Le[e]&&(clearTimeout(Le[e].id),delete Le[e]),!t)return 0;var n=setTimeout(()=>{delete Le[e],pr(()=>qn(e,performance.now()))},t);return Le[e]={id:n,Xb:t},0},B:(e,t,n,i)=>{var a=new Date().getFullYear(),d=new Date(a,0,1).getTimezoneOffset();a=new Date(a,6,1).getTimezoneOffset(),F[e>>2]=60*Math.max(d,a),L[t>>2]=+(d!=a),t=f=>{var v=Math.abs(f);return`UTC${0<=f?"-":"+"}${String(Math.floor(v/60)).padStart(2,"0")}${String(v%60).padStart(2,"0")}`},e=t(d),t=t(a),a<d?(oe(e,P,n,17),oe(t,P,i,17)):(oe(e,P,i,17),oe(t,P,n,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:e=>{var t=P.length;if(e>>>=0,2147483648<e)return!1;for(var n=1;4>=n;n*=2){var i=t*(1+.2/n);i=Math.min(i,e+100663296);e:{i=(Math.min(2147483648,65536*Math.ceil(Math.max(e,i)/65536))-J.buffer.byteLength+65535)/65536|0;try{J.grow(i),Qt();var a=1;break e}catch{}a=void 0}if(a)return!0}return!1},E:(e,t)=>{var n=0;return wn().forEach((i,a)=>{var d=t+n;for(a=F[e+4*a>>2]=d,d=0;d<i.length;++d)B[a++]=i.charCodeAt(d);B[a]=0,n+=i.length+1}),0},F:(e,t)=>{var n=wn();F[e>>2]=n.length;var i=0;return n.forEach(a=>i+=a.length+1),F[t>>2]=i,0},e:function(e){try{var t=W(e);return _t(t),0}catch(n){if(typeof x>"u"||n.name!=="ErrnoError")throw n;return n.Pa}},p:function(e,t){try{var n=W(e);return B[t]=n.tty?2:U(n.mode)?3:(n.mode&61440)===40960?7:4,Oe[t+2>>1]=0,X[t+8>>3]=BigInt(0),X[t+16>>3]=BigInt(0),0}catch(i){if(typeof x>"u"||i.name!=="ErrnoError")throw i;return i.Pa}},w:function(e,t,n,i){try{e:{var a=W(e);e=t;for(var d,f=t=0;f<n;f++){var v=F[e>>2],T=F[e+4>>2];e+=8;var O=gn(a,B,v,T,d);if(0>O){var A=-1;break e}if(t+=O,O<T)break;typeof d<"u"&&(d+=O)}A=t}return F[i>>2]=A,0}catch(Q){if(typeof x>"u"||Q.name!=="ErrnoError")throw Q;return Q.Pa}},D:function(e,t,n,i){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var a=W(e);return yn(a,t,n),X[i>>3]=BigInt(a.position),a.ob&&t===0&&n===0&&(a.ob=null),0}catch(d){if(typeof x>"u"||d.name!=="ErrnoError")throw d;return d.Pa}},I:function(e){try{var t=W(e);return t.Ma?.fsync?t.Ma.fsync(t):0}catch(n){if(typeof x>"u"||n.name!=="ErrnoError")throw n;return n.Pa}},t:function(e,t,n,i){try{e:{var a=W(e);e=t;for(var d,f=t=0;f<n;f++){var v=F[e>>2],T=F[e+4>>2];e+=8;var O=Sn(a,B,v,T,d);if(0>O){var A=-1;break e}if(t+=O,O<T)break;typeof d<"u"&&(d+=O)}A=t}return F[i>>2]=A,0}catch(Q){if(typeof x>"u"||Q.name!=="ErrnoError")throw Q;return Q.Pa}},k:vn},S;(async function(){function e(n){return S=n.exports,J=S.M,Qt(),se=S.O,me--,o.monitorRunDependencies?.(me),me==0&&Te&&(n=Te,Te=null,n()),S}me++,o.monitorRunDependencies?.(me);var t={a:mr};return o.instantiateWasm?new Promise(n=>{o.instantiateWasm(t,(i,a)=>{e(i,a),n(i.exports)})}):(tt??=o.locateFile?o.locateFile("sql-wasm.wasm",j):j+"sql-wasm.wasm",e((await Xn(t)).instance))})(),o._sqlite3_free=e=>(o._sqlite3_free=S.P)(e),o._sqlite3_value_text=e=>(o._sqlite3_value_text=S.Q)(e),o._sqlite3_prepare_v2=(e,t,n,i,a)=>(o._sqlite3_prepare_v2=S.R)(e,t,n,i,a),o._sqlite3_step=e=>(o._sqlite3_step=S.S)(e),o._sqlite3_reset=e=>(o._sqlite3_reset=S.T)(e),o._sqlite3_exec=(e,t,n,i,a)=>(o._sqlite3_exec=S.U)(e,t,n,i,a),o._sqlite3_finalize=e=>(o._sqlite3_finalize=S.V)(e),o._sqlite3_column_name=(e,t)=>(o._sqlite3_column_name=S.W)(e,t),o._sqlite3_column_text=(e,t)=>(o._sqlite3_column_text=S.X)(e,t),o._sqlite3_column_type=(e,t)=>(o._sqlite3_column_type=S.Y)(e,t),o._sqlite3_errmsg=e=>(o._sqlite3_errmsg=S.Z)(e),o._sqlite3_clear_bindings=e=>(o._sqlite3_clear_bindings=S._)(e),o._sqlite3_value_blob=e=>(o._sqlite3_value_blob=S.$)(e),o._sqlite3_value_bytes=e=>(o._sqlite3_value_bytes=S.aa)(e),o._sqlite3_value_double=e=>(o._sqlite3_value_double=S.ba)(e),o._sqlite3_value_int=e=>(o._sqlite3_value_int=S.ca)(e),o._sqlite3_value_type=e=>(o._sqlite3_value_type=S.da)(e),o._sqlite3_result_blob=(e,t,n,i)=>(o._sqlite3_result_blob=S.ea)(e,t,n,i),o._sqlite3_result_double=(e,t)=>(o._sqlite3_result_double=S.fa)(e,t),o._sqlite3_result_error=(e,t,n)=>(o._sqlite3_result_error=S.ga)(e,t,n),o._sqlite3_result_int=(e,t)=>(o._sqlite3_result_int=S.ha)(e,t),o._sqlite3_result_int64=(e,t)=>(o._sqlite3_result_int64=S.ia)(e,t),o._sqlite3_result_null=e=>(o._sqlite3_result_null=S.ja)(e),o._sqlite3_result_text=(e,t,n,i)=>(o._sqlite3_result_text=S.ka)(e,t,n,i),o._sqlite3_aggregate_context=(e,t)=>(o._sqlite3_aggregate_context=S.la)(e,t),o._sqlite3_column_count=e=>(o._sqlite3_column_count=S.ma)(e),o._sqlite3_data_count=e=>(o._sqlite3_data_count=S.na)(e),o._sqlite3_column_blob=(e,t)=>(o._sqlite3_column_blob=S.oa)(e,t),o._sqlite3_column_bytes=(e,t)=>(o._sqlite3_column_bytes=S.pa)(e,t),o._sqlite3_column_double=(e,t)=>(o._sqlite3_column_double=S.qa)(e,t),o._sqlite3_bind_blob=(e,t,n,i,a)=>(o._sqlite3_bind_blob=S.ra)(e,t,n,i,a),o._sqlite3_bind_double=(e,t,n)=>(o._sqlite3_bind_double=S.sa)(e,t,n),o._sqlite3_bind_int=(e,t,n)=>(o._sqlite3_bind_int=S.ta)(e,t,n),o._sqlite3_bind_text=(e,t,n,i,a)=>(o._sqlite3_bind_text=S.ua)(e,t,n,i,a),o._sqlite3_bind_parameter_index=(e,t)=>(o._sqlite3_bind_parameter_index=S.va)(e,t),o._sqlite3_sql=e=>(o._sqlite3_sql=S.wa)(e),o._sqlite3_normalized_sql=e=>(o._sqlite3_normalized_sql=S.xa)(e),o._sqlite3_changes=e=>(o._sqlite3_changes=S.ya)(e),o._sqlite3_close_v2=e=>(o._sqlite3_close_v2=S.za)(e),o._sqlite3_create_function_v2=(e,t,n,i,a,d,f,v,T)=>(o._sqlite3_create_function_v2=S.Aa)(e,t,n,i,a,d,f,v,T),o._sqlite3_update_hook=(e,t,n)=>(o._sqlite3_update_hook=S.Ba)(e,t,n),o._sqlite3_open=(e,t)=>(o._sqlite3_open=S.Ca)(e,t);var St=o._malloc=e=>(St=o._malloc=S.Da)(e),Ve=o._free=e=>(Ve=o._free=S.Ea)(e);o._RegisterExtensionFunctions=e=>(o._RegisterExtensionFunctions=S.Fa)(e);var Rn=(e,t)=>(Rn=S.Ga)(e,t),qn=(e,t)=>(qn=S.Ha)(e,t),xe=e=>(xe=S.Ia)(e),_e=e=>(_e=S.Ja)(e),Ne=()=>(Ne=S.Ka)();o.stackSave=()=>Ne(),o.stackRestore=e=>xe(e),o.stackAlloc=e=>_e(e),o.cwrap=(e,t,n,i)=>{var a=!n||n.every(d=>d==="number"||d==="boolean");return t!=="string"&&a&&!i?o["_"+e]:(...d)=>_r(e,t,n,d)},o.addFunction=je,o.removeFunction=pe,o.UTF8ToString=it,o.ALLOC_NORMAL=Qe,o.allocate=ze,o.allocateUTF8OnStack=yt;function vt(){function e(){if(o.calledRun=!0,!re){if(!o.noFSInit&&!on){var t,n;on=!0,i??=o.stdin,t??=o.stdout,n??=o.stderr,i?fe("stdin",i):pt("/dev/tty","/dev/stdin"),t?fe("stdout",null,t):pt("/dev/tty","/dev/stdout"),n?fe("stderr",null,n):pt("/dev/tty1","/dev/stderr"),qe("/dev/stdin",0),qe("/dev/stdout",1),qe("/dev/stderr",1)}if(S.N(),sn=!1,o.onRuntimeInitialized?.(),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;){var i=o.postRun.shift();Vt.unshift(i)}zt(Vt)}}if(0<me)Te=vt;else{if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)Kn();zt(Jt),0<me?Te=vt:o.setStatus?(o.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>o.setStatus(""),1),e()},1)):e()}}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();return vt(),l}),Ge)};typeof Xe=="object"&&typeof Se=="object"?(Se.exports=Ye,Se.exports.default=Ye):typeof define=="function"&&define.amd?define([],function(){return Ye}):typeof Xe=="object"&&(Xe.Module=Ye)});function Qr(p,r){if(p===r)return null;if(typeof p!="object"||p===null||typeof r!="object"||r===null||Array.isArray(p)||Array.isArray(r))return JSON.stringify(p)===JSON.stringify(r)?null:r;let s={},l=!1;for(let c in r)if(Object.prototype.hasOwnProperty.call(r,c))if(!(c in p))s[c]=r[c],l=!0;else{let o=Qr(p[c],r[c]);o!==null&&(s[c]=o,l=!0)}for(let c in p)Object.prototype.hasOwnProperty.call(p,c)&&!(c in r)&&(s[c]="__DELETED__",l=!0);return l?s:null}function Et(p,r){if(r===null)return p;if(typeof p!="object"||p===null||typeof r!="object"||r===null||Array.isArray(p)||Array.isArray(r))return r;let s=M({},p);for(let l in r)if(Object.prototype.hasOwnProperty.call(r,l)){let c=r[l];c==="__DELETED__"?delete s[l]:l in s?s[l]=Et(s[l],c):s[l]=c}return s}var Ut=Ur($n());var H=class{constructor(r,s,l="accession_id"){this.db=r;this.tableName=s;this.primaryKey=l}findAll(r){let s=`SELECT * FROM ${this.tableName}`;return r?.orderBy&&(s+=this.buildOrderByClause(r.orderBy)),r?.limit!==void 0&&(s+=` LIMIT ${r.limit}`),r?.offset!==void 0&&(s+=` OFFSET ${r.offset}`),this.executeQuery(s)}findById(r){let s=`SELECT * FROM ${this.tableName} WHERE ${this.primaryKey} = ?`,l=this.executeQuery(s,[r]);return l.length>0?l[0]:null}findBy(r,s){let{whereClause:l,params:c}=this.buildWhereClause(r),o=`SELECT * FROM ${this.tableName} WHERE ${l}`;return s?.orderBy&&(o+=this.buildOrderByClause(s.orderBy)),s?.limit!==void 0&&(o+=` LIMIT ${s.limit}`),s?.offset!==void 0&&(o+=` OFFSET ${s.offset}`),this.executeQuery(o,c)}findOneBy(r){let s=this.findBy(r,{limit:1});return s.length>0?s[0]:null}count(){let r=`SELECT COUNT(*) as count FROM ${this.tableName}`,s=this.db.exec(r);return s.length===0?0:s[0].values[0][0]}countBy(r){let{whereClause:s,params:l}=this.buildWhereClause(r),c=`SELECT COUNT(*) as count FROM ${this.tableName} WHERE ${s}`,o=this.db.prepare(c);o.bind(l),o.step();let m=o.get()[0];return o.free(),m}exists(r){let s=`SELECT 1 FROM ${this.tableName} WHERE ${this.primaryKey} = ? LIMIT 1`,l=this.db.prepare(s);l.bind([r]);let c=l.step();return l.free(),c}create(r){let s=Object.keys(r),l=Object.values(r).map(y=>this.serializeValue(y)),c=s.map(()=>"?").join(", "),o=`INSERT INTO ${this.tableName} (${s.join(", ")}) VALUES (${c})`,m=this.db.prepare(o);return m.run(l),m.free(),this.findById(r[this.primaryKey])}update(r,s){let l=Object.keys(s);if(l.length===0)return this.findById(r);let c=l.map(R=>`${R} = ?`).join(", "),o=[...Object.values(s).map(R=>this.serializeValue(R)),r],m=`UPDATE ${this.tableName} SET ${c} WHERE ${this.primaryKey} = ?`,y=this.db.prepare(m);return y.run(o),y.free(),this.findById(r)}delete(r){let s=`DELETE FROM ${this.tableName} WHERE ${this.primaryKey} = ?`,l=this.db.prepare(s);l.run([r]);let c=this.db.getRowsModified();return l.free(),c>0}deleteBy(r){let{whereClause:s,params:l}=this.buildWhereClause(r),c=`DELETE FROM ${this.tableName} WHERE ${s}`,o=this.db.prepare(c);o.run(l);let m=this.db.getRowsModified();return o.free(),m}rawQuery(r,s){return this.executeQuery(r,s)}rawExecute(r,s){let l=this.db.prepare(r);s?l.run(s.map(o=>this.serializeValue(o))):l.run();let c=this.db.getRowsModified();return l.free(),c}executeQuery(r,s){let l=s?this.db.exec(r,s.map(c=>this.serializeValue(c))):this.db.exec(r);return l.length===0?[]:this.resultToObjects(l[0])}resultToObjects(r){return r.values.map(s=>{let l={};return r.columns.forEach((c,o)=>{l[c]=this.deserializeValue(s[o],c)}),l})}buildWhereClause(r){let s=[],l=[];for(let[c,o]of Object.entries(r))if(o===null)s.push(`${c} IS NULL`);else{if(o===void 0)continue;if(Array.isArray(o)){let m=o.map(()=>"?").join(", ");s.push(`${c} IN (${m})`),l.push(...o)}else s.push(`${c} = ?`),l.push(o)}return{whereClause:s.length>0?s.join(" AND "):"1=1",params:l}}buildOrderByClause(r){return` ORDER BY ${(Array.isArray(r)?r:[r]).map(c=>`${String(c.column)} ${c.direction}`).join(", ")}`}serializeValue(r){return r==null?null:typeof r=="boolean"?r?1:0:typeof r=="object"?JSON.stringify(r):r}deserializeValue(r,s){if(r===null)return null;if((s.endsWith("_json")||s.endsWith("_config")||["capabilities","compatible_backends","available_simulation_backends","user_configured_capabilities","plr_state","plr_definition","allowed_resource_definition_names","compatible_resource_fqns","tags","connection_info"].includes(s))&&typeof r=="string")try{return JSON.parse(r)}catch{return r}return typeof r=="number"&&this.isBooleanColumn(s)?r===1:r}isBooleanColumn(r){return["is_top_level","solo_execution","preconfigure_deck","deprecated","is_deck_param","optional","is_recursive","auto_sync_enabled","is_consumable","has_deck","is_simulation_override","is_simulated_frontend","accepts_tips","accepts_plates","accepts_tubes","requires_deck","maintenance_enabled"].includes(r)}};var kt=class extends H{constructor(r){super(r,"protocol_runs","accession_id")}findByStatus(r){let s=r.map(()=>"?").join(", "),l=`SELECT * FROM ${this.tableName} WHERE status IN (${s}) ORDER BY created_at DESC`;return this.executeQuery(l,r)}findRecent(r=10){return this.findAll({orderBy:{column:"created_at",direction:"DESC"},limit:r})}findByProtocolDefinition(r){return this.findBy({top_level_protocol_definition_accession_id:r},{orderBy:{column:"created_at",direction:"DESC"}})}findRunning(){return this.findByStatus(["running","preparing","resuming"])}findCompletedInRange(r,s){let l=`
            SELECT * FROM ${this.tableName}
            WHERE status = 'completed'
            AND end_time >= ?
            AND end_time <= ?
            ORDER BY end_time DESC
        `;return this.executeQuery(l,[r,s])}};function Ee(p){let r;if(p.simulation_result_json)try{r=typeof p.simulation_result_json=="string"?JSON.parse(p.simulation_result_json):p.simulation_result_json}catch(c){console.error("Failed to parse simulation_result_json",c)}let s=[];if(p.inferred_requirements_json)try{s=typeof p.inferred_requirements_json=="string"?JSON.parse(p.inferred_requirements_json):p.inferred_requirements_json}catch(c){console.error("Failed to parse inferred_requirements_json",c)}let l=[];if(p.failure_modes_json)try{l=typeof p.failure_modes_json=="string"?JSON.parse(p.failure_modes_json):p.failure_modes_json}catch(c){console.error("Failed to parse failure_modes_json",c)}return z(M({},p),{simulation_result:r,inferred_requirements:s,failure_modes:l,simulation_result_json:void 0,inferred_requirements_json:void 0,failure_modes_json:void 0})}var Ot=class extends H{constructor(r){super(r,"function_protocol_definitions","accession_id")}findTopLevel(){return this.findBy({is_top_level:!0}).map(Ee)}findByCategory(r){return this.findBy({category:r}).map(Ee)}findActive(){return this.findBy({deprecated:!1}).map(Ee)}search(r){let s=`
            SELECT * FROM ${this.tableName}
            WHERE name LIKE ? OR description LIKE ? OR fqn LIKE ?
            ORDER BY name ASC
        `,l=`%${r}%`;return this.executeQuery(s,[l,l,l]).map(Ee)}findAll(r){return super.findAll(r).map(Ee)}findById(r){let s=super.findById(r);return s?Ee(s):null}},Tt=class extends H{constructor(r){super(r,"function_call_logs","accession_id")}findByProtocolRun(r){return this.findBy({protocol_run_accession_id:r},{orderBy:{column:"sequence_in_run",direction:"ASC"}})}findChildren(r){return this.findBy({parent_function_call_log_accession_id:r},{orderBy:{column:"sequence_in_run",direction:"ASC"}})}},Dt=class extends H{constructor(r){super(r,"machines","accession_id")}get joinedSelect(){return`SELECT m.* FROM ${this.tableName} m`}findAll(r){let s=this.joinedSelect;r?.orderBy&&(s+=this.buildOrderByClause(r.orderBy)),r?.limit!==void 0&&(s+=` LIMIT ${r.limit}`),r?.offset!==void 0&&(s+=` OFFSET ${r.offset}`);let l=this.executeQuery(s);return console.log("[MachineRepository] findAll executed, found:",l.length,l),l}findById(r){let s=`${this.joinedSelect} WHERE m.accession_id = ?`,l=this.executeQuery(s,[r]);return l.length>0?l[0]:null}findByStatus(r){let s=r.map(()=>"?").join(", "),l=`${this.joinedSelect} WHERE m.status IN (${s})`;return this.executeQuery(l,r)}findAvailable(){return this.findByStatus(["AVAILABLE"])}findByWorkcell(r){return this.findBy({workcell_accession_id:r})}findByCategory(r){return this.findBy({machine_category:r})}create(r){let s=["accession_id","asset_type","name","fqn","location","plr_state","plr_definition","properties_json","machine_category","description","manufacturer","model","serial_number","installation_date","status","status_details","connection_info","is_simulation_override","user_configured_capabilities","workcell_accession_id","resource_counterpart_accession_id","deck_child_accession_id","deck_child_definition_accession_id","last_seen_online","current_protocol_run_accession_id","maintenance_enabled","maintenance_schedule_json"],l={};s.forEach(o=>{o in r&&(l[o]=r[o])});let c=Object.keys(l);if(c.length>0){let o=Object.values(l).map(q=>this.serializeValue(q)),m=c.map(()=>"?").join(", "),y=`INSERT INTO machines (${c.join(", ")}) VALUES (${m})`,R=this.db.prepare(y);R.run(o),R.free()}return this.findById(r.accession_id)}},Pt=class extends H{constructor(r){super(r,"machine_definitions","accession_id")}findByFqn(r){return this.findOneBy({fqn:r})}findByCategory(r){return this.findBy({machine_category:r})}findWithDecks(){return this.findBy({has_deck:!0})}},Ct=class extends H{constructor(r){super(r,"machine_frontend_definitions","accession_id")}findByFqn(r){return this.findOneBy({fqn:r})}findByCategory(r){return this.findBy({machine_category:r})}},Lt=class extends H{constructor(r){super(r,"machine_backend_definitions","accession_id")}findByFqn(r){return this.findOneBy({fqn:r})}findByFrontend(r){return this.findBy({frontend_definition_accession_id:r})}},jt=class extends H{constructor(r){super(r,"resources","accession_id")}get joinedSelect(){return`SELECT r.* FROM ${this.tableName} r`}findAll(r){let s=this.joinedSelect;return r?.orderBy&&(s+=this.buildOrderByClause(r.orderBy)),r?.limit!==void 0&&(s+=` LIMIT ${r.limit}`),r?.offset!==void 0&&(s+=` OFFSET ${r.offset}`),this.executeQuery(s)}findById(r){let s=`${this.joinedSelect} WHERE r.accession_id = ?`,l=this.executeQuery(s,[r]);return l.length>0?l[0]:null}findByStatus(r){let s=r.map(()=>"?").join(", "),l=`${this.joinedSelect} WHERE r.status IN (${s})`;return this.executeQuery(l,r)}findByDeck(r){return this.findBy({deck_accession_id:r})}findChildren(r){return this.findBy({parent_accession_id:r})}create(r){let s=["accession_id","asset_type","name","fqn","location","plr_state","plr_definition","properties_json","resource_definition_accession_id","parent_accession_id","status","status_details","current_protocol_run_accession_id","current_deck_position_name","machine_location_accession_id","deck_accession_id","workcell_accession_id"],l={};s.forEach(o=>{o in r&&(l[o]=r[o])});let c=Object.keys(l);if(c.length>0){let o=Object.values(l).map(q=>this.serializeValue(q)),m=c.map(()=>"?").join(", "),y=`INSERT INTO resources (${c.join(", ")}) VALUES (${m})`,R=this.db.prepare(y);R.run(o),R.free()}return this.findById(r.accession_id)}},xt=class extends H{constructor(r){super(r,"resource_definitions","accession_id")}findByFqn(r){return this.findOneBy({fqn:r})}findConsumables(){return this.findBy({is_consumable:!0})}findByPlrCategory(r){return this.findBy({plr_category:r})}findByVendor(r){return this.findBy({vendor:r})}search(r){let s=`
            SELECT * FROM ${this.tableName}
            WHERE name LIKE ? OR fqn LIKE ?
            ORDER BY name ASC
        `,l=`%${r}%`;return this.executeQuery(s,[l,l])}findPlatesByWellCount(r){return this.findBy({num_items:r,plr_category:"Plate"})}},Nt=class extends H{constructor(r){super(r,"decks","accession_id")}findByMachine(r){return this.findBy({parent_machine_accession_id:r})}},It=class extends H{constructor(r){super(r,"deck_definition_catalog","accession_id")}findByFqn(r){return this.findOneBy({fqn:r})}},At=class extends H{constructor(r){super(r,"deck_position_definitions","accession_id")}findByDeckType(r){return this.findBy({deck_type_id:r})}},Ft=class extends H{constructor(r){super(r,"workcells","accession_id")}findActive(){return this.findBy({status:"active"})}},Mt=class extends H{constructor(r){super(r,"function_data_outputs","accession_id")}findByProtocolRun(r){return this.findBy({protocol_run_accession_id:r},{orderBy:{column:"measurement_timestamp",direction:"ASC"}})}findByFunctionCall(r){return this.findBy({function_call_log_accession_id:r})}};function Bt(p){return{protocolRuns:new kt(p),protocolDefinitions:new Ot(p),functionCallLogs:new Tt(p),machines:new Dt(p),machineDefinitions:new Pt(p),machineFrontendDefinitions:new Ct(p),machineBackendDefinitions:new Lt(p),resources:new jt(p),resourceDefinitions:new xt(p),decks:new Nt(p),deckDefinitions:new It(p),deckPositions:new At(p),workcells:new Ft(p),dataOutputs:new Mt(p)}}var $t={"pylabrobot.liquid_handling.backends.hamilton.Starlet":{machine_type:"Starlet",config_fields:[{field_name:"has_core96",display_name:"96-Channel Head (CoRe 96)",field_type:"boolean",default_value:!1,help_text:"Includes the CoRe 96-channel head for high-throughput pipetting."},{field_name:"has_iswap",display_name:"iSWAP Gripper",field_type:"boolean",default_value:!1,help_text:"Includes the iSWAP gripper for plate transport."}]}},Hn=[{accession_id:"plr-plate-001",name:"Cor_96_wellplate_360ul_Fb",fqn:"pylabrobot.resources.corning_costar.plates.Cor_96_wellplate_360ul_Fb",plr_category:"Plate",vendor:"Corning",description:"Corning 96-well flat bottom plate, 360\xB5L",num_items:96,is_consumable:!0,is_reusable:!0,properties_json:{wells:96,volume_ul:360,well_shape:"flat"}},{accession_id:"plr-plate-002",name:"Cor_384_wellplate_112ul_Fb",fqn:"pylabrobot.resources.corning_costar.plates.Cor_384_wellplate_112ul_Fb",plr_category:"Plate",vendor:"Corning",description:"Corning 384-well flat bottom plate",num_items:384,is_consumable:!0,is_reusable:!0,properties_json:{wells:384,volume_ul:112,well_shape:"flat"}},{accession_id:"plr-plate-003",name:"Cor_96_wellplate_Vb",fqn:"pylabrobot.resources.corning_costar.plates.Cor_96_wellplate_Vb",plr_category:"Plate",vendor:"Corning",description:"Corning 96-well V-bottom plate",num_items:96,is_consumable:!0,is_reusable:!0,properties_json:{wells:96,well_shape:"V-bottom"}},{accession_id:"plr-plate-010",name:"Gre_96_Fl_Fb",fqn:"pylabrobot.resources.greiner.plates.Gre_96_Fl_Fb",plr_category:"Plate",vendor:"Greiner",description:"Greiner 96-well flat bottom plate",num_items:96,is_consumable:!0,is_reusable:!0,properties_json:{wells:96,well_shape:"flat"}},{accession_id:"plr-plate-011",name:"Gre_384_Sq_Fb",fqn:"pylabrobot.resources.greiner.plates.Gre_384_Sq_Fb",plr_category:"Plate",vendor:"Greiner",description:"Greiner 384-well square flat bottom",num_items:384,is_consumable:!0,is_reusable:!0,properties_json:{wells:384,well_shape:"square"}},{accession_id:"plr-plate-012",name:"Gre_96_DWP_2mL_Rb",fqn:"pylabrobot.resources.greiner.plates.Gre_96_DWP_2mL_Rb",plr_category:"Plate",vendor:"Greiner",description:"Greiner 96 deep well plate 2mL round bottom",num_items:96,is_consumable:!0,is_reusable:!0,properties_json:{wells:96,volume_ul:2e3,well_shape:"round",deep_well:!0}},{accession_id:"plr-plate-020",name:"Thermo_96_Nunc_Fb",fqn:"pylabrobot.resources.thermo_fisher.plates.Thermo_96_Nunc_Fb",plr_category:"Plate",vendor:"Thermo Fisher",description:"Thermo Nunc 96-well flat bottom",num_items:96,is_consumable:!0,is_reusable:!0,properties_json:{wells:96,well_shape:"flat"}},{accession_id:"plr-plate-021",name:"Thermo_384_Nunc_Fb",fqn:"pylabrobot.resources.thermo_fisher.plates.Thermo_384_Nunc_Fb",plr_category:"Plate",vendor:"Thermo Fisher",description:"Thermo Nunc 384-well flat bottom",num_items:384,is_consumable:!0,is_reusable:!0,properties_json:{wells:384,well_shape:"flat"}},{accession_id:"plr-plate-030",name:"Epp_96_DWP_1mL",fqn:"pylabrobot.resources.eppendorf.plates.Epp_96_DWP_1mL",plr_category:"Plate",vendor:"Eppendorf",description:"Eppendorf 96 deep well plate 1mL",num_items:96,is_consumable:!0,is_reusable:!0,properties_json:{wells:96,volume_ul:1e3,deep_well:!0}},{accession_id:"plr-plate-040",name:"BioRad_96_PCR",fqn:"pylabrobot.resources.biorad.plates.BioRad_96_PCR",plr_category:"Plate",vendor:"Bio-Rad",description:"Bio-Rad 96-well PCR plate",num_items:96,is_consumable:!0,is_reusable:!1,properties_json:{wells:96,pcr_compatible:!0}}],Wn=[{accession_id:"plr-tips-001",name:"HT_P_300uL_NTR_96",fqn:"pylabrobot.resources.hamilton.tips.HT_P_300uL_NTR_96",plr_category:"TipRack",vendor:"Hamilton",description:"Hamilton 300\xB5L non-filtered tips",num_items:96,is_consumable:!0,is_reusable:!1,properties_json:{tips:96,volume_ul:300,filtered:!1}},{accession_id:"plr-tips-002",name:"HT_P_1000uL_NTR_96",fqn:"pylabrobot.resources.hamilton.tips.HT_P_1000uL_NTR_96",plr_category:"TipRack",vendor:"Hamilton",description:"Hamilton 1000\xB5L non-filtered tips",num_items:96,is_consumable:!0,is_reusable:!1,properties_json:{tips:96,volume_ul:1e3,filtered:!1}},{accession_id:"plr-tips-003",name:"HT_P_50uL_F_96",fqn:"pylabrobot.resources.hamilton.tips.HT_P_50uL_F_96",plr_category:"TipRack",vendor:"Hamilton",description:"Hamilton 50\xB5L filtered tips",num_items:96,is_consumable:!0,is_reusable:!1,properties_json:{tips:96,volume_ul:50,filtered:!0}},{accession_id:"plr-tips-010",name:"opentrons_96_tiprack_300ul",fqn:"pylabrobot.resources.opentrons.tip_racks.opentrons_96_tiprack_300ul",plr_category:"TipRack",vendor:"Opentrons",description:"Opentrons 300\xB5L tip rack",num_items:96,is_consumable:!0,is_reusable:!1,properties_json:{tips:96,volume_ul:300}},{accession_id:"plr-tips-011",name:"opentrons_96_tiprack_20ul",fqn:"pylabrobot.resources.opentrons.tip_racks.opentrons_96_tiprack_20ul",plr_category:"TipRack",vendor:"Opentrons",description:"Opentrons 20\xB5L tip rack",num_items:96,is_consumable:!0,is_reusable:!1,properties_json:{tips:96,volume_ul:20}},{accession_id:"plr-tips-012",name:"opentrons_96_tiprack_1000ul",fqn:"pylabrobot.resources.opentrons.tip_racks.opentrons_96_tiprack_1000ul",plr_category:"TipRack",vendor:"Opentrons",description:"Opentrons 1000\xB5L tip rack",num_items:96,is_consumable:!0,is_reusable:!1,properties_json:{tips:96,volume_ul:1e3}},{accession_id:"plr-tips-020",name:"Tecan_DiTi_200ul",fqn:"pylabrobot.resources.tecan.tips.Tecan_DiTi_200ul",plr_category:"TipRack",vendor:"Tecan",description:"Tecan 200\xB5L disposable tips",num_items:96,is_consumable:!0,is_reusable:!1,properties_json:{tips:96,volume_ul:200,disposable:!0}},{accession_id:"plr-tips-021",name:"Tecan_DiTi_1000ul",fqn:"pylabrobot.resources.tecan.tips.Tecan_DiTi_1000ul",plr_category:"TipRack",vendor:"Tecan",description:"Tecan 1000\xB5L disposable tips",num_items:96,is_consumable:!0,is_reusable:!1,properties_json:{tips:96,volume_ul:1e3,disposable:!0}}],Un=[{accession_id:"plr-res-001",name:"Agilent_1_reservoir_290ml",fqn:"pylabrobot.resources.agilent.troughs.Agilent_1_reservoir_290ml",plr_category:"Reservoir",vendor:"Agilent",description:"Agilent 290mL single-well reservoir",num_items:1,is_consumable:!1,is_reusable:!0,properties_json:{wells:1,volume_ml:290}},{accession_id:"plr-res-002",name:"Nest_12_reservoir_15ml",fqn:"pylabrobot.resources.nest.troughs.Nest_12_reservoir_15ml",plr_category:"Reservoir",vendor:"Nest",description:"Nest 12-channel reservoir 15mL per channel",num_items:12,is_consumable:!1,is_reusable:!0,properties_json:{wells:12,volume_ml:15}},{accession_id:"plr-res-003",name:"USA_Scientific_12_reservoir_22ml",fqn:"pylabrobot.resources.usascientific.troughs.USA_Scientific_12_reservoir_22ml",plr_category:"Reservoir",vendor:"USA Scientific",description:"USA Scientific 12-channel reservoir",num_items:12,is_consumable:!1,is_reusable:!0,properties_json:{wells:12,volume_ml:22}},{accession_id:"plr-res-004",name:"Generic_1_trough_100ml",fqn:"pylabrobot.resources.generic.troughs.Generic_1_trough_100ml",plr_category:"Reservoir",vendor:"Generic",description:"Generic single-well trough 100mL",num_items:1,is_consumable:!0,is_reusable:!1,properties_json:{wells:1,volume_ml:100}}],Qn=[{accession_id:"plr-car-001",name:"PLT_CAR_L5AC_A00",fqn:"pylabrobot.resources.hamilton.carriers.PLT_CAR_L5AC_A00",plr_category:"Carrier",vendor:"Hamilton",description:"Hamilton 5-position plate carrier",num_items:5,is_consumable:!1,is_reusable:!0,properties_json:{positions:5,carrier_type:"plate"}},{accession_id:"plr-car-002",name:"TIP_CAR_480_A00",fqn:"pylabrobot.resources.hamilton.carriers.TIP_CAR_480_A00",plr_category:"Carrier",vendor:"Hamilton",description:"Hamilton tip carrier (480 tips)",num_items:5,is_consumable:!1,is_reusable:!0,properties_json:{positions:5,carrier_type:"tip"}},{accession_id:"plr-car-003",name:"TIP_CAR_288_A00",fqn:"pylabrobot.resources.hamilton.carriers.TIP_CAR_288_A00",plr_category:"Carrier",vendor:"Hamilton",description:"Hamilton tip carrier (288 tips)",num_items:3,is_consumable:!1,is_reusable:!0,properties_json:{positions:3,carrier_type:"tip"}},{accession_id:"plr-car-010",name:"MP_3Pos_Fixed",fqn:"pylabrobot.resources.tecan.carriers.MP_3Pos_Fixed",plr_category:"Carrier",vendor:"Tecan",description:"Tecan 3-position microplate carrier",num_items:3,is_consumable:!1,is_reusable:!0,properties_json:{positions:3,carrier_type:"plate"}},{accession_id:"plr-car-011",name:"DiTi_4Pos",fqn:"pylabrobot.resources.tecan.carriers.DiTi_4Pos",plr_category:"Carrier",vendor:"Tecan",description:"Tecan 4-position DiTi carrier",num_items:4,is_consumable:!1,is_reusable:!0,properties_json:{positions:4,carrier_type:"tip"}}],zn=[{accession_id:"plr-tube-001",name:"Eppendorf_1_5mL",fqn:"pylabrobot.resources.eppendorf.tubes.Eppendorf_1_5mL",plr_category:"Tube",vendor:"Eppendorf",description:"Eppendorf 1.5mL microcentrifuge tube",num_items:1,is_consumable:!0,is_reusable:!0,properties_json:{volume_ml:1.5}},{accession_id:"plr-tube-002",name:"Eppendorf_2mL",fqn:"pylabrobot.resources.eppendorf.tubes.Eppendorf_2mL",plr_category:"Tube",vendor:"Eppendorf",description:"Eppendorf 2mL microcentrifuge tube",num_items:1,is_consumable:!0,is_reusable:!0,properties_json:{volume_ml:2}},{accession_id:"plr-tube-003",name:"Falcon_15mL",fqn:"pylabrobot.resources.corning.falcon.tubes.Falcon_15mL",plr_category:"Tube",vendor:"Corning",description:"Falcon 15mL conical tube",num_items:1,is_consumable:!0,is_reusable:!0,properties_json:{volume_ml:15,conical:!0}},{accession_id:"plr-tube-004",name:"Falcon_50mL",fqn:"pylabrobot.resources.corning.falcon.tubes.Falcon_50mL",plr_category:"Tube",vendor:"Corning",description:"Falcon 50mL conical tube",num_items:1,is_consumable:!0,is_reusable:!0,properties_json:{volume_ml:50,conical:!0}}],ke=[{accession_id:"plr-mach-001",name:"STAR",fqn:"pylabrobot.liquid_handling.backends.hamilton.STAR",vendor:"Hamilton",description:"Hamilton STAR liquid handler",has_deck:!0,machine_type:"LiquidHandler",properties_json:{channels:8,volume_range:"0.5-1000\xB5L"},frontend_fqn:"pylabrobot.liquid_handling.LiquidHandler"},{accession_id:"plr-mach-002",name:"Starlet",fqn:"pylabrobot.liquid_handling.backends.hamilton.Starlet",vendor:"Hamilton",description:"Hamilton Starlet liquid handler",has_deck:!0,machine_type:"LiquidHandler",properties_json:{channels:8,volume_range:"0.5-1000\xB5L"},frontend_fqn:"pylabrobot.liquid_handling.LiquidHandler"},{accession_id:"plr-mach-003",name:"Vantage",fqn:"pylabrobot.liquid_handling.backends.hamilton.Vantage",vendor:"Hamilton",description:"Hamilton Vantage liquid handler",has_deck:!0,machine_type:"LiquidHandler",properties_json:{channels:8,volume_range:"0.5-1000\xB5L"},frontend_fqn:"pylabrobot.liquid_handling.LiquidHandler"},{accession_id:"plr-mach-010",name:"OT2",fqn:"pylabrobot.liquid_handling.backends.opentrons.OT2",vendor:"Opentrons",description:"Opentrons OT-2 liquid handler",has_deck:!0,machine_type:"LiquidHandler",properties_json:{pipettes:2,deck_slots:11},frontend_fqn:"pylabrobot.liquid_handling.LiquidHandler"},{accession_id:"plr-mach-011",name:"Flex",fqn:"pylabrobot.liquid_handling.backends.opentrons.Flex",vendor:"Opentrons",description:"Opentrons Flex liquid handler",has_deck:!0,machine_type:"LiquidHandler",properties_json:{pipettes:2,deck_slots:12},frontend_fqn:"pylabrobot.liquid_handling.LiquidHandler"},{accession_id:"plr-mach-020",name:"EVO",fqn:"pylabrobot.liquid_handling.backends.tecan.EVO",vendor:"Tecan",description:"Tecan Freedom EVO liquid handler",has_deck:!0,machine_type:"LiquidHandler",properties_json:{channels:8},frontend_fqn:"pylabrobot.liquid_handling.LiquidHandler"},{accession_id:"plr-mach-021",name:"Fluent",fqn:"pylabrobot.liquid_handling.backends.tecan.Fluent",vendor:"Tecan",description:"Tecan Fluent liquid handler",has_deck:!0,machine_type:"LiquidHandler",properties_json:{channels:8},frontend_fqn:"pylabrobot.liquid_handling.LiquidHandler"},{accession_id:"plr-mach-030",name:"CLARIOstarBackend",fqn:"pylabrobot.plate_reading.clario_star_backend.CLARIOstarBackend",vendor:"BMG Labtech",description:"BMG CLARIOstar plate reader backend",has_deck:!1,machine_type:"PlateReader",properties_json:{detection_modes:["absorbance","fluorescence","luminescence"]},frontend_fqn:"pylabrobot.plate_reading.PlateReader"},{accession_id:"plr-mach-031",name:"SPECTROstar",fqn:"pylabrobot.plate_reading.backends.bmg.SPECTROstar",vendor:"BMG Labtech",description:"BMG SPECTROstar plate reader",has_deck:!1,machine_type:"PlateReader",properties_json:{detection_modes:["absorbance"]},frontend_fqn:"pylabrobot.plate_reading.PlateReader"},{accession_id:"plr-mach-040",name:"HamiltonHeaterShaker",fqn:"pylabrobot.heating_shaking.backends.hamilton.HamiltonHeaterShaker",vendor:"Hamilton",description:"Hamilton heater shaker",has_deck:!1,machine_type:"Shaker",properties_json:{temp_range:"4-105\xB0C",rpm_range:"100-2000"},frontend_fqn:"pylabrobot.heating_shaking.HeaterShaker"},{accession_id:"plr-mach-041",name:"InhecoTEC",fqn:"pylabrobot.heating_shaking.backends.inheco.InhecoTEC",vendor:"Inheco",description:"Inheco TEC controller",has_deck:!1,machine_type:"Shaker",properties_json:{temp_range:"4-110\xB0C"},frontend_fqn:"pylabrobot.heating_shaking.HeaterShaker"},{accession_id:"sim-mach-001",name:"Simulated Liquid Handler",fqn:"praxis.simulated.LiquidHandler",vendor:"PyLabRobot",description:"Simulated Liquid Handler - select backend at instantiation",has_deck:!0,machine_type:"LiquidHandler",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.liquid_handling.LiquidHandler",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.liquid_handling.backends.ChatterboxBackend","pylabrobot.liquid_handling.backends.LiquidHandlerChatterboxBackend"]},{accession_id:"sim-mach-002",name:"Simulated Plate Reader",fqn:"praxis.simulated.PlateReader",vendor:"PyLabRobot",description:"Simulated Plate Reader - select backend at instantiation",has_deck:!1,machine_type:"PlateReader",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.plate_reading.PlateReader",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.plate_reading.backends.ChatterboxBackend"]},{accession_id:"sim-mach-003",name:"Simulated Heater Shaker",fqn:"praxis.simulated.HeaterShaker",vendor:"PyLabRobot",description:"Simulated Heater Shaker - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.heating_shaking.HeaterShaker",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.heating_shaking.backends.ChatterboxBackend"]},{accession_id:"sim-mach-004",name:"Simulated Shaker",fqn:"praxis.simulated.Shaker",vendor:"PyLabRobot",description:"Simulated Shaker - select backend at instantiation",has_deck:!1,machine_type:"Shaker",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.shaking.Shaker",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.shaking.backends.ChatterboxBackend"]},{accession_id:"sim-mach-005",name:"Simulated Temperature Controller",fqn:"praxis.simulated.TemperatureController",vendor:"PyLabRobot",description:"Simulated Temperature Controller - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.temperature_controlling.TemperatureController",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.temperature_controlling.backends.ChatterboxBackend"]},{accession_id:"sim-mach-006",name:"Simulated Centrifuge",fqn:"praxis.simulated.Centrifuge",vendor:"PyLabRobot",description:"Simulated Centrifuge - select backend at instantiation",has_deck:!1,machine_type:"Centrifuge",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.centrifuging.Centrifuge",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.centrifuging.backends.ChatterboxBackend"]},{accession_id:"sim-mach-007",name:"Simulated Thermocycler",fqn:"praxis.simulated.Thermocycler",vendor:"PyLabRobot",description:"Simulated Thermocycler - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.thermocycling.Thermocycler",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.thermocycling.backends.ChatterboxBackend"]},{accession_id:"sim-mach-008",name:"Simulated Pump",fqn:"praxis.simulated.Pump",vendor:"PyLabRobot",description:"Simulated Pump - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.pumping.Pump",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.pumping.backends.ChatterboxBackend"]},{accession_id:"sim-mach-009",name:"Simulated Pump Array",fqn:"praxis.simulated.PumpArray",vendor:"PyLabRobot",description:"Simulated Pump Array - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.pumping.PumpArray",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.pumping.backends.ChatterboxBackend"]},{accession_id:"sim-mach-010",name:"Simulated Fan",fqn:"praxis.simulated.Fan",vendor:"PyLabRobot",description:"Simulated Fan - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.fans.Fan",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.fans.backends.ChatterboxBackend"]},{accession_id:"sim-mach-011",name:"Simulated Plate Sealer",fqn:"praxis.simulated.Sealer",vendor:"PyLabRobot",description:"Simulated Plate Sealer - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.plate_sealing.Sealer",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.plate_sealing.backends.ChatterboxBackend"]},{accession_id:"sim-mach-012",name:"Simulated Plate Peeler",fqn:"praxis.simulated.Peeler",vendor:"PyLabRobot",description:"Simulated Plate Peeler - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.plate_peeling.Peeler",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.plate_peeling.backends.ChatterboxBackend"]},{accession_id:"sim-mach-013",name:"Simulated Powder Dispenser",fqn:"praxis.simulated.PowderDispenser",vendor:"PyLabRobot",description:"Simulated Powder Dispenser - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.powder_dispensing.PowderDispenser",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.powder_dispensing.backends.ChatterboxBackend"]},{accession_id:"sim-mach-014",name:"Simulated Incubator",fqn:"praxis.simulated.Incubator",vendor:"PyLabRobot",description:"Simulated Incubator - select backend at instantiation",has_deck:!1,machine_type:"Incubator",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.incubating.Incubator",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.incubating.backends.ChatterboxBackend"]},{accession_id:"sim-mach-015",name:"Simulated SCARA Robot",fqn:"praxis.simulated.SCARA",vendor:"PyLabRobot",description:"Simulated SCARA Robot - select backend at instantiation",has_deck:!1,machine_type:"Other",properties_json:{simulated:!0},frontend_fqn:"pylabrobot.scara.SCARA",is_simulated_frontend:!0,available_simulation_backends:["pylabrobot.scara.backends.ChatterboxBackend"]}],Ht=[{accession_id:"fdef-lh",name:"Liquid Handler",fqn:"pylabrobot.liquid_handling.LiquidHandler",machine_category:"LiquidHandler",has_deck:!0},{accession_id:"fdef-pr",name:"Plate Reader",fqn:"pylabrobot.plate_reading.PlateReader",machine_category:"PlateReader",has_deck:!1},{accession_id:"fdef-hs",name:"Heater Shaker",fqn:"pylabrobot.heating_shaking.HeaterShaker",machine_category:"Shaker",has_deck:!1},{accession_id:"fdef-sh",name:"Shaker",fqn:"pylabrobot.shaking.Shaker",machine_category:"Shaker",has_deck:!1},{accession_id:"fdef-tc",name:"Temperature Controller",fqn:"pylabrobot.temperature_controlling.TemperatureController",machine_category:"Other",has_deck:!1},{accession_id:"fdef-ce",name:"Centrifuge",fqn:"pylabrobot.centrifuging.Centrifuge",machine_category:"Centrifuge",has_deck:!1},{accession_id:"fdef-th",name:"Thermocycler",fqn:"pylabrobot.thermocycling.Thermocycler",machine_category:"Other",has_deck:!1},{accession_id:"fdef-pu",name:"Pump",fqn:"pylabrobot.pumping.Pump",machine_category:"Other",has_deck:!1},{accession_id:"fdef-pa",name:"Pump Array",fqn:"pylabrobot.pumping.PumpArray",machine_category:"Other",has_deck:!1},{accession_id:"fdef-fa",name:"Fan",fqn:"pylabrobot.fans.Fan",machine_category:"Other",has_deck:!1},{accession_id:"fdef-se",name:"Plate Sealer",fqn:"pylabrobot.plate_sealing.Sealer",machine_category:"Other",has_deck:!1},{accession_id:"fdef-pee",name:"Plate Peeler",fqn:"pylabrobot.plate_peeling.Peeler",machine_category:"Other",has_deck:!1},{accession_id:"fdef-po",name:"Powder Dispenser",fqn:"pylabrobot.powder_dispensing.PowderDispenser",machine_category:"Other",has_deck:!1},{accession_id:"fdef-in",name:"Incubator",fqn:"pylabrobot.incubating.Incubator",machine_category:"Incubator",has_deck:!1},{accession_id:"fdef-sc",name:"SCARA Robot",fqn:"pylabrobot.scara.SCARA",machine_category:"Other",has_deck:!1}],Wt=ke.map(p=>{let r="fdef-lh";return p.frontend_fqn==="pylabrobot.plate_reading.PlateReader"?r="fdef-pr":p.frontend_fqn==="pylabrobot.heating_shaking.HeaterShaker"?r="fdef-hs":p.frontend_fqn==="pylabrobot.shaking.Shaker"?r="fdef-sh":p.frontend_fqn==="pylabrobot.temperature_controlling.TemperatureController"?r="fdef-tc":p.frontend_fqn==="pylabrobot.centrifuging.Centrifuge"?r="fdef-ce":p.frontend_fqn==="pylabrobot.thermocycling.Thermocycler"?r="fdef-th":p.frontend_fqn==="pylabrobot.pumping.Pump"?r="fdef-pu":p.frontend_fqn==="pylabrobot.pumping.PumpArray"?r="fdef-pa":p.frontend_fqn==="pylabrobot.fans.Fan"?r="fdef-fa":p.frontend_fqn==="pylabrobot.plate_sealing.Sealer"?r="fdef-se":p.frontend_fqn==="pylabrobot.plate_peeling.Peeler"?r="fdef-pee":p.frontend_fqn==="pylabrobot.powder_dispensing.PowderDispenser"?r="fdef-po":p.frontend_fqn==="pylabrobot.incubating.Incubator"?r="fdef-in":p.frontend_fqn==="pylabrobot.scara.SCARA"&&(r="fdef-sc"),{accession_id:p.accession_id.replace("mach","bdef").replace("sim-","sim-bdef-"),name:p.name,fqn:p.fqn,frontend_definition_accession_id:r,description:p.description,backend_type:p.fqn.includes("Chatterbox")||p.fqn.includes("praxis.simulated")?"simulator":"hardware",manufacturer:p.vendor,model:p.name}}),Ke=[...Hn,...Wn,...Un,...Qn,...zn],di={plates:Hn.length,tipRacks:Wn.length,reservoirs:Un.length,carriers:Qn.length,tubes:zn.length,machines:ke.length,total:Ke.length+ke.length};function zr(p){let r=!1,s=0;for(let l of Object.values(p))if(!(typeof l!="object"||l===null)&&"head_state"in l&&l.head_state){let c=l.head_state;if(typeof c=="object")for(let o of Object.values(c))typeof o=="object"&&o!==null&&"tip"in o&&o.tip!==null&&s++;r=s>0;break}return{tips_loaded:r,tips_count:s}}function Vr(p){let r={};for(let[s,l]of Object.entries(p))if(!(typeof l!="object"||l===null)&&"volume"in l&&typeof l.volume=="number"){let c=l.volume;if(c>0){let o=Jr(s),m=Gr(s);r[o]||(r[o]={}),r[o][m]=c}}return r}function Jr(p){let r=p.match(/^(.+?)(?:_well)?_([A-P]\d{1,2})$/i);return r?r[1]:/^[A-P]\d{1,2}$/i.test(p)?"unknown_plate":p}function Gr(p){let r=p.match(/([A-P]\d{1,2})$/i);return r?r[1].toUpperCase():p}function Yr(p){return Object.keys(p)}function Vn(p){if(!p||Object.keys(p).length===0)return null;let r=zr(p),s=Vr(p),l=Yr(p);return{tips:r,liquids:s,on_deck:l,raw_plr_state:p}}var Jn=class p{db$;dbInstance=null;repositories=null;statusSubject=new qt({initialized:!1,source:"none",tableCount:0});status$=this.statusSubject.asObservable();isReady$=new qt(!1);constructor(){this.db$=xn(this.initDbWithOptionalReset()).pipe(An(r=>{this.dbInstance=r,this.repositories=Bt(r)}),In(1)),typeof window<"u"&&(window.sqliteService=this),this.statusSubject.subscribe(r=>{this.isReady$.next(r.initialized)})}async initDbWithOptionalReset(){try{typeof window<"u"&&(new URL(window.location.href).searchParams.get("resetdb")==="1"||typeof localStorage<"u"&&localStorage.getItem("praxis_reset_db")==="1")&&(console.warn("[SqliteService] Reset flag detected. Clearing IndexedDB store..."),await this.clearStore(),typeof localStorage<"u"&&localStorage.removeItem("praxis_reset_db"))}catch(r){console.warn("[SqliteService] Optional reset failed or unsupported:",r)}return this.initDb()}getDatabase(){return this.db$}getRepositories(){return this.db$.pipe(D(()=>{if(!this.repositories)throw new Error("Repositories not initialized");return this.repositories}))}get protocolRuns(){return this.getRepositories().pipe(D(r=>r.protocolRuns))}get protocolDefinitions(){return this.getRepositories().pipe(D(r=>r.protocolDefinitions))}get machines(){return this.getRepositories().pipe(D(r=>r.machines))}get machineDefinitions(){return this.getRepositories().pipe(D(r=>r.machineDefinitions))}get machineFrontendDefinitions(){return this.getRepositories().pipe(D(r=>r.machineFrontendDefinitions))}get machineBackendDefinitions(){return this.getRepositories().pipe(D(r=>r.machineBackendDefinitions))}get resources(){return this.getRepositories().pipe(D(r=>r.resources))}get resourceDefinitions(){return this.getRepositories().pipe(D(r=>r.resourceDefinitions))}get decks(){return this.getRepositories().pipe(D(r=>r.decks))}get deckDefinitions(){return this.getRepositories().pipe(D(r=>r.deckDefinitions))}get deckPositions(){return this.getRepositories().pipe(D(r=>r.deckPositions))}get workcells(){return this.getRepositories().pipe(D(r=>r.workcells))}async initDb(){try{let r=await(0,Ut.default)({locateFile:o=>`/assets/wasm/${o}`}),s=null,l=await this.loadFromStore();if(l)try{s=new r.Database(l);try{s.exec("SELECT 1 FROM machine_definitions LIMIT 1"),console.log("[SqliteService] Loaded database from IndexedDB persistence"),this.statusSubject.next({initialized:!0,source:"indexeddb",tableCount:this.getTableCount(s)})}catch{console.warn("[SqliteService] Persisted DB looks outdated (missing machine_definitions), forcing refresh"),s=null}}catch(o){console.warn("[SqliteService] Failed to load persisted DB or schema invalid, fallback to prebuilt/fresh",o),s=null}s||(s=await this.tryLoadPrebuiltDb(r)),s||(s=await this.tryLoadSchemaDb(r)),s||(s=this.createLegacyDb(r)),this.seedDefinitionCatalogs(s),this.seedDefaultAssets(s),this.seedDefaultRuns(s),this.saveToStore(s);let c=this.getTableCount(s);return console.log(`[SqliteService] Database initialized with ${c} tables`),s}catch(r){throw console.error("[SqliteService] Failed to initialize database:",r),this.statusSubject.next({initialized:!1,source:"none",tableCount:0,error:r instanceof Error?r.message:"Unknown error"}),new Error(`SQLite initialization failed: ${r instanceof Error?r.message:"Unknown error"}`)}}async tryLoadPrebuiltDb(r){try{let s=await fetch("/assets/db/praxis.db");if(!s.ok)return console.log("[SqliteService] Prebuilt database (praxis.db) not found, falling back to schema.sql"),null;let l=await s.arrayBuffer(),c=new Uint8Array(l),o=new r.Database(c),m=this.getTableCount(o);console.log(`[SqliteService] Loaded prebuilt database with ${m} tables`);try{let y=o.exec("SELECT COUNT(*) FROM resource_definitions"),R=o.exec("SELECT COUNT(*) FROM machine_definitions");console.log(`[SqliteService] Prebuilt DB stats: ${y[0].values[0][0]} resources, ${R[0].values[0][0]} machines`)}catch{return console.warn("[SqliteService] Prebuilt DB validation failed, using fresh DB"),null}return this.statusSubject.next({initialized:!0,source:"prebuilt",tableCount:m}),o}catch(s){return console.warn("[SqliteService] Failed to load prebuilt database:",s),null}}async tryLoadSchemaDb(r){try{let s=await fetch("/assets/db/schema.sql");if(!s.ok)return console.log("[SqliteService] schema.sql not available"),null;let l=await s.text(),c=new r.Database;c.run(l);let o=this.getTableCount(c);return console.log("[SqliteService] Created database from schema.sql"),this.statusSubject.next({initialized:!0,source:"schema",tableCount:o}),c}catch(s){return console.warn("[SqliteService] Could not create database from schema.sql:",s),null}}createLegacyDb(r){let s=new r.Database;this.seedDefaultAssets(s);let l=this.getTableCount(s);return this.statusSubject.next({initialized:!0,source:"legacy",tableCount:l}),s}getTableCount(r){let s=r.exec("SELECT COUNT(*) FROM sqlite_master WHERE type='table'");return s.length>0?s[0].values[0][0]:0}seedDefaultRuns(r){}seedDefinitionCatalogs(r){try{let s=0,l=0,c=0,o=0;try{let h=r.exec("SELECT COUNT(*) FROM machine_definitions");s=h.length>0?h[0].values[0][0]:0;let N=r.exec("SELECT COUNT(*) FROM resource_definitions");l=N.length>0?N[0].values[0][0]:0;let j=r.exec("SELECT COUNT(*) FROM machine_frontend_definitions");c=j.length>0?j[0].values[0][0]:0;let ee=r.exec("SELECT COUNT(*) FROM machine_backend_definitions");o=ee.length>0?ee[0].values[0][0]:0}catch(h){console.warn("[SqliteService] Definition tables may not exist yet:",h);return}console.log("[SqliteService] Seeding definition catalogs (merging with existing)..."),r.exec("BEGIN TRANSACTION");let m=r.prepare(`
                INSERT OR IGNORE INTO resource_definitions
                (accession_id, name, fqn, resource_type, vendor, description, properties_json, is_consumable, num_items, plr_category)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
            `);for(let h of Ke)m.run([h.accession_id,h.name,h.fqn,h.plr_category,h.vendor||null,h.description||null,JSON.stringify(h.properties_json),h.is_consumable?1:0,h.num_items||null,h.plr_category]);m.free();let y=r.prepare(`
                INSERT OR IGNORE INTO machine_definitions
                (accession_id, name, fqn, machine_category, manufacturer, description, has_deck, properties_json, capabilities_config, frontend_fqn, is_simulated_frontend, available_simulation_backends, compatible_backends, plr_category)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
            `);for(let h of ke){let N=h.capabilities_config;!N&&$t[h.fqn]&&(N=$t[h.fqn]),y.run([h.accession_id,h.name,h.fqn,h.machine_type,h.vendor||null,h.description||null,h.has_deck?1:0,JSON.stringify(h.properties_json),N?JSON.stringify(N):null,h.frontend_fqn||null,h.is_simulated_frontend?1:0,h.available_simulation_backends?JSON.stringify(h.available_simulation_backends):null,null,"Machine"])}y.free();let R=r.prepare(`
                INSERT OR IGNORE INTO machine_frontend_definitions
                (accession_id, name, fqn, machine_category, description, has_deck, capabilities, capabilities_config, plr_category)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
            `);for(let h of Ht)R.run([h.accession_id,h.name,h.fqn,h.machine_category,h.description||null,h.has_deck?1:0,h.capabilities?JSON.stringify(h.capabilities):null,h.capabilities_config?JSON.stringify(h.capabilities_config):null,"Machine"]);R.free();let q=r.prepare(`
                INSERT OR IGNORE INTO machine_backend_definitions
                (accession_id, fqn, name, description, backend_type, connection_config, manufacturer, model, frontend_definition_accession_id, is_deprecated)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 0)
            `);for(let h of Wt)q.run([h.accession_id,h.fqn,h.name,h.description||null,h.backend_type,h.connection_config?JSON.stringify(h.connection_config):null,h.manufacturer||null,h.model||null,h.frontend_definition_accession_id]);q.free(),r.exec("COMMIT"),console.log(`[SqliteService] Seeded ${Ke.length} resource definitions, ${ke.length} machine definitions, ${Ht.length} frontends and ${Wt.length} backends`)}catch(s){try{r.exec("ROLLBACK")}catch{}console.error("[SqliteService] Failed to seed definition catalogs",s)}}seedDefaultAssets(r){try{let s=0;try{let y=r.exec("SELECT COUNT(*) FROM resources");s=y.length>0?y[0].values[0][0]:0}catch{}if(s>0){console.log("[SqliteService] Resources already exist, skipping default seeding");return}console.log("[SqliteService] Seeding default resources from definitions...");let l=()=>crypto.randomUUID(),c=new Date().toISOString(),o="SELECT accession_id, name, fqn FROM resource_definitions",m=[];try{let y=r.exec(o);y.length>0&&(m=y[0].values)}catch(y){console.warn("[SqliteService] Could not query resource definitions for seeding",y)}r.exec("BEGIN TRANSACTION");try{let y=r.prepare(`
                    INSERT OR IGNORE INTO resources (accession_id, asset_type, name, fqn, created_at, updated_at, properties_json, resource_definition_accession_id, status)
                    VALUES (?, 'RESOURCE', ?, ?, ?, ?, ?, ?, ?)
                `),R=0;for(let q of m){let[h,N,j]=q,ee=l(),le=`resources.default.${N.replace(/\s+/g,"_").toLowerCase()}`;y.run([ee,N,le,c,c,JSON.stringify({is_default:!0}),h,"available"]),R++}y.free(),r.exec("COMMIT"),console.log(`[SqliteService] Seeded ${R} resources`)}catch(y){throw r.exec("ROLLBACK"),console.error("[SqliteService] Failed to seed default assets",y),y}}catch(s){console.warn("[SqliteService] Error seeding default assets:",s)}}createMachine(r){return this.db$.pipe(D(s=>{console.log("[SqliteService] createMachine called with:",{name:r.name,plr_backend:r.plr_backend,connection_type:r.connection_type});let l=new Date().toISOString(),c=crypto.randomUUID();try{s.exec("BEGIN TRANSACTION");let o=null,m=null,y=null;if(r.machine_definition_accession_id){let $=s.prepare("SELECT accession_id, machine_category, compatible_backends, manufacturer, description, name, model FROM machine_definitions WHERE accession_id = ?");try{$.bind([r.machine_definition_accession_id]),$.step()&&(o=$.get())}finally{$.free()}}let R=r.plr_backend||r.connection_info?.plr_backend||"",q=R.toLowerCase();if(!o&&q){let $=s.prepare("SELECT accession_id, machine_category, compatible_backends, manufacturer, description, name, model FROM machine_definitions WHERE LOWER(fqn) = ?");try{$.bind([q]),$.step()&&(o=$.get())}finally{$.free()}}if(!o&&q){console.log(`[SqliteService] Searching backend definitions for: ${R}`);let $=s.prepare(`
                            SELECT accession_id, manufacturer, model, frontend_definition_accession_id, description 
                            FROM machine_backend_definitions 
                            WHERE LOWER(fqn) LIKE ?
                        `);try{let ne=q.split(".").pop()||"",ce="%"+ne.toLowerCase();if(console.log(`[SqliteService] Backend class: ${ne}, pattern: ${ce}`),$.bind([ce]),$.step()){let J=$.get();if(console.log("[SqliteService] Found backend row:",J),m=J[0],y=J[3],y){let re=s.prepare("SELECT machine_category, name FROM machine_frontend_definitions WHERE accession_id = ?");try{if(re.bind([y]),re.step()){let ue=re.get();console.log("[SqliteService] Found frontend row:",ue),o=[m,ue[0],null,J[1]||"Unknown",J[4]||`${ue[1]} device`,ue[1],J[2]||J[0]],console.log(`[SqliteService] Found backend definition: ${m} -> frontend: ${y}`)}else console.log(`[SqliteService] No frontend found for ID: ${y}`)}finally{re.free()}}else console.log("[SqliteService] Backend has no frontend_definition_accession_id")}else console.log(`[SqliteService] No backend found matching pattern: ${ce}`)}finally{$.free()}}let h=o?o[0]:null,N=o?o[1]:"liquid_handler",j=o?`User registered instance of ${o[4]||r.name}`:`Registered Machine: ${r.name}`,ee=r.is_simulated||q.includes("chatterbox")||q.includes("simulator")||q.includes("simulated")||r.connection_type==="sim",ae=s.prepare(`
                        INSERT INTO machines (accession_id, asset_type, name, fqn, created_at, updated_at, properties_json, machine_category, status, connection_info, description, manufacturer, model,
                        maintenance_enabled, maintenance_schedule_json, last_maintenance_json, location_label, is_simulation_override, simulation_backend_name, machine_definition_accession_id)
                        VALUES (?, 'MACHINE', ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                    `),le=`machines.user.${r.name.replace(/\s+/g,"_").toLowerCase()}_${c.slice(0,4)}`;return ae.run([c,r.name,le,l,l,JSON.stringify(r.configuration||{}),N,"IDLE",JSON.stringify(M({connection_type:r.connection_type||"serial",plr_backend:R},r.connection_info)),j,o?o[3]:"Unknown",o&&(o[6]||o[5])||r.name,1,JSON.stringify({frequency:"monthly",last_maintenance:null}),JSON.stringify({}),"Main Lab",ee?1:0,r.simulation_backend_name||null,h]),ae.free(),s.exec("COMMIT"),this.saveToStore(s),console.log(`[SqliteService] Created machine: ${r.name} (${c})`),{accession_id:c,name:r.name,status:"registered",fqn:le}}catch(o){throw s.exec("ROLLBACK"),console.error("[SqliteService] Failed to create machine:",o),o}}))}resetToDefaults(){let r=this.dbInstance;if(!r){console.error("[SqliteService] Cannot reset, DB not initialized");return}try{console.log("[SqliteService] Resetting to defaults..."),r.exec("BEGIN TRANSACTION"),r.run("DELETE FROM resources"),r.run("DELETE FROM machines"),r.exec("COMMIT"),this.seedDefaultAssets(r);let s=this.getTableCount(r);this.statusSubject.next(z(M({},this.statusSubject.value),{tableCount:s})),this.saveToStore(r),console.log("[SqliteService] Reset complete")}catch(s){throw r.exec("ROLLBACK"),console.error("[SqliteService] Failed to reset to defaults",s),s}}getProtocols(){return this.db$.pipe(D(r=>{try{let s=r.exec("SELECT * FROM function_protocol_definitions");if(s.length===0)return[];let l=this.resultToObjects(s[0]),c=[];try{let m=r.exec("SELECT * FROM parameter_definitions");m.length>0&&(c=this.resultToObjects(m[0]))}catch(m){console.warn("[SqliteService] Failed to fetch parameters",m)}let o=[];try{let m=r.exec("SELECT * FROM protocol_asset_requirements");m.length>0&&(o=this.resultToObjects(m[0]))}catch(m){console.warn("[SqliteService] Failed to fetch assets",m)}return l.map(m=>{let y=c.filter(q=>q.protocol_definition_accession_id===m.accession_id).map(q=>z(M({},q),{constraints:q.constraints_json,ui_hint:q.ui_hint_json,itemized_spec:q.itemized_spec_json})),R=o.filter(q=>q.protocol_definition_accession_id===m.accession_id).map(q=>z(M({},q),{constraints:q.constraints_json,location_constraints:q.location_constraints_json}));return z(M({},m),{is_top_level:m.is_top_level===1||m.is_top_level===!0,requires_deck:m.requires_deck===1||m.requires_deck===!0,solo_execution:m.solo_execution===1||m.solo_execution===!0,preconfigure_deck:m.preconfigure_deck===1||m.preconfigure_deck===!0,parameters:y,assets:R,tags:m.tags?typeof m.tags=="string"?m.tags.split(","):m.tags:[],hardware_requirements:m.hardware_requirements_json?JSON.parse(m.hardware_requirements_json):{},computation_graph:m.computation_graph_json?JSON.parse(m.computation_graph_json):void 0,simulation_result:m.simulation_result_json?JSON.parse(m.simulation_result_json):void 0,inferred_requirements:m.inferred_requirements_json?JSON.parse(m.inferred_requirements_json):void 0,failure_modes:m.failure_modes_json?JSON.parse(m.failure_modes_json):void 0})})}catch(s){return console.error("[SqliteService] Error fetching protocols:",s),[]}}))}async getProtocolById(r){return new Promise(s=>{this.db$.pipe(Nn(1)).subscribe(l=>{try{let c=l.exec(`SELECT * FROM function_protocol_definitions WHERE accession_id = '${r}'`);if(c.length===0||c[0].values.length===0){s(null);return}let o=this.resultToObjects(c[0])[0],m=[];try{let q=l.exec(`SELECT * FROM parameter_definitions WHERE protocol_definition_accession_id = '${r}'`);q.length>0&&(m=this.resultToObjects(q[0]).map(h=>z(M({},h),{constraints_json:h.constraints_json?JSON.parse(h.constraints_json):{},ui_hint_json:h.ui_hint_json?JSON.parse(h.ui_hint_json):{},itemized_spec_json:h.itemized_spec_json?JSON.parse(h.itemized_spec_json):void 0})))}catch(q){console.warn("[SqliteService] Failed to fetch parameters for protocol",q)}let y=[];try{let q=l.exec(`SELECT * FROM protocol_asset_requirements WHERE protocol_definition_accession_id = '${r}'`);q.length>0&&(y=this.resultToObjects(q[0]).map(h=>z(M({},h),{constraints_json:h.constraints_json?JSON.parse(h.constraints_json):{},location_constraints_json:h.location_constraints_json?JSON.parse(h.location_constraints_json):void 0})))}catch(q){console.warn("[SqliteService] Failed to fetch assets for protocol",q)}let R=z(M({},o),{is_top_level:o.is_top_level===1||o.is_top_level===!0,requires_deck:o.requires_deck===1||o.requires_deck===!0,solo_execution:o.solo_execution===1||o.solo_execution===!0,preconfigure_deck:o.preconfigure_deck===1||o.preconfigure_deck===!0,parameters:m,assets:y,hardware_requirements_json:o.hardware_requirements_json?JSON.parse(o.hardware_requirements_json):{},computation_graph_json:o.computation_graph_json?JSON.parse(o.computation_graph_json):void 0,simulation_result_json:o.simulation_result_json?JSON.parse(o.simulation_result_json):void 0,inferred_requirements_json:o.inferred_requirements_json?JSON.parse(o.inferred_requirements_json):void 0,failure_modes_json:o.failure_modes_json?JSON.parse(o.failure_modes_json):void 0});s(R)}catch(c){console.error("[SqliteService] Error fetching protocol by ID:",c),s(null)}})})}getProtocolRuns(){return this.db$.pipe(D(r=>{let s=r.exec("SELECT * FROM protocol_runs");return s.length===0?[]:this.resultToObjects(s[0]).map(l=>z(M({},l),{parameters:l.parameters_json?JSON.parse(l.parameters_json):null,user_params_json:l.user_params_json?JSON.parse(l.user_params_json):null,protocol:{accession_id:l.protocol_accession_id||l.top_level_protocol_definition_accession_id}}))}))}getTransferLogs(r){return this.db$.pipe(D(s=>{try{let l=s.exec(`SELECT * FROM function_call_logs WHERE protocol_run_accession_id = '${r}' ORDER BY sequence_in_run ASC`);return l.length===0?[]:this.resultToObjects(l[0])}catch(l){return console.warn("[SqliteService] Failed to fetch transfer logs",l),[]}}))}getProtocolRun(r){return this.getProtocolRuns().pipe(D(s=>s.find(l=>l.accession_id===r)))}getResources(){return this.db$.pipe(D(r=>{try{let s=r.exec("SELECT * FROM resources");return s.length===0?[]:this.resultToObjects(s[0]).map(l=>z(M({},l),{properties_json:l.properties_json?JSON.parse(l.properties_json):{}}))}catch(s){return console.warn("[SqliteService] Failed to fetch resources",s),[]}}))}getMachines(){return this.db$.pipe(D(r=>{try{let s=r.exec("SELECT * FROM machines");if(console.log("[SqliteService] getMachines raw result:",s),s.length===0)return[];let l=this.resultToObjects(s[0]).map(c=>z(M({},c),{properties_json:c.properties_json?JSON.parse(c.properties_json):{},connection_info_json:c.connection_info_json?JSON.parse(c.connection_info_json):c.connection_info||{}}));return console.log("[SqliteService] getMachines parsed:",l.length,l),l}catch(s){return console.warn("[SqliteService] Failed to fetch machines",s),[]}}))}getResourceDefinitions(){return this.db$.pipe(D(r=>{try{let s=r.exec("SELECT * FROM resource_definitions");return s.length===0?[]:this.resultToObjects(s[0])}catch(s){return console.warn("[SqliteService] Failed to fetch resource definitions",s),[]}}))}getMachineDefinitions(){return this.db$.pipe(D(r=>{try{let s=r.exec("SELECT * FROM machine_definitions");return s.length===0?[]:this.resultToObjects(s[0])}catch(s){return console.warn("[SqliteService] Failed to fetch machine definitions",s),[]}}))}resultToObjects(r){return r.values.map(s=>{let l={};return r.columns.forEach((c,o)=>{l[c]=s[o]}),l})}getProtocolSimulationData(r){return this.db$.pipe(D(s=>{try{let l=s.exec(`SELECT inferred_requirements_json, failure_modes_json, simulation_result_json
                         FROM function_protocol_definitions
                         WHERE accession_id = '${r}'`);if(l.length===0||l[0].values.length===0)return null;let c=l[0].values[0];return{inferred_requirements:c[0]?JSON.parse(c[0]):[],failure_modes:c[1]?JSON.parse(c[1]):[],simulation_result:c[2]?JSON.parse(c[2]):null}}catch(l){return console.error("[SqliteService] Error fetching simulation data:",l),null}}))}async exportDatabase(){if(!this.dbInstance)throw new Error("Database not initialized");let r=this.dbInstance.export(),s=new Blob([r.buffer],{type:"application/x-sqlite3"}),l=URL.createObjectURL(s),c=document.createElement("a");c.href=l,c.download=`praxis-backup-${new Date().toISOString().slice(0,10)}.db`,c.click(),URL.revokeObjectURL(l)}async importDatabase(r){let s=await r.arrayBuffer(),l=new Uint8Array(s),c=await(0,Ut.default)({locateFile:m=>`/assets/wasm/${m}`});this.dbInstance&&this.dbInstance.close(),this.dbInstance=new c.Database(l),this.repositories=Bt(this.dbInstance),await this.saveToStore(this.dbInstance);let o=this.getTableCount(this.dbInstance);this.statusSubject.next({initialized:!0,source:"indexeddb",tableCount:o}),console.log("[SqliteService] Database imported successfully")}async save(){this.dbInstance&&(await this.saveToStore(this.dbInstance),console.debug("[SqliteService] Database saved to IndexedDB"))}async saveToStore(r){try{let s=r.export(),l=indexedDB.open("praxis_db",1);return l.onupgradeneeded=c=>{let o=c.target.result;o.objectStoreNames.contains("sqlite")||o.createObjectStore("sqlite")},new Promise((c,o)=>{l.onsuccess=m=>{let y=m.target.result;if(!y.objectStoreNames.contains("sqlite")){y.close(),c();return}let R=y.transaction("sqlite","readwrite");R.objectStore("sqlite").put(s,"db_dump"),R.oncomplete=()=>{y.close(),c()},R.onerror=h=>{y.close(),o(h)}},l.onerror=m=>o(m)})}catch(s){console.error("[SqliteService] Failed to save to IndexedDB",s)}}async loadFromStore(){return new Promise(r=>{let s=indexedDB.open("praxis_db",1);s.onupgradeneeded=l=>{let c=l.target.result;c.objectStoreNames.contains("sqlite")||c.createObjectStore("sqlite")},s.onsuccess=l=>{let c=l.target.result;if(!c.objectStoreNames.contains("sqlite")){c.close(),r(null);return}let o=c.transaction("sqlite","readonly"),y=o.objectStore("sqlite").get("db_dump"),R=null;y.onsuccess=()=>{R=y.result||null},o.oncomplete=()=>{c.close(),r(R)},o.onerror=()=>{c.close(),r(null)}},s.onerror=()=>r(null)})}async clearStore(){return new Promise((r,s)=>{let l=indexedDB.open("praxis_db",1);l.onupgradeneeded=c=>{let o=c.target.result;o.objectStoreNames.contains("sqlite")||o.createObjectStore("sqlite")},l.onsuccess=c=>{let o=c.target.result;if(!o.objectStoreNames.contains("sqlite")){o.close(),r();return}try{let m=o.transaction("sqlite","readwrite");m.objectStore("sqlite").clear(),m.oncomplete=()=>{o.close(),r()},m.onerror=R=>{o.close(),s(R.target.error)}}catch(m){o.close(),s(m)}},l.onerror=c=>{s(c.target.error)}})}saveStateResolution(r,s){return this.db$.pipe(D(l=>{try{l.run(`
                        CREATE TABLE IF NOT EXISTS state_resolution_log (
                            id TEXT PRIMARY KEY,
                            run_id TEXT NOT NULL,
                            operation_id TEXT NOT NULL,
                            operation_description TEXT,
                            resolution_type TEXT NOT NULL,
                            action_taken TEXT NOT NULL,
                            resolved_values_json TEXT,
                            notes TEXT,
                            resolved_by TEXT DEFAULT 'user',
                            resolved_at TEXT NOT NULL,
                            created_at TEXT NOT NULL
                        )
                    `);let c=l.prepare(`
                        INSERT INTO state_resolution_log 
                        (id, run_id, operation_id, operation_description, resolution_type, 
                         action_taken, resolved_values_json, notes, resolved_by, resolved_at, created_at)
                        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                    `),o=new Date().toISOString();c.run([crypto.randomUUID(),r,s.operation_id,s.operation_description||"",s.resolution_type,s.action,JSON.stringify(s.resolved_values||{}),s.notes||null,"user",o,o]),c.free(),this.saveToStore(l),console.log("[SqliteService] State resolution saved for run:",r)}catch(c){throw console.error("[SqliteService] Failed to save state resolution:",c),c}}))}getStateResolutions(r){return this.db$.pipe(D(s=>{try{let l=s.exec(`SELECT * FROM state_resolution_log WHERE run_id = '${r}' ORDER BY resolved_at DESC`);return l.length===0?[]:this.resultToObjects(l[0]).map(c=>z(M({},c),{resolved_values:c.resolved_values_json?JSON.parse(c.resolved_values_json):{}}))}catch{return[]}}))}updateProtocolRunStatus(r,s){return this.db$.pipe(D(l=>{try{let c=new Date().toISOString();l.run("UPDATE protocol_runs SET status = ?, updated_at = ? WHERE accession_id = ?",[s,c,r]),this.saveToStore(l),console.log(`[SqliteService] Updated run ${r} status to ${s}`)}catch(c){throw console.error("[SqliteService] Failed to update run status:",c),c}}))}getDeckState(r){return this.db$.pipe(D(s=>{try{s.run(`
                        CREATE TABLE IF NOT EXISTS deck_states (
                            machine_id CHAR(32) NOT NULL,
                            state_json TEXT NOT NULL,
                            updated_at DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL,
                            PRIMARY KEY (machine_id),
                            FOREIGN KEY(machine_id) REFERENCES machines (accession_id)
                        )
                    `);let l=s.exec(`SELECT state_json FROM deck_states WHERE machine_id = '${r}'`);return l.length===0||l[0].values.length===0?null:JSON.parse(l[0].values[0][0])}catch(l){return console.error("[SqliteService] Failed to get deck state:",l),null}}))}saveDeckState(r,s){return this.db$.pipe(D(l=>{try{l.run(`
                        CREATE TABLE IF NOT EXISTS deck_states (
                            machine_id CHAR(32) NOT NULL,
                            state_json TEXT NOT NULL,
                            updated_at DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL,
                            PRIMARY KEY (machine_id),
                            FOREIGN KEY(machine_id) REFERENCES machines (accession_id)
                        )
                    `);let c=l.prepare(`
                        INSERT OR REPLACE INTO deck_states (machine_id, state_json, updated_at)
                        VALUES (?, ?, ?)
                    `);c.run([r,JSON.stringify(s),new Date().toISOString()]),c.free(),this.saveToStore(l)}catch(c){throw console.error("[SqliteService] Failed to save deck state:",c),c}}))}createProtocolRun(r){return this.db$.pipe(D(s=>{let l=Object.keys(r),c=Object.values(r),o=l.map(()=>"?").join(", "),m=`INSERT INTO protocol_runs (${l.join(", ")}) VALUES (${o})`;try{s.run(m,c),this.saveToStore(s)}catch(y){console.error("[SqliteService] Failed to create protocol run:",y)}}))}updateProtocolRun(r,s){return this.db$.pipe(D(l=>{let c=Object.keys(s),o=Object.values(s),y=`UPDATE protocol_runs SET ${c.map(R=>`${R} = ?`).join(", ")} WHERE accession_id = ?`;try{l.run(y,[...o,r]),this.saveToStore(l)}catch(R){console.error("[SqliteService] Failed to update protocol run:",R)}}))}createFunctionCallLog(r){return this.db$.pipe(D(s=>{let l=Object.keys(r),c=Object.values(r),o=l.map(()=>"?").join(", "),m=`INSERT INTO function_call_logs (${l.join(", ")}) VALUES (${o})`;try{s.run(m,c)}catch(y){console.error("[SqliteService] Failed to insert function call log:",y)}}))}getRunStateHistory(r){return this.db$.pipe(D(s=>{let l=s.prepare("SELECT accession_id, initial_state_json FROM protocol_runs WHERE accession_id = ?"),c=null;try{l.bind([r]),l.step()&&(c=l.getAsObject())}finally{l.free()}if(!c)throw new Error(`Run not found: ${r}`);let o=s.prepare(`
                    SELECT accession_id, sequence_in_run, name, input_args_json, state_before_json, state_after_json, status, start_time, duration_ms, error_message_text
                    FROM function_call_logs
                    WHERE protocol_run_accession_id = ?
                    ORDER BY sequence_in_run ASC
                `),m=[];try{for(o.bind([r]);o.step();)m.push(o.getAsObject())}finally{o.free()}let y=c.initial_state_json?JSON.parse(c.initial_state_json):{},R=(h,N)=>{if(!N)return h;try{let j=JSON.parse(N);return j&&j._is_diff?Et(h,j.diff):j}catch(j){return console.warn("[SqliteService] Error parsing state json:",j),h}},q=m.map(h=>{let N=R(y,h.state_before_json);y=N;let j=R(y,h.state_after_json);return y=j,{operation_index:h.sequence_in_run,operation_id:h.accession_id,method_name:h.name||"unknown",args:h.input_args_json?JSON.parse(h.input_args_json):{},state_before:this.wrapStateSnapshot(N)||this.getEmptyState(),state_after:this.wrapStateSnapshot(j)||this.getEmptyState(),timestamp:h.start_time,duration_ms:h.duration_ms,status:(h.status||"COMPLETED").toLowerCase(),error_message:h.error_message_text}});return{run_id:r,protocol_name:"Browser Run",operations:q,final_state:this.wrapStateSnapshot(y)||this.getEmptyState()}}))}pruneRunHistory(r=5){return this.db$.pipe(D(s=>{console.log(`[SqliteService] Pruning run history (keeping last ${r})...`);try{s.exec("BEGIN TRANSACTION");let l=s.prepare(`
                        SELECT accession_id FROM protocol_runs 
                        ORDER BY created_at DESC 
                        LIMIT -1 OFFSET ?
                    `),c=[];try{for(l.bind([r]);l.step();)c.push(l.get()[0])}finally{l.free()}if(c.length>0){let o=c.map(m=>`'${m}'`).join(",");s.run(`DELETE FROM function_call_logs WHERE protocol_run_accession_id IN (${o})`),s.run(`DELETE FROM protocol_runs WHERE accession_id IN (${o})`),console.log(`[SqliteService] Pruned ${c.length} stale runs and their logs.`)}s.exec("COMMIT"),this.saveToStore(s)}catch(l){s.run("ROLLBACK"),console.warn("[SqliteService] Failed to prune history:",l)}}))}wrapStateSnapshot(r){if(!r)return null;let s=Vn(r);return s?{tips:s.tips,liquids:s.liquids,on_deck:s.on_deck,raw_plr_state:s.raw_plr_state}:null}getEmptyState(){return{tips:{tips_loaded:!1,tips_count:0},liquids:{},on_deck:[]}}static \u0275fac=function(s){return new(s||p)};static \u0275prov=Fn({token:p,factory:p.\u0275fac,providedIn:"root"})};export{ke as a,Wt as b,Ke as c,Qr as d,Jn as e};
