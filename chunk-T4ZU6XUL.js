import{a as hn}from"./chunk-K7KQAV6O.js";import{a as _n}from"./chunk-IHPLTZEU.js";import"./chunk-JHMITVIR.js";import{a as cn}from"./chunk-HOWLB6L5.js";import"./chunk-HXPSBJ7W.js";import{a as gt,b as Ce}from"./chunk-62JYEZTC.js";import{b as ie}from"./chunk-QFTYFRTT.js";import{a as ln}from"./chunk-U2FQBRAF.js";import{c as rn}from"./chunk-KHLMMB7R.js";import{a as st,b as lt,c as ct,d as mt,e as dt,f as pt,h as ut,i as ft}from"./chunk-GKGNTNFJ.js";import{a as sn}from"./chunk-SEKTGI6S.js";import{a as Me,b as we,c as Se,d as De,e as Te,f as Ee,g as ke,h as Re,i as Ie,j as Pe,k as xt,l as Oe,m as ae}from"./chunk-MJO6NRX7.js";import"./chunk-QPZUELQO.js";import{a as mn,b as dn,c as pn,d as Ct,e as un}from"./chunk-WNYFH7QK.js";import"./chunk-BRQ7VCIS.js";import{b as _t,c as ve,d as be,e as ye}from"./chunk-XG2SDX2Y.js";import"./chunk-TQGVYNR7.js";import"./chunk-LAXWCL6A.js";import{c as H}from"./chunk-QEA2ESGG.js";import{a as Ye,b as Ze,c as ge,d as an,e as Ke,f as et,g as tt,h as ne}from"./chunk-JG6HUHEY.js";import{a as xn,b as Cn}from"./chunk-DV7VBFQH.js";import{c as Xe}from"./chunk-PWVAMWZ2.js";import"./chunk-GX2D2L2X.js";import{a as fn,b as gn}from"./chunk-ERJX7L3L.js";import"./chunk-5XV7PTQI.js";import{a as _e,b as xe}from"./chunk-FFXGIJC7.js";import{b as q,f as W}from"./chunk-7F4BNMQ6.js";import{a as G,b as $}from"./chunk-HJ4PUJUU.js";import"./chunk-GW7MQSL6.js";import"./chunk-F4M4TAIC.js";import{p as ot,r as rt}from"./chunk-FGBSBVHW.js";import"./chunk-5R36QA5Q.js";import{h as ht}from"./chunk-SJZ6P2DA.js";import"./chunk-SKMC2KSJ.js";import{P as fe,R as te,S as j,U as on,Z as nt,fa as it,ta as he,ua as at}from"./chunk-YMB734HE.js";import{a as nn,c as Qe}from"./chunk-HUJ7WYYJ.js";import{b as A,c as N}from"./chunk-M6LIKZVL.js";import{d as Zt,k as Kt,n as Je,p as en,q as tn,s as ue}from"./chunk-Q6UYEA4T.js";import{$b as v,Ac as ee,Ba as Wt,Bb as P,Bc as o,C as Ue,Cc as g,Dc as h,Ec as qe,Ga as R,Gc as le,Hb as y,Hc as ce,Ic as me,Ma as Jt,Oc as We,P as qt,Pc as At,Sb as d,Tb as p,Tc as pe,Uc as $e,Vb as se,Vc as Xt,Wb as O,Wc as Yt,Xb as L,Yb as u,Zb as i,Zc as C,_b as a,bd as Nt,dc as F,e as Ht,ec as B,fc as Lt,gc as z,kc as b,lb as s,ma as T,mc as m,qc as He,rc as Fe,sa as E,sc as Be,ta as k,vb as de,wc as ze,xc as Qt,yc as K}from"./chunk-ZXFVGPYG.js";import{a as Ne,b as Ve}from"./chunk-RNQFGQA5.js";function jn(n,e){if(n&1&&(i(0,"span",2),o(1),a()),n&2){let t=m();s(),g(t.config().label)}}var Y=class n{status;showLabel=!0;statusConfigs={available:{label:"Available",icon:"check_circle",cssClass:"status-available",tooltip:"Resource is available for use"},reserved:{label:"Reserved",icon:"schedule",cssClass:"status-reserved",tooltip:"Reserved for an upcoming protocol run"},in_use:{label:"In Use",icon:"play_circle",cssClass:"status-in_use",tooltip:"Currently being used in a protocol"},depleted:{label:"Depleted",icon:"remove_circle",cssClass:"status-depleted",tooltip:"Resource has been consumed/depleted"},expired:{label:"Expired",icon:"warning",cssClass:"status-expired",tooltip:"Resource has expired"},idle:{label:"Idle",icon:"pause_circle",cssClass:"status-idle",tooltip:"Machine is idle and ready"},running:{label:"Running",icon:"play_arrow",cssClass:"status-running",tooltip:"Machine is currently running a protocol"},error:{label:"Error",icon:"error",cssClass:"status-error",tooltip:"Machine has encountered an error"},offline:{label:"Offline",icon:"cloud_off",cssClass:"status-offline",tooltip:"Machine is offline or disconnected"},maintenance:{label:"Maintenance",icon:"build",cssClass:"status-maintenance",tooltip:"Machine is undergoing maintenance"},unknown:{label:"Unknown",icon:"help_outline",cssClass:"status-unknown",tooltip:"Status is unknown"}};config=C(()=>this.statusConfigs[this.status]||this.statusConfigs.unknown);static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-asset-status-chip"]],inputs:{status:"status",showLabel:"showLabel"},decls:4,vars:6,consts:[[1,"status-chip",3,"matTooltip","disableRipple"],[1,"status-icon"],[1,"status-label"]],template:function(t,r){t&1&&(i(0,"mat-chip",0)(1,"mat-icon",1),o(2),a(),d(3,jn,2,1,"span",2),a()),t&2&&(ee(r.config().cssClass),u("matTooltip",r.config().tooltip)("disableRipple",!0),s(2),g(r.config().icon),s(),p(r.showLabel?3:-1))},dependencies:[W,q,$,G,N,A],styles:[".status-chip[_ngcontent-%COMP%]{--mdc-chip-container-height: 24px;font-size:.75rem;font-weight:500}.status-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px;margin-right:4px}.status-label[_ngcontent-%COMP%]{text-transform:capitalize}.status-available[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-tertiary-container);--mdc-chip-label-text-color: var(--sys-on-tertiary-container)}.status-reserved[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-secondary-container);--mdc-chip-label-text-color: var(--sys-on-secondary-container)}.status-in_use[_ngcontent-%COMP%], .status-running[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-primary-container);--mdc-chip-label-text-color: var(--sys-on-primary-container)}.status-idle[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-surface-container-high);--mdc-chip-label-text-color: var(--sys-on-surface)}.status-depleted[_ngcontent-%COMP%], .status-expired[_ngcontent-%COMP%], .status-error[_ngcontent-%COMP%], .status-offline[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-error-container);--mdc-chip-label-text-color: var(--sys-on-error-container)}.status-maintenance[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-tertiary-container);--mdc-chip-label-text-color: var(--sys-on-tertiary-container)}.status-unknown[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-outline-variant);--mdc-chip-label-text-color: var(--sys-on-surface-variant)}"],changeDetection:0})};function Un(n,e){n&1&&(i(0,"mat-icon",4),o(1,"chevron_right"),a())}function Hn(n,e){if(n&1&&(i(0,"div",2)(1,"span",3),o(2),a(),d(3,Un,2,0,"mat-icon",4),a()),n&2){let t=e.$implicit,r=e.$index,l=e.$count;s(),K("last",r===l-1),u("title",t),s(),g(t),s(),p(r!==l-1?3:-1)}}function qn(n,e){if(n&1&&(i(0,"div",0),O(1,Hn,4,5,"div",2,se),a()),n&2){let t=m();s(),L(t.parts())}}function Wn(n,e){n&1&&(i(0,"span",1),o(1,"Unassigned"),a())}var re=class n{location;parts=C(()=>this.location?this.location.split(/\/| > | -> |>|->/g).map(e=>e.trim()).filter(Boolean):[]);static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-location-breadcrumb"]],inputs:{location:"location"},decls:2,vars:1,consts:[[1,"breadcrumb-container"],[1,"no-location"],[1,"breadcrumb-item"],[1,"part-text",3,"title"],[1,"separator"]],template:function(t,r){t&1&&d(0,qn,3,0,"div",0)(1,Wn,2,0,"span",1),t&2&&p(r.parts().length>0?0:1)},dependencies:[N,A],styles:[".breadcrumb-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;gap:2px;font-size:.85rem;color:var(--mat-sys-on-surface-variant)}.breadcrumb-item[_ngcontent-%COMP%]{display:flex;align-items:center}.part-text[_ngcontent-%COMP%]{white-space:nowrap;max-width:150px;overflow:hidden;text-overflow:ellipsis;cursor:default}.part-text[_ngcontent-%COMP%]:hover{color:var(--mat-sys-primary)}.part-text.last[_ngcontent-%COMP%]{font-weight:500;color:var(--mat-sys-on-surface)}.separator[_ngcontent-%COMP%]{font-size:16px;height:16px;width:16px;color:var(--mat-sys-outline);margin:0 1px}.no-location[_ngcontent-%COMP%]{font-style:italic;color:var(--mat-sys-outline);font-size:.8rem}"]})};function vn(n){if(n.maintenance_enabled===!1)return"disabled";let e=n.maintenance_schedule_json;if(!e||!e.enabled||!e.intervals?.length)return"disabled";let t=Vt(n);if(!t)return"ok";let r=Math.ceil((t.getTime()-Date.now())/(1e3*60*60*24));return r<0?"overdue":r<=7?"warning":"ok"}function Vt(n){let e=n.maintenance_schedule_json,t=n.last_maintenance_json||{};if(!e||!e.intervals)return null;let r=null;for(let l of e.intervals){if(!l.required)continue;let c=t[l.type],_=c?new Date(c.completed_at):new Date(n.created_at||Date.now()),x=new Date(_);x.setDate(_.getDate()+l.interval_days),(!r||x<r)&&(r=x)}return r}function Jn(n,e){if(n&1&&(i(0,"span",3),o(1),a()),n&2){let t=m(2);s(),g(t.labelText())}}function Qn(n,e){if(n&1&&(i(0,"div",1)(1,"mat-icon",2),o(2),a(),d(3,Jn,2,1,"span",3),a()),n&2){let t=m();ee(t.status()),u("matTooltip",t.tooltipText()),s(2),g(t.icon()),s(),p(t.showLabel()?3:-1)}}var Le=class n{store=T(ie);machine=Nt.required();showLabel=Nt(!1);status=C(()=>this.store.maintenanceEnabled()?vn(this.machine()):"disabled");icon=C(()=>{switch(this.status()){case"ok":return"check_circle";case"warning":return"schedule";case"overdue":return"error";default:return"build"}});labelText=C(()=>{switch(this.status()){case"ok":return"Maintained";case"warning":return"Due Soon";case"overdue":return"Overdue";default:return""}});tooltipText=C(()=>{let e=Vt(this.machine());if(!e)return"Maintenance tracking disabled";let t=Math.ceil((e.getTime()-Date.now())/(1e3*60*60*24));return t<0?`Maintenance overdue by ${Math.abs(t)} days`:t===0?"Maintenance due today":`Maintenance due in ${t} days`});static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-maintenance-badge"]],inputs:{machine:[1,"machine"],showLabel:[1,"showLabel"]},decls:1,vars:1,consts:[[1,"badge",3,"class","matTooltip"],[1,"badge",3,"matTooltip"],[1,"icon"],[1,"label"]],template:function(t,r){t&1&&d(0,Qn,4,5,"div",0),t&2&&p(r.status()!=="disabled"?0:-1)},dependencies:[N,A,$,G],styles:[".badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;line-height:16px;border:1px solid transparent;-webkit-user-select:none;user-select:none;transition:all .2s}.icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px;display:flex;align-items:center;justify-content:center}.ok[_ngcontent-%COMP%]{background-color:#22c55e1a;color:#15803d;border-color:#22c55e33}.warning[_ngcontent-%COMP%]{background-color:#eab3081a;color:#a16207;border-color:#eab30833}.overdue[_ngcontent-%COMP%]{background-color:#ef44441a;color:#b91c1c;border-color:#ef444433}"]})};function Kn(n,e){if(n&1&&v(0,"app-deck-visualizer",20),n&2){let t=m();u("layoutData",t.data.machine.plr_state)}}function ei(n,e){n&1&&(i(0,"div",21)(1,"mat-icon"),o(2,"no_sim"),a(),i(3,"p"),o(4,"No deck state available"),a()())}function ti(n,e){if(n&1&&(i(0,"pre"),o(1),pe(2,"json"),a()),n&2){let t=m();s(),g($e(2,1,t.data.machine.connection_info))}}function ni(n,e){n&1&&(i(0,"span"),o(1,"N/A"),a())}function ii(n,e){if(n&1){let t=z();i(0,"div",35)(1,"h3"),o(2,"Schedule"),a(),i(3,"p",38),o(4,"Edit the maintenance schedule JSON configuration."),a(),i(5,"textarea",39),me("ngModelChange",function(l){E(t);let c=m(2);return ce(c.scheduleJsonString,l)||(c.scheduleJsonString=l),k(l)}),o(6,"                  "),a(),i(7,"div",40)(8,"button",41),b("click",function(){E(t);let l=m(2);return k(l.resetSchedule())}),o(9,"Reset to Default"),a(),i(10,"button",42),b("click",function(){E(t);let l=m(2);return k(l.saveMaintenanceSettings())}),o(11),a()()()}if(n&2){let t=m(2);s(5),le("ngModel",t.scheduleJsonString),s(5),u("disabled",t.isSaving),s(),h(" ",t.isSaving?"Saving...":"Save Changes"," ")}}function ai(n,e){if(n&1&&(i(0,"div",44)(1,"mat-icon",46),o(2,"check_circle"),a(),i(3,"div",47)(4,"span",48),o(5),pe(6,"titlecase"),a(),i(7,"span",49),o(8),pe(9,"date"),a()()()),n&2){let t=e.$implicit;s(5),g($e(6,2,t.type)),s(3),g(Xt(9,4,t.completed_at,"medium"))}}function oi(n,e){n&1&&(i(0,"p",45),o(1,"No maintenance history recorded."),a())}function ri(n,e){if(n&1&&(i(0,"div",36)(1,"h3"),o(2,"Recent History"),a(),i(3,"div",43),O(4,ai,10,7,"div",44,se),d(6,oi,2,0,"p",45),a()()),n&2){let t=m(2);s(4),L(t.historyEntries),s(2),p(t.historyEntries.length===0?6:-1)}}function si(n,e){n&1&&(i(0,"div",37)(1,"mat-icon"),o(2,"off"),a(),i(3,"p"),o(4,"Maintenance tracking is disabled for this machine."),a()())}function li(n,e){if(n&1){let t=z();i(0,"div",26)(1,"div",31),v(2,"app-maintenance-badge",32)(3,"span",33),i(4,"mat-slide-toggle",34),me("ngModelChange",function(l){E(t);let c=m();return ce(c.maintenanceEnabled,l)||(c.maintenanceEnabled=l),k(l)}),o(5," Enable Maintenance Tracking "),a()(),d(6,ii,12,3,"div",35),d(7,ri,7,1,"div",36),d(8,si,5,0,"div",37),a()}if(n&2){let t=m();s(2),u("machine",t.data.machine)("showLabel",!0),s(2),le("ngModel",t.maintenanceEnabled),s(2),p(t.maintenanceEnabled?6:-1),s(),p(t.maintenanceEnabled?7:-1),s(),p(t.maintenanceEnabled?-1:8)}}function ci(n,e){if(n&1){let t=z();i(0,"div",27)(1,"mat-icon"),o(2,"settings_off"),a(),i(3,"h3"),o(4,"Maintenance Tracking Globally Disabled"),a(),i(5,"p"),o(6,"Enable maintenance tracking in "),i(7,"span",50),b("click",function(){E(t);let l=m();return k(l.dialogRef.close())}),o(8,"Settings"),a(),o(9," to manage schedules."),a()()}}var vt=class n{constructor(e,t){this.dialogRef=e;this.data=t;this.generateMockData(),this.initMaintenanceState()}store=T(ie);assetService=T(H);snackBar=T(ut);mockUtilization=[];averageUtilization=0;maintenanceEnabled=!0;scheduleJsonString="";isSaving=!1;historyEntries=[];initMaintenanceState(){this.maintenanceEnabled=this.data.machine.maintenance_enabled??!0,this.scheduleJsonString=JSON.stringify(this.data.machine.maintenance_schedule_json||{},null,2);let e=this.data.machine.last_maintenance_json||{};this.historyEntries=Object.values(e).sort((t,r)=>new Date(r.completed_at).getTime()-new Date(t.completed_at).getTime())}resetSchedule(){this.scheduleJsonString=JSON.stringify({intervals:[{type:"yearly",interval_days:365,description:"Annual Inspection",required:!0}],enabled:!0},null,2)}saveMaintenanceSettings(){try{let e=JSON.parse(this.scheduleJsonString);this.isSaving=!0,this.assetService.updateMachine(this.data.machine.accession_id,{maintenance_enabled:this.maintenanceEnabled,maintenance_schedule_json:e}).subscribe({next:t=>{this.data.machine=t,this.isSaving=!1,this.snackBar.open("Maintenance settings saved","Close",{duration:3e3}),this.initMaintenanceState()},error:t=>{this.isSaving=!1,console.error("Failed to save settings",t),this.snackBar.open("Error saving settings","Close",{duration:3e3})}})}catch{this.snackBar.open("Invalid JSON format","Close",{duration:3e3})}}generateMockData(){this.mockUtilization=Array.from({length:24},()=>Math.floor(Math.random()*60)+20);let e=this.mockUtilization.reduce((t,r)=>t+r,0);this.averageUtilization=Math.round(e/this.mockUtilization.length)}static \u0275fac=function(t){return new(t||n)(de(Ye),de(Ze))};static \u0275cmp=P({type:n,selectors:[["app-machine-details-dialog"]],decls:71,vars:19,consts:[["mat-dialog-title",""],[1,"title-container"],[1,"machine-icon"],[1,"title-text"],[1,"subtitle"],[3,"status","showLabel"],[1,"details-content"],["animationDuration","0ms"],["label","Overview"],[1,"overview-grid"],[1,"detail-item"],[1,"label"],[1,"p-mono"],[1,"detail-item","full-width"],[3,"location"],[1,"sparkline-container"],["color","var(--mat-sys-tertiary)",3,"data","height"],[1,"trend-label"],["label","Deck Layout"],[1,"deck-view-container"],[3,"layoutData"],[1,"no-data"],["label","Technical"],[1,"tech-details"],[3,"color"],["label","Maintenance"],[1,"maintenance-container"],[1,"global-disabled-msg"],["align","end"],["mat-button","",3,"click"],["mat-button","","color","primary",3,"mat-dialog-close"],[1,"maintenance-header"],[3,"machine","showLabel"],[1,"spacer"],["color","primary",3,"ngModelChange","ngModel"],[1,"config-section"],[1,"history-section"],[1,"disabled-msg"],[1,"hint"],["spellcheck","false",1,"json-editor",3,"ngModelChange","ngModel"],[1,"actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"history-list"],[1,"history-item"],[1,"no-history"],[1,"text-green-500"],[1,"history-details"],[1,"type"],[1,"date"],[1,"link",3,"click"]],template:function(t,r){t&1&&(i(0,"h2",0)(1,"div",1)(2,"mat-icon",2),o(3,"precision_manufacturing"),a(),i(4,"div",3)(5,"span"),o(6),a(),i(7,"span",4),o(8),a()(),v(9,"app-asset-status-chip",5),a()(),i(10,"mat-dialog-content",6)(11,"mat-tab-group",7)(12,"mat-tab",8)(13,"div",9)(14,"div",10)(15,"span",11),o(16,"Accession ID"),a(),i(17,"span",12),o(18),a()(),i(19,"div",10)(20,"span",11),o(21,"Manufacturer"),a(),i(22,"span"),o(23),a()(),i(24,"div",13)(25,"span",11),o(26,"Location"),a(),v(27,"app-location-breadcrumb",14),a(),i(28,"div",13)(29,"span",11),o(30,"Utilization (24h)"),a(),i(31,"div",15),v(32,"app-sparkline",16),i(33,"span",17),o(34),a()()(),i(35,"div",13)(36,"span",11),o(37,"Description"),a(),i(38,"span"),o(39),a()()()(),i(40,"mat-tab",18)(41,"div",19),d(42,Kn,1,1,"app-deck-visualizer",20)(43,ei,5,0,"div",21),a()(),i(44,"mat-tab",22)(45,"div",23)(46,"div",10)(47,"span",11),o(48,"FQN (Driver)"),a(),i(49,"span",12),o(50),a()(),i(51,"div",10)(52,"span",11),o(53,"Connection Info"),a(),d(54,ti,3,3,"pre"),d(55,ni,2,0,"span"),a(),i(56,"div",10)(57,"span",11),o(58,"Simulation Override"),a(),i(59,"mat-chip",24),o(60),a()()()(),i(61,"mat-tab",25),d(62,li,9,6,"div",26)(63,ci,10,0,"div",27),a()()(),i(64,"mat-dialog-actions",28)(65,"button",29),b("click",function(){return r.dialogRef.close()}),o(66,"Close"),a(),i(67,"button",30)(68,"mat-icon"),o(69,"edit"),a(),o(70," Edit "),a()()),t&2&&(s(6),g(r.data.machine.name),s(2),g(r.data.machine.model||"Unknown Model"),s(),u("status",r.data.machine.status)("showLabel",!0),s(9),g(r.data.machine.accession_id),s(5),g(r.data.machine.manufacturer||"N/A"),s(4),u("location",r.data.machine.location),s(5),u("data",r.mockUtilization)("height",40),s(2),h("Avg: ",r.averageUtilization,"%"),s(5),g(r.data.machine.description||"No description provided."),s(3),p(r.data.machine.plr_state?42:43),s(8),g(r.data.machine.fqn||"N/A"),s(4),p(r.data.machine.connection_info?54:-1),s(),p(r.data.machine.connection_info?-1:55),s(4),u("color",r.data.machine.is_simulation_override?"accent":"primary"),s(),h(" ",r.data.machine.is_simulation_override?"Enabled":"Disabled"," "),s(2),p(r.store.maintenanceEnabled()?62:63),s(5),u("mat-dialog-close","edit"))},dependencies:[ue,ne,an,Ke,tt,et,j,te,N,A,ye,ve,be,W,q,hn,Y,re,cn,Ce,gt,he,on,nt,it,ft,Le,tn,Je,en],styles:[".title-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.machine-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px;color:var(--mat-sys-primary)}.title-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.subtitle[_ngcontent-%COMP%]{font-size:.8rem;color:var(--mat-sys-on-surface-variant);font-weight:400}.details-content[_ngcontent-%COMP%]{min-width:500px;min-height:400px;padding-top:16px}.overview-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px;padding:16px}.detail-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.full-width[_ngcontent-%COMP%]{grid-column:span 2}.label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--mat-sys-on-surface-variant);text-transform:uppercase;letter-spacing:.5px}.p-mono[_ngcontent-%COMP%]{font-family:monospace;background:var(--mat-sys-surface-container);padding:2px 4px;border-radius:4px;width:fit-content}.deck-view-container[_ngcontent-%COMP%]{height:350px;padding:16px;background:var(--mat-sys-surface-container-low);border-radius:8px}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--mat-sys-on-surface-variant);opacity:.7}.tech-details[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:24px}pre[_ngcontent-%COMP%]{background:var(--mat-sys-surface-container);padding:12px;border-radius:8px;margin:0;white-space:pre-wrap;font-size:.85rem}.sparkline-container[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;gap:16px;padding:8px 0}.trend-label[_ngcontent-%COMP%]{font-size:.8em;color:var(--mat-sys-tertiary);font-weight:500;white-space:nowrap}.maintenance-container[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:20px}.maintenance-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding-bottom:16px;border-bottom:1px solid var(--mat-sys-outline-variant)}.spacer[_ngcontent-%COMP%]{flex:1}.config-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .history-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;font-size:1rem;font-weight:500}.hint[_ngcontent-%COMP%]{margin:0 0 8px;font-size:.8rem;color:var(--mat-sys-on-surface-variant)}.json-editor[_ngcontent-%COMP%]{width:100%;height:200px;font-family:monospace;font-size:13px;padding:12px;background:var(--mat-sys-surface-container);border:1px solid var(--mat-sys-outline-variant);border-radius:8px;resize:vertical;color:var(--mat-sys-on-surface)}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}.disabled-msg[_ngcontent-%COMP%], .global-disabled-msg[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px;color:var(--mat-sys-on-surface-variant);text-align:center;background:var(--mat-sys-surface-container-low);border-radius:8px}.history-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.history-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px;background:var(--mat-sys-surface-container);border-radius:6px}.history-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.type[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem}.date[_ngcontent-%COMP%]{font-size:.8rem;color:var(--mat-sys-on-surface-variant)}.no-history[_ngcontent-%COMP%]{font-style:italic;color:var(--mat-sys-outline);font-size:.9rem}"]})};var Sn=(n,e)=>e.accession_id;function mi(n,e){n&1&&(i(0,"div",5),v(1,"mat-spinner",12),a())}function di(n,e){n&1&&(i(0,"th",27),o(1," Name "),a())}function pi(n,e){if(n&1&&(i(0,"td",28),o(1),a()),n&2){let t=e.$implicit;s(),h(" ",t.name," ")}}function ui(n,e){n&1&&(i(0,"th",27),o(1," Mode "),a())}function fi(n,e){n&1&&(i(0,"mat-chip",29)(1,"mat-icon",31),o(2,"computer"),a(),o(3," Simulated "),a()),n&2&&u("highlighted",!1)}function gi(n,e){n&1&&(i(0,"mat-chip",30)(1,"mat-icon",31),o(2,"precision_manufacturing"),a(),o(3," Physical "),a()),n&2&&u("highlighted",!1)}function hi(n,e){if(n&1&&(i(0,"td",28),d(1,fi,4,1,"mat-chip",29)(2,gi,4,1,"mat-chip",30),a()),n&2){let t=e.$implicit;s(),p(t.is_simulation_override?1:2)}}function _i(n,e){n&1&&(i(0,"th",27),o(1," Status "),a())}function xi(n,e){if(n&1&&(i(0,"td",28),v(1,"app-asset-status-chip",32),a()),n&2){let t=e.$implicit;s(),u("status",t.status)("showLabel",!0)}}function Ci(n,e){n&1&&(i(0,"th",27),o(1," Category "),a())}function vi(n,e){if(n&1&&(i(0,"td",28),o(1),a()),n&2){let t=e.$implicit;s(),h(" ",t.machine_category||"Unknown"," ")}}function bi(n,e){n&1&&(i(0,"th",27),o(1," Model "),a())}function yi(n,e){if(n&1&&(i(0,"td",28),o(1),a()),n&2){let t=e.$implicit;s(),h(" ",t.model||"N/A"," ")}}function Mi(n,e){n&1&&(i(0,"th",27),o(1," Location "),a())}function wi(n,e){if(n&1&&(i(0,"td",28),v(1,"app-location-breadcrumb",33),a()),n&2){let t=e.$implicit;s(),u("location",t.location)}}function Si(n,e){n&1&&(i(0,"th",27),o(1," Maintenance "),a())}function Di(n,e){if(n&1&&(i(0,"td",28),v(1,"app-maintenance-badge",34),a()),n&2){let t=e.$implicit;s(),u("machine",t)}}function Ti(n,e){n&1&&(i(0,"th",27),o(1," Actions "),a())}function Ei(n,e){if(n&1){let t=z();i(0,"td",28)(1,"button",35),b("click",function(){let l=E(t).$implicit,c=m(2);return k(c.viewDetails(l))}),i(2,"mat-icon"),o(3,"info"),a()(),i(4,"button",36),b("click",function(){let l=E(t).$implicit,c=m(2);return k(c.editMachine(l))}),i(5,"mat-icon"),o(6,"edit"),a()(),i(7,"button",37),b("click",function(){let l=E(t).$implicit,c=m(2);return k(c.deleteMachine(l))}),i(8,"mat-icon"),o(9,"delete"),a()()()}}function ki(n,e){n&1&&v(0,"tr",38)}function Ri(n,e){if(n&1){let t=z();i(0,"tr",39),b("contextmenu",function(l){let c=E(t).$implicit,_=m(2);return k(_.onContextMenu(l,c))}),a()}}function Ii(n,e){n&1&&(i(0,"tr",40)(1,"td",41),o(2,"No machines matching the selected filters"),a()())}function Pi(n,e){if(n&1&&(i(0,"div",6)(1,"table",13),F(2,14),y(3,di,2,0,"th",15)(4,pi,2,1,"td",16),B(),F(5,17),y(6,ui,2,0,"th",15)(7,hi,3,1,"td",16),B(),F(8,18),y(9,_i,2,0,"th",15)(10,xi,2,2,"td",16),B(),F(11,19),y(12,Ci,2,0,"th",15)(13,vi,2,1,"td",16),B(),F(14,20),y(15,bi,2,0,"th",15)(16,yi,2,1,"td",16),B(),F(17,21),y(18,Mi,2,0,"th",15)(19,wi,2,1,"td",16),B(),F(20,22),y(21,Si,2,0,"th",15)(22,Di,2,1,"td",16),B(),F(23,23),y(24,Ti,2,0,"th",15)(25,Ei,10,0,"td",16),B(),y(26,ki,1,0,"tr",24)(27,Ri,1,0,"tr",25)(28,Ii,3,0,"tr",26),a()()),n&2){let t=m();s(),u("dataSource",t.filteredMachines()),s(25),u("matHeaderRowDef",t.displayedColumns()),s(),u("matRowDefColumns",t.displayedColumns())}}function Oi(n,e){if(n&1&&v(0,"app-maintenance-badge",34),n&2){let t=m().$implicit;u("machine",t)}}function Li(n,e){if(n&1){let t=z();i(0,"div",43),b("click",function(){let l=E(t).$implicit,c=m(2);return k(c.viewDetails(l))})("contextmenu",function(l){let c=E(t).$implicit,_=m(2);return k(_.onContextMenu(l,c))}),i(1,"div",44)(2,"div",45)(3,"div",46)(4,"mat-icon"),o(5),a()(),i(6,"div",47)(7,"h3",48),o(8),a(),i(9,"p",49),o(10),a()()()(),i(11,"div",50)(12,"div",51)(13,"mat-icon",52),o(14,"location_on"),a(),i(15,"span",53),o(16),a()()(),i(17,"div",54),v(18,"app-asset-status-chip",55),d(19,Oi,1,1,"app-maintenance-badge",34),a()()}if(n&2){let t=e.$implicit,r=m(2);s(5),g(t.is_simulation_override?"computer":"precision_manufacturing"),s(3),g(t.name),s(2),g(t.model||t.machine_category),s(6),g(t.location_label||"Unassigned"),s(2),u("status",t.status),s(),p(r.store.maintenanceEnabled()?19:-1)}}function Ai(n,e){if(n&1&&(i(0,"div",7),O(1,Li,20,6,"div",42,Sn),a()),n&2){let t=m();s(),L(t.filteredMachines())}}function Ni(n,e){if(n&1){let t=z();i(0,"div",57),b("click",function(){let l=E(t).$implicit,c=m(2);return k(c.viewDetails(l))}),i(1,"mat-icon",58),o(2),a(),i(3,"div",59)(4,"div",60)(5,"span",61),o(6),a(),i(7,"span",62),o(8),a()()(),v(9,"app-asset-status-chip",55),i(10,"div",63)(11,"button",64),b("click",function(l){let c=E(t).$implicit,_=m(2);return l.stopPropagation(),k(_.editMachine(c))}),i(12,"mat-icon"),o(13,"edit"),a()(),i(14,"button",65),b("click",function(l){let c=E(t).$implicit,_=m(2);return l.stopPropagation(),k(_.deleteMachine(c))}),i(15,"mat-icon"),o(16,"delete"),a()()()()}if(n&2){let t=e.$implicit;s(2),g(t.is_simulation_override?"computer":"precision_manufacturing"),s(4),g(t.name),s(2),g(t.machine_category),s(),u("status",t.status)}}function Vi(n,e){if(n&1&&(i(0,"div",8),O(1,Ni,17,4,"div",56,Sn),a()),n&2){let t=m();s(),L(t.filteredMachines())}}function Fi(n,e){n&1&&(i(0,"div",9)(1,"mat-icon",66),o(2,"inventory_2"),a(),i(3,"p"),o(4,"No machines matching the current filters."),a()())}function Bi(n,e){if(n&1){let t=z();i(0,"button",67),b("click",function(){let l=E(t).item,c=m();return k(c.editMachine(l))}),i(1,"mat-icon"),o(2,"edit"),a(),i(3,"span"),o(4,"Edit"),a()(),i(5,"button",67),b("click",function(){let l=E(t).item,c=m();return k(c.duplicateMachine(l))}),i(6,"mat-icon"),o(7,"content_copy"),a(),i(8,"span"),o(9,"Duplicate"),a()(),v(10,"mat-divider"),i(11,"button",67),b("click",function(){let l=E(t).item,c=m();return k(c.deleteMachine(l))}),i(12,"mat-icon",68),o(13,"delete"),a(),i(14,"span",69),o(15,"Delete"),a()()}}var bt=class n{assetService=T(H);dialog=T(ge);store=T(ie);machines=R([]);machineDefinitions=R([]);isLoading=R(!0);viewConfig=C(()=>({viewTypes:["table","card","list"],groupByOptions:[{label:"Status",value:"status"},{label:"Category",value:"machine_category"}],filters:[{key:"status",label:"Status",type:"multiselect",options:[{label:"Idle",value:"idle",icon:"hourglass_empty"},{label:"Running",value:"running",icon:"play_arrow"},{label:"Error",value:"error",icon:"error_outline"},{label:"Offline",value:"offline",icon:"wifi_off"},{label:"Maintenance",value:"maintenance",icon:"build"}]},{key:"category",label:"Category",type:"chips",options:this.availableCategories().map(e=>({label:e,value:e}))},{key:"simulated",label:"Mode",type:"select",options:[{label:"All",value:null},{label:"Physical",value:!1,icon:"precision_manufacturing"},{label:"Simulated",value:!0,icon:"computer"}]},{key:"backends",label:"Backend",type:"multiselect",options:this.availableBackends().map(e=>({label:e,value:e}))}],sortOptions:[{label:"Name",value:"name"},{label:"Category",value:"category"},{label:"Status",value:"status"},{label:"Date Added",value:"created_at"}],storageKey:"machine-list",defaults:{viewType:"table",sortBy:"name",sortOrder:"asc"}}));viewState=R({viewType:"table",groupBy:null,filters:{},sortBy:"name",sortOrder:"asc",search:""});availableCategories=C(()=>{let e=new Set;return this.machines().forEach(t=>{t.machine_category&&e.add(t.machine_category)}),Array.from(e).sort()});availableBackends=C(()=>{let e=new Set;return this.machineDefinitions().forEach(t=>{t.compatible_backends&&t.compatible_backends.forEach(r=>e.add(r))}),Array.from(e).sort()});displayedColumns=C(()=>{let e=["name","simulated","status","category","model","location"];return this.store.maintenanceEnabled()&&e.push("maintenance"),e.push("actions"),e});contextMenuTrigger;contextMenuPosition={x:"0px",y:"0px"};machineRegisteredListener=()=>{this.loadMachines()};ngOnInit(){this.loadMachines(),this.loadMachineDefinitions(),window.addEventListener("machine-registered",this.machineRegisteredListener)}ngOnDestroy(){window.removeEventListener("machine-registered",this.machineRegisteredListener)}loadMachines(){this.isLoading.set(!0),this.assetService.getMachines().subscribe({next:e=>{this.machines.set(e),this.isLoading.set(!1)},error:e=>{console.error("[ASSET-DEBUG] loadMachines: Error fetching machines:",e),this.isLoading.set(!1)}})}loadMachineDefinitions(){this.assetService.getMachineDefinitions().subscribe({next:e=>this.machineDefinitions.set(e),error:e=>console.error("[ASSET-DEBUG] Error loading machine definitions:",e)})}onViewStateChange(e){this.viewState.set(e)}filteredMachines=C(()=>{let e=this.machines(),t=this.viewState();if(t.search){let x=t.search.toLowerCase();e=e.filter(f=>f.name.toLowerCase().includes(x)||f.machine_category?.toLowerCase().includes(x)||f.model?.toLowerCase().includes(x)||f.manufacturer?.toLowerCase().includes(x))}let r=t.filters.status||[];r.length>0&&(e=e.filter(x=>r.includes(x.status)));let l=t.filters.category||[];l.length>0&&(e=e.filter(x=>x.machine_category&&l.includes(x.machine_category)));let c=t.filters.simulated?.[0];return c!=null&&(e=e.filter(x=>(x.is_simulation_override??!1)===c)),(t.filters.backends||[]).length>0,e.sort((x,f)=>{let D="",w="";switch(t.sortBy){case"name":D=x.name.toLowerCase(),w=f.name.toLowerCase();break;case"category":D=(x.machine_category||"").toLowerCase(),w=(f.machine_category||"").toLowerCase();break;case"created_at":D=new Date(x.created_at||0).getTime(),w=new Date(f.created_at||0).getTime();break;case"status":D=x.status,w=f.status;break}let M=D>w?1:D<w?-1:0;return t.sortOrder==="asc"?M:-M}),e});onContextMenu(e,t){e.preventDefault(),this.contextMenuPosition.x=e.clientX+"px",this.contextMenuPosition.y=e.clientY+"px",this.contextMenuTrigger.menuData={item:t},this.contextMenuTrigger.openMenu()}viewDetails(e){this.dialog.open(vt,{width:"800px",data:{machine:e}})}editMachine(e){}duplicateMachine(e){}deleteMachine(e){confirm(`Are you sure you want to delete machine "${e.name}"?`)&&this.assetService.deleteMachine(e.accession_id).subscribe({next:()=>{this.loadMachines()},error:t=>console.error("Error deleting machine",t)})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-machine-list"]],viewQuery:function(t,r){if(t&1&&He(Ct,5),t&2){let l;Fe(l=Be())&&(r.contextMenuTrigger=l.first)}},decls:13,vars:12,consts:[["contextMenu","matMenu"],[1,"machine-list-container"],[1,"bg-[var(--mat-sys-surface)]","border-b","border-[var(--theme-border)]","px-4","py-2","mb-4","rounded-xl","shadow-sm"],[3,"stateChange","config","state"],[1,"flex-1","overflow-hidden","relative"],[1,"absolute","inset-0","flex","items-center","justify-center","bg-white/50","dark:bg-black/50","z-20","backdrop-blur-sm","rounded-xl"],[1,"bg-[var(--mat-sys-surface)]","border","border-[var(--theme-border)]","rounded-xl","overflow-hidden","shadow-sm"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-4"],[1,"flex","flex-col","gap-2"],[1,"flex","flex-col","items-center","justify-center","p-12","text-[var(--mat-sys-on-surface-variant)]"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],["matMenuContent",""],["diameter","40"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","simulated"],["matColumnDef","status"],["matColumnDef","category"],["matColumnDef","model"],["matColumnDef","location"],["matColumnDef","maintenance"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","machine-row",3,"contextmenu",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],[1,"simulated-chip",3,"highlighted"],[1,"physical-chip",3,"highlighted"],[1,"chip-icon"],[3,"status","showLabel"],[3,"location"],[3,"machine"],["mat-icon-button","","color","primary","matTooltip","View Details",3,"click"],["mat-icon-button","","color","accent","matTooltip","Edit Machine",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete Machine",3,"click"],["mat-header-row",""],["mat-row","",1,"machine-row",3,"contextmenu"],[1,"mat-row"],["colspan","7",1,"mat-cell"],[1,"praxis-card","premium","group","cursor-pointer"],[1,"praxis-card","premium","group","cursor-pointer",3,"click","contextmenu"],[1,"card-header"],[1,"flex","items-center","gap-3","min-w-0"],[1,"w-10","h-10","rounded-lg","flex-shrink-0","flex","items-center","justify-center","bg-[var(--mat-sys-primary-container)]","text-[var(--mat-sys-primary)]"],[1,"min-w-0"],[1,"card-title","group-hover:text-[var(--mat-sys-primary)]","transition-colors"],[1,"card-subtitle"],[1,"card-content"],[1,"card-meta","mb-2"],[1,"!w-3","!h-3","!text-[12px]"],[1,"truncate"],[1,"card-actions"],[3,"status"],[1,"flex","items-center","gap-4","p-3","bg-[var(--mat-sys-surface)]","border","border-[var(--theme-border)]","rounded-xl","hover:bg-[var(--mat-sys-surface-container-highest)]","cursor-pointer"],[1,"flex","items-center","gap-4","p-3","bg-[var(--mat-sys-surface)]","border","border-[var(--theme-border)]","rounded-xl","hover:bg-[var(--mat-sys-surface-container-highest)]","cursor-pointer",3,"click"],[1,"text-[var(--mat-sys-primary)]"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2"],[1,"font-bold","truncate"],[1,"text-xs","text-[var(--mat-sys-on-surface-variant)]"],[1,"flex","items-center","gap-1"],["mat-icon-button","",3,"click"],["mat-icon-button","","color","warn",3,"click"],[1,"!w-12","!h-12","!text-[48px]","mb-4","opacity-20"],["mat-menu-item","",3,"click"],["color","warn"],[2,"color","var(--mat-sys-error)"]],template:function(t,r){if(t&1){let l=z();i(0,"div",1)(1,"div",2)(2,"app-view-controls",3),b("stateChange",function(_){return E(l),k(r.onViewStateChange(_))}),a()(),i(3,"div",4),d(4,mi,2,0,"div",5),d(5,Pi,29,3,"div",6),d(6,Ai,3,0,"div",7),d(7,Vi,3,0,"div",8),d(8,Fi,5,0,"div",9),a(),v(9,"div",10),i(10,"mat-menu",null,0),y(12,Bi,16,0,"ng-template",11),a()()}if(t&2){let l=ze(11);s(2),u("config",r.viewConfig())("state",r.viewState()),s(2),p(r.isLoading()?4:-1),s(),p(r.viewState().viewType==="table"?5:-1),s(),p(r.viewState().viewType==="card"?6:-1),s(),p(r.viewState().viewType==="list"?7:-1),s(),p(!r.isLoading()&&r.filteredMachines().length===0?8:-1),s(),Qt("left",r.contextMenuPosition.x)("top",r.contextMenuPosition.y),u("matMenuTriggerFor",l)}},dependencies:[Oe,Me,Se,ke,De,we,Re,Te,Ee,Ie,Pe,xt,N,A,j,fe,$,G,ot,rt,un,pn,mn,dn,Ct,gn,fn,W,q,xe,_e,Y,re,Le,ae],styles:[".machine-list-container[_ngcontent-%COMP%]{padding:0 16px 16px}.mat-elevation-z2[_ngcontent-%COMP%]{width:100%}.machine-row[_ngcontent-%COMP%]:hover{background-color:var(--mat-sys-surface-container-highest);cursor:pointer}.mat-no-data-row[_ngcontent-%COMP%]{text-align:center;font-style:italic;color:var(--mat-sys-color-on-surface-variant)}.simulated-chip[_ngcontent-%COMP%]{--mdc-chip-container-height: 24px;font-size:.75rem;background:var(--mat-sys-tertiary-container);color:var(--mat-sys-tertiary)}.physical-chip[_ngcontent-%COMP%]{--mdc-chip-container-height: 24px;font-size:.75rem;background:var(--mat-sys-success-container);color:var(--mat-sys-success)}[_nghost-%COMP%]     .chip-icon{font-size:14px;width:14px;height:14px;margin-right:4px}"],changeDetection:0})};function zi(n,e){if(n&1&&(i(0,"span",5)(1,"strong"),o(2),a(),o(3," discarded "),a()),n&2){let t=m();s(2),g(t.discardedInstances.length)}}function $i(n,e){n&1&&(i(0,"th",20),o(1,"Name"),a())}function Gi(n,e){if(n&1&&(i(0,"td",21),o(1),a()),n&2){let t=e.$implicit;s(),g(t.name)}}function ji(n,e){n&1&&(i(0,"th",20),o(1,"Status"),a())}function Ui(n,e){if(n&1&&(i(0,"td",21)(1,"mat-chip"),o(2),pe(3,"titlecase"),a()()),n&2){let t=e.$implicit;s(),ee("status-"+t.status.toLowerCase()),s(),h(" ",$e(3,3,t.status)," ")}}function Hi(n,e){n&1&&(i(0,"th",20),o(1,"Location"),a())}function qi(n,e){if(n&1&&(i(0,"td",21),v(1,"app-location-breadcrumb",22),a()),n&2){let t=e.$implicit;s(),u("location",t.location)}}function Wi(n,e){n&1&&(i(0,"th",20),o(1,"Actions"),a())}function Ji(n,e){if(n&1){let t=z();i(0,"button",25),b("click",function(){E(t);let l=m(2).$implicit,c=m(2);return k(c.markForCleaning(l))}),i(1,"mat-icon"),o(2,"cleaning_services"),a()()}}function Qi(n,e){if(n&1){let t=z();i(0,"button",23),b("click",function(){E(t);let l=m().$implicit,c=m(2);return k(c.markDiscarded(l))}),i(1,"mat-icon"),o(2,"delete_outline"),a()(),d(3,Ji,3,0,"button",24)}if(n&2){let t=m(3);s(3),p(t.isReusable?3:-1)}}function Xi(n,e){if(n&1&&(i(0,"td",21),d(1,Qi,4,1),a()),n&2){let t=e.$implicit;s(),p(t.status==="AVAILABLE"||t.status==="IN_USE"?1:-1)}}function Yi(n,e){n&1&&v(0,"tr",26)}function Zi(n,e){n&1&&v(0,"tr",27)}function Ki(n,e){if(n&1&&(i(0,"table",7),F(1,12),y(2,$i,2,0,"th",13)(3,Gi,2,1,"td",14),B(),F(4,15),y(5,ji,2,0,"th",13)(6,Ui,4,5,"td",14),B(),F(7,16),y(8,Hi,2,0,"th",13)(9,qi,2,1,"td",14),B(),F(10,17),y(11,Wi,2,0,"th",13)(12,Xi,2,1,"td",14),B(),y(13,Yi,1,0,"tr",18)(14,Zi,1,0,"tr",19),a()),n&2){let t=m();u("dataSource",t.visibleInstances),s(13),u("matHeaderRowDef",t.displayedColumns),s(),u("matRowDefColumns",t.displayedColumns)}}function ea(n,e){n&1&&(i(0,"div",8)(1,"mat-icon"),o(2,"inventory_2"),a(),i(3,"p"),o(4,"No instances to display"),a()())}var yt=class n{constructor(e,t){this.dialogRef=e;this.data=t;this.showDiscarded=t.showDiscarded}showDiscarded;displayedColumns=["name","status","location","actions"];get activeInstances(){return this.data.instances.filter(e=>e.status!=="depleted"&&e.status!=="expired")}get discardedInstances(){return this.data.instances.filter(e=>e.status==="depleted"||e.status==="expired")}get visibleInstances(){return this.showDiscarded?this.data.instances:this.activeInstances}get isReusable(){return this.data.definition.is_reusable??!1}markDiscarded(e){}markForCleaning(e){}addInstance(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||n)(de(Ye),de(Ze))};static \u0275cmp=P({type:n,selectors:[["app-resource-instances-dialog"]],decls:23,vars:5,consts:[["mat-dialog-title",""],[1,"subtitle"],[1,"header-row"],[1,"stats"],[1,"stat"],[1,"stat","discarded"],[3,"ngModelChange","ngModel"],["mat-table","",1,"instances-table",3,"dataSource"],[1,"empty-state"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","location"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"location"],["mat-icon-button","","color","warn","matTooltip","Mark as discarded",3,"click"],["mat-icon-button","","color","primary","matTooltip","Mark for cleaning"],["mat-icon-button","","color","primary","matTooltip","Mark for cleaning",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,r){t&1&&(i(0,"h2",0),o(1),i(2,"span",1),o(3,"Instances"),a()(),i(4,"mat-dialog-content")(5,"div",2)(6,"div",3)(7,"span",4)(8,"strong"),o(9),a(),o(10," active "),a(),d(11,zi,4,1,"span",5),a(),i(12,"mat-slide-toggle",6),me("ngModelChange",function(c){return ce(r.showDiscarded,c)||(r.showDiscarded=c),c}),o(13," Show Discarded "),a()(),d(14,Ki,15,3,"table",7)(15,ea,5,0,"div",8),a(),i(16,"mat-dialog-actions",9)(17,"button",10),b("click",function(){return r.dialogRef.close()}),o(18,"Close"),a(),i(19,"button",11),b("click",function(){return r.addInstance()}),i(20,"mat-icon"),o(21,"add"),a(),o(22," Add Instance "),a()()),t&2&&(s(),h(" ",r.data.definition.name," "),s(8),g(r.activeInstances.length),s(2),p(r.discardedInstances.length>0?11:-1),s(),le("ngModel",r.showDiscarded),s(2),p(r.visibleInstances.length>0?14:15))},dependencies:[ue,ne,Ke,tt,et,Oe,Me,Se,ke,De,we,Re,Te,Ee,Ie,Pe,N,A,j,te,fe,W,q,Ce,gt,he,nt,it,re,Je],styles:[".subtitle[_ngcontent-%COMP%]{font-size:.9rem;font-weight:400;color:var(--sys-on-surface-variant);margin-left:8px}.header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.stats[_ngcontent-%COMP%]{display:flex;gap:16px}.stat[_ngcontent-%COMP%]{font-size:.9rem}.stat.discarded[_ngcontent-%COMP%]{color:var(--sys-error)}.instances-table[_ngcontent-%COMP%]{width:100%}.status-available[_ngcontent-%COMP%]{background-color:var(--sys-primary-container)!important;color:var(--sys-on-primary-container)!important}.status-in_use[_ngcontent-%COMP%]{background-color:var(--sys-secondary-container)!important;color:var(--sys-on-secondary-container)!important}.status-depleted[_ngcontent-%COMP%], .status-expired[_ngcontent-%COMP%]{background-color:var(--sys-error-container)!important;color:var(--sys-on-error-container)!important}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;color:var(--sys-on-surface-variant)}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}"],changeDetection:0})};var ta={Plate:"Microplates with wells for holding samples. Available in 96, 384, or 1536-well formats.",TipRack:"Disposable pipette tips organized in a rack. Tips are consumed during liquid handling.",Reservoir:"Single or multi-channel containers for reagents. Typically used for buffers and wash solutions.",Carrier:"Deck-mounted holders that organize plates, tips, or other labware in fixed positions.",Trough:"Open containers for bulk liquids. Similar to reservoirs but often larger capacity.",Tube:"Individual sample tubes (Eppendorf, Falcon, etc.) for storing samples or reagents.",Deck:"The working surface of a liquid handler where all labware is positioned.",Resource:"Generic labware item that doesn't fit other categories.",Other:"Miscellaneous labware or equipment."},na={consumable:"Items that are used up during protocols. Consumables have a quantity that decreases as they are used (e.g., tips, reagents).",reusable:"Items that can be washed and used multiple times. Plates and carriers are typically reusable.","top-level":"Items that sit directly on the deck surface. Non-top-level items are nested inside carriers or other containers.","needs-processing":"Items that require additional processing before use (e.g., thawing, mixing, or preparation).",infinite:"Effectively unlimited quantity. The system will not track depletion for this item.","low-stock":"Quantity is running low. Consider restocking before the next protocol run.",depleted:"Item has been fully consumed and is no longer available for use.",expired:"Item has passed its expiration date and should not be used."};var ia={LiquidHandler:"Automated pipetting system for precise liquid transfers between containers.",PlateReader:"Instrument for measuring optical properties (absorbance, fluorescence, luminescence) of samples in plates.",Shaker:"Device for mixing or agitating plates and containers.",Centrifuge:"Instrument for separating components by spinning samples at high speed.",Incubator:"Temperature-controlled chamber for growing cells or running reactions.",Washer:"Automated plate washer for removing liquids and washing wells.",Dispenser:"Bulk reagent dispenser for rapid filling of plates.",Sealer:"Device for applying adhesive seals or heat seals to plates.",Other:"General laboratory equipment."};function Tn(n){return ta[n]||`${n} labware`}function Mt(n){return na[n.toLowerCase()]||n}function En(n){return ia[n]||`${n} equipment`}var wt={Plate:"grid_view",plate:"grid_view",TipRack:"tip_rack_custom",tip_rack:"tip_rack_custom",Reservoir:"water_drop",reservoir:"water_drop",Trough:"waves",trough:"waves",Tube:"test_tube",tube:"test_tube",Carrier:"table_rows",carrier:"table_rows",Deck:"view_quilt",Lid:"vertical_align_top",lid:"vertical_align_top",Resource:"category",resource:"category",Other:"category"},kn={LiquidHandler:"precision_manufacturing",PlateReader:"sensors",HeaterShaker:"microwave",Shaker:"vibration",Centrifuge:"rotate_right",Thermocycler:"device_thermostat",TemperatureController:"thermostat",Incubator:"wb_sunny",Pump:"water",Fan:"air",Sealer:"compress",Peeler:"layers_clear",PowderDispenser:"grain",Washer:"local_laundry_service",Dispenser:"format_color_fill",MagneticRack:"vertical_align_bottom",Other:"smart_toy"};function Rn(n){if(wt[n])return wt[n];let e=n.toLowerCase();return wt[e]?wt[e]:"category"}function In(n){return kn[n]?kn[n]:"smart_toy"}var Ft=["Carriers","Holders","Plates","TipRacks","Containers","Other"],aa=new Set(["deck","resource","well","tip_spot"]);function Bt(n){return n.replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").toLowerCase().replace(/-/g,"_")}var oa={plate_carrier:"Carriers",tip_carrier:"Carriers",trough_carrier:"Carriers",tube_carrier:"Carriers",carrier:"Carriers",mfx_carrier:"Carriers",mfx_module:"Carriers",tube_rack:"Holders",aluminum_block:"Holders",plate:"Plates",tip_rack:"TipRacks",trough:"Containers",tube:"Containers",lid:"Containers",petri_dish:"Containers",container:"Containers",reservoir:"Containers",trash:"Containers"};function Pn(n){if(!n)return!0;let e=Bt(n);return aa.has(e)}function On(n){if(!n)return"Other";let e=Bt(n);return oa[e]??"Other"}function Ln(n){return n?Bt(n):"other"}var zt={cor:"Corning",corning:"Corning",opentrons:"Opentrons",hamilton:"Hamilton",greiner:"Greiner",bld:"Bio-Rad",biorad:"Bio-Rad",thermo:"Thermo Fisher",nunc:"Nunc",falcon:"Falcon",eppendorf:"Eppendorf",axygen:"Axygen",tecan:"Tecan",azenta:"Azenta",nest:"Nest",sarstedt:"Sarstedt",revvity:"Revvity",porvair:"Porvair",agilent:"Agilent",beckman:"Beckman Coulter"},An={fb:"Flat",flat:"Flat",rb:"Round",rd:"Round",round:"Round",vb:"V-Bottom",v:"V-Bottom",conical:"V-Bottom",u:"U-Bottom",ub:"U-Bottom"},Nn={plate:"Plate",plt:"Plate",tip:"TipRack",tiprack:"TipRack",ntr:"TipRack",trough:"Trough",reservoir:"Trough",tube:"TubeRack"},ra=new Set(["wellplate","well","plate","tiprack","tip","rack","carrier","generic","standard","custom","module","nest","holder","ul","ml","l"]),St={pcr_strip:"PCR Strip",pcr:"PCR Plate",deepwell:"Deep Well",deep_well:"Deep Well",skirted:"Skirted Plate",half_skirted:"Half-Skirted Plate",unskirted:"Unskirted Plate",reservoir:"Reservoir",aluminumblock:"Aluminum Block",aluminum_block:"Aluminum Block",cooling_block:"Cooling Block",microplate:"Microplate",filter:"Filter Plate",storage:"Storage Plate"};function $t(n){let e=n.name||n.fqn?.split(".").pop()||"Unknown",t=n.fqn||"",l=e.toLowerCase().split(/[_\-\s]+/),c=n.vendor||null,_=n.num_items||null,x=n.well_volume_ul||n.tip_volume_ul||null,f=null,D=null,w=null;for(let M=0;M<l.length;M++){let S=l[M],V=l[M+1]||"";if(!c&&M===0&&zt[S]){c=zt[S];continue}if(!_&&/^\d+$/.test(S)){let I=parseInt(S,10);if([6,12,24,48,96,384,1536].includes(I)||I<=20){_=I;continue}}if(!x){let I=S.match(/^(\d+)(ul|ml)?$/);if(I&&(I[2]||V==="ul"||V==="ml")){let Z=parseInt(I[1],10);if((V==="ml"||I[2]==="ml")&&(Z*=1e3),Z>0&&Z<=1e5){x=Z,(V==="ul"||V==="ml")&&M++;continue}}}if(!f&&An[S]){f=An[S];continue}if(!D&&Nn[S]){D=Nn[S];continue}if(!w){let I=`${S}_${V}`;if(St[I]){w=St[I],M++;continue}if(St[S]){w=St[S];continue}}}if(!w){let M=l.filter(S=>!ra.has(S)&&!/^\d+$/.test(S)&&!zt[S]&&S.length>1);M.length>0&&(w=M.slice(0,3).map(S=>S.charAt(0).toUpperCase()+S.slice(1)).join(" "))}return{vendor:c,itemCount:_,volumeUl:x,displayName:w,bottomType:f,slotType:D,rawName:e}}function Vn(n){let e=$t(n);return e.displayName||e.rawName}function Fn(n){return n?n>=1e3?`${n/1e3}mL`:`${n}\xB5L`:null}function Bn(n,e){if(!n)return null;let t=e.toLowerCase();return t.includes("plate")||t.includes("well")?`${n}-well`:t.includes("tip")?`${n} tips`:t.includes("carrier")?`${n} slots`:t.includes("tube")||t.includes("rack")?`${n} positions`:`${n} items`}function sa(n,e){if(n&1&&(i(0,"mat-chip",1),o(1),a()),n&2){let t=m(2);u("matTooltip",t.itemCountTooltip),s(),h(" ",t.itemCountLabel," ")}}function la(n,e){if(n&1&&(i(0,"mat-chip",2),o(1),a()),n&2){let t=m(2);u("matTooltip",t.volumeTooltip),s(),h(" ",t.volumeLabel," ")}}function ca(n,e){if(n&1&&(i(0,"mat-chip",3),o(1),a()),n&2){let t=m(2);s(),h(" ",t.parsed.bottomType," ")}}function ma(n,e){if(n&1&&(i(0,"mat-chip",4),o(1),a()),n&2){let t=m(2);s(),h(" ",t.parsed.slotType," ")}}function da(n,e){if(n&1&&(i(0,"mat-chip",5),o(1),a()),n&2){let t=m(2);s(),h(" ",t.parsed.vendor," ")}}function pa(n,e){if(n&1&&(i(0,"mat-chip",6),o(1),a()),n&2){let t=m(2);s(),h(" ",t.parsed.displayName," ")}}function ua(n,e){if(n&1&&(i(0,"span",7),o(1),a()),n&2){let t=m(2);s(),h(" [PLR: ",t.parsed.rawName,"] ")}}function fa(n,e){if(n&1&&(i(0,"div",0),d(1,sa,2,2,"mat-chip",1),d(2,la,2,2,"mat-chip",2),d(3,ca,2,1,"mat-chip",3),d(4,ma,2,1,"mat-chip",4),d(5,da,2,1,"mat-chip",5),d(6,pa,2,1,"mat-chip",6),d(7,ua,2,1,"span",7),a()),n&2){let t=m();s(),p(t.itemCountLabel?1:-1),s(),p(t.volumeLabel?2:-1),s(),p(t.parsed.bottomType?3:-1),s(),p(t.parsed.slotType?4:-1),s(),p(t.showVendor&&t.parsed.vendor?5:-1),s(),p(t.showDisplayName&&t.parsed.displayName?6:-1),s(),p(t.showPlrName?7:-1)}}var Dt=class n{definition;showVendor=!0;showDisplayName=!1;showPlrName=!1;parsed=null;itemCountLabel=null;volumeLabel=null;itemCountTooltip="";volumeTooltip="";ngOnChanges(){if(this.definition){this.parsed=$t(this.definition);let e=Ln(this.definition.plr_category);this.itemCountLabel=Bn(this.parsed.itemCount,e),this.volumeLabel=Fn(this.parsed.volumeUl),e.includes("tip")?(this.itemCountTooltip="Number of tips",this.volumeTooltip="Maximum tip volume"):e.includes("carrier")?(this.itemCountTooltip="Number of slots",this.volumeTooltip=""):(this.itemCountTooltip="Number of wells",this.volumeTooltip="Well volume")}}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-resource-chips"]],inputs:{definition:"definition",showVendor:"showVendor",showDisplayName:"showDisplayName",showPlrName:"showPlrName"},features:[Jt],decls:1,vars:1,consts:[[1,"chip-row"],[1,"info-chip","count",3,"matTooltip"],[1,"info-chip","volume",3,"matTooltip"],["matTooltip","Well bottom type",1,"info-chip","bottom"],["matTooltip","Slot type",1,"info-chip","slot"],["matTooltip","Vendor",1,"info-chip","vendor"],["matTooltip","Type",1,"info-chip","type"],["matTooltip","PyLabRobot identifier",1,"plr-name"]],template:function(t,r){t&1&&d(0,fa,8,7,"div",0),t&2&&p(r.parsed?0:-1)},dependencies:[W,q,$,G],styles:[".chip-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:4px;align-items:center}.info-chip[_ngcontent-%COMP%]{--mdc-chip-container-height: 22px;font-size:.7rem;font-weight:500}.info-chip.count[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--mat-sys-primary-container);--mdc-chip-label-text-color: var(--mat-sys-on-primary-container)}.info-chip.volume[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--mat-sys-secondary-container);--mdc-chip-label-text-color: var(--mat-sys-on-secondary-container)}.info-chip.vendor[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--mat-sys-surface-container-high);--mdc-chip-label-text-color: var(--mat-sys-on-surface-variant)}.info-chip.type[_ngcontent-%COMP%], .info-chip.bottom[_ngcontent-%COMP%], .info-chip.slot[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--mat-sys-tertiary-container);--mdc-chip-label-text-color: var(--mat-sys-on-tertiary-container)}.plr-name[_ngcontent-%COMP%]{font-size:.65rem;color:var(--mat-sys-on-surface-variant);font-family:monospace;opacity:.7}"],changeDetection:0})};var zn=n=>({defGroup:n}),$n=(n,e)=>e.category,Gt=(n,e)=>e.definition.accession_id;function ha(n,e){if(n&1&&v(0,"app-asset-status-chip",12),n&2){let t=m().defGroup;u("status",t.primaryStatus)("showLabel",!0)}}function _a(n,e){if(n&1&&(i(0,"mat-chip",14),o(1,"Consumable"),a()),n&2){let t=m(3);u("matTooltip",t.getPropertyTooltip("consumable"))}}function xa(n,e){if(n&1&&(i(0,"span",16),o(1,"\u221E"),a()),n&2){let t=m(3);u("matTooltip",t.getPropertyTooltip("infinite"))}}function Ca(n,e){if(n&1&&(i(0,"span",21),o(1),a()),n&2){let t=m().defGroup,r=m(2);K("low",t.activeCount<3),u("matTooltip",t.activeCount<3?r.getPropertyTooltip("low-stock"):"Available quantity"),s(),h(" ",t.isConsumable?t.activeCount:1," ")}}function va(n,e){if(n&1&&(i(0,"span",18),o(1),a()),n&2){let t=m().defGroup,r=m(2);u("matTooltip",r.getPropertyTooltip("depleted")),s(),h(" (",t.discardedCount," discarded) ")}}function ba(n,e){if(n&1&&(i(0,"mat-icon",19),o(1,"refresh"),a()),n&2){let t=m(3);u("matTooltip",t.getPropertyTooltip("reusable"))}}function ya(n,e){if(n&1){let t=z();i(0,"div",8),b("click",function(){let l=E(t).defGroup,c=m(2);return k(c.openInstancesDialog(l))}),i(1,"div",9)(2,"span",10),o(3),a(),i(4,"div",11),d(5,ha,1,2,"app-asset-status-chip",12),v(6,"app-resource-chips",13),d(7,_a,2,1,"mat-chip",14),a()(),i(8,"div",15),d(9,xa,2,1,"span",16)(10,Ca,2,4,"span",17),d(11,va,2,2,"span",18),d(12,ba,2,1,"mat-icon",19),a(),i(13,"mat-icon",20),o(14,"chevron_right"),a()()}if(n&2){let t,r=e.defGroup,l=m(2);s(3),g(l.getDisplayLabel(r.definition)),s(2),p(r.isConsumable&&r.primaryStatus?5:-1),s(),u("definition",r.definition)("showVendor",!0)("showDisplayName",!1),s(),p(r.isConsumable?7:-1),s(2),p(r.isConsumable&&r.isInfinite?9:10),s(2),p((t=l.viewState().filters.show_discarded)!=null&&t.includes(!0)&&r.discardedCount>0?11:-1),s(),p(r.isReusable?12:-1)}}function Ma(n,e){if(n&1&&(i(0,"mat-chip",28),o(1," Consumable "),a()),n&2){let t=m().$implicit,r=m(3);K("mixed",t.consumableStatus==="mixed"),u("matTooltip",t.consumableStatus==="mixed"?"Some items in this category are consumable (used up during protocols)":r.getPropertyTooltip("consumable"))}}function wa(n,e){n&1&&Lt(0)}function Sa(n,e){if(n&1&&y(0,wa,1,0,"ng-container",29),n&2){let t=e.$implicit;m(3);let r=ze(1);u("ngTemplateOutlet",r)("ngTemplateOutletContext",At(2,zn,t))}}function Da(n,e){if(n&1&&(i(0,"mat-expansion-panel",22)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon",23),o(4),a(),i(5,"span",24),o(6),a()(),i(7,"mat-panel-description")(8,"span",25),o(9),a(),d(10,Ma,2,3,"mat-chip",26),a()(),i(11,"div",27),O(12,Sa,1,4,"ng-container",null,Gt),a()()),n&2){let t=e.$implicit,r=m(3);s(3),u("matTooltip",r.getCategoryTooltip(t.category)),s(),g(r.getCategoryIcon(t.category)),s(),u("matTooltip",r.getCategoryTooltip(t.category)),s(),g(t.category),s(3),h("",t.totalCount," types"),s(),p(t.consumableStatus!=="none"?10:-1),s(2),L(t.definitions)}}function Ta(n,e){if(n&1&&(i(0,"mat-accordion",6),O(1,Da,14,6,"mat-expansion-panel",22,$n),a()),n&2){let t=m(2);s(),L(t.filteredGroups())}}function Ea(n,e){n&1&&Lt(0)}function ka(n,e){if(n&1&&y(0,Ea,1,0,"ng-container",29),n&2){let t=e.$implicit;m(2);let r=ze(1);u("ngTemplateOutlet",r)("ngTemplateOutletContext",At(2,zn,t))}}function Ra(n,e){if(n&1&&(i(0,"div",7),O(1,ka,1,4,"ng-container",null,Gt),a()),n&2){let t=m(2);s(),L(t.filteredFlatDefinitions())}}function Ia(n,e){if(n&1&&(y(0,ya,15,9,"ng-template",null,0,Yt),d(2,Ta,3,0,"mat-accordion",6)(3,Ra,3,0,"div",7)),n&2){let t=m();s(2),p(t.viewState().groupBy?2:3)}}function Pa(n,e){if(n&1&&v(0,"app-asset-status-chip",37),n&2){let t=m().$implicit;u("status",t.primaryStatus)}}function Oa(n,e){if(n&1){let t=z();i(0,"div",31),b("click",function(){let l=E(t).$implicit,c=m(3);return k(c.openInstancesDialog(l))}),i(1,"div",32)(2,"mat-icon"),o(3),a()(),i(4,"div",33)(5,"span",34),o(6),a(),i(7,"span",35),o(8),a()(),i(9,"div",36),d(10,Pa,1,1,"app-asset-status-chip",37),i(11,"div",38),o(12),a()()()}if(n&2){let t=e.$implicit,r=m().$implicit,l=m(2);s(3),g(l.getCategoryIcon(r.category)),s(3),g(l.getDisplayLabel(t.definition)),s(2),g(r.category),s(2),p(t.isConsumable&&t.primaryStatus?10:-1),s(2),h(" ",t.isConsumable&&t.isInfinite?"\u221E":t.isConsumable?t.activeCount:1," ")}}function La(n,e){if(n&1&&O(0,Oa,13,5,"div",30,Gt),n&2){let t=e.$implicit;L(t.definitions)}}function Aa(n,e){if(n&1&&(i(0,"div",4),O(1,La,2,0,null,null,$n),a()),n&2){let t=m();s(),L(t.filteredGroups())}}function Na(n,e){n&1&&(i(0,"div",5)(1,"mat-icon"),o(2,"inventory_2"),a(),i(3,"p"),o(4,"No resources matching current filters"),a()())}var Tt=class n{assetService=T(H);dialog=T(ge);store=T(ie);resources=R([]);definitions=R([]);machines=R([]);viewConfig=C(()=>({viewTypes:["accordion","list"],groupByOptions:[{label:"Category",value:"category"}],filters:[{key:"status",label:"Status",type:"multiselect",options:[{label:"Available",value:"available",icon:"check_circle"},{label:"In Use",value:"in_use",icon:"play_arrow"},{label:"Reserved",value:"reserved",icon:"lock"},{label:"Depleted",value:"depleted",icon:"remove_circle"},{label:"Expired",value:"expired",icon:"event_busy"}]},{key:"category",label:"Category",type:"multiselect",options:this.categories().map(e=>({label:e,value:e}))},{key:"brands",label:"Brand",type:"multiselect",options:this.brands().map(e=>({label:e,value:e}))},{key:"machine_id",label:"Location",type:"multiselect",options:this.machines().map(e=>({label:e.name,value:e.accession_id}))},{key:"show_discarded",label:"Show Discarded",type:"toggle",defaultValue:!1}],sortOptions:[{label:"Name",value:"name"},{label:"Count",value:"count"},{label:"Category",value:"category"},{label:"Created",value:"created_at"}],storageKey:"resource-accordion",defaults:{viewType:"accordion",sortBy:"name",sortOrder:"asc"}}));viewState=R({viewType:"accordion",groupBy:"category",filters:{},sortBy:"name",sortOrder:"asc",search:""});onViewStateChange(e){this.viewState.set(e)}brands=C(()=>{let e=new Set;return this.resources().forEach(t=>{let r=t.definition?.vendor||t.vendor||t.manufacturer;r&&e.add(r)}),Array.from(e).sort()});constructor(){}categories=C(()=>this.resourceGroups().map(e=>e.category).sort());resourceGroups=C(()=>{let e=this.definitions(),t=this.resources(),r=new Map;e.forEach(c=>{if(Pn(c.plr_category))return;let _=On(c.plr_category),x=c.is_consumable??!1,f=t.filter(I=>I.resource_definition_accession_id===c.accession_id),D=f.filter(I=>I.status!=="depleted"&&I.status!=="expired"),w=f.filter(I=>I.status==="depleted"||I.status==="expired"),M={reserved:1,in_use:2,depleted:3,expired:4,available:5,unknown:6},S=null;x&&D.length>0&&(S=D.sort((Z,U)=>(M[Z.status]||99)-(M[U.status]||99))[0]?.status||null);let V={definition:c,instances:f,count:c.default_count??null,isInfinite:x&&this.store.infiniteConsumables(),isConsumable:x,isReusable:c.is_reusable??!1,activeCount:D.length,discardedCount:w.length,primaryStatus:S};r.has(_)||r.set(_,[]),r.get(_).push(V)});let l=[];return r.forEach((c,_)=>{let x=c.filter(D=>D.isConsumable).length,f;x===0?f="none":x===c.length?f="all":f="mixed",l.push({category:_,definitions:c,totalCount:c.length,consumableStatus:f})}),l.sort((c,_)=>{let x=Ft.indexOf(c.category),f=Ft.indexOf(_.category);return x-f})});filteredFlatDefinitions=C(()=>this.filteredGroups().map(t=>t.definitions).flat());filteredGroups=C(()=>{let e=this.viewState(),t=this.resourceGroups(),r=e.filters.category||[];r.length>0&&(t=t.filter(f=>r.includes(f.category)));let l=e.filters.show_discarded?.includes(!0),c=e.filters.status||[],_=e.filters.brands||[],x=e.filters.machine_id||[];return t.map(f=>{let D=f.definitions.map(w=>{let M=w.instances;if(l||(M=M.filter(U=>U.status!=="depleted"&&U.status!=="expired")),c.length>0&&(M=M.filter(U=>c.includes(U.status))),x.length>0&&(M=M.filter(U=>U.location&&x.some(Ae=>U.location?.startsWith(Ae)))),_.length>0){let U=w.definition.vendor;if(!U||!_.includes(U))return null}if(e.search){let U=e.search.toLowerCase(),Ae=w.definition.name.toLowerCase().includes(U),Ot=f.category.toLowerCase().includes(U);if(!Ae&&!Ot)return null}if((c.length>0||x.length>0)&&M.length===0)return null;let V=M.length,I={reserved:1,in_use:2,depleted:3,expired:4,available:5,unknown:6},Z=null;return w.isConsumable&&M.length>0&&(Z=[...M].sort((Ae,Ot)=>(I[Ae.status]||99)-(I[Ot.status]||99))[0]?.status||null),Ve(Ne({},w),{instances:M,activeCount:V,primaryStatus:Z})}).filter(w=>w!==null);return D.sort((w,M)=>{let S="",V="";switch(e.sortBy){case"name":S=w.definition.name.toLowerCase(),V=M.definition.name.toLowerCase();break;case"count":S=w.activeCount,V=M.activeCount;break;case"created_at":S=w.definition.created_at||"",V=M.definition.created_at||"";break}let I=S>V?1:S<V?-1:0;return e.sortOrder==="asc"?I:-I}),Ve(Ne({},f),{definitions:D,totalCount:D.length})}).filter(f=>f.definitions.length>0).sort((f,D)=>{if(e.sortBy==="category"){let w=f.category.localeCompare(D.category);return e.sortOrder==="asc"?w:-w}return f.category.localeCompare(D.category)})});ngOnInit(){this.loadData()}loadData(){this.assetService.getResources().subscribe(e=>{this.resources.set(e)}),this.assetService.getResourceDefinitions().subscribe(e=>{this.definitions.set(e)}),this.assetService.getMachines().subscribe(e=>{this.machines.set(e)})}onFiltersChange(e){}getCategoryIcon(e){switch(e){case"Carriers":return"grid_view";case"Holders":return"biotech";case"Plates":return"dataset";case"TipRacks":return"apps";case"Containers":return"science";case"Other":return"category";default:return Rn(e)}}getDisplayLabel(e){return Vn(e)}getCategoryTooltip(e){return Tn(e)}getPropertyTooltip(e){return Mt(e)}openInstancesDialog(e){this.dialog.open(yt,{width:"900px",data:{definition:e.definition,instances:e.instances,showDiscarded:this.viewState().filters.show_discarded?.includes(!0)}})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-resource-accordion"]],decls:6,vars:5,consts:[["definitionItem",""],[1,"resource-accordion-container"],[1,"bg-[var(--mat-sys-surface)]","border-b","border-[var(--theme-border)]","px-4","py-2","mb-4","rounded-xl","shadow-sm"],[3,"stateChange","config","state"],[1,"flex","flex-col","gap-2"],[1,"empty-state"],["multi","true"],[1,"definition-list","flat-list"],[1,"definition-item",3,"click"],[1,"def-info"],[1,"def-name"],[1,"def-chips"],[3,"status","showLabel"],[3,"definition","showVendor","showDisplayName"],[1,"info-chip","consumable",3,"matTooltip"],[1,"def-counts"],[1,"count","infinite",3,"matTooltip"],[1,"count",3,"low","matTooltip"],[1,"count","discarded",3,"matTooltip"],[1,"reusable-icon",3,"matTooltip"],[1,"chevron"],[1,"count",3,"matTooltip"],[1,"category-panel"],[1,"category-icon",3,"matTooltip"],[3,"matTooltip"],[1,"count-badge"],[1,"consumable-chip",3,"mixed","matTooltip"],[1,"definition-list"],[1,"consumable-chip",3,"matTooltip"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"flex","items-center","gap-4","p-3","bg-[var(--mat-sys-surface)]","border","border-[var(--theme-border)]","rounded-lg","hover:border-[var(--mat-sys-primary)]","transition-colors","cursor-pointer"],[1,"flex","items-center","gap-4","p-3","bg-[var(--mat-sys-surface)]","border","border-[var(--theme-border)]","rounded-lg","hover:border-[var(--mat-sys-primary)]","transition-colors","cursor-pointer",3,"click"],[1,"w-10","h-10","rounded-full","bg-[var(--mat-sys-primary-container)]","text-[var(--mat-sys-on-primary-container)]","flex","items-center","justify-center"],[1,"flex-1","flex","flex-col"],[1,"font-medium"],[1,"text-xs","text-[var(--mat-sys-on-surface-variant)]"],[1,"flex","items-center","gap-2"],["size","small",3,"status"],[1,"text-sm","font-semibold","px-2","py-1","bg-[var(--mat-sys-surface-container-highest)]","rounded","text-[var(--mat-sys-on-surface)]"]],template:function(t,r){t&1&&(i(0,"div",1)(1,"div",2)(2,"app-view-controls",3),b("stateChange",function(c){return r.onViewStateChange(c)}),a()(),d(3,Ia,4,1),d(4,Aa,3,0,"div",4),d(5,Na,5,0,"div",5),a()),t&2&&(s(2),u("config",r.viewConfig())("state",r.viewState()),s(),p(r.viewState().viewType==="accordion"?3:-1),s(),p(r.viewState().viewType==="list"?4:-1),s(),p(r.filteredGroups().length===0?5:-1))},dependencies:[pt,dt,st,lt,mt,ct,N,A,j,$,G,sn,Ce,ne,at,Y,Dt,ae,Kt],styles:[".resource-accordion-container[_ngcontent-%COMP%]{padding:0 16px 16px}.accordion-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.accordion-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:500}.discard-toggle[_ngcontent-%COMP%]{font-size:.85rem}.filter-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.category-panel[_ngcontent-%COMP%]{margin-bottom:8px}.category-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:20px;width:20px;height:20px}.count-badge[_ngcontent-%COMP%]{background:var(--sys-primary-container);color:var(--sys-on-primary-container);padding:2px 8px;border-radius:12px;font-size:.75rem;margin-right:8px}.consumable-chip[_ngcontent-%COMP%]{font-size:.65rem;min-height:20px;padding:0 6px}.consumable-chip.mixed[_ngcontent-%COMP%]{border:2px dashed var(--sys-outline);background:transparent}.definition-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.definition-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 16px;background:linear-gradient(135deg,var(--mat-sys-surface) 0%,var(--mat-sys-surface-container-low) 100%);border:1px solid var(--theme-border);border-radius:12px;cursor:pointer;transition:all .2s ease}.definition-item[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,var(--mat-sys-surface-container-low) 0%,var(--mat-sys-surface-container) 100%);border-color:var(--sys-primary);transform:translate(4px);box-shadow:0 4px 12px #0000001a}.def-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:2px;min-width:0}.def-name[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--theme-text-primary)}.def-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}.info-chip[_ngcontent-%COMP%]{--mdc-chip-container-height: 20px;font-size:.65rem;font-weight:500}.info-chip.consumable[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-tertiary-container);--mdc-chip-label-text-color: var(--sys-on-tertiary-container)}.info-chip.vendor[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-surface-container-high);--mdc-chip-label-text-color: var(--sys-on-surface-variant)}.def-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant)}.def-counts[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-right:8px}.count[_ngcontent-%COMP%]{font-weight:600;font-size:1rem}.count.infinite[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--sys-primary)}.count.low[_ngcontent-%COMP%]{color:var(--sys-error)}.count.discarded[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant)}.reusable-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;color:var(--sys-tertiary)}.chevron[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;color:var(--sys-on-surface-variant)}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}"],changeDetection:0})};var Va=(n,e)=>e.category,Gn=(n,e)=>e.manufacturer,jt=(n,e)=>e.accession_id;function Fa(n,e){if(n&1&&(i(0,"mat-chip",20),o(1),a()),n&2){let t=e.$implicit;s(),h("",t,"-channel")}}function Ba(n,e){if(n&1&&O(0,Fa,2,1,"mat-chip",20,se),n&2){let t=m().$implicit;L(t.capabilities.channels)}}function za(n,e){if(n&1&&(i(0,"mat-chip",21),o(1),a()),n&2){let t=e.$implicit;u("matTooltip","Module: "+t),s(),g(t)}}function $a(n,e){if(n&1&&O(0,za,2,2,"mat-chip",21,se),n&2){let t=m().$implicit;L(t.capabilities.modules)}}function Ga(n,e){if(n&1&&(i(0,"span",19),o(1),a()),n&2){let t=m().$implicit;s(),h(" ",t.compatible_backends.length," drivers ")}}function ja(n,e){if(n&1&&(i(0,"div",14)(1,"div",15)(2,"span",16),o(3),a(),i(4,"div",17),d(5,Ba,2,0),d(6,$a,2,0),a()(),i(7,"div",18),d(8,Ga,2,1,"span",19),a()()),n&2){let t=e.$implicit;s(3),g(t.name),s(2),p(!(t.capabilities==null||t.capabilities.channels==null)&&t.capabilities.channels.length?5:-1),s(),p(!(t.capabilities==null||t.capabilities.modules==null)&&t.capabilities.modules.length?6:-1),s(2),p(t.compatible_backends!=null&&t.compatible_backends.length?8:-1)}}function Ua(n,e){if(n&1&&(i(0,"mat-expansion-panel",11)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon",12),o(4,"business"),a(),o(5),a(),i(6,"mat-panel-description")(7,"span",13),o(8),a()()(),i(9,"div",4),O(10,ja,9,4,"div",14,jt),a()()),n&2){let t=e.$implicit;s(5),h(" ",t.manufacturer," "),s(3),g(t.count),s(2),L(t.machines)}}function Ha(n,e){if(n&1&&(i(0,"mat-expansion-panel",6)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon",7),o(4),a(),i(5,"span",8),o(6),a()(),i(7,"mat-panel-description")(8,"span",9),o(9),a()()(),i(10,"mat-accordion",10),O(11,Ua,12,2,"mat-expansion-panel",11,Gn),a()()),n&2){let t=e.$implicit,r=m(2);s(3),u("matTooltip",r.getCategoryTooltip(t.category)),s(),g(r.getCategoryIcon(t.category)),s(),u("matTooltip",r.getCategoryTooltip(t.category)),s(),g(t.category),s(3),h("",t.totalCount," types"),s(2),L(t.manufacturers)}}function qa(n,e){if(n&1&&O(0,Ha,13,5,"mat-expansion-panel",6,Va),n&2){let t=m();L(t.filteredCategories())}}function Wa(n,e){if(n&1&&(i(0,"span",23),o(1),a()),n&2){let t=m().$implicit;s(),h(" ",t.compatible_backends.length," drivers ")}}function Ja(n,e){if(n&1&&(i(0,"div",14)(1,"div",15)(2,"span",16),o(3),a(),i(4,"span",22),o(5),a()(),i(6,"div",18),d(7,Wa,2,1,"span",23),a()()),n&2){let t=e.$implicit;s(3),g(t.name),s(2),g(t.machine_category),s(2),p(t.compatible_backends!=null&&t.compatible_backends.length?7:-1)}}function Qa(n,e){if(n&1&&(i(0,"mat-expansion-panel",11)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"mat-icon",12),o(4,"business"),a(),o(5),a(),i(6,"mat-panel-description")(7,"span",9),o(8),a()()(),i(9,"div",4),O(10,Ja,8,3,"div",14,jt),a()()),n&2){let t=e.$implicit;s(5),h(" ",t.manufacturer," "),s(3),h("",t.count," types"),s(2),L(t.machines)}}function Xa(n,e){if(n&1&&O(0,Qa,12,2,"mat-expansion-panel",11,Gn),n&2){let t=m();L(t.filteredByManufacturer())}}function Ya(n,e){if(n&1&&(i(0,"span",23),o(1),a()),n&2){let t=m().$implicit;s(),h("",t.compatible_backends.length," drivers")}}function Za(n,e){if(n&1&&(i(0,"div",24)(1,"div",25)(2,"div",26)(3,"span",27),o(4),a(),i(5,"span",22),o(6),a()(),d(7,Ya,2,1,"span",23),a()()),n&2){let t=e.$implicit;s(4),g(t.name),s(2),qe("",t.manufacturer," \u2022 ",t.machine_category),s(),p(t.compatible_backends!=null&&t.compatible_backends.length?7:-1)}}function Ka(n,e){if(n&1&&(i(0,"div",4),O(1,Za,8,4,"div",24,jt),a()),n&2){let t=m();s(),L(t.filteredFlatList())}}function eo(n,e){if(n&1&&(i(0,"div",5)(1,"mat-icon"),o(2,"inventory_2"),a(),i(3,"p"),o(4),a()()),n&2){let t=m();s(4),h('No machine types matching "',t.viewState.search,'"')}}var Et=class n{assetService=T(H);definitions=R([]);_viewState=R({viewType:"accordion",groupBy:"category",filters:{},sortBy:"name",sortOrder:"asc",search:""});set viewState(e){this._viewState.set(e)}get viewState(){return this._viewState()}constructor(){}filteredFlatList=C(()=>{let e=this.viewState,t=e.search?.toLowerCase()||"",r=this.definitions().filter(l=>l.name.toLowerCase().includes(t)||l.manufacturer?.toLowerCase().includes(t)||l.machine_category?.toLowerCase().includes(t));return r=[...r].sort((l,c)=>{let _=l[e.sortBy]||"",x=c[e.sortBy]||"",f=_.toString().localeCompare(x.toString());return e.sortOrder==="asc"?f:-f}),r});filteredByManufacturer=C(()=>{let e=this.filteredFlatList(),t=new Map;return e.forEach(r=>{let l=r.manufacturer||"Unknown";t.has(l)||t.set(l,[]),t.get(l).push(r)}),Array.from(t.entries()).map(([r,l])=>({manufacturer:r,machines:l,count:l.length})).sort((r,l)=>r.manufacturer.localeCompare(l.manufacturer))});filteredCategories=C(()=>{let e=this.filteredFlatList(),t=new Map;e.forEach(l=>{let c=l.machine_category||"Other",_=l.manufacturer||"Unknown";t.has(c)||t.set(c,new Map);let x=t.get(c);x.has(_)||x.set(_,[]),x.get(_).push(l)});let r=[];return t.forEach((l,c)=>{let _=[];l.forEach((x,f)=>{_.push({manufacturer:f,machines:x,count:x.length})}),r.push({category:c,manufacturers:_.sort((x,f)=>x.manufacturer.localeCompare(f.manufacturer)),totalCount:_.reduce((x,f)=>x+f.count,0)})}),r.sort((l,c)=>l.category.localeCompare(c.category))});ngOnInit(){this.loadData()}loadData(){this.assetService.getMachineDefinitions().subscribe(e=>{this.definitions.set(e)})}getCategoryIcon(e){return In(e)}getCategoryTooltip(e){return En(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-machine-definition-accordion"]],inputs:{viewState:"viewState"},decls:11,vars:3,consts:[[1,"accordion-container"],[1,"accordion-header"],[1,"total-badge"],["multi","true"],[1,"machine-list"],[1,"empty-state"],[1,"category-panel"],[1,"category-icon",3,"matTooltip"],[3,"matTooltip"],[1,"count-badge","ml-auto"],["multi","true",1,"nested-accordion"],[1,"manufacturer-panel"],[1,"manufacturer-icon"],[1,"count-badge","small"],[1,"machine-item"],[1,"machine-info"],[1,"machine-name"],[1,"machine-chips"],[1,"machine-meta"],["matTooltip","Compatible drivers/backends",1,"backends-count"],["matTooltip","Number of channels",1,"capability-chip"],[1,"capability-chip","module",3,"matTooltip"],[1,"text-xs","text-[var(--mat-sys-on-surface-variant)]"],[1,"backends-count"],[1,"machine-item","p-4","bg-[var(--mat-sys-surface-container)]","rounded-lg","mb-2"],[1,"flex","items-center","justify-between"],[1,"flex","flex-col"],[1,"font-medium"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"div",1)(2,"h3"),o(3,"Machine Registry"),a(),i(4,"span",2),o(5),a()(),i(6,"mat-accordion",3),d(7,qa,2,0)(8,Xa,2,0)(9,Ka,3,0,"div",4),a(),d(10,eo,5,1,"div",5),a()),t&2&&(s(5),h("",r.definitions().length," types"),s(2),p(r.viewState.groupBy==="category"?7:r.viewState.groupBy==="manufacturer"?8:9),s(3),p(r.filteredFlatList().length===0?10:-1))},dependencies:[pt,dt,st,lt,mt,ct,N,A,j,$,G,W,q,ot,rt,he,at],styles:[".accordion-container[_ngcontent-%COMP%]{padding:0 16px 16px}.accordion-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.accordion-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:500}.total-badge[_ngcontent-%COMP%]{background:var(--sys-tertiary-container);color:var(--sys-on-tertiary-container);padding:4px 12px;border-radius:12px;font-size:.8rem;font-weight:500}.filter-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.category-panel[_ngcontent-%COMP%]{margin-bottom:8px}.category-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:20px;width:20px;height:20px}.manufacturer-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px;width:18px;height:18px;color:var(--sys-on-surface-variant)}.count-badge[_ngcontent-%COMP%]{background:var(--sys-primary-container);color:var(--sys-on-primary-container);padding:2px 8px;border-radius:12px;font-size:.75rem}.count-badge.small[_ngcontent-%COMP%]{padding:1px 6px;font-size:.7rem}.nested-accordion[_ngcontent-%COMP%]{padding:8px 0}.manufacturer-panel[_ngcontent-%COMP%]{margin-bottom:4px;padding-top:4px;background:var(--mat-sys-surface-container)}.machine-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.machine-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--sys-surface-container);border-radius:8px;cursor:pointer;transition:background .2s ease}.machine-item[_ngcontent-%COMP%]:hover{background:var(--sys-surface-container-high)}.machine-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.machine-name[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem}.machine-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:4px}.capability-chip[_ngcontent-%COMP%]{--mdc-chip-container-height: 20px;font-size:.65rem;font-weight:500}.capability-chip.module[_ngcontent-%COMP%]{--mdc-chip-elevated-container-color: var(--sys-tertiary-container);--mdc-chip-label-text-color: var(--sys-on-tertiary-container)}.machine-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.backends-count[_ngcontent-%COMP%]{font-size:.7rem;color:var(--sys-on-surface-variant);background:var(--sys-surface-container-highest);padding:2px 6px;border-radius:4px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;color:var(--sys-on-surface-variant)}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}"],changeDetection:0})};function to(n,e){n&1&&(i(0,"div",1)(1,"mat-icon"),o(2,"info"),a(),i(3,"span"),o(4," Registry is read-only in browser mode. Definitions are loaded from bundled PyLabRobot data. "),a()())}function no(n,e){n&1&&(i(0,"div",24)(1,"mat-icon",25),o(2,"precision_manufacturing"),a(),i(3,"span"),o(4,"Machine Types"),a()())}function io(n,e){n&1&&(i(0,"div",24)(1,"mat-icon",25),o(2,"science"),a(),i(3,"span"),o(4,"Resource Types"),a()())}function ao(n,e){n&1&&(i(0,"th",26),o(1," Name "),a())}function oo(n,e){if(n&1&&(i(0,"td",27),o(1),a()),n&2){let t=e.$implicit;s(),h(" ",t.name," ")}}function ro(n,e){n&1&&(i(0,"th",26),o(1," Type "),a())}function so(n,e){if(n&1&&(i(0,"td",27),o(1),a()),n&2){let t=e.$implicit;s(),h(" ",t.resource_type||"N/A"," ")}}function lo(n,e){n&1&&(i(0,"th",26),o(1," Manufacturer "),a())}function co(n,e){if(n&1&&(i(0,"td",27),o(1),a()),n&2){let t=e.$implicit;s(),h(" ",t.manufacturer||"N/A"," ")}}function mo(n,e){n&1&&(i(0,"th",26),o(1," Model "),a())}function po(n,e){if(n&1&&(i(0,"td",27),o(1),a()),n&2){let t=e.$implicit;s(),h(" ",t.model||"N/A"," ")}}function uo(n,e){n&1&&(i(0,"th",28),o(1," Consumable "),a())}function fo(n,e){if(n&1&&(i(0,"td",29)(1,"mat-icon",30),o(2),a()()),n&2){let t=e.$implicit,r=m();s(),u("color",t.is_consumable?"primary":"warn")("matTooltip",t.is_consumable?r.getPropertyTooltip("consumable"):"Non-consumable: can be reused across protocols"),s(),h(" ",t.is_consumable?"check_circle":"cancel"," ")}}function go(n,e){n&1&&(i(0,"th",28),o(1," Actions "),a())}function ho(n,e){n&1&&(i(0,"td",29)(1,"button",31)(2,"mat-icon"),o(3,"info"),a()()())}function _o(n,e){n&1&&v(0,"tr",32)}function xo(n,e){n&1&&v(0,"tr",33)}function Co(n,e){if(n&1&&(i(0,"tr",34)(1,"td",35)(2,"div",36)(3,"mat-icon"),o(4,"search_off"),a(),i(5,"span"),o(6),a()()()()),n&2){let t=m();s(6),h('No resource definitions matching the filter "',t.resourceViewState().search,'"')}}var kt=class n{assetService=T(H);modeService=T(Xe);resourceDefinitions=R([]);machineViewState=R({viewType:"accordion",groupBy:"category",filters:{},sortBy:"name",sortOrder:"asc",search:""});resourceViewState=R({viewType:"table",groupBy:null,filters:{},sortBy:"name",sortOrder:"asc",search:""});machineViewConfig=C(()=>({viewTypes:["accordion"],groupByOptions:[{label:"Category",value:"category"},{label:"Manufacturer",value:"manufacturer"}],sortOptions:[{label:"Name",value:"name"},{label:"Manufacturer",value:"manufacturer"}],storageKey:"machine-definitions",defaults:{viewType:"accordion",sortBy:"name",sortOrder:"asc"}}));resourceViewConfig=C(()=>({viewTypes:["table"],filters:[{key:"manufacturer",label:"Manufacturer",type:"multiselect",options:this.manufacturers().map(e=>({label:e,value:e}))},{key:"plr_category",label:"Category",type:"multiselect",options:this.categories().map(e=>({label:e,value:e}))},{key:"consumable",label:"Consumable Only",type:"toggle",defaultValue:!1}],sortOptions:[{label:"Name",value:"name"},{label:"Type",value:"resource_type"},{label:"Manufacturer",value:"manufacturer"}],storageKey:"resource-definitions",defaults:{viewType:"table",sortBy:"name",sortOrder:"asc"}}));manufacturers=C(()=>{let e=new Set;return this.resourceDefinitions().forEach(t=>{t.manufacturer&&e.add(t.manufacturer)}),Array.from(e).sort()});categories=C(()=>{let e=new Set;return this.resourceDefinitions().forEach(t=>{t.plr_category&&e.add(t.plr_category)}),Array.from(e).sort()});filteredResourceDefinitions=C(()=>{let e=this.resourceViewState(),t=this.resourceDefinitions();if(e.search){let c=e.search.toLowerCase();t=t.filter(_=>_.name.toLowerCase().includes(c)||_.resource_type?.toLowerCase().includes(c)||_.manufacturer?.toLowerCase().includes(c)||_.model?.toLowerCase().includes(c))}let r=e.filters.manufacturer||[];r.length>0&&(t=t.filter(c=>c.manufacturer&&r.includes(c.manufacturer)));let l=e.filters.plr_category||[];return l.length>0&&(t=t.filter(c=>c.plr_category&&l.includes(c.plr_category))),e.filters.consumable?.includes(!0)&&(t=t.filter(c=>c.is_consumable)),t=[...t].sort((c,_)=>{let x=c[e.sortBy]||"",f=_[e.sortBy]||"",D=x.toString().localeCompare(f.toString());return e.sortOrder==="asc"?D:-D}),t});onMachineViewStateChange(e){this.machineViewState.set(e)}onResourceViewStateChange(e){this.resourceViewState.set(e)}displayedResourceColumns=["name","type","manufacturer","model","consumable","actions"];constructor(){this.loadResourceDefinitions()}loadResourceDefinitions(){this.assetService.getResourceDefinitions().subscribe(e=>{this.resourceDefinitions.set(e)},e=>{console.error("Error fetching resource definitions:",e)})}getPropertyTooltip(e){return Mt(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-definitions-list"]],decls:36,vars:9,consts:[[1,"definitions-list-container"],[1,"browser-mode-banner"],["animationDuration","0ms"],["mat-tab-label",""],[1,"tab-content"],[1,"bg-[var(--mat-sys-surface)]","border-b","border-[var(--theme-border)]","px-4","py-2","mb-4","rounded-xl","shadow-sm","mx-4","mt-4"],[3,"stateChange","config","state"],[3,"viewState"],[1,"resource-tab-content"],[1,"bg-[var(--mat-sys-surface)]","border-b","border-[var(--theme-border)]","px-4","py-2","mb-4","rounded-xl","shadow-sm","mt-4"],["mat-table","",1,"mat-elevation-z2","mt-4",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","manufacturer"],["matColumnDef","model"],["matColumnDef","consumable"],["mat-header-cell","","class","!text-center",4,"matHeaderCellDef"],["mat-cell","","class","!text-center",4,"matCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"flex","items-center","gap-2"],[1,"!w-5","!h-5","!text-[18px]"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"!text-center"],["mat-cell","",1,"!text-center"],[3,"color","matTooltip"],["mat-icon-button","","color","primary","matTooltip","View Details"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","6",1,"mat-cell"],[1,"empty-state"]],template:function(t,r){t&1&&(i(0,"div",0),d(1,to,5,0,"div",1),i(2,"mat-tab-group",2)(3,"mat-tab"),y(4,no,5,0,"ng-template",3),i(5,"div",4)(6,"div",5)(7,"app-view-controls",6),b("stateChange",function(c){return r.onMachineViewStateChange(c)}),a()(),v(8,"app-machine-definition-accordion",7),a()(),i(9,"mat-tab"),y(10,io,5,0,"ng-template",3),i(11,"div",8)(12,"div",9)(13,"app-view-controls",6),b("stateChange",function(c){return r.onResourceViewStateChange(c)}),a()(),i(14,"table",10),F(15,11),y(16,ao,2,0,"th",12)(17,oo,2,1,"td",13),B(),F(18,14),y(19,ro,2,0,"th",12)(20,so,2,1,"td",13),B(),F(21,15),y(22,lo,2,0,"th",12)(23,co,2,1,"td",13),B(),F(24,16),y(25,mo,2,0,"th",12)(26,po,2,1,"td",13),B(),F(27,17),y(28,uo,2,0,"th",18)(29,fo,3,3,"td",19),B(),F(30,20),y(31,go,2,0,"th",18)(32,ho,4,0,"td",19),B(),y(33,_o,1,0,"tr",21)(34,xo,1,0,"tr",22)(35,Co,7,1,"tr",23),a()()()()()),t&2&&(s(),p(r.modeService.isBrowserMode()?1:-1),s(6),u("config",r.machineViewConfig())("state",r.machineViewState()),s(),u("viewState",r.machineViewState()),s(5),u("config",r.resourceViewConfig())("state",r.resourceViewState()),s(),u("dataSource",r.filteredResourceDefinitions()),s(19),u("matHeaderRowDef",r.displayedResourceColumns),s(),u("matRowDefColumns",r.displayedResourceColumns))},dependencies:[Oe,Me,Se,ke,De,we,Re,Te,Ee,Ie,Pe,xt,N,A,j,fe,$,G,ye,_t,ve,be,Et,ae],styles:[".definitions-list-container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.browser-mode-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;background:var(--mat-sys-secondary-container);color:var(--mat-sys-on-secondary-container);padding:12px 16px;margin:16px 16px 0;border-radius:8px}.filter-field[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.mat-elevation-z2[_ngcontent-%COMP%]{width:100%}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 0;color:var(--mat-sys-on-surface-variant);gap:12px}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}mat-tab-group[_ngcontent-%COMP%]{margin-top:0}.resource-tab-content[_ngcontent-%COMP%]{padding:0 16px 16px}"],changeDetection:0})};var Ut=()=>({width:"40px",height:"24px","margin-bottom":"0"}),vo=(n,e)=>e.id;function bo(n,e){n&1&&v(0,"ngx-skeleton-loader",7),n&2&&u("theme",We(1,Ut))}function yo(n,e){if(n&1&&(o(0),i(1,"span",37),o(2),a()),n&2){let t=m();h(" ",t.physicalOnlineMachinesCount()),s(2),h("/",t.physicalMachinesCount())}}function Mo(n,e){if(n&1&&o(0),n&2){let t=m();qe(" ",t.simulatedOnlineMachinesCount(),"/",t.simulatedMachinesCount()," ")}}function wo(n,e){if(n&1&&(i(0,"div",12),v(1,"span",38),i(2,"span",39),o(3),a()()),n&2){let t=m();s(3),h("",t.machinesAttentionCount()," Issues")}}function So(n,e){n&1&&v(0,"ngx-skeleton-loader",7),n&2&&u("theme",We(1,Ut))}function Do(n,e){if(n&1&&o(0),n&2){let t=m();h(" ",t.totalResourcesCount()," ")}}function To(n,e){if(n&1&&(i(0,"div",15)(1,"mat-icon",40),o(2,"warning"),a(),i(3,"span",41),o(4),a()()),n&2){let t=m();s(4),h("",t.lowStockCount()," Low Stock")}}function Eo(n,e){n&1&&v(0,"ngx-skeleton-loader",7),n&2&&u("theme",We(1,Ut))}function ko(n,e){if(n&1&&o(0),n&2){let t=m();h(" ",t.totalDefinitionsCount()," ")}}function Ro(n,e){if(n&1&&(i(0,"span",33),o(1),a()),n&2){let t=m();s(),h("",t.allAlerts().length," Items")}}function Io(n,e){if(n&1){let t=z();i(0,"div",43),b("click",function(){let l=E(t).$implicit,c=m(2);return k(c.navigateTo(l.type==="machine"?"machine":"resource"))}),i(1,"div",44)(2,"mat-icon",45),o(3),a()(),i(4,"div",46)(5,"div",47)(6,"span",48),o(7),a(),i(8,"span",49),o(9),a()(),i(10,"p",50),o(11),a()(),i(12,"mat-icon",51),o(13,"chevron_right"),a()()}if(n&2){let t=e.$implicit;s(),K("bg-red-400-20",t.severity==="error")("bg-amber-400-20",t.severity==="warning"),s(),K("text-red-400",t.severity==="error")("text-amber-400",t.severity==="warning"),s(),h(" ",t.icon," "),s(4),g(t.name),s(2),g(t.type),s(2),g(t.message)}}function Po(n,e){if(n&1&&(i(0,"div",35),O(1,Io,14,12,"div",42,vo),a()),n&2){let t=m();s(),L(t.allAlerts())}}function Oo(n,e){n&1&&(i(0,"div",36)(1,"mat-icon",52),o(2,"check_circle"),a(),i(3,"p",53),o(4,"All systems operational"),a()())}var Rt=class n{assetService=T(H);router=T(Qe);subscription=new Ht;machines=R([]);resources=R([]);totalDefinitionsCount=R(0);isLoading=R(!0);totalMachinesCount=C(()=>this.machines().length);physicalMachines=C(()=>this.machines().filter(e=>!e.is_simulation_override));simulatedMachines=C(()=>this.machines().filter(e=>e.is_simulation_override));physicalMachinesCount=C(()=>this.physicalMachines().length);simulatedMachinesCount=C(()=>this.simulatedMachines().length);physicalOnlineMachinesCount=C(()=>this.physicalMachines().filter(e=>e.status!=="offline"&&e.status!=="error").length);simulatedOnlineMachinesCount=C(()=>this.simulatedMachines().filter(e=>e.status!=="offline"&&e.status!=="error").length);machinesAttentionCount=C(()=>this.machines().filter(e=>e.status==="error"||e.status==="offline").length);totalResourcesCount=C(()=>this.resources().length);lowStockCount=C(()=>this.resources().filter(e=>e.status==="depleted"||e.status==="expired").length);allAlerts=C(()=>{let e=[];return this.machines().forEach(t=>{t.status==="error"?e.push({id:t.accession_id,type:"machine",name:t.name,message:"Machine reported an error state",severity:"error",icon:"error"}):t.status==="offline"&&e.push({id:t.accession_id,type:"machine",name:t.name,message:"Machine is offline",severity:"error",icon:"cloud_off"})}),this.resources().forEach(t=>{t.status==="depleted"?e.push({id:t.accession_id,type:"resource",name:"Resource Depleted",message:"Resource has been depleted",severity:"warning",icon:"remove_circle"}):t.status==="expired"&&e.push({id:t.accession_id,type:"resource",name:"Resource Expired",message:"Resource expiration date passed",severity:"warning",icon:"event_busy"})}),e});ngOnInit(){this.refreshData()}ngOnDestroy(){this.subscription.unsubscribe()}refreshData(){this.isLoading.set(!0),this.subscription.add(Ue({machines:this.assetService.getMachines(),resources:this.assetService.getResources(),definitions:this.assetService.getResourceDefinitions()}).subscribe({next:e=>{this.machines.set(e.machines),this.resources.set(e.resources),this.totalDefinitionsCount.set(e.definitions.length),this.isLoading.set(!1)},error:e=>{console.error("Failed to load dashboard data",e),this.isLoading.set(!1)}}))}navigateTo(e){this.router.navigate([],{queryParams:{type:e},queryParamsHandling:"merge"})}triggerAction(e){let t=new CustomEvent("asset-dashboard-action",{detail:e});window.dispatchEvent(t)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-asset-dashboard"]],decls:81,vars:8,consts:[[1,"h-full","flex","flex-col","gap-6","overflow-y-auto"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"group","relative","bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","rounded-2xl","p-6","flex","items-center","gap-4","hover:bg-surface-elevated","transition-all","cursor-pointer",3,"click"],[1,"w-12","h-12","rounded-xl","flex","items-center","justify-center","bg-gradient-to-br","from-blue-500/20","to-cyan-500/20"],[1,"text-blue-400"],[1,"flex","flex-col"],[1,"text-2xl","font-bold","text-sys-text-primary"],["count","1","appearance","line",3,"theme"],[1,"text-xs","font-semibold","text-sys-text-secondary","uppercase","tracking-wider","leading-tight"],[1,"ml-auto","flex","flex-col","items-end","opacity-60"],[1,"text-sm","font-bold","text-sys-text-secondary"],[1,"text-[10px]","uppercase","font-bold","tracking-tight"],[1,"absolute","-top-2","-right-2","flex","items-center","gap-1.5","px-2","py-1","rounded-full","bg-red-400/10","border","border-red-400/20","backdrop-blur-md","shadow-lg"],[1,"w-12","h-12","rounded-xl","flex","items-center","justify-center","bg-gradient-to-br","from-orange-500/20","to-amber-500/20"],[1,"text-orange-400"],[1,"absolute","top-4","right-4","flex","items-center","gap-1.5","px-2","py-1","rounded-full","bg-amber-400/10","border","border-amber-400/20"],[1,"w-12","h-12","rounded-xl","flex","items-center","justify-center","bg-gradient-to-br","from-purple-500/20","to-pink-500/20"],[1,"text-purple-400"],[1,"absolute","top-4","right-4","text-xs","font-semibold","text-sys-text-secondary","bg-[var(--mat-sys-surface-variant)]","px-2","py-1","rounded","border","border-[var(--theme-border)]"],[1,"flex","items-center","gap-4","px-1"],[1,"text-lg","font-semibold","text-sys-text-secondary"],[1,"flex-1","h-px","bg-[var(--theme-border)]"],[1,"text-xs","font-medium","text-sys-text-secondary"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","rounded-2xl","overflow-hidden","flex","flex-col"],[1,"p-4","border-b","border-[var(--theme-border)]","flex","items-center","justify-between"],[1,"text-lg","font-semibold","text-sys-text-primary","flex","items-center","gap-2"],[1,"text-green-400"],[1,"p-4","grid","grid-cols-2","gap-3"],["mat-stroked-button","",1,"!border-[var(--theme-border)]","!text-sys-text-secondary","!justify-start","!px-4","!py-4","hover:!bg-[var(--mat-sys-surface-variant)]","hover:!border-primary/50","hover:!text-primary","transition-all","group","flex","items-center",3,"click"],[1,"mr-2","group-hover:text-primary","transition-colors"],[1,"bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","rounded-2xl","overflow-hidden","flex","flex-col","h-full"],[1,"text-amber-400"],[1,"text-xs","font-bold","text-amber-400","bg-amber-400/10","px-2","py-1","rounded-full"],[1,"flex-1","overflow-y-auto","max-h-[300px]","p-2"],[1,"flex","flex-col","gap-2"],[1,"h-full","flex","flex-col","items-center","justify-center","text-sys-text-secondary","p-8"],[1,"text-lg","font-normal","text-sys-text-secondary"],[1,"w-1.5","h-1.5","rounded-full","bg-red-400","animate-pulse"],[1,"text-xs","font-bold","text-red-400"],[1,"text-amber-400","!w-3","!h-3","!text-[12px]"],[1,"text-xs","font-bold","text-amber-400"],[1,"flex","items-center","gap-3","p-3","rounded-xl","bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","hover:bg-surface-elevated","transition-colors","cursor-pointer","group"],[1,"flex","items-center","gap-3","p-3","rounded-xl","bg-[var(--mat-sys-surface-variant)]","border","border-[var(--theme-border)]","hover:bg-surface-elevated","transition-colors","cursor-pointer","group",3,"click"],[1,"w-10","h-10","rounded-lg","flex","items-center","justify-center","shrink-0","mr-1"],[1,"!w-6","!h-6","!text-[24px]"],[1,"flex-1","min-w-0"],[1,"flex","items-center","justify-between","mb-1"],[1,"font-medium","text-sys-text-primary","truncate","max-w-[70%]","group-hover:text-primary","transition-colors"],[1,"text-xs","uppercase","font-bold","tracking-wider","opacity-60","ml-2"],[1,"text-xs","text-sys-text-secondary","truncate"],[1,"text-sys-text-secondary","group-hover:text-sys-text-primary"],[1,"!w-12","!h-12","!text-[48px]","mb-4","text-green-500/30"],[1,"text-lg","font-semibold"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"section",1)(2,"div",2),b("click",function(){return r.navigateTo("machine")}),i(3,"div",3)(4,"mat-icon",4),o(5,"precision_manufacturing"),a()(),i(6,"div",5)(7,"span",6),d(8,bo,1,2,"ngx-skeleton-loader",7)(9,yo,3,2),a(),i(10,"span",8),o(11,"Physical Machines Online"),a()(),i(12,"div",9)(13,"span",10),d(14,Mo,1,2),a(),i(15,"span",11),o(16,"Simulated"),a()(),d(17,wo,4,1,"div",12),a(),i(18,"div",2),b("click",function(){return r.navigateTo("resource")}),i(19,"div",13)(20,"mat-icon",14),o(21,"inventory_2"),a()(),i(22,"div",5)(23,"span",6),d(24,So,1,2,"ngx-skeleton-loader",7)(25,Do,1,1),a(),i(26,"span",8),o(27,"Total Items"),a()(),d(28,To,5,1,"div",15),a(),i(29,"div",2),b("click",function(){return r.navigateTo("registry")}),i(30,"div",16)(31,"mat-icon",17),o(32,"inventory_2"),a()(),i(33,"div",5)(34,"span",6),d(35,Eo,1,2,"ngx-skeleton-loader",7)(36,ko,1,1),a(),i(37,"span",8),o(38,"Registry Types"),a()(),i(39,"div",18),o(40," Hardware Definitions "),a()()(),i(41,"div",19)(42,"span",20),o(43,"Inventory"),a(),v(44,"div",21),i(45,"span",22),o(46,"What you have"),a()(),i(47,"div",23)(48,"section",24)(49,"div",25)(50,"h3",26)(51,"mat-icon",27),o(52,"bolt"),a(),o(53," Quick Actions "),a()(),i(54,"div",28)(55,"button",29),b("click",function(){return r.triggerAction("add-machine")}),i(56,"mat-icon",30),o(57,"add_circle"),a(),o(58," Add Machine "),a(),i(59,"button",29),b("click",function(){return r.triggerAction("add-resource")}),i(60,"mat-icon",30),o(61,"add_box"),a(),o(62," Add Resource "),a(),i(63,"button",29),b("click",function(){return r.triggerAction("discover")}),i(64,"mat-icon",30),o(65,"usb"),a(),o(66," Discover Hardware "),a(),i(67,"button",29),b("click",function(){return r.navigateTo("registry")}),i(68,"mat-icon",30),o(69,"search"),a(),o(70," Browse Registry "),a()()(),i(71,"section",31)(72,"div",25)(73,"h3",26)(74,"mat-icon",32),o(75,"notifications_active"),a(),o(76," Needs Attention "),a(),d(77,Ro,2,1,"span",33),a(),i(78,"div",34),d(79,Po,3,0,"div",35)(80,Oo,5,0,"div",36),a()()()()),t&2&&(s(8),p(r.isLoading()?8:9),s(6),p(r.isLoading()?-1:14),s(3),p(r.machinesAttentionCount()>0?17:-1),s(7),p(r.isLoading()?24:25),s(4),p(r.lowStockCount()>0?28:-1),s(7),p(r.isLoading()?35:36),s(42),p(r.allAlerts().length>0?77:-1),s(2),p(r.allAlerts().length>0?79:80))},dependencies:[N,A,j,te,ht,$,Cn,xn],styles:["[_nghost-%COMP%]{display:block;height:100%}.bg-red-400-20[_ngcontent-%COMP%]{background-color:#f8717133}.bg-amber-400-20[_ngcontent-%COMP%]{background-color:#fbbf2433}"],changeDetection:0})};var Lo=(n,e)=>e.accession_id;function Ao(n,e){n&1&&(i(0,"div",4),v(1,"mat-spinner",8),a())}function No(n,e){if(n&1&&(i(0,"div",6)(1,"div",9),o(2),a(),i(3,"div",10)(4,"div",11)(5,"mat-icon"),o(6),a()(),i(7,"div",12)(8,"h3",13),o(9),a(),i(10,"p",14),o(11),a()()(),i(12,"div",15)(13,"div",16)(14,"span",17),o(15,"Status"),a(),v(16,"app-asset-status-chip",18),a(),i(17,"div",16)(18,"span",17),o(19,"Location"),a(),i(20,"div",19)(21,"mat-icon",20),o(22,"location_on"),a(),i(23,"span",21),o(24),a()()()(),i(25,"div",22)(26,"span",23),o(27),a()()()),n&2){let t=e.$implicit,r=m();s(2),h(" ",r.isMachine(t)?"Machine":"Resource"," "),s(2),u("ngClass",r.getIconBgClass(t)),s(),ee(r.getIconTextClass(t)),s(),g(r.getIcon(t)),s(2),u("matTooltip",t.name),s(),g(t.name),s(2),g(r.getAssetSubtitle(t)),s(5),u("status",t.status),s(7),u("matTooltip",r.getLocationLabel(t)),s(),g(r.getLocationLabel(t)),s(3),g(r.getShortId(t.accession_id))}}function Vo(n,e){n&1&&(i(0,"div",7)(1,"div",24)(2,"mat-icon",25),o(3,"filter_list_off"),a()(),i(4,"h3",26),o(5,"No assets found"),a(),i(6,"p"),o(7,"Try adjusting your filters or search terms"),a()())}var It=class n{assetService=T(H);machines=R([]);resources=R([]);workcells=R([]);isLoading=R(!0);viewConfig=C(()=>({viewTypes:["card","list"],groupByOptions:[{label:"None",value:null},{label:"Status",value:"status"},{label:"Category",value:"category"},{label:"Location",value:"location"}],filters:[{key:"status",label:"Status",type:"multiselect",options:[{label:"Available",value:"available",icon:"check_circle"},{label:"In Use",value:"in_use",icon:"play_circle"},{label:"Error",value:"error",icon:"error"},{label:"Maintenance",value:"maintenance",icon:"build"}]},{key:"category",label:"Category",type:"chips",options:this.categories().map(e=>({label:e,value:e}))},{key:"machine_id",label:"Location",type:"select",options:[{label:"Any location",value:null},...this.machines().map(e=>({label:e.name,value:e.accession_id}))]},{key:"workcell_id",label:"Workcell",type:"select",options:[{label:"Any workcell",value:null},...this.workcells().map(e=>({label:e.name,value:e.accession_id}))]},{key:"maintenance_due",label:"Maintenance",type:"select",options:[{label:"All",value:!1},{label:"Due Only",value:!0}]}],sortOptions:[{label:"Name",value:"name"},{label:"Date Added",value:"created_at"},{label:"Status",value:"status"},{label:"Category",value:"category"}],storageKey:"spatial-view",defaults:{sortBy:"created_at",sortOrder:"desc"}}));viewState=R({viewType:"card",groupBy:null,filters:{status:[],category:[],machine_id:[],workcell_id:[],maintenance_due:[]},sortBy:"created_at",sortOrder:"desc",search:""});categories=C(()=>{let e=new Set;return this.machines().forEach(t=>{t.machine_category&&e.add(t.machine_category)}),Array.from(e).sort()});allAssets=C(()=>[...this.machines(),...this.resources()]);filteredAssets=C(()=>{let e=this.allAssets(),t=this.viewState();if(t.search){let f=t.search.toLowerCase();e=e.filter(D=>D.name.toLowerCase().includes(f)||(D.fqn||"").toLowerCase().includes(f)||(D.location_label||"").toLowerCase().includes(f))}let r=t.filters.status||[];r.length>0&&(e=e.filter(f=>r.includes(f.status)));let l=t.filters.category||[];l.length>0&&(e=e.filter(f=>this.isMachine(f)?f.machine_category&&l.includes(f.machine_category):!1));let c=t.filters.machine_id?.[0];c&&(e=e.filter(f=>f.accession_id===c?!0:this.isMachine(f)?!1:f.machine_location_accession_id===c));let _=t.filters.workcell_id?.[0];_&&(e=e.filter(f=>f.workcell_accession_id===_));let x=t.filters.maintenance_due?.[0];return e.sort((f,D)=>{let w="",M="",S=(V,I)=>I==="name"?V.name?.toLowerCase()||"":I==="created_at"?new Date(V.created_at||0).getTime():I==="status"?V.status:I==="category"?(this.isMachine(V)&&V.machine_category||"").toLowerCase():"";return w=S(f,t.sortBy),M=S(D,t.sortBy),w<M?t.sortOrder==="asc"?-1:1:w>M?t.sortOrder==="asc"?1:-1:0}),e});ngOnInit(){this.refreshData()}refreshData(){this.isLoading.set(!0),Ue({machines:this.assetService.getMachines(),resources:this.assetService.getResources()}).subscribe({next:e=>{this.machines.set(e.machines),this.resources.set(e.resources),this.isLoading.set(!1)},error:e=>{console.error("Failed to load assets",e),this.isLoading.set(!1)}})}onViewStateChange(e){this.viewState.set(e)}clearFilters(){this.viewState.update(e=>Ve(Ne({},e),{search:"",groupBy:null,filters:{status:[],category:[],machine_id:[],workcell_id:[],maintenance_due:[]}}))}isMachine(e){return"machine_category"in e}getIcon(e){return this.isMachine(e)?e.machine_category?.toLowerCase().includes("liquid")?"water_drop":"precision_manufacturing":"science"}getIconBgClass(e){return this.isMachine(e)?"bg-blue-500/10":"bg-orange-500/10"}getIconTextClass(e){return this.isMachine(e)?"text-blue-500":"text-orange-500"}getAssetSubtitle(e){return this.isMachine(e)?e.model||e.manufacturer||"Unknown Model":e.resource_definition_accession_id?"Resource":"Custom Resource"}getLocationLabel(e){return e.location_label||"Unassigned"}getShortId(e){return e.substring(0,8)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-spatial-view"]],decls:9,vars:4,consts:[[1,"h-full","flex","flex-col","bg-[var(--mat-sys-surface-variant)]"],[1,"bg-[var(--mat-sys-surface)]","border-b","border-[var(--theme-border)]","px-6","py-2"],[3,"stateChange","config","state"],[1,"flex-1","overflow-y-auto","p-6","relative"],[1,"absolute","inset-0","flex","items-center","justify-center","bg-white/50","dark:bg-black/50","z-20","backdrop-blur-sm"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-6"],[1,"asset-card","group","relative","bg-[var(--mat-sys-surface)]","border","border-[var(--theme-border)]","rounded-2xl","p-5","hover:shadow-lg","hover:-translate-y-1","transition-all","duration-200","cursor-pointer"],[1,"flex","flex-col","items-center","justify-center","h-[60vh]","text-sys-text-tertiary"],["diameter","40"],[1,"absolute","top-4","right-4","text-[10px]","uppercase","font-bold","tracking-wider","px-2","py-1","rounded","bg-[var(--mat-sys-surface-variant)]","text-sys-text-tertiary"],[1,"flex","items-start","gap-4","mb-4"],[1,"w-12","h-12","rounded-xl","flex","items-center","justify-center","shrink-0",3,"ngClass"],[1,"min-w-0","flex-1"],[1,"font-bold","text-lg","text-sys-text-primary","truncate","mb-1",3,"matTooltip"],[1,"text-xs","text-sys-text-secondary","truncate"],[1,"grid","grid-cols-2","gap-y-3","gap-x-2","text-sm","mb-4"],[1,"flex","flex-col"],[1,"text-[10px]","uppercase","text-sys-text-tertiary","font-bold","tracking-wider","mb-0.5"],[1,"w-fit",3,"status"],[1,"flex","items-center","gap-1.5","text-sys-text-secondary","truncate"],[1,"!w-3","!h-3","!text-[12px]","opacity-70"],[1,"truncate",3,"matTooltip"],[1,"pt-3","border-t","border-[var(--theme-border)]","flex","items-center","justify-between","opacity-60","group-hover:opacity-100","transition-opacity"],[1,"text-xs","text-sys-text-tertiary","font-mono"],[1,"w-20","h-20","rounded-full","bg-[var(--mat-sys-surface-variant)]","flex","items-center","justify-center","mb-4"],[1,"!w-10","!h-10","!text-[40px]","opacity-50"],[1,"text-lg","font-medium","text-sys-text-secondary","mb-1"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"div",1)(2,"app-view-controls",2),b("stateChange",function(c){return r.onViewStateChange(c)}),a()(),i(3,"div",3),d(4,Ao,2,0,"div",4),i(5,"div",5),O(6,No,28,12,"div",6,Lo),a(),d(8,Vo,8,0,"div",7),a()()),t&2&&(s(2),u("config",r.viewConfig())("state",r.viewState()),s(2),p(r.isLoading()?4:-1),s(2),L(r.filteredAssets()),s(2),p(!r.isLoading()&&r.filteredAssets().length===0?8:-1))},dependencies:[ue,Zt,N,A,j,ht,xe,_e,$,G,Y,ae],styles:['[_nghost-%COMP%]{display:block;height:100%}.asset-card[_ngcontent-%COMP%]{min-height:200px;display:flex;flex-direction:column;background:linear-gradient(135deg,var(--mat-sys-surface) 0%,var(--mat-sys-surface-container-low) 100%);position:relative;overflow:hidden}.asset-card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-20%;right:-10%;width:100px;height:100px;background:radial-gradient(circle at center,var(--mat-sys-primary) 0%,transparent 70%);opacity:.03;pointer-events:none}.asset-card[_ngcontent-%COMP%]:hover{border-color:var(--mat-sys-primary);box-shadow:0 8px 24px -12px var(--mat-sys-primary)}'],changeDetection:0})};var Fo=["machineList"],Bo=["resourceAccordion"];function zo(n,e){n&1&&(i(0,"div",20)(1,"mat-icon",21),o(2,"dashboard"),a(),i(3,"span",22),o(4,"Overview"),a()())}function $o(n,e){n&1&&(i(0,"div",20)(1,"mat-icon",21),o(2,"map"),a(),i(3,"span",22),o(4,"Spatial View"),a()())}function Go(n,e){n&1&&(i(0,"div",20)(1,"mat-icon",21),o(2,"precision_manufacturing"),a(),i(3,"span",22),o(4,"Machines"),a()())}function jo(n,e){n&1&&(i(0,"div",17),v(1,"mat-spinner",23),a())}function Uo(n,e){n&1&&(i(0,"div",20)(1,"mat-icon",21),o(2,"science"),a(),i(3,"span",22),o(4,"Resources"),a()())}function Ho(n,e){n&1&&(i(0,"div",17),v(1,"mat-spinner",23),a())}function qo(n,e){n&1&&(i(0,"div",20)(1,"mat-icon",21),o(2,"inventory_2"),a(),i(3,"span",22),o(4,"Registry"),a()())}function Wo(n,e){n&1&&(i(0,"div",17),v(1,"mat-spinner",23),a())}var Pt=class n{dialog=T(ge);assetService=T(H);route=T(nn);router=T(Qe);ngZone=T(Wt);modeService=T(Xe);snackBar=T(ut);machineList;resourceAccordion;selectedIndex=0;assetTypeLabel=R("Machine");isLoading=R(!1);isSyncing=R(!1);hardwareDiscoveryListener=()=>{this.ngZone.run(()=>this.openHardwareDiscovery())};ngOnInit(){window.addEventListener("open-hardware-discovery",this.hardwareDiscoveryListener),window.addEventListener("asset-dashboard-action",this.dashboardActionListener),this.route.queryParams.subscribe(e=>{let t=e.type;t==="machine"?(this.selectedIndex=2,this.assetTypeLabel.set("Machine")):t==="resource"?(this.selectedIndex=3,this.assetTypeLabel.set("Resource")):t==="registry"||t==="definition"?(this.selectedIndex=4,this.assetTypeLabel.set("Registry Item")):t==="spatial"?(this.selectedIndex=1,this.assetTypeLabel.set("Asset")):(this.selectedIndex=0,this.assetTypeLabel.set("Asset"))})}ngOnDestroy(){window.removeEventListener("open-hardware-discovery",this.hardwareDiscoveryListener),window.removeEventListener("asset-dashboard-action",this.dashboardActionListener)}onTabChange(e){this.selectedIndex=e;let t="overview";switch(e){case 0:this.assetTypeLabel.set("Asset"),t="overview";break;case 1:this.assetTypeLabel.set("Asset"),t="spatial";break;case 2:this.assetTypeLabel.set("Machine"),t="machine";break;case 3:this.assetTypeLabel.set("Resource"),t="resource";break;case 4:this.assetTypeLabel.set("Registry Item"),t="registry";break}this.router.navigate([],{relativeTo:this.route,queryParams:{type:t},queryParamsHandling:"merge",replaceUrl:!0})}dashboardActionListener=e=>{let t=e.detail;this.ngZone.run(()=>{t==="add-machine"&&this.openAddMachine(),t==="add-resource"&&this.openAddResource(),t==="discover"&&this.openHardwareDiscovery()})};openAddAsset(){if(!this.isLoading()){if(this.selectedIndex===2)this.openAddMachine();else if(this.selectedIndex===3)this.openAddResource();else if(this.selectedIndex===0||this.selectedIndex===1)this.openAddAssetChoice();else if(this.selectedIndex===4){if(this.modeService.isBrowserMode()){this.snackBar.open("Resource definitions are loaded from bundled data in Browser Mode. Connect to a backend to add custom definitions.","Close",{duration:5e3});return}this.triggerSyncDefinitions()}}}openAddAssetChoice(){this.openUnifiedDialog()}triggerSyncDefinitions(){this.isSyncing.set(!0),this.assetService.syncDefinitions().pipe(qt(()=>this.isSyncing.set(!1))).subscribe({next:e=>{this.snackBar.open(e.message||"Synchronization started successfully.","Close",{duration:3e3})},error:e=>{console.error("Error during synchronization",e),this.snackBar.open("Failed to initiate synchronization. See console for details.","Close",{duration:5e3})}})}openAddMachine(){this.openUnifiedDialog("machine")}openAddResource(){this.openUnifiedDialog("resource")}openUnifiedDialog(e=null){this.dialog.open(_n,{minWidth:"600px",maxWidth:"1000px",width:"80vw",height:"auto",minHeight:"400px",maxHeight:"90vh",data:e?{preselectedType:e.toUpperCase()}:{}}).afterClosed().subscribe(r=>{r&&(this.machineList?.loadMachines(),this.resourceAccordion?.loadData())})}openHardwareDiscovery(){this.dialog.open(rn,{width:"1000px",maxHeight:"90vh"}).afterClosed().subscribe(()=>{this.machineList?.loadMachines()})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-assets"]],viewQuery:function(t,r){if(t&1&&He(Fo,5)(Bo,5),t&2){let l;Fe(l=Be())&&(r.machineList=l.first),Fe(l=Be())&&(r.resourceAccordion=l.first)}},decls:41,vars:8,consts:[["machineList",""],["resourceAccordion",""],[1,"p-6","max-w-screen-2xl","mx-auto","h-full","flex","flex-col"],[1,"flex","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","gap-4","mb-4"],[1,"min-w-0","flex-1"],[1,"text-3xl","font-bold","text-sys-text-primary","mb-1","truncate"],[1,"text-sys-text-secondary","truncate"],[1,"flex","flex-wrap","items-center","gap-2","sm:gap-3","w-full","sm:w-auto"],[1,"sm:mr-2"],[1,"flex-1","sm:flex-initial",3,"matTooltip"],["mat-flat-button","","data-tour-id","add-asset-btn",1,"!bg-gradient-to-br","!from-primary","!to-primary-dark","!text-white","!rounded-full","!px-6","!py-3","!font-semibold","shadow-lg","shadow-primary/20","hover:shadow-primary/40","transition-all","hover:-translate-y-0.5","disabled:opacity-50","disabled:cursor-not-allowed","w-full","sm:w-auto",3,"click","disabled"],[1,"bg-surface","border","border-[var(--theme-border)]","rounded-3xl","overflow-hidden","backdrop-blur-xl","flex","flex-col","flex-1","min-h-0","shadow-xl","relative"],["animationDuration","300ms","mat-stretch-tabs","false","mat-align-tabs","start",1,"assets-tabs","flex-1","flex","flex-col","min-h-0","custom-tabs",3,"selectedIndexChange","selectedIndex"],["mat-tab-label",""],[1,"h-full","overflow-hidden","bg-[var(--mat-sys-surface-variant)]","relative","p-4"],[1,"h-full","overflow-hidden","bg-[var(--mat-sys-surface-variant)]","relative"],[1,"h-full","overflow-y-auto","bg-[var(--mat-sys-surface-variant)]","relative"],[1,"absolute","inset-0","bg-[var(--mat-sys-surface-variant)]","backdrop-blur-sm","z-10","flex","items-center","justify-center"],["data-tour-id","machine-list"],["data-tour-id","resource-list"],[1,"flex","items-center","gap-2","px-2","py-1"],[1,"!w-5","!h-5","!text-[20px]"],[1,"font-medium"],["diameter","40"]],template:function(t,r){if(t&1){let l=z();i(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1",5),o(4,"Asset Management"),a(),i(5,"p",6),o(6,"Manage your laboratory hardware and inventory"),a()(),i(7,"div",7),v(8,"app-hardware-discovery-button",8),i(9,"span",9)(10,"button",10),b("click",function(){return E(l),k(r.openAddAsset())}),i(11,"mat-icon"),o(12),a(),o(13),a()()()(),i(14,"div",11)(15,"mat-tab-group",12),me("selectedIndexChange",function(_){return E(l),ce(r.selectedIndex,_)||(r.selectedIndex=_),k(_)}),b("selectedIndexChange",function(_){return E(l),k(r.onTabChange(_))}),i(16,"mat-tab"),y(17,zo,5,0,"ng-template",13),i(18,"div",14),v(19,"app-asset-dashboard"),a()(),i(20,"mat-tab"),y(21,$o,5,0,"ng-template",13),i(22,"div",15),v(23,"app-spatial-view"),a()(),i(24,"mat-tab"),y(25,Go,5,0,"ng-template",13),i(26,"div",16),d(27,jo,2,0,"div",17),v(28,"app-machine-list",18,0),a()(),i(30,"mat-tab"),y(31,Uo,5,0,"ng-template",13),i(32,"div",16),d(33,Ho,2,0,"div",17),v(34,"app-resource-accordion",19,1),a()(),i(36,"mat-tab"),y(37,qo,5,0,"ng-template",13),i(38,"div",16),d(39,Wo,2,0,"div",17),v(40,"app-definitions-list"),a()()()()()}t&2&&(s(9),u("matTooltip",r.selectedIndex===4?r.modeService.isBrowserMode()?"Resource definitions are loaded from bundled data in Browser Mode.":"Sync all hardware and protocol definitions from the backend.":""),s(),u("disabled",r.isLoading()||r.isSyncing()),s(2),g(r.selectedIndex===4?"sync":"add"),s(),h(" ",r.selectedIndex===4?"Sync Definitions":"Add "+r.assetTypeLabel()," "),s(2),le("selectedIndex",r.selectedIndex),s(12),p(r.isLoading()?27:-1),s(6),p(r.isLoading()?33:-1),s(6),p(r.isSyncing()?39:-1))},dependencies:[ye,_t,ve,be,N,A,j,te,ne,xe,_e,$,G,ft,bt,Tt,kt,Rt,It,ln],styles:["[_nghost-%COMP%]{display:block;height:100%}  .custom-tabs .mat-mdc-tab-header{border-bottom:none!important;background:var(--mat-sys-surface-variant)}  .custom-tabs .mat-mdc-tab-label-container{padding:0 16px}  .custom-tabs .mdc-tab{color:var(--theme-text-secondary)!important;font-family:inherit!important;letter-spacing:normal!important;min-width:80px!important;padding:0 20px!important;height:56px!important;opacity:1!important}  .custom-tabs .mdc-tab__content{flex:0 1 auto!important}  .custom-tabs .mdc-tab--active{color:var(--theme-text-primary)!important}  .custom-tabs .mdc-tab--active .mdc-tab__text-label{color:var(--primary-color)!important}  .custom-tabs .mdc-tab--active .mat-icon{color:var(--primary-color)!important}  .custom-tabs .mat-mdc-tab-group-indicator{border-bottom-color:var(--primary-color)!important;height:3px!important;border-radius:3px 3px 0 0}  .custom-tabs .mat-mdc-tab-body-wrapper{flex:1;height:100%}"],changeDetection:0})};var Qc=[{path:"",component:Pt}];export{Qc as ASSET_ROUTES};
