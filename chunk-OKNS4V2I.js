import{a as Ft,b as Ht,c as Nt,d as Bt,e as At,f as Vt,g as jt,h as $t,i as Gt,j as Ut,l as Qt,m as qt}from"./chunk-MJO6NRX7.js";import{a as kt}from"./chunk-FHX7ZVQY.js";import"./chunk-QPZUELQO.js";import"./chunk-WNYFH7QK.js";import{e as Wt,i as Kt,k as Zt}from"./chunk-BRQ7VCIS.js";import{a as L}from"./chunk-J7WD5ZND.js";import{a as Jt,b as Xt}from"./chunk-DV7VBFQH.js";import"./chunk-VFPGQJKT.js";import{a as Ot}from"./chunk-GX2D2L2X.js";import"./chunk-O2OSWUJ6.js";import"./chunk-ULQGHXUB.js";import"./chunk-ERJX7L3L.js";import"./chunk-5XV7PTQI.js";import{a as W,b as O}from"./chunk-FFXGIJC7.js";import{f as Lt}from"./chunk-7F4BNMQ6.js";import{a as Tt,b as wt}from"./chunk-HJ4PUJUU.js";import"./chunk-GW7MQSL6.js";import"./chunk-F4M4TAIC.js";import{c as zt,m as Et}from"./chunk-FGBSBVHW.js";import"./chunk-5R36QA5Q.js";import{h as K}from"./chunk-SJZ6P2DA.js";import"./chunk-SKMC2KSJ.js";import{B as Rt,P as Q,S as E}from"./chunk-YMB734HE.js";import{d as U}from"./chunk-HUJ7WYYJ.js";import{b as C,c as S}from"./chunk-M6LIKZVL.js";import{r as It,s as G}from"./chunk-Q6UYEA4T.js";import{$b as p,Aa as ht,Ac as A,Bb as x,Bc as l,Cb as _t,Cc as y,Dc as v,E as ct,Ec as V,Ga as u,Hb as I,Ja as vt,Mc as St,Oc as j,Pc as tt,Qb as bt,Rb as R,Sb as f,Tb as h,Tc as Mt,Vb as xt,Vc as Pt,Wb as N,X as mt,Xb as B,Y as dt,Yb as c,Zb as n,Zc as et,_b as a,bd as it,dc as T,ec as w,gc as z,ha as pt,hd as Dt,ia as ut,j as st,ka as gt,kc as _,lb as s,ld as $,m as lt,ma as g,mc as m,md as F,sa as P,ta as D,ua as k,va as ft,wc as yt,yc as Ct}from"./chunk-ZXFVGPYG.js";import"./chunk-RNQFGQA5.js";var ae=(i,e)=>e.accession_id;function oe(i,e){i&1&&p(0,"mat-spinner",6)}function re(i,e){i&1&&(n(0,"div",8)(1,"mat-icon",10),l(2,"hourglass_empty"),a(),n(3,"p"),l(4,"No active runs at the moment"),a()())}function se(i,e){if(i&1&&(n(0,"div",11)(1,"div",12)(2,"div",13)(3,"mat-icon"),l(4),a(),n(5,"div",14)(6,"div",15),l(7),a(),n(8,"div",16),l(9),a()()(),n(10,"mat-icon",17),l(11,"chevron_right"),a()()()),i&2){let t=e.$implicit,o=m(2);c("routerLink",St("/app/monitor/",t.accession_id)),s(3),A(o.runHistoryService.getStatusColor(t.status)),s(),v(" ",o.runHistoryService.getStatusIcon(t.status)," "),s(3),v(" ",t.protocol_name||t.name||"Unnamed Run"," "),s(2),V(" ",t.status," \xB7 Started ",o.formatTime(t.start_time||t.created_at)," ")}}function le(i,e){if(i&1&&(n(0,"div",9),N(1,se,12,8,"div",11,ae),a()),i&2){let t=m();s(),B(t.activeRuns())}}var Z=class i{runHistoryService=g(L);activeRuns=u([]);isLoading=u(!0);pollSubscription;POLL_INTERVAL_MS=5e3;ngOnInit(){this.pollSubscription=ct(this.POLL_INTERVAL_MS).pipe(mt(0),dt(()=>this.runHistoryService.getActiveRuns())).subscribe({next:e=>{this.activeRuns.set(e),this.isLoading.set(!1)},error:e=>{console.error("[ActiveRunsPanel] Error fetching active runs:",e),this.isLoading.set(!1)}})}ngOnDestroy(){this.pollSubscription?.unsubscribe()}formatTime(e){if(!e)return"-";try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return e}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=x({type:i,selectors:[["app-active-runs-panel"]],decls:12,vars:2,consts:[[1,"praxis-card","mb-6"],[1,"card-header","border-b","border-[var(--theme-border)]","bg-[var(--mat-sys-surface-variant)]"],[1,"flex","items-center","justify-between","w-full"],[1,"flex","items-center","gap-2"],[1,"text-[var(--mat-sys-success)]"],[1,"text-lg","font-semibold","text-sys-text-primary"],["diameter","18",1,"ml-2"],[1,"card-content"],[1,"empty-state","text-center","py-8","text-sys-text-tertiary","opacity-60"],[1,"runs-list","space-y-3"],[1,"!w-12","!h-12","!text-[48px]","mb-2"],[1,"praxis-card-min","group","cursor-pointer","hover:bg-[var(--mat-sys-surface-variant)]","transition-all",3,"routerLink"],[1,"flex","items-center","justify-between","gap-3"],[1,"flex","items-center","gap-3","min-w-0"],[1,"min-w-0"],[1,"font-medium","text-sys-text-primary","truncate","group-hover:text-[var(--mat-sys-primary)]","transition-colors"],[1,"text-xs","text-sys-text-secondary","truncate"],[1,"!w-4","!h-4","!text-[16px]","opacity-0","group-hover:opacity-100","transition-opacity"]],template:function(t,o){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),l(5,"play_circle"),a(),n(6,"h2",5),l(7,"Active Runs"),a(),f(8,oe,1,0,"mat-spinner",6),a()()(),n(9,"div",7),f(10,re,5,0,"div",8)(11,le,3,0,"div",9),a()()),t&2&&(s(8),h(o.isLoading()?8:-1),s(2),h(o.activeRuns().length===0&&!o.isLoading()?10:11))},dependencies:[U,K,S,C,E,O,W],encapsulation:2})};function ce(i,e){if(i&1&&(n(0,"mat-option",17),l(1),a()),i&2){let t=e.$implicit;c("value",t),s(),v(" ",t," ")}}function me(i,e){if(i&1){let t=z();n(0,"mat-form-field",14)(1,"mat-select",16,0),_("selectionChange",function(r){P(t);let d=m(2);return D(d._changePageSize(r.value))}),N(3,ce,2,2,"mat-option",17,xt),a(),n(5,"div",18),_("click",function(){P(t);let r=yt(2);return D(r.open())}),a()()}if(i&2){let t=m(2);c("appearance",t._formFieldAppearance)("color",t.color),s(),c("value",t.pageSize)("disabled",t.disabled),bt("aria-labelledby",t._pageSizeLabelId),c("panelClass",t.selectConfig.panelClass||"")("disableOptionCentering",t.selectConfig.disableOptionCentering),s(2),B(t._displayedPageSizeOptions)}}function de(i,e){if(i&1&&(n(0,"div",15),l(1),a()),i&2){let t=m(2);s(),y(t.pageSize)}}function pe(i,e){if(i&1&&(n(0,"div",3)(1,"div",13),l(2),a(),f(3,me,6,7,"mat-form-field",14),f(4,de,2,1,"div",15),a()),i&2){let t=m();s(),R("id",t._pageSizeLabelId),s(),v(" ",t._intl.itemsPerPageLabel," "),s(),h(t._displayedPageSizeOptions.length>1?3:-1),s(),h(t._displayedPageSizeOptions.length<=1?4:-1)}}function ue(i,e){if(i&1){let t=z();n(0,"button",19),_("click",function(){P(t);let r=m();return D(r._buttonClicked(0,r._previousButtonsDisabled()))}),k(),n(1,"svg",8),p(2,"path",20),a()()}if(i&2){let t=m();c("matTooltip",t._intl.firstPageLabel)("matTooltipDisabled",t._previousButtonsDisabled())("disabled",t._previousButtonsDisabled())("tabindex",t._previousButtonsDisabled()?-1:null),R("aria-label",t._intl.firstPageLabel)}}function ge(i,e){if(i&1){let t=z();n(0,"button",21),_("click",function(){P(t);let r=m();return D(r._buttonClicked(r.getNumberOfPages()-1,r._nextButtonsDisabled()))}),k(),n(1,"svg",8),p(2,"path",22),a()()}if(i&2){let t=m();c("matTooltip",t._intl.lastPageLabel)("matTooltipDisabled",t._nextButtonsDisabled())("disabled",t._nextButtonsDisabled())("tabindex",t._nextButtonsDisabled()?-1:null),R("aria-label",t._intl.lastPageLabel)}}var fe=(()=>{class i{changes=new st;itemsPerPageLabel="Items per page:";nextPageLabel="Next page";previousPageLabel="Previous page";firstPageLabel="First page";lastPageLabel="Last page";getRangeLabel=(t,o,r)=>{if(r==0||o==0)return`0 of ${r}`;r=Math.max(r,0);let d=t*o,M=d<r?Math.min(d+o,r):d+o;return`${d+1} \u2013 ${M} of ${r}`};static \u0275fac=function(o){return new(o||i)};static \u0275prov=pt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),he=50;var ve=new gt("MAT_PAGINATOR_DEFAULT_OPTIONS"),ot=(()=>{class i{_intl=g(fe);_changeDetectorRef=g(Dt);_formFieldAppearance;_pageSizeLabelId=g(Rt).getId("mat-paginator-page-size-label-");_intlChanges;_isInitialized=!1;_initializedStream=new lt(1);color;get pageIndex(){return this._pageIndex}set pageIndex(t){this._pageIndex=Math.max(t||0,0),this._changeDetectorRef.markForCheck()}_pageIndex=0;get length(){return this._length}set length(t){this._length=t||0,this._changeDetectorRef.markForCheck()}_length=0;get pageSize(){return this._pageSize}set pageSize(t){this._pageSize=Math.max(t||0,0),this._updateDisplayedPageSizeOptions()}_pageSize;get pageSizeOptions(){return this._pageSizeOptions}set pageSizeOptions(t){this._pageSizeOptions=(t||[]).map(o=>F(o,0)),this._updateDisplayedPageSizeOptions()}_pageSizeOptions=[];hidePageSize=!1;showFirstLastButtons=!1;selectConfig={};disabled=!1;page=new ht;_displayedPageSizeOptions;initialized=this._initializedStream;constructor(){let t=this._intl,o=g(ve,{optional:!0});if(this._intlChanges=t.changes.subscribe(()=>this._changeDetectorRef.markForCheck()),o){let{pageSize:r,pageSizeOptions:d,hidePageSize:M,showFirstLastButtons:H}=o;r!=null&&(this._pageSize=r),d!=null&&(this._pageSizeOptions=d),M!=null&&(this.hidePageSize=M),H!=null&&(this.showFirstLastButtons=H)}this._formFieldAppearance=o?.formFieldAppearance||"outline"}ngOnInit(){this._isInitialized=!0,this._updateDisplayedPageSizeOptions(),this._initializedStream.next()}ngOnDestroy(){this._initializedStream.complete(),this._intlChanges.unsubscribe()}nextPage(){this.hasNextPage()&&this._navigate(this.pageIndex+1)}previousPage(){this.hasPreviousPage()&&this._navigate(this.pageIndex-1)}firstPage(){this.hasPreviousPage()&&this._navigate(0)}lastPage(){this.hasNextPage()&&this._navigate(this.getNumberOfPages()-1)}hasPreviousPage(){return this.pageIndex>=1&&this.pageSize!=0}hasNextPage(){let t=this.getNumberOfPages()-1;return this.pageIndex<t&&this.pageSize!=0}getNumberOfPages(){return this.pageSize?Math.ceil(this.length/this.pageSize):0}_changePageSize(t){let o=this.pageIndex*this.pageSize,r=this.pageIndex;this.pageIndex=Math.floor(o/t)||0,this.pageSize=t,this._emitPageEvent(r)}_nextButtonsDisabled(){return this.disabled||!this.hasNextPage()}_previousButtonsDisabled(){return this.disabled||!this.hasPreviousPage()}_updateDisplayedPageSizeOptions(){this._isInitialized&&(this.pageSize||(this._pageSize=this.pageSizeOptions.length!=0?this.pageSizeOptions[0]:he),this._displayedPageSizeOptions=this.pageSizeOptions.slice(),this._displayedPageSizeOptions.indexOf(this.pageSize)===-1&&this._displayedPageSizeOptions.push(this.pageSize),this._displayedPageSizeOptions.sort((t,o)=>t-o),this._changeDetectorRef.markForCheck())}_emitPageEvent(t){this.page.emit({previousPageIndex:t,pageIndex:this.pageIndex,pageSize:this.pageSize,length:this.length})}_navigate(t){let o=this.pageIndex;t!==o&&(this.pageIndex=t,this._emitPageEvent(o))}_buttonClicked(t,o){o||this._navigate(t)}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=x({type:i,selectors:[["mat-paginator"]],hostAttrs:["role","group",1,"mat-mdc-paginator"],inputs:{color:"color",pageIndex:[2,"pageIndex","pageIndex",F],length:[2,"length","length",F],pageSize:[2,"pageSize","pageSize",F],pageSizeOptions:"pageSizeOptions",hidePageSize:[2,"hidePageSize","hidePageSize",$],showFirstLastButtons:[2,"showFirstLastButtons","showFirstLastButtons",$],selectConfig:"selectConfig",disabled:[2,"disabled","disabled",$]},outputs:{page:"page"},exportAs:["matPaginator"],decls:14,vars:14,consts:[["selectRef",""],[1,"mat-mdc-paginator-outer-container"],[1,"mat-mdc-paginator-container"],[1,"mat-mdc-paginator-page-size"],[1,"mat-mdc-paginator-range-actions"],["aria-atomic","true","aria-live","polite","role","status",1,"mat-mdc-paginator-range-label"],["matIconButton","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-first",3,"matTooltip","matTooltipDisabled","disabled","tabindex"],["matIconButton","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-previous",3,"click","matTooltip","matTooltipDisabled","disabled","tabindex"],["viewBox","0 0 24 24","focusable","false","aria-hidden","true",1,"mat-mdc-paginator-icon"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["matIconButton","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-next",3,"click","matTooltip","matTooltipDisabled","disabled","tabindex"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],["matIconButton","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-last",3,"matTooltip","matTooltipDisabled","disabled","tabindex"],["aria-hidden","true",1,"mat-mdc-paginator-page-size-label"],[1,"mat-mdc-paginator-page-size-select",3,"appearance","color"],[1,"mat-mdc-paginator-page-size-value"],["hideSingleSelectionIndicator","",3,"selectionChange","value","disabled","aria-labelledby","panelClass","disableOptionCentering"],[3,"value"],[1,"mat-mdc-paginator-touch-target",3,"click"],["matIconButton","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-first",3,"click","matTooltip","matTooltipDisabled","disabled","tabindex"],["d","M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"],["matIconButton","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-last",3,"click","matTooltip","matTooltipDisabled","disabled","tabindex"],["d","M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"]],template:function(o,r){o&1&&(n(0,"div",1)(1,"div",2),f(2,pe,5,4,"div",3),n(3,"div",4)(4,"div",5),l(5),a(),f(6,ue,3,5,"button",6),n(7,"button",7),_("click",function(){return r._buttonClicked(r.pageIndex-1,r._previousButtonsDisabled())}),k(),n(8,"svg",8),p(9,"path",9),a()(),ft(),n(10,"button",10),_("click",function(){return r._buttonClicked(r.pageIndex+1,r._nextButtonsDisabled())}),k(),n(11,"svg",8),p(12,"path",11),a()(),f(13,ge,3,5,"button",12),a()()()),o&2&&(s(2),h(r.hidePageSize?-1:2),s(3),v(" ",r._intl.getRangeLabel(r.pageIndex,r.pageSize,r.length)," "),s(),h(r.showFirstLastButtons?6:-1),s(),c("matTooltip",r._intl.previousPageLabel)("matTooltipDisabled",r._previousButtonsDisabled())("disabled",r._previousButtonsDisabled())("tabindex",r._previousButtonsDisabled()?-1:null),R("aria-label",r._intl.previousPageLabel),s(3),c("matTooltip",r._intl.nextPageLabel)("matTooltipDisabled",r._nextButtonsDisabled())("disabled",r._nextButtonsDisabled())("tabindex",r._nextButtonsDisabled()?-1:null),R("aria-label",r._intl.nextPageLabel),s(3),h(r.showFirstLastButtons?13:-1))},dependencies:[Et,Kt,Wt,Q,Tt],styles:[`.mat-mdc-paginator{display:block;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-paginator-container-text-color, var(--mat-sys-on-surface));background-color:var(--mat-paginator-container-background-color, var(--mat-sys-surface));font-family:var(--mat-paginator-container-text-font, var(--mat-sys-body-small-font));line-height:var(--mat-paginator-container-text-line-height, var(--mat-sys-body-small-line-height));font-size:var(--mat-paginator-container-text-size, var(--mat-sys-body-small-size));font-weight:var(--mat-paginator-container-text-weight, var(--mat-sys-body-small-weight));letter-spacing:var(--mat-paginator-container-text-tracking, var(--mat-sys-body-small-tracking));--mat-form-field-container-height: var(--mat-paginator-form-field-container-height, 40px);--mat-form-field-container-vertical-padding: var(--mat-paginator-form-field-container-vertical-padding, 8px)}.mat-mdc-paginator .mat-mdc-select-value{font-size:var(--mat-paginator-select-trigger-text-size, var(--mat-sys-body-small-size))}.mat-mdc-paginator .mat-mdc-form-field-subscript-wrapper{display:none}.mat-mdc-paginator .mat-mdc-select{line-height:1.5}.mat-mdc-paginator-outer-container{display:flex}.mat-mdc-paginator-container{display:flex;align-items:center;justify-content:flex-end;padding:0 8px;flex-wrap:wrap;width:100%;min-height:var(--mat-paginator-container-size, 56px)}.mat-mdc-paginator-page-size{display:flex;align-items:baseline;margin-right:8px}[dir=rtl] .mat-mdc-paginator-page-size{margin-right:0;margin-left:8px}.mat-mdc-paginator-page-size-label{margin:0 4px}.mat-mdc-paginator-page-size-select{margin:0 4px;width:var(--mat-paginator-page-size-select-width, 84px)}.mat-mdc-paginator-range-label{margin:0 32px 0 24px}.mat-mdc-paginator-range-actions{display:flex;align-items:center}.mat-mdc-paginator-icon{display:inline-block;width:28px;fill:var(--mat-paginator-enabled-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-icon-button[aria-disabled] .mat-mdc-paginator-icon{fill:var(--mat-paginator-disabled-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}[dir=rtl] .mat-mdc-paginator-icon{transform:rotate(180deg)}@media(forced-colors: active){.mat-mdc-icon-button[aria-disabled] .mat-mdc-paginator-icon,.mat-mdc-paginator-icon{fill:currentColor}.mat-mdc-paginator-range-actions .mat-mdc-icon-button{outline:solid 1px}.mat-mdc-paginator-range-actions .mat-mdc-icon-button[aria-disabled]{color:GrayText}}.mat-mdc-paginator-touch-target{display:var(--mat-paginator-touch-target-display, block);position:absolute;top:50%;left:50%;width:var(--mat-paginator-page-size-select-width, 84px);height:var(--mat-paginator-page-size-select-touch-target-height, 48px);background-color:rgba(0,0,0,0);transform:translate(-50%, -50%);cursor:pointer}
`],encapsulation:2,changeDetection:0})}return i})(),Yt=(()=>{class i{static \u0275fac=function(o){return new(o||i)};static \u0275mod=_t({type:i});static \u0275inj=ut({imports:[E,Zt,wt,ot]})}return i})();var be=()=>({height:"48px","border-radius":"12px","margin-bottom":"0"}),xe=()=>({height:"64px","border-radius":"12px","margin-bottom":"0"}),te=i=>["/app/monitor",i],ye=()=>[10,25,50];function Ce(i,e){i&1&&(n(0,"div",4),p(1,"ngx-skeleton-loader",8)(2,"ngx-skeleton-loader",9),a()),i&2&&(s(),c("theme",j(2,be)),s(),c("theme",j(3,xe)))}function Se(i,e){i&1&&(n(0,"div",5)(1,"mat-icon",10),l(2,"history"),a(),n(3,"p",11),l(4,"No runs yet"),a(),n(5,"p",12),l(6,"Execute a protocol to see run history here"),a()())}function Me(i,e){i&1&&(n(0,"th",25),l(1,"Status"),a())}function Pe(i,e){if(i&1&&(n(0,"td",26)(1,"div",27)(2,"mat-icon",28),l(3),a(),n(4,"span",29),l(5),a()()()),i&2){let t=e.$implicit,o=m(2);s(2),A(o.runHistoryService.getStatusColor(t.status)),s(),v(" ",o.runHistoryService.getStatusIcon(t.status)," "),s(2),y(t.status)}}function De(i,e){i&1&&(n(0,"th",25),l(1,"Protocol"),a())}function Ie(i,e){if(i&1&&(n(0,"td",26)(1,"span",30),l(2),a()()),i&2){let t=e.$implicit;s(2),v(" ",t.protocol_name||t.name||"Unnamed"," ")}}function Re(i,e){i&1&&(n(0,"th",25),l(1,"Started"),a())}function Te(i,e){if(i&1&&(n(0,"td",31),l(1),a()),i&2){let t=e.$implicit,o=m(2);s(),v(" ",o.formatDate(t.start_time||t.created_at)," ")}}function we(i,e){i&1&&(n(0,"th",25),l(1,"Duration"),a())}function ze(i,e){if(i&1&&(n(0,"td",31),l(1),a()),i&2){let t=e.$implicit,o=m(2);s(),v(" ",o.runHistoryService.formatDuration(t.duration_ms)," ")}}function Ee(i,e){i&1&&p(0,"th",32)}function Oe(i,e){if(i&1&&(n(0,"td",26)(1,"button",33)(2,"mat-icon"),l(3,"visibility"),a()()()),i&2){let t=e.$implicit;s(),c("routerLink",tt(1,te,t.accession_id))}}function Le(i,e){i&1&&p(0,"tr",34)}function ke(i,e){if(i&1&&p(0,"tr",35),i&2){let t=e.$implicit;c("routerLink",tt(1,te,t.accession_id))}}function Fe(i,e){if(i&1&&(n(0,"div",6)(1,"table",13),T(2,14),I(3,Me,2,0,"th",15)(4,Pe,6,4,"td",16),w(),T(5,17),I(6,De,2,0,"th",15)(7,Ie,3,1,"td",16),w(),T(8,18),I(9,Re,2,0,"th",15)(10,Te,2,1,"td",19),w(),T(11,20),I(12,we,2,0,"th",15)(13,ze,2,1,"td",19),w(),T(14,21),I(15,Ee,1,0,"th",22)(16,Oe,4,3,"td",16),w(),I(17,Le,1,0,"tr",23)(18,ke,1,3,"tr",24),a()()),i&2){let t=m();s(),c("dataSource",t.runs()),s(16),c("matHeaderRowDef",t.displayedColumns),s(),c("matRowDefColumns",t.displayedColumns)}}function He(i,e){if(i&1){let t=z();n(0,"div",7)(1,"mat-paginator",36),_("page",function(r){P(t);let d=m();return D(d.onPageChange(r))}),a()()}if(i&2){let t=m();s(),c("length",t.totalRuns())("pageSize",t.pageSize)("pageSizeOptions",j(3,ye))}}var J=class i{runHistoryService=g(L);filters=it(null);search=it("");runs=u([]);isLoading=u(!0);totalRuns=u(0);displayedColumns=["status","protocol","started","duration","actions"];pageSize=10;currentOffset=0;refreshInterval;constructor(){vt(()=>{let e=this.filters(),t=this.search();this.currentOffset=0,this.loadRuns()})}ngOnInit(){this.refreshInterval=setInterval(()=>{this.loadRuns()},1e4)}ngOnDestroy(){this.refreshInterval&&clearInterval(this.refreshInterval)}loadRuns(){this.isLoading.set(!0);let e=this.filters();this.runHistoryService.getRunHistory({limit:this.pageSize,offset:this.currentOffset,status:e?.status?.length?e.status:void 0,protocol_id:e?.protocol_id??void 0,machine_id:e?.machine_id??void 0,sort_by:e?.sort_by??"created_at",sort_order:e?.sort_order??"desc",search:this.search()||void 0}).subscribe({next:t=>{this.runs.set(t),this.totalRuns.set(t.length<this.pageSize?this.currentOffset+t.length:this.currentOffset+t.length+1),this.isLoading.set(!1)},error:t=>{console.error("[RunHistoryTable] Error loading runs:",t),this.isLoading.set(!1)}})}onPageChange(e){this.currentOffset=e.pageIndex*e.pageSize,this.loadRuns()}formatDate(e){if(!e)return"-";try{return new Date(e).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=x({type:i,selectors:[["app-run-history-table"]],inputs:{filters:[1,"filters"],search:[1,"search"]},decls:9,vars:2,consts:[[1,"history-container","praxis-card","mt-6"],[1,"card-header","border-b","border-[var(--theme-border)]","bg-[var(--mat-sys-surface-variant)]"],[1,"text-xl","font-semibold","text-sys-text-primary"],[1,"card-content","!p-0"],[1,"skeleton-container","flex","flex-col","gap-3","p-4"],[1,"empty-state","text-center","py-12","text-sys-text-tertiary","opacity-60"],[1,"table-container","overflow-hidden"],[1,"card-actions","bg-[var(--mat-sys-surface-container)]","!p-0"],["count","1","appearance","line",3,"theme"],["count","5","appearance","line",3,"theme"],[1,"!w-16","!h-16","!text-[64px]","mb-4"],[1,"text-lg"],[1,"text-sm"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","status"],["mat-header-cell","","class","!bg-[var(--mat-sys-surface-container)]",4,"matHeaderCellDef"],["mat-cell","","class","!py-3",4,"matCellDef"],["matColumnDef","protocol"],["matColumnDef","started"],["mat-cell","","class","!py-3 text-sys-text-secondary",4,"matCellDef"],["matColumnDef","duration"],["matColumnDef","actions"],["mat-header-cell","","class","!bg-[var(--mat-sys-surface-container)] w-16",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-[var(--mat-sys-surface-variant)] cursor-pointer",3,"routerLink",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"!bg-[var(--mat-sys-surface-container)]"],["mat-cell","",1,"!py-3"],[1,"flex","items-center","gap-2"],[1,"!w-5","!h-5","!text-[20px]"],[1,"text-sm","font-medium"],[1,"font-medium","text-sys-text-primary"],["mat-cell","",1,"!py-3","text-sys-text-secondary"],["mat-header-cell","",1,"!bg-[var(--mat-sys-surface-container)]","w-16"],["mat-icon-button","","aria-label","View run details",3,"routerLink"],["mat-header-row",""],["mat-row","",1,"hover:bg-[var(--mat-sys-surface-variant)]","cursor-pointer",3,"routerLink"],["aria-label","Select page of runs",1,"w-full","!bg-transparent",3,"page","length","pageSize","pageSizeOptions"]],template:function(t,o){t&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),l(3,"Run History"),a()(),n(4,"div",3),f(5,Ce,3,4,"div",4)(6,Se,7,0,"div",5)(7,Fe,19,3,"div",6),a(),f(8,He,2,4,"div",7),a()),t&2&&(s(5),h(o.isLoading()&&o.runs().length===0?5:o.runs().length===0&&!o.isLoading()?6:7),s(3),h(o.runs().length>0?8:-1))},dependencies:[U,Qt,Ft,Nt,jt,Bt,Ht,$t,At,Vt,Gt,Ut,Yt,ot,S,C,E,Q,O,Lt,Xt,Jt],styles:[".history-container[_ngcontent-%COMP%]{margin-top:24px}table[_ngcontent-%COMP%]{width:100%}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:600;color:var(--mat-sys-on-surface-variant)}tr.mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:var(--mat-sys-surface-variant)}"]})};function Ne(i,e){i&1&&(n(0,"div",1),p(1,"mat-spinner",2),a())}function Be(i,e){if(i&1&&(n(0,"div",3)(1,"div",4)(2,"div",5)(3,"mat-icon"),l(4,"today"),a()()(),n(5,"div",6)(6,"span",7),l(7),a(),n(8,"span",8),l(9,"Runs Today"),a()()(),n(10,"div",3)(11,"div",4)(12,"div",9)(13,"mat-icon"),l(14,"history"),a()()(),n(15,"div",6)(16,"span",7),l(17),a(),n(18,"span",8),l(19,"Total Runs"),a()()(),n(20,"div",3)(21,"div",4)(22,"div",10)(23,"mat-icon"),l(24),a()(),n(25,"div",11),l(26),a()(),n(27,"div",6)(28,"span",7),l(29),Mt(30,"number"),a(),n(31,"span",8),l(32,"Success Rate"),a()()(),n(33,"div",3)(34,"div",4)(35,"div",12)(36,"mat-icon"),l(37,"timer"),a()()(),n(38,"div",6)(39,"span",13),l(40),a(),n(41,"span",8),l(42,"Avg Duration"),a()()()),i&2){let t=m();s(7),y(t.stats().runsToday),s(10),y(t.stats().totalRuns),s(5),Ct("warning",t.stats().successRate<80),s(2),y(t.stats().successRate>=80?"check_circle":"warning"),s(2),V(" ",t.stats().completedRuns," / ",t.stats().completedRuns+t.stats().failedRuns," "),s(3),v("",Pt(30,9,t.stats().successRate,"1.0-0"),"%"),s(11),y(t.formatDuration(t.stats().avgDurationMs))}}var X=class i{runHistoryService=g(L);isLoading=u(!0);stats=u({totalRuns:0,runsToday:0,successRate:0,avgDurationMs:0,completedRuns:0,failedRuns:0});ngOnInit(){this.loadStats()}loadStats(){this.runHistoryService.getRunHistory({limit:100}).subscribe({next:e=>{this.calculateStats(e),this.isLoading.set(!1)},error:()=>{this.isLoading.set(!1)}})}calculateStats(e){let t=new Date;t.setHours(0,0,0,0);let o=e.filter(b=>new Date(b.created_at)>=t).length,r=e.filter(b=>b.status==="COMPLETED").length,d=e.filter(b=>b.status==="FAILED").length,M=r+d,H=M>0?r/M*100:100,Y=e.filter(b=>b.duration_ms&&b.duration_ms>0),ie=Y.length>0?Y.reduce((b,rt)=>b+(rt.duration_ms||0),0)/Y.length:0;this.stats.set({totalRuns:e.length,runsToday:o,successRate:H,avgDurationMs:ie,completedRuns:r,failedRuns:d})}formatDuration(e){return!e||e===0?"-":this.runHistoryService.formatDuration(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=x({type:i,selectors:[["app-run-stats-panel"]],decls:3,vars:1,consts:[[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","gap-4","mb-6"],[1,"col-span-full","py-12","flex","items-center","justify-center","praxis-card"],["diameter","32"],[1,"praxis-card","group","cursor-default"],[1,"card-header","pb-2"],[1,"stat-icon","runs-today"],[1,"card-content"],[1,"text-3xl","font-bold","text-sys-text-primary","block"],[1,"card-subtitle"],[1,"stat-icon","total-runs"],[1,"stat-icon","success-rate"],[1,"ml-auto","text-xs","font-medium","text-sys-text-tertiary"],[1,"stat-icon","avg-duration"],[1,"text-3xl","font-bold","text-sys-text-primary","block","truncate"]],template:function(t,o){t&1&&(n(0,"div",0),f(1,Ne,2,0,"div",1)(2,Be,43,12),a()),t&2&&(s(),h(o.isLoading()?1:2))},dependencies:[G,S,C,O,W,It],styles:[".stat-icon[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.stat-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:24px;height:24px;font-size:24px}.stat-icon.runs-today[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary-container)}.stat-icon.runs-today[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--tertiary-color)}.stat-icon.total-runs[_ngcontent-%COMP%]{background:var(--mat-sys-primary-container)}.stat-icon.total-runs[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--primary-color)}.stat-icon.success-rate[_ngcontent-%COMP%]{background:var(--mat-sys-success-container)}.stat-icon.success-rate[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--mat-sys-success)}.stat-icon.success-rate.warning[_ngcontent-%COMP%]{background:var(--mat-sys-warning-container)}.stat-icon.success-rate.warning[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--mat-sys-warning)}.stat-icon.avg-duration[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary-container)}.stat-icon.avg-duration[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--tertiary-color)}"]})};var ee=class i{protocolService=g(kt);apiWrapper=g(zt);currentFilters=u(null);searchQuery=u("");protocols=u([]);machines=u([]);viewControlsConfig=et(()=>({storageKey:"execution-monitor",filters:[{key:"status",label:"Status",type:"multiselect",pinned:!0,options:[{label:"Running",value:"RUNNING"},{label:"Completed",value:"COMPLETED"},{label:"Failed",value:"FAILED"},{label:"Paused",value:"PAUSED"},{label:"Pending",value:"PENDING"},{label:"Queued",value:"QUEUED"},{label:"Cancelled",value:"CANCELLED"}]},{key:"machine_id",label:"Machine",type:"multiselect",options:this.machines().map(e=>({label:e.name||"Unknown",value:e.accession_id}))},{key:"protocol_id",label:"Protocol",type:"multiselect",options:this.protocols().map(e=>({label:e.name||"Unknown",value:e.accession_id}))}],sortOptions:[{label:"Date Created",value:"created_at"},{label:"Start Time",value:"start_time"},{label:"Status",value:"status"}],defaults:{sortBy:"created_at",sortOrder:"desc"}}));ngOnInit(){this.loadFilterOptions()}loadFilterOptions(){this.protocolService.getProtocols().subscribe(e=>{this.protocols.set(e)}),this.apiWrapper.wrap(Ot.getMultiApiV1MachinesGet()).subscribe(e=>{this.machines.set(e)})}onViewControlsChange(e){this.searchQuery.set(e.search),this.currentFilters.set({status:e.filters.status||[],protocol_id:e.filters.protocol_id||null,machine_id:e.filters.machine_id||null,sort_by:e.sortBy||"created_at",sort_order:e.sortOrder})}activeFiltersCount=et(()=>{let e=this.currentFilters();if(!e)return 0;let t=0;return e.status?.length&&t++,e.protocol_id?.length&&t++,e.machine_id?.length&&t++,t});onFiltersChange(e){this.currentFilters.set(e)}onSearch(e){this.searchQuery.set(e)}clearFilters(){this.searchQuery.set("")}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=x({type:i,selectors:[["app-execution-monitor"]],decls:14,vars:3,consts:[[1,"p-6","max-w-screen-2xl","mx-auto"],[1,"flex","items-center","gap-4","mb-8"],[1,"w-12","h-12","rounded-xl","bg-gradient-to-br","from-[var(--mat-sys-success-container)]","to-[var(--mat-sys-tertiary-container)]","flex","items-center","justify-center","border","border-[var(--theme-border)]"],[1,"text-[var(--mat-sys-success)]","!w-6","!h-6","!text-[24px]"],[1,"text-3xl","font-bold","text-sys-text-primary","mb-1"],[1,"text-sys-text-secondary"],[3,"stateChange","config"],["data-tour-id","run-history-table",3,"filters","search"]],template:function(t,o){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),l(4,"monitor_heart"),a()(),n(5,"div")(6,"h1",4),l(7,"Execution Monitor"),a(),n(8,"p",5),l(9,"Track and analyze protocol executions"),a()()(),p(10,"app-run-stats-panel")(11,"app-active-runs-panel"),n(12,"app-view-controls",6),_("stateChange",function(d){return o.onViewControlsChange(d)}),a(),p(13,"app-run-history-table",7),a()),t&2&&(s(12),c("config",o.viewControlsConfig()),s(),c("filters",o.currentFilters())("search",o.searchQuery()))},dependencies:[G,K,S,C,Z,J,X,qt],encapsulation:2})};export{ee as ExecutionMonitorComponent};
