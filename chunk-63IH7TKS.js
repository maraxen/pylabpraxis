import{c as P}from"./chunk-PWVAMWZ2.js";import{a as R}from"./chunk-ULQGHXUB.js";import{a as n,b as a,c as w}from"./chunk-FGBSBVHW.js";import{e as A}from"./chunk-SKMC2KSJ.js";import{I as i,ha as g,ma as S,r as s,w as o}from"./chunk-ZXFVGPYG.js";import{a as _,b as y}from"./chunk-RNQFGQA5.js";var d=class{static createApiV1SchedulerEntriesPost(e){return a(n,{method:"POST",url:"/api/v1/scheduler/entries",body:e,mediaType:"application/json",errors:{422:"Validation Error"}})}static getMultiApiV1SchedulerEntriesGet(e=100,r,t,l,v,m,f,c,u,p){return a(n,{method:"GET",url:"/api/v1/scheduler/entries",query:{limit:e,offset:r,sort_by:t,date_range_start:l,date_range_end:v,protocol_run_accession_id:m,machine_accession_id:f,resource_accession_id:c,parent_accession_id:u},body:p,mediaType:"application/json",errors:{422:"Validation Error"}})}static getApiV1SchedulerEntriesAccessionIdGet(e){return a(n,{method:"GET",url:"/api/v1/scheduler/entries/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static updateApiV1SchedulerEntriesAccessionIdPut(e,r){return a(n,{method:"PUT",url:"/api/v1/scheduler/entries/{accession_id}",path:{accession_id:e},body:r,mediaType:"application/json",errors:{422:"Validation Error"}})}static deleteApiV1SchedulerEntriesAccessionIdDelete(e){return a(n,{method:"DELETE",url:"/api/v1/scheduler/entries/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static updateStatusApiV1SchedulerScheduleEntryAccessionIdStatusPut(e,r){return a(n,{method:"PUT",url:"/api/v1/scheduler/{schedule_entry_accession_id}/status",path:{schedule_entry_accession_id:e},body:r,mediaType:"application/json",errors:{422:"Validation Error"}})}static updatePriorityApiV1SchedulerScheduleEntryAccessionIdPriorityPut(e,r){return a(n,{method:"PUT",url:"/api/v1/scheduler/{schedule_entry_accession_id}/priority",path:{schedule_entry_accession_id:e},body:r,mediaType:"application/json",errors:{422:"Validation Error"}})}static listReservationsApiV1SchedulerReservationsGet(e=!1,r){return a(n,{method:"GET",url:"/api/v1/scheduler/reservations",query:{include_released:e,asset_key:r},errors:{422:"Validation Error"}})}static releaseReservationApiV1SchedulerReservationsAssetKeyDelete(e,r=!1){return a(n,{method:"DELETE",url:"/api/v1/scheduler/reservations/{asset_key}",path:{asset_key:e},query:{force:r},errors:{422:"Validation Error"}})}static getUncertainStatesApiV1SchedulerScheduleEntryAccessionIdUncertainStateGet(e){return a(n,{method:"GET",url:"/api/v1/scheduler/{schedule_entry_accession_id}/uncertain-state",path:{schedule_entry_accession_id:e},errors:{422:"Validation Error"}})}static resolveStateApiV1SchedulerScheduleEntryAccessionIdResolveStatePost(e,r){return a(n,{method:"POST",url:"/api/v1/scheduler/{schedule_entry_accession_id}/resolve-state",path:{schedule_entry_accession_id:e},body:r,mediaType:"application/json",errors:{422:"Validation Error"}})}static resumeRunApiV1SchedulerScheduleEntryAccessionIdResumePost(e){return a(n,{method:"POST",url:"/api/v1/scheduler/{schedule_entry_accession_id}/resume",path:{schedule_entry_accession_id:e},errors:{422:"Validation Error"}})}static abortRunApiV1SchedulerScheduleEntryAccessionIdAbortPost(e,r){return a(n,{method:"POST",url:"/api/v1/scheduler/{schedule_entry_accession_id}/abort",path:{schedule_entry_accession_id:e},query:{reason:r},errors:{422:"Validation Error"}})}};var V=class h{modeService=S(P);sqliteService=S(A);apiWrapper=S(w);getRunHistory(e){return this.modeService.isBrowserMode()?this.sqliteService.getProtocolRuns().pipe(o(r=>{let t=r.map(c=>y(_({},c),{protocol_accession_id:c.top_level_protocol_definition_accession_id,status:c.status}));if(e?.status&&e.status.length>0){let c=Array.isArray(e.status)?e.status:[e.status];t=t.filter(u=>c.includes(u.status))}if(e?.protocol_id){let c=Array.isArray(e.protocol_id)?e.protocol_id:[e.protocol_id];t=t.filter(u=>c.includes(u.protocol_accession_id||""))}if(e?.machine_id){let c=Array.isArray(e.machine_id)?e.machine_id:[e.machine_id];t=t.filter(u=>{let p=u.machine_accession_id||u.machine_id;return c.includes(p||"")})}let l=e?.sort_by||"created_at",v=e?.sort_order||"desc";t.sort((c,u)=>{let p=c[l]||"",E=u[l]||"",b=p<E?-1:p>E?1:0;return v==="desc"?-b:b});let m=e?.offset||0,f=e?.limit||50;return t.slice(m,m+f)}),i(r=>(console.error("[RunHistoryService] Browser mode error:",r),s([])))):this.apiWrapper.wrap(R.getMultiApiV1ProtocolsRunsGet(e?.limit,e?.offset,e?.sort_by,void 0,void 0,e?.protocol_id,e?.machine_id,void 0,void 0,void 0)).pipe(o(r=>r),i(r=>(console.error("[RunHistoryService] Failed to fetch run history:",r),s([]))))}getActiveRuns(){if(this.modeService.isBrowserMode()){let e=["PENDING","PREPARING","QUEUED","RUNNING","PAUSED"];return this.sqliteService.getProtocolRuns().pipe(o(r=>r.map(t=>y(_({},t),{protocol_accession_id:t.top_level_protocol_definition_accession_id,status:t.status})).filter(t=>e.includes(t.status))),i(r=>(console.error("[RunHistoryService] Browser mode getActiveRuns error:",r),s([]))))}return this.apiWrapper.wrap(R.getProtocolQueueApiV1ProtocolsRunsQueueGet()).pipe(o(e=>e),i(e=>(console.error("[RunHistoryService] Failed to fetch active runs:",e),s([]))))}getRunDetail(e){return this.modeService.isBrowserMode()?this.sqliteService.getProtocolRun(e).pipe(o(r=>r?y(_({},r),{protocol_accession_id:r.top_level_protocol_definition_accession_id,status:r.status}):null),i(r=>(console.error("[RunHistoryService] Browser mode getRunDetail error:",r),s(null)))):this.apiWrapper.wrap(R.getApiV1ProtocolsRunsAccessionIdGet(e)).pipe(o(r=>r),i(r=>(console.error("[RunHistoryService] Failed to fetch run detail:",r),s(null))))}getStatusColor(e){switch(e){case"RUNNING":return"status-running";case"QUEUED":case"PREPARING":return"status-warning";case"PENDING":return"status-info";case"COMPLETED":return"status-success";case"FAILED":return"status-error";case"CANCELLED":return"status-neutral";case"PAUSED":return"status-warning";default:return"status-neutral"}}getStatusIcon(e){switch(e){case"RUNNING":return"play_circle";case"QUEUED":return"schedule";case"PREPARING":return"hourglass_empty";case"PENDING":return"pending";case"COMPLETED":return"check_circle";case"FAILED":return"error";case"CANCELLED":return"cancel";case"PAUSED":return"pause_circle";default:return"help"}}formatDuration(e){if(!e)return"-";let r=Math.floor(e/1e3),t=Math.floor(r/60),l=Math.floor(t/60);return l>0?`${l}h ${t%60}m`:t>0?`${t}m ${r%60}s`:`${r}s`}getUncertainStates(e){return this.modeService.isBrowserMode()?(console.warn("[RunHistoryService] State resolution not yet implemented in browser mode"),s([])):this.apiWrapper.wrap(d.getUncertainStatesApiV1SchedulerScheduleEntryAccessionIdUncertainStateGet(e)).pipe(o(r=>r),i(r=>(console.error("[RunHistoryService] Failed to fetch uncertain states:",r),s([]))))}resolveStates(e,r){return this.modeService.isBrowserMode()?this.sqliteService.saveStateResolution(e,r).pipe(o(()=>({id:crypto.randomUUID(),run_id:e,operation_id:r.operation_id,operation_description:"Browser mode resolution",resolution_type:r.resolution_type,action_taken:r.action,resolved_at:new Date().toISOString(),resolved_by:"user"})),i(t=>(console.error("[RunHistoryService] Failed to save resolution:",t),s(null)))):this.apiWrapper.wrap(d.resolveStateApiV1SchedulerScheduleEntryAccessionIdResolveStatePost(e,r)).pipe(o(t=>t),i(t=>(console.error("[RunHistoryService] Failed to submit resolution:",t),s(null))))}resumeRun(e){return this.modeService.isBrowserMode()?this.sqliteService.updateProtocolRunStatus(e,"RUNNING").pipe(o(()=>!0),i(r=>(console.error("[RunHistoryService] Failed to resume run:",r),s(!1)))):this.apiWrapper.wrap(d.resumeRunApiV1SchedulerScheduleEntryAccessionIdResumePost(e)).pipe(o(()=>!0),i(r=>(console.error("[RunHistoryService] Failed to resume run:",r),s(!1))))}abortRun(e,r){return this.modeService.isBrowserMode()?this.sqliteService.updateProtocolRunStatus(e,"CANCELLED").pipe(o(()=>!0),i(t=>(console.error("[RunHistoryService] Failed to abort run:",t),s(!1)))):this.apiWrapper.wrap(d.abortRunApiV1SchedulerScheduleEntryAccessionIdAbortPost(e,r)).pipe(o(()=>!0),i(t=>(console.error("[RunHistoryService] Failed to abort run:",t),s(!1))))}static \u0275fac=function(r){return new(r||h)};static \u0275prov=g({token:h,factory:h.\u0275fac,providedIn:"root"})};export{V as a};
