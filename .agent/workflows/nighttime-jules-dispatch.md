---
description: Bulk dispatch tasks to Jules for overnight processing, review completed sessions, and merge results
---

# Nighttime Jules Dispatch Workflow

Use this workflow when you want to dispatch a large batch of tasks to Jules for asynchronous overnight processing.

## Prerequisites

- Jules CLI installed: `npm install -g @google/jules`
- Authenticated: `jules login`
- MCP workspace handshake completed

## Phase 1: Preparation

### 1.1 Ensure Branch is Synchronized

```bash
git status
git push origin <branch_name>
```

### 1.2 Check Current Jules Capacity

```bash
jules remote list --session 2>&1 | cat | grep -c "maraxen/pylabpraxis"
```

Jules can handle ~60 concurrent sessions per repository.

### 1.3 Review Existing Dispatches

```bash
# Check pending dispatches in MCP database
sqlite3 .agent/agent.db "SELECT COUNT(*) FROM dispatches WHERE target = 'jules' AND status = 'pending'"
```

## Phase 2: Task Identification

### 2.1 Review Sources for Tasks

1. **Technical Debt**: `.agent/TECHNICAL_DEBT.md`
2. **Development Matrix**: `.agent/DEVELOPMENT_MATRIX.md`
3. **Backlog Files**: `.agent/backlog/*.md`
4. **Research Gaps**: `.agent/research/`

### 2.2 Categorize Tasks by Type

| Type | Examples | Jules Fit |
|------|----------|-----------|
| **Research** | Architecture analysis, feasibility studies | ✅ Good |
| **Audit** | Lint errors, type coverage, dependency check | ✅ Good |
| **Documentation** | JSDoc, README updates, guides | ✅ Good |
| **Tests** | Unit tests, E2E tests, test utilities | ✅ Good |
| **Implementation** | Bug fixes, small features | ⚠️ Atomic only |
| **Refactoring** | Large-scale changes | ❌ Avoid |

### 2.3 Create Dispatches via MCP

Use the `dispatch` tool with target `jules`:

```
mcp_orbitalvelocity_dispatch({
  target: "jules",
  prompt: "## Task: [Title]\n\n**CRITICAL: Ensure you complete your work on the `<branch_name>` branch.**\n\n**Files**: ...\n\n**Requirements**:\n1. ...\n\n**Acceptance Criteria**:\n- ..."
})
```

**Key prompt elements**:

- Always include branch instruction: "Ensure you complete your work on the `<branch>` branch"
- Specify exact file paths
- Include acceptance criteria with verifiable commands
- Keep scope atomic (1-3 files preferred)

## Phase 3: Batch Submission

### 3.1 Submit Pending Dispatches to Jules

// turbo

```bash
python3 .agent/scripts/submit_jules.py 2>&1
```

This script:

- Reads pending `jules` dispatches from the MCP database
- Submits each to Jules via CLI
- Updates dispatch status to `running`
- Records Jules session IDs

### 3.2 Verify Submission

```bash
jules remote list --session 2>&1 | cat | head -30
```

## Phase 4: Morning Review

### 4.1 Check Completed Sessions

```bash
jules remote list --session 2>&1 | cat | grep "Completed"
```

### 4.2 Review Each Completed Session

For each completed session, review before applying:

```bash
# Preview the diff (DO NOT auto-apply)
jules remote pull --session <session_id> 2>&1 | head -100
```

**Review checklist**:

- [ ] Changes are on correct branch
- [ ] Diff looks reasonable
- [ ] No unexpected file modifications
- [ ] Acceptance criteria would be met

### 4.3 Apply Good Sessions

```bash
jules remote pull --session <session_id> --apply 2>&1
```

### 4.4 Handle Failed/Partial Sessions

For sessions that failed or produced incorrect output:

1. Note what went wrong
2. Create improved dispatch with better specification
3. Include the failure context in the new prompt

### 4.5 Update Dispatch Statuses

```bash
sqlite3 .agent/agent.db "UPDATE dispatches SET status = 'completed', result = 'Applied: <description>' WHERE claimed_by LIKE '%<session_id>%'"
```

## Phase 5: Commit and Push

### 5.1 Stage Applied Changes

```bash
git add .agent/ <other_files>
git status
```

### 5.2 Create Atomic Commit

```bash
git commit -m "docs(agent): integrate Jules-generated content

- List of applied changes
- Generated by Jules AI, reviewed and applied locally"
```

### 5.3 Push to Remote

```bash
git push origin <branch_name>
```

## Useful Commands Reference

```bash
# List all pylabpraxis sessions
jules remote list --session 2>&1 | cat | grep "maraxen/pylabpraxis"

# Count sessions by status
jules remote list --session 2>&1 | cat | grep -c "Completed"
jules remote list --session 2>&1 | cat | grep -c "In Progress"
jules remote list --session 2>&1 | cat | grep -c "Planning"

# Get pending MCP dispatches
sqlite3 .agent/agent.db "SELECT id, prompt_preview FROM dispatches WHERE target = 'jules' AND status = 'pending'"

# Update dispatch after manual handling
sqlite3 .agent/agent.db "UPDATE dispatches SET status = 'failed', result = 'Reason' WHERE id = '<dispatch_id>'"
```

## Task Template

```markdown
## Task: [Clear Action Title]

**CRITICAL: Ensure you complete your work on the `angular_refactor` branch.**

**Files**: 
- `path/to/file1.ts`
- `path/to/file2.ts`

**Context**: Brief explanation of why this task exists.

**Requirements**:
1. Specific requirement with clear outcome
2. Another requirement
3. DO NOT: Anti-requirement (what to avoid)

**Acceptance Criteria**:
- Command that proves success: `npm run lint`
- Another verifiable criterion
```

## Notes

- Jules works on its own clone of the repo in a cloud VM
- Sessions default to the repository's default branch unless specified
- Always include explicit branch instructions in prompts
- Review all diffs before applying - Jules can make mistakes
- Failed patches often mean the file structure differs between branches
