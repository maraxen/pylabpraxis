# Simulation Engine & Python Execution Investigation

## 1. Python Execution Errors

### SyntaxError: multiple statements found while compiling a single statement
**Source:** `praxis/web-client/src/app/core/workers/python.worker.ts` executing code from `ExecutionService`.

**Analysis:**
The `ExecutionService` constructs a complete Python script (lines 330-374 in `execution.service.ts`) containing imports, parameter deserialization, and execution logic. This script is sent to `PythonRuntimeService`, which forwards it to `python.worker.ts`.

In `python.worker.ts`, the `executePush` function (lines 255-323) splits the incoming code by newline and pushes it line-by-line to `pyConsole`:
```typescript
const lines = code.split('\n');
for (let i = 0; i < lines.length; i++) {
  const line = lines[i];
  // ... pyConsole.push(line)
}
```
The `SyntaxError: multiple statements found...` occurs because `PyodideConsole.push` behaves like an interactive interpreter (compiling with `mode='single'`). If the split logic sends a block that is interpreted as having multiple statements in a single interactive command (or if the script structure is incompatible with line-by-line feeding), this error is raised.

**Recommendation:**
Refactor `python.worker.ts` to support a non-interactive execution mode (using `pyodide.runPython` or `exec()` with `mode='exec'`) for scripts sent by `ExecutionService`.

### LiquidHandler Missing Arguments
**Source:** `praxis/web-client/src/app/features/playground/playground.component.ts` and `web_bridge.py`.

**Analysis:**
1.  **Playground Generation:** In `playground.component.ts` (line 1009), the `LiquidHandler` instantiation code is generated as:
    ```typescript
    `${varName} = LiquidHandler(backend=${varName}_backend)`
    ```
    This is missing the `deck` argument, which is required in recent PyLabRobot versions.
2.  **Parameter Resolution:** In `praxis/web-client/src/assets/python/web_bridge.py`, the `resolve_parameters` function handles instantiation of `Plate` and `TipRack` but has no logic for `LiquidHandler`. If a protocol requires a `LiquidHandler` instance as a parameter, it receives a raw dictionary/string instead.

**Recommendation:**
1.  Update `playground.component.ts` to include the `deck` argument in generated code.
2.  Update `web_bridge.py` to handle `LiquidHandler` instantiation in `resolve_parameters`.

## 2. Browser Import Error ("import praxis")

**Source:** `praxis/web-client/src/app/features/run-protocol/services/execution.service.ts`.

**Analysis:**
The browser simulation attempts to import the protocol using:
```python
from ${moduleName} import ${functionName}
```
However, the `praxis` python package is not installed in the Pyodide environment. `python.worker.ts` (line 175) only installs `['jedi', 'pylabrobot']`. No wheel for `praxis` exists in `src/assets/wheels`.

**Recommendation:**
Build a wheel for the `praxis` python package and ensure it is loaded in `python.worker.ts`, or mock the package in the browser environment if full functionality is not required.

## 3. Fake Data (Protocol Execution Monitor)

**Source:** `praxis/web-client/src/app/core/services/simulation-results.service.ts`.

**Analysis:**
The "Protocol Execution Monitor" data is being generated by `createMockStateHistory` (lines 186-251) in `SimulationResultsService`. This method generates deterministic fake operations (pick_up_tips, aspirate, dispense) and hardcoded state snapshots.

Additional mock data sources:
*   `praxis/web-client/src/app/core/interceptors/browser-mode.interceptor.ts`: Intercepts API calls and returns mock responses for runs, machines, and discovery.
*   `praxis/web-client/src/assets/browser-data/`: Contains static JSON-like TS files for mock resources and machines.
