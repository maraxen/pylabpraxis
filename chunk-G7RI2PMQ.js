import{c as R}from"./chunk-PWVAMWZ2.js";import{a as d}from"./chunk-O2OSWUJ6.js";import{a as h,c as w}from"./chunk-FGBSBVHW.js";import{e as q}from"./chunk-SKMC2KSJ.js";import{I as n,Y as l,h as g,ha as v,ma as m,r as i,w as s}from"./chunk-ZXFVGPYG.js";import{a as c}from"./chunk-RNQFGQA5.js";var M=class S{apiWrapper=m(w);modeService=m(R);sqliteService=m(q);getInferredRequirements(t){return this.modeService.isBrowserMode()?this.getRequirementsFromBrowserMode(t):this.apiWrapper.wrap(d.getApiV1ProtocolsDefinitionsAccessionIdGet(t)).pipe(s(e=>e.properties_json?.inferred_requirements||[]),n(e=>(console.error("[SimulationResults] Error fetching requirements:",e),i([]))))}getFailureModes(t){return this.modeService.isBrowserMode()?this.getFailureModesFromBrowserMode(t):this.apiWrapper.wrap(d.getApiV1ProtocolsDefinitionsAccessionIdGet(t)).pipe(s(e=>e.properties_json?.failure_modes||[]),n(e=>(console.error("[SimulationResults] Error fetching failure modes:",e),i([]))))}getSimulationResult(t){return this.modeService.isBrowserMode()?this.getSimulationResultFromBrowserMode(t):this.apiWrapper.wrap(d.getApiV1ProtocolsDefinitionsAccessionIdGet(t)).pipe(s(e=>e.properties_json?.simulation_result||null),n(e=>(console.error("[SimulationResults] Error fetching simulation result:",e),i(null))))}getStateHistory(t){return this.modeService.isBrowserMode()?this.getStateHistoryFromBrowserMode(t):new g(e=>{fetch(`${h.BASE}/api/v1/protocols/runs/${t}/state-history`,{headers:c({Accept:"application/json"},h.HEADERS)}).then(r=>{if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}).then(r=>{e.next(r),e.complete()}).catch(r=>{console.error("[SimulationResults] Error fetching state history:",r),e.next(null),e.complete()})})}hasSimulationData(t){return this.getSimulationResult(t).pipe(s(e=>e!==null))}getRequirementsFromBrowserMode(t){return this.sqliteService.isReady$.pipe(l(e=>e?this.sqliteService.getProtocolSimulationData(t).pipe(s(r=>r?.inferred_requirements||[])):i([])),n(()=>i([])))}getFailureModesFromBrowserMode(t){return this.sqliteService.isReady$.pipe(l(e=>e?this.sqliteService.getProtocolSimulationData(t).pipe(s(r=>r?.failure_modes||[])):i([])),n(()=>i([])))}getSimulationResultFromBrowserMode(t){return this.sqliteService.isReady$.pipe(l(e=>e?this.sqliteService.getProtocolSimulationData(t).pipe(s(r=>r?.simulation_result||null)):i(null)),n(()=>i(null)))}getStateHistoryFromBrowserMode(t){return this.sqliteService.isReady$.pipe(l(e=>e?this.sqliteService.getRunStateHistory(t):i(null)),n(()=>i(null)))}createMockStateHistory(t,e=10){let r=[],u=!1,p=0,f={A1:500,A2:500,A3:500},_=[{method:"pick_up_tips",resource:"tip_rack"},{method:"aspirate",resource:"source_plate"},{method:"dispense",resource:"dest_plate"},{method:"aspirate",resource:"source_plate"},{method:"dispense",resource:"dest_plate"},{method:"drop_tips",resource:"tip_rack"}];for(let o=0;o<e&&o<_.length;o++){let{method:a,resource:b}=_[o],y={tips:{tips_loaded:u,tips_count:p},liquids:{source_plate:c({},f)},on_deck:["tip_rack","source_plate","dest_plate"]};a==="pick_up_tips"?(u=!0,p=8):a==="drop_tips"?(u=!1,p=0):a==="aspirate"&&(f.A1-=50);let A={tips:{tips_loaded:u,tips_count:p},liquids:{source_plate:c({},f)},on_deck:["tip_rack","source_plate","dest_plate"]};r.push({operation_index:o,operation_id:`op_${o}`,method_name:a,resource:b,state_before:y,state_after:A,timestamp:new Date(Date.now()+o*1e3).toISOString(),duration_ms:500+Math.random()*1e3,status:"completed"})}return{run_id:t,protocol_name:"Mock Protocol",operations:r,final_state:r.length>0?r[r.length-1].state_after:{tips:{tips_loaded:!1,tips_count:0},liquids:{},on_deck:[]},total_duration_ms:r.reduce((o,a)=>o+(a.duration_ms||0),0)}}static \u0275fac=function(e){return new(e||S)};static \u0275prov=v({token:S,factory:S.\u0275fac,providedIn:"root"})};export{M as a};
