import{c as M}from"./chunk-PWVAMWZ2.js";import{a as g}from"./chunk-GX2D2L2X.js";import{a as s,b as a,c as P}from"./chunk-FGBSBVHW.js";import{e as T}from"./chunk-SKMC2KSJ.js";import{L as b,Y as v,ha as D,ma as f,v as E,w as c}from"./chunk-ZXFVGPYG.js";import{a as _,b as h}from"./chunk-RNQFGQA5.js";var I=class d{sqlite=f(T);HAMILTON_STAR_RAIL_SPACING=22.5;HAMILTON_STAR_RAIL_OFFSET=100;STANDARD_CARRIER_RAIL_SPAN=6;getDeckDefinition(e){return e?e==="pylabrobot.resources.hamilton.HamiltonSTARDeck"||e==="HamiltonSTARDeck"||e.includes("HamiltonSTARDeck")?this.getHamiltonSTARSpec():e==="pylabrobot.resources.hamilton.STARlet.STARLetDeck"||e==="STARLetDeck"||e.includes("STARLet")?this.getHamiltonSTARLetSpec():e==="pylabrobot.resources.hamilton.Vantage.VantageDeck"||e==="VantageDeck"||e.includes("Vantage")?this.getVantageSpec():e.includes("Hamilton")||e.includes("STAR")?this.getHamiltonSTARSpec():e==="pylabrobot.resources.opentrons.deck.OTDeck"||e==="OTDeck"||e.includes("OT2")||e.includes("OT-2")||e.toLowerCase().includes("opentrons")?this.getOTDeckSpec():null:null}getDeckTypeForMachine(e){if(!e)return null;let n=e.backend_definition?.name?.toLowerCase()||"",i=e.backend_definition?.fqn?.toLowerCase()||"";if(n.includes("ot-2")||n.includes("ot2")||i.includes("opentrons.ot2")||n.includes("flex")||i.includes("opentrons.flex"))return"pylabrobot.resources.opentrons.deck.OTDeck";let r=e.machine_category||e.machine_type||"",t=e.model||"",o=(e.manufacturer||"").toLowerCase();if(r.includes("Hamilton")||r.includes("STAR")||t.includes("STAR")||o.includes("hamilton"))return"pylabrobot.resources.hamilton.HamiltonSTARDeck";if(r.includes("Opentrons")||r.includes("OT")||t.includes("OT")||o.includes("opentrons"))return"pylabrobot.resources.opentrons.deck.OTDeck";let u=((e.connection_info||{}).backend||"").toString();return u.includes("hamilton.STAR")||u.includes("HamiltonDeck")?"pylabrobot.resources.hamilton.HamiltonSTARDeck":u.includes("opentrons.OT2")||u.includes("OTDeck")?"pylabrobot.resources.opentrons.deck.OTDeck":null}getCompatibleCarriers(e){return e?e.includes("Hamilton")||e.includes("STAR")||e.includes("Vantage")?this.getHamiltonCarriers():[]:[]}loadDeckDefinitions(){return this.sqlite.deckDefinitions.pipe(b(1),c(e=>e.findAll().filter(i=>i.fqn&&i.name).map(i=>({fqn:i.fqn,name:i.name})).sort((i,r)=>i.name.localeCompare(r.name))))}saveUserDeckConfiguration(e,n){return this.sqlite.deckDefinitions.pipe(b(1),c(i=>{let r=new Date().toISOString(),t={accession_id:crypto.randomUUID(),name:n,fqn:`deck_config.user.${n.replace(/\s+/g,"_").toLowerCase()}`,description:`User defined deck configuration for ${e.deckName}`,created_at:r,updated_at:r,properties_json:{is_user_config:!0,base_deck_fqn:e.deckType,configuration:e}};return i.create(t)}))}getUserDeckConfigurations(){return this.sqlite.deckDefinitions.pipe(b(1),c(e=>e.findAll().filter(i=>{let r=i.properties_json;return r&&r.is_user_config===!0}).map(i=>({id:i.accession_id,name:i.name,config:i.properties_json.configuration}))))}getUserConfigsForMachine(e){return this.sqlite.deckDefinitions.pipe(b(1),c(n=>n.findAll().filter(r=>{let t=r.properties_json;if(!t||!t.is_user_config)return!1;let o=t.base_deck_fqn;return!!(e.includes("Hamilton")&&o.includes("Hamilton")||e.includes("OT")&&o.includes("OT"))}).map(r=>({id:r.accession_id,name:r.name,config:r.properties_json.configuration}))))}getHamiltonSTARSpec(){let n=[];for(let i=0;i<30;i++)n.push(this.HAMILTON_STAR_RAIL_OFFSET+i*this.HAMILTON_STAR_RAIL_SPACING);return{fqn:"pylabrobot.resources.hamilton.HamiltonSTARDeck",name:"Hamilton STAR Deck",manufacturer:"Hamilton",layoutType:"rail-based",numRails:30,railSpacing:this.HAMILTON_STAR_RAIL_SPACING,railPositions:n,compatibleCarriers:["pylabrobot.resources.ml_star.plt_car_l5ac","pylabrobot.resources.ml_star.tip_car_480","pylabrobot.resources.ml_star.rgt_car_3r"],dimensions:{width:1200,height:653.5,depth:500}}}getHamiltonSTARLetSpec(){let n=[];for(let i=0;i<20;i++)n.push(this.HAMILTON_STAR_RAIL_OFFSET+i*this.HAMILTON_STAR_RAIL_SPACING);return{fqn:"pylabrobot.resources.hamilton.STARlet.STARLetDeck",name:"Hamilton STARLet Deck",manufacturer:"Hamilton",layoutType:"rail-based",numRails:20,railSpacing:this.HAMILTON_STAR_RAIL_SPACING,railPositions:n,compatibleCarriers:["pylabrobot.resources.ml_star.plt_car_l5ac","pylabrobot.resources.ml_star.tip_car_480","pylabrobot.resources.ml_star.rgt_car_3r"],dimensions:{width:800,height:653.5,depth:500}}}getVantageSpec(){let n=[];for(let i=0;i<40;i++)n.push(this.HAMILTON_STAR_RAIL_OFFSET+i*this.HAMILTON_STAR_RAIL_SPACING);return{fqn:"pylabrobot.resources.hamilton.Vantage.VantageDeck",name:"Hamilton Vantage Deck",manufacturer:"Hamilton",layoutType:"rail-based",numRails:40,railSpacing:this.HAMILTON_STAR_RAIL_SPACING,railPositions:n,compatibleCarriers:["pylabrobot.resources.ml_star.plt_car_l5ac","pylabrobot.resources.ml_star.tip_car_480"],dimensions:{width:1600,height:750,depth:600}}}getOTDeckSpec(){return{fqn:"pylabrobot.resources.opentrons.deck.OTDeck",name:"Opentrons OT-2 Deck",manufacturer:"Opentrons",layoutType:"slot-based",numSlots:12,slots:[{slotNumber:1,label:"1",slotType:"standard",position:{x:0,y:0,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:2,label:"2",slotType:"standard",position:{x:132.5,y:0,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:3,label:"3",slotType:"standard",position:{x:265,y:0,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:4,label:"4",slotType:"standard",position:{x:0,y:90.5,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:5,label:"5",slotType:"standard",position:{x:132.5,y:90.5,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:6,label:"6",slotType:"standard",position:{x:265,y:90.5,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:7,label:"7",slotType:"standard",position:{x:0,y:181,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:8,label:"8",slotType:"standard",position:{x:132.5,y:181,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:9,label:"9",slotType:"standard",position:{x:265,y:181,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:10,label:"10",slotType:"standard",position:{x:0,y:271.5,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:11,label:"11",slotType:"standard",position:{x:132.5,y:271.5,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Plate","TipRack","Trough","Reservoir","TubeRack"]},{slotNumber:12,label:"Trash",slotType:"trash",position:{x:265,y:271.5,z:0},dimensions:{width:127.76,height:85.48},compatibleResourceTypes:["Trash"]}],dimensions:{width:624.3,height:565.2,depth:900}}}createPlrResourceFromSpec(e){let n={name:"deck",type:e.fqn,location:{x:0,y:0,z:0,type:"Coordinate"},size_x:e.dimensions.width,size_y:e.dimensions.height,size_z:e.dimensions.depth,children:[]};return e.numRails&&(n.num_rails=e.numRails),e.layoutType==="slot-based"&&e.slots&&e.slots.forEach(i=>{(i.slotType==="trash"||i.slotType==="module")&&n.children.push({name:i.label,type:i.slotType==="trash"?"Trash":"Resource",location:{x:i.position.x,y:i.position.y,z:i.position.z,type:"Coordinate"},size_x:i.dimensions.width,size_y:i.dimensions.height,size_z:10,children:[],slot_id:i.slotNumber.toString()})}),n}createPlrResourceFromConfig(e){let n=this.getDeckDefinition(e.deckType),i=n?this.createPlrResourceFromSpec(n):{name:e.deckName,type:e.deckType,location:{x:0,y:0,z:0,type:"Coordinate"},size_x:e.dimensions.width,size_y:e.dimensions.height,size_z:e.dimensions.depth,children:[]};return e.carriers.forEach(r=>{let t=0,o=63,p=100;if(n?.layoutType==="rail-based"){let l=e.rails.find(m=>m.index===r.railPosition);l?t=l.xPosition:t=this.HAMILTON_STAR_RAIL_OFFSET+r.railPosition*this.HAMILTON_STAR_RAIL_SPACING}else if(n?.layoutType==="slot-based"&&n.slots){let l=n.slots.find(m=>m.slotNumber===r.railPosition);l&&(t=l.position.x,o=l.position.y,p=l.position.z)}let u={name:r.id,type:r.fqn,location:{x:t,y:o,z:p,type:"Coordinate"},size_x:r.dimensions.width,size_y:r.dimensions.height,size_z:r.dimensions.depth,children:[]};r.slots.forEach(l=>{let m={name:l.id,type:"Site",location:l.position,size_x:l.dimensions.width,size_y:l.dimensions.height,size_z:10,children:[]};if(l.resource){let L={name:l.resource.name,type:l.resource.type,location:{x:0,y:0,z:0,type:"Coordinate"},size_x:l.dimensions.width,size_y:l.dimensions.height,size_z:l.resource.size_z||15,children:[]};m.children.push(L)}u.children.push(m)}),i.children.push(u)}),i}createDeckConfiguration(e){let n=this.createRailsFromSpec(e);return{deckType:e.fqn,deckName:e.name,rails:n,carriers:[],dimensions:e.dimensions,numRails:e.numRails||0}}createCarrierFromDefinition(e,n,i){let r=this.createSlotsForCarrier(e,n);return{id:n,fqn:e.fqn,name:e.name,type:e.type,railPosition:i,railSpan:e.railSpan,slots:r,dimensions:e.dimensions}}createRailsFromSpec(e){let n=[],i=e.railPositions||this.calculateRailPositions(e);for(let r=0;r<(e.numRails||0);r++)n.push({index:r,xPosition:i[r],width:e.railSpacing||0,compatibleCarrierTypes:e.compatibleCarriers||[]});return n}calculateRailPositions(e){let n=[],i=e.numRails||0,r=e.railSpacing||22.5;for(let t=0;t<i;t++)n.push(this.HAMILTON_STAR_RAIL_OFFSET+t*r);return n}createSlotsForCarrier(e,n){let i=[],r=e.dimensions.height/e.numSlots;for(let t=0;t<e.numSlots;t++)i.push({id:`${n}_slot_${t}`,index:t,name:`Position ${t+1}`,compatibleResourceTypes:e.compatibleResourceTypes,occupied:!1,resource:null,position:{x:10,y:10+t*r,z:0},dimensions:{width:e.dimensions.width-20,height:r-10}});return i}getHamiltonCarriers(){return[{fqn:"pylabrobot.resources.ml_star.plt_car_l5ac",name:"Plate Carrier L5AC",type:"plate",railSpan:this.STANDARD_CARRIER_RAIL_SPAN,numSlots:5,compatibleResourceTypes:["Plate","Microplate","WellPlate","Lid"],dimensions:{width:135,height:497,depth:10}},{fqn:"pylabrobot.resources.ml_star.tip_car_480",name:"Tip Carrier 480",type:"tip",railSpan:this.STANDARD_CARRIER_RAIL_SPAN,numSlots:5,compatibleResourceTypes:["TipRack","NestedTipRack"],dimensions:{width:135,height:497,depth:10}},{fqn:"pylabrobot.resources.ml_star.rgt_car_3r",name:"Reagent Carrier 3R",type:"trough",railSpan:this.STANDARD_CARRIER_RAIL_SPAN,numSlots:3,compatibleResourceTypes:["Trough","Reservoir"],dimensions:{width:135,height:497,depth:10}},{fqn:"pylabrobot.resources.ml_star.tube_car_24",name:"Tube Carrier 24",type:"tube",railSpan:this.STANDARD_CARRIER_RAIL_SPAN,numSlots:6,compatibleResourceTypes:["TubeRack","Tube"],dimensions:{width:135,height:497,depth:10}},{fqn:"pylabrobot.resources.ml_star.mfx_car_l5",name:"MFX Carrier L5",type:"mfx",railSpan:this.STANDARD_CARRIER_RAIL_SPAN,numSlots:5,compatibleResourceTypes:["Plate","TipRack","Trough"],dimensions:{width:135,height:497,depth:10}}]}static \u0275fac=function(n){return new(n||d)};static \u0275prov=D({token:d,factory:d.\u0275fac,providedIn:"root"})};var q=new Set(["LiquidHandler","PlateReader","HeaterShaker","Shaker","TemperatureController","Centrifuge","Thermocycler","Pump","Incubator"]);function w(d){if(d.plr_category&&d.plr_category!==""&&d.plr_category!=="Other"&&d.plr_category!=="null")return d.plr_category;if(d.resource_type&&d.resource_type!=="")return d.resource_type;if(d.fqn){let e=d.fqn.toLowerCase();if(e.includes("plate")&&!e.includes("carrier")&&!e.includes("reader"))return"Plate";if(e.includes("tip_rack")||e.includes("tiprack"))return"TipRack";if(e.includes("trough")||e.includes("reservoir"))return"Trough";if(e.includes("carrier"))return"Carrier";if(e.includes("tube")&&!e.includes("rack"))return"Tube";if(e.includes("tuberack")||e.includes("tube")&&e.includes("rack"))return"TubeRack";if(e.includes("lid"))return"Lid";if(e.includes("trash"))return"Trash"}return"Other"}var y=class{static listFrontendDefinitionsApiV1MachineFrontendsGet(e,n=100){return a(s,{method:"GET",url:"/api/v1/machine-frontends/",query:{skip:e,limit:n},errors:{422:"Validation Error"}})}static createFrontendDefinitionApiV1MachineFrontendsPost(e){return a(s,{method:"POST",url:"/api/v1/machine-frontends/",body:e,mediaType:"application/json",errors:{422:"Validation Error"}})}static getFrontendDefinitionApiV1MachineFrontendsAccessionIdGet(e){return a(s,{method:"GET",url:"/api/v1/machine-frontends/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static updateFrontendDefinitionApiV1MachineFrontendsAccessionIdPut(e,n){return a(s,{method:"PUT",url:"/api/v1/machine-frontends/{accession_id}",path:{accession_id:e},body:n,mediaType:"application/json",errors:{422:"Validation Error"}})}static deleteFrontendDefinitionApiV1MachineFrontendsAccessionIdDelete(e){return a(s,{method:"DELETE",url:"/api/v1/machine-frontends/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static getCompatibleBackendsApiV1MachineFrontendsAccessionIdBackendsGet(e){return a(s,{method:"GET",url:"/api/v1/machine-frontends/{accession_id}/backends",path:{accession_id:e},errors:{422:"Validation Error"}})}};var k=class{static listBackendDefinitionsApiV1MachineBackendsGet(e,n=100){return a(s,{method:"GET",url:"/api/v1/machine-backends/",query:{skip:e,limit:n},errors:{422:"Validation Error"}})}static createBackendDefinitionApiV1MachineBackendsPost(e){return a(s,{method:"POST",url:"/api/v1/machine-backends/",body:e,mediaType:"application/json",errors:{422:"Validation Error"}})}static getBackendDefinitionApiV1MachineBackendsAccessionIdGet(e){return a(s,{method:"GET",url:"/api/v1/machine-backends/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static updateBackendDefinitionApiV1MachineBackendsAccessionIdPut(e,n){return a(s,{method:"PUT",url:"/api/v1/machine-backends/{accession_id}",path:{accession_id:e},body:n,mediaType:"application/json",errors:{422:"Validation Error"}})}static deleteBackendDefinitionApiV1MachineBackendsAccessionIdDelete(e){return a(s,{method:"DELETE",url:"/api/v1/machine-backends/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}};var R=class{static createApiV1ResourcesPost(e){return a(s,{method:"POST",url:"/api/v1/resources/",body:e,mediaType:"application/json",errors:{422:"Validation Error"}})}static getMultiApiV1ResourcesGet(e=100,n,i,r,t,o,p,u,l,m){return a(s,{method:"GET",url:"/api/v1/resources/",query:{limit:e,offset:n,sort_by:i,date_range_start:r,date_range_end:t,protocol_run_accession_id:o,machine_accession_id:p,resource_accession_id:u,parent_accession_id:l},body:m,mediaType:"application/json",errors:{422:"Validation Error"}})}static getApiV1ResourcesAccessionIdGet(e){return a(s,{method:"GET",url:"/api/v1/resources/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static updateApiV1ResourcesAccessionIdPut(e,n){return a(s,{method:"PUT",url:"/api/v1/resources/{accession_id}",path:{accession_id:e},body:n,mediaType:"application/json",errors:{422:"Validation Error"}})}static deleteApiV1ResourcesAccessionIdDelete(e){return a(s,{method:"DELETE",url:"/api/v1/resources/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}};var A=class{static getResourceDefinitionFacetsApiV1ResourcesDefinitionsFacetsGet(e,n,i,r){return a(s,{method:"GET",url:"/api/v1/resources/definitions/facets",query:{plr_category:e,vendor:n,num_items:i,plate_type:r},errors:{422:"Validation Error"}})}static createApiV1ResourcesDefinitionsPost(e){return a(s,{method:"POST",url:"/api/v1/resources/definitions",body:e,mediaType:"application/json",errors:{422:"Validation Error"}})}static getMultiApiV1ResourcesDefinitionsGet(e=100,n,i,r,t,o,p,u,l,m){return a(s,{method:"GET",url:"/api/v1/resources/definitions",query:{limit:e,offset:n,sort_by:i,date_range_start:r,date_range_end:t,protocol_run_accession_id:o,machine_accession_id:p,resource_accession_id:u,parent_accession_id:l},body:m,mediaType:"application/json",errors:{422:"Validation Error"}})}static getApiV1ResourcesDefinitionsAccessionIdGet(e){return a(s,{method:"GET",url:"/api/v1/resources/definitions/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static updateApiV1ResourcesDefinitionsAccessionIdPut(e,n){return a(s,{method:"PUT",url:"/api/v1/resources/definitions/{accession_id}",path:{accession_id:e},body:n,mediaType:"application/json",errors:{422:"Validation Error"}})}static deleteApiV1ResourcesDefinitionsAccessionIdDelete(e){return a(s,{method:"DELETE",url:"/api/v1/resources/definitions/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static createApiV1ResourcesPost(e){return a(s,{method:"POST",url:"/api/v1/resources/",body:e,mediaType:"application/json",errors:{422:"Validation Error"}})}static getMultiApiV1ResourcesGet(e=100,n,i,r,t,o,p,u,l,m){return a(s,{method:"GET",url:"/api/v1/resources/",query:{limit:e,offset:n,sort_by:i,date_range_start:r,date_range_end:t,protocol_run_accession_id:o,machine_accession_id:p,resource_accession_id:u,parent_accession_id:l},body:m,mediaType:"application/json",errors:{422:"Validation Error"}})}static getApiV1ResourcesAccessionIdGet(e){return a(s,{method:"GET",url:"/api/v1/resources/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static updateApiV1ResourcesAccessionIdPut(e,n){return a(s,{method:"PUT",url:"/api/v1/resources/{accession_id}",path:{accession_id:e},body:n,mediaType:"application/json",errors:{422:"Validation Error"}})}static deleteApiV1ResourcesAccessionIdDelete(e){return a(s,{method:"DELETE",url:"/api/v1/resources/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}};var C=class{static syncAllDefinitionsApiV1DiscoverySyncAllPost(){return a(s,{method:"POST",url:"/api/v1/discovery/sync-all"})}};var S=class{static createApiV1WorkcellPost(e){return a(s,{method:"POST",url:"/api/v1/workcell/",body:e,mediaType:"application/json",errors:{422:"Validation Error"}})}static getMultiApiV1WorkcellGet(e=100,n,i,r,t,o,p,u,l,m){return a(s,{method:"GET",url:"/api/v1/workcell/",query:{limit:e,offset:n,sort_by:i,date_range_start:r,date_range_end:t,protocol_run_accession_id:o,machine_accession_id:p,resource_accession_id:u,parent_accession_id:l},body:m,mediaType:"application/json",errors:{422:"Validation Error"}})}static getApiV1WorkcellAccessionIdGet(e){return a(s,{method:"GET",url:"/api/v1/workcell/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}static updateApiV1WorkcellAccessionIdPut(e,n){return a(s,{method:"PUT",url:"/api/v1/workcell/{accession_id}",path:{accession_id:e},body:n,mediaType:"application/json",errors:{422:"Validation Error"}})}static deleteApiV1WorkcellAccessionIdDelete(e){return a(s,{method:"DELETE",url:"/api/v1/workcell/{accession_id}",path:{accession_id:e},errors:{422:"Validation Error"}})}};var B=class d{modeService=f(M);sqliteService=f(T);apiWrapper=f(P);API_URL="/api/v1";getMachines(){return this.modeService.isBrowserMode()?(console.debug("[ASSET-DEBUG] getMachines: Browser mode, querying SqliteService.machines"),this.sqliteService.machines.pipe(c(e=>{let n=e.findAll();return console.debug("[ASSET-DEBUG] getMachines: Found",n.length,"machines in DB",n),n.map(i=>h(_({},i),{status:i.status||"OFFLINE",machine_type:i.machine_category,name:i.name||"Unknown",fqn:i.fqn||""}))}))):this.apiWrapper.wrap(g.getMultiApiV1MachinesGet()).pipe(c(e=>e.map(n=>n)))}createMachine(e){return console.debug("[ASSET-DEBUG] createMachine called with:",e),this.modeService.isBrowserMode()?(console.debug("[ASSET-DEBUG] createMachine: Browser mode, creating via SqliteService"),this.sqliteService.machines.pipe(v(async n=>{let i=e.is_simulation_override||!!e.simulation_backend_name,r=Math.random().toString(36).substring(2,9),t=i?`SIM-${Date.now()}-${r}`:`SN-${r.toUpperCase()}`,o={status:"idle",location:"Unknown",maintenance_enabled:!1,maintenance_schedule_json:{intervals:[],enabled:!1},is_simulated:!1,serial_number:t,firmware_version:"0.0.0"},p=h(_(_({},o),e),{accession_id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString(),asset_type:"MACHINE",fqn:`machines.${e.name.replace(/\s+/g,"_").toLowerCase()}`,machine_category:e.machine_category||e.machine_type||"unknown"});return console.debug("[ASSET-DEBUG] createMachine: Calling repo.create with:",p),n.create(p),await this.sqliteService.save(),console.debug("[ASSET-DEBUG] createMachine: Machine created and saved to store"),p}))):this.apiWrapper.wrap(g.createApiV1MachinesPost(e)).pipe(c(n=>n))}deleteMachine(e){return this.modeService.isBrowserMode()?this.sqliteService.machines.pipe(c(n=>{n.delete(e)})):this.apiWrapper.wrap(g.deleteApiV1MachinesAccessionIdDelete(e))}updateMachine(e,n){if(this.modeService.isBrowserMode())throw new Error("Update machine not implemented for browser mode");return this.apiWrapper.wrap(g.updateApiV1MachinesAccessionIdPut(e,n)).pipe(c(i=>i))}getResources(){return this.modeService.isBrowserMode()?(console.debug("[ASSET-DEBUG] getResources: Browser mode, querying SqliteService.resources"),this.sqliteService.resources.pipe(c(e=>{let n=e.findAll();return console.debug("[ASSET-DEBUG] getResources: Found",n.length,"resources in DB",n),n.map(i=>h(_({},i),{status:i.status||"available",name:i.name||"Unknown",fqn:i.fqn||""}))}))):this.apiWrapper.wrap(R.getMultiApiV1ResourcesGet()).pipe(c(e=>e.map(n=>n)))}createResource(e){return console.debug("[ASSET-DEBUG] createResource called with:",e),this.modeService.isBrowserMode()?(console.debug("[ASSET-DEBUG] createResource: Browser mode, creating via SqliteService"),this.sqliteService.resources.pipe(v(async n=>{let i=h(_({},e),{accession_id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString(),status:"available",asset_type:"RESOURCE",fqn:`resources.${e.name.replace(/\s+/g,"_").toLowerCase()}`});return console.debug("[ASSET-DEBUG] createResource: Calling repo.create with:",i),n.create(i),await this.sqliteService.save(),console.debug("[ASSET-DEBUG] createResource: Resource created and saved to store"),i}))):this.apiWrapper.wrap(R.createApiV1ResourcesPost(e)).pipe(c(n=>n))}deleteResource(e){return this.modeService.isBrowserMode()?this.sqliteService.resources.pipe(c(n=>{n.delete(e)})):this.apiWrapper.wrap(R.deleteApiV1ResourcesAccessionIdDelete(e))}getWorkcells(){return this.modeService.isBrowserMode()?this.sqliteService.workcells.pipe(c(e=>e.findAll().map(i=>h(_({},i),{status:i.status||"unknown"})))):this.apiWrapper.wrap(S.getMultiApiV1WorkcellGet()).pipe(c(e=>e.map(n=>n)))}getMachineDefinitions(){return this.modeService.isBrowserMode()?this.sqliteService.machineDefinitions.pipe(c(e=>{let n=e.findAll();return console.debug("[ASSET-DEBUG] getMachineDefinitions: Found",n.length,"definitions in DB"),n.map(i=>h(_({},i),{name:i.name||"Unknown Definition",compatible_backends:typeof i.compatible_backends=="string"?(()=>{try{return JSON.parse(i.compatible_backends)}catch{return[]}})():Array.isArray(i.compatible_backends)?i.compatible_backends:[]}))})):this.apiWrapper.wrap(g.getMultiApiV1MachinesDefinitionsGet(100)).pipe(c(e=>e.map(n=>n)))}getMachineFrontendDefinitions(){return this.modeService.isBrowserMode()?this.sqliteService.machineFrontendDefinitions.pipe(c(e=>e.findAll().map(i=>h(_({},i),{name:i.name||"Unknown Frontend"})))):this.apiWrapper.wrap(y.listFrontendDefinitionsApiV1MachineFrontendsGet(0,100)).pipe(c(e=>e.map(n=>n)))}getMachineBackendDefinitions(){return this.modeService.isBrowserMode()?this.sqliteService.machineBackendDefinitions.pipe(c(e=>e.findAll().map(i=>h(_({},i),{name:i.name||"Unknown Backend"})))):this.apiWrapper.wrap(k.listBackendDefinitionsApiV1MachineBackendsGet(0,100)).pipe(c(e=>e.map(n=>n)))}searchMachineDefinitions(e,n){return this.getMachineDefinitions().pipe(c(i=>i.filter(r=>(r.name.toLowerCase().includes(e.toLowerCase())||r.description?.toLowerCase().includes(e.toLowerCase())||r.manufacturer?.toLowerCase().includes(e.toLowerCase()))&&(!n||r.machine_category===n))))}getBackendsForFrontend(e){return this.modeService.isBrowserMode()?this.sqliteService.machineBackendDefinitions.pipe(c(n=>n.findByFrontend(e).map(r=>h(_({},r),{name:r.name||"Unknown Backend"})))):this.apiWrapper.wrap(y.getCompatibleBackendsApiV1MachineFrontendsAccessionIdBackendsGet(e)).pipe(c(n=>n.map(i=>i)))}getResourceDefinitions(e){return this.modeService.isBrowserMode()?this.sqliteService.resourceDefinitions.pipe(c(n=>{let i=n.findAll();return e&&(i=i.filter(r=>r.plr_category===e)),i.map(r=>h(_({},r),{name:r.name||"Unknown Definition"}))})):this.apiWrapper.wrap(A.getMultiApiV1ResourcesDefinitionsGet(100,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e?{search_filters:{plr_category:e}}:void 0)).pipe(c(n=>n.map(i=>i)))}searchResourceDefinitions(e,n){return this.getResourceDefinitions(n).pipe(c(i=>i.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())||r.description?.toLowerCase().includes(e.toLowerCase())||r.vendor?.toLowerCase().includes(e.toLowerCase()))))}async getResourceDefinition(e,n){if(this.modeService.isBrowserMode())try{let i=await E(this.sqliteService.resourceDefinitions),r=null;return e&&(r=i.findOneBy({fqn:e})),!r&&n&&(r=i.findBy({}).find(o=>o.name?.toLowerCase().includes(n.toLowerCase())||o.plr_category?.toLowerCase().includes(n.toLowerCase()))||null),r?h(_({},r),{is_consumable:r.is_consumable??!1}):null}catch(i){return console.warn("Sqlite lookup failed",i),null}else try{let i=await E(this.getResourceDefinitions());if(e){let r=i.find(t=>t.fqn===e);if(r)return r}if(n){let r=i.find(t=>t.name.toLowerCase().includes(n.toLowerCase())||t.plr_category?.toLowerCase().includes(n.toLowerCase()));if(r)return r}return null}catch(i){return console.warn("API lookup failed",i),null}}getFacets(e={}){return this.modeService.isBrowserMode()?this.getResourceDefinitions().pipe(c(n=>{let i=n,r=i.map(o=>h(_({},o),{_inferredCategory:w(o)}));e.plr_category?.length&&(i=r.filter(o=>e.plr_category.includes(o._inferredCategory))),e.vendor?.length&&(i=i.filter(o=>e.vendor.includes(o.vendor||""))),e.num_items?.length&&(i=i.filter(o=>e.num_items.includes(o.num_items))),e.plate_type?.length&&(i=i.filter(o=>e.plate_type.includes(o.plate_type||"")));let t=o=>{let p=new Map;return o.forEach(u=>{if(u!=null&&u!==""){let l=p.get(u)||0;p.set(u,l+1)}}),Array.from(p.entries()).map(([u,l])=>({value:u,count:l})).sort((u,l)=>l.count-u.count)};return{plr_category:t(n.map(o=>w(o))),vendor:t(i.map(o=>o.vendor)),num_items:t(i.map(o=>o.num_items)),plate_type:t(i.map(o=>o.plate_type)),well_volume_ul:t(i.map(o=>o.well_volume_ul)),tip_volume_ul:t(i.map(o=>o.tip_volume_ul))}})):this.apiWrapper.wrap(A.getResourceDefinitionFacetsApiV1ResourcesDefinitionsFacetsGet(e.plr_category?.[0],e.vendor?.[0],e.num_items?.[0],e.plate_type?.[0])).pipe(c(n=>n))}getMachineFacets(){return this.modeService.isBrowserMode()?this.getMachineDefinitions().pipe(c(e=>{let n=i=>{let r=new Map;return i.forEach(t=>{if(t!=null&&t!==""){let o=r.get(t)||0;r.set(t,o+1)}}),Array.from(r.entries()).map(([t,o])=>({value:t,count:o})).sort((t,o)=>o.count-t.count)};return{machine_category:n(e.map(i=>i.machine_category)),manufacturer:n(e.map(i=>i.manufacturer))}})):this.apiWrapper.wrap(g.getMachineDefinitionFacetsApiV1MachinesDefinitionsFacetsGet()).pipe(c(e=>e))}syncDefinitions(){return this.apiWrapper.wrap(C.syncAllDefinitionsApiV1DiscoverySyncAllPost()).pipe(c(e=>e))}static \u0275fac=function(n){return new(n||d)};static \u0275prov=D({token:d,factory:d.\u0275fac,providedIn:"root"})};export{I as a,q as b,B as c};
