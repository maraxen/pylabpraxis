import{a as $e}from"./chunk-VTEHCM5Y.js";import{a as ft}from"./chunk-K7KQAV6O.js";import{a as se,b as me}from"./chunk-HGHWDJ3Y.js";import{a as J,c as X,d as L,e as Z}from"./chunk-WNYFH7QK.js";import{e as gt,i as ht,k as xt}from"./chunk-BRQ7VCIS.js";import{e as pt}from"./chunk-XG2SDX2Y.js";import{g as de}from"./chunk-TQGVYNR7.js";import{a as le,c as dt}from"./chunk-QEA2ESGG.js";import{a as Ae,c as qe,h as Qe}from"./chunk-JG6HUHEY.js";import"./chunk-PWVAMWZ2.js";import"./chunk-GX2D2L2X.js";import{a as ut,k as _t}from"./chunk-ERJX7L3L.js";import"./chunk-5XV7PTQI.js";import"./chunk-GW7MQSL6.js";import"./chunk-F4M4TAIC.js";import{f as at,g as rt,m as ct,p as lt,q as st,r as mt}from"./chunk-FGBSBVHW.js";import"./chunk-5R36QA5Q.js";import"./chunk-SKMC2KSJ.js";import{P as Y,R as K,S as B,U as Ue,W as ne,Z as He,_ as Ye,ga as Ke,ha as Je,ka as Xe,na as Ze,oa as et,pa as tt,qa as nt,sa as it,ua as ot}from"./chunk-YMB734HE.js";import{b as R,c as F}from"./chunk-M6LIKZVL.js";import{e as Be,f as Le,o as ce,r as je,s as k}from"./chunk-Q6UYEA4T.js";import{$b as v,Ac as W,Bb as M,Bc as r,C as De,Cc as b,Dc as x,Ec as H,Fc as Ge,Ga as E,Hb as A,Ja as Te,Rb as We,Sb as u,Tb as f,Tc as z,Uc as re,Vc as te,Wb as P,Xb as D,Yb as g,Zb as o,Zc as O,_b as a,ac as d,ad as T,bc as m,bd as Se,cc as q,gc as S,ha as Oe,hc as Ve,jb as Ie,kc as h,lb as c,lc as Ne,ma as N,mc as s,qc as Re,rc as Fe,sa as _,sc as ze,ta as C,ua as ie,va as oe,w as Pe,wc as U,xc as ae,yc as w}from"./chunk-ZXFVGPYG.js";import{a as j,b as $}from"./chunk-RNQFGQA5.js";var pe=class t{assetService=N(dt);deckCatalog=N(le);workcellGroups=E([]);selectedMachine=E(null);loadWorkcellGroups(){return De({machines:this.assetService.getMachines(),workcells:this.assetService.getWorkcells()}).pipe(Pe(({machines:n,workcells:e})=>{let i=this.groupByWorkcell(n,e);return this.workcellGroups.set(i),i}))}groupByWorkcell(n,e){let i=[],l=new Map;e.forEach(y=>l.set(y.accession_id,[]));let p=[];return n.forEach(y=>{let G=this.mapToMachineWithRuntime(y);y.workcell_accession_id&&l.has(y.workcell_accession_id)?l.get(y.workcell_accession_id).push(G):p.push(G)}),e.forEach(y=>{i.push({workcell:y,machines:l.get(y.accession_id)||[],isExpanded:!0})}),p.length>0&&i.push({workcell:null,machines:p,isExpanded:!0}),i}mapToMachineWithRuntime(n){let e=n.plr_definition;if(!e){let i=this.deckCatalog.getDeckTypeForMachine(n);if(i){let l=this.deckCatalog.getDeckDefinition(i);l&&(e=this.deckCatalog.createPlrResourceFromSpec(l))}}return $(j({},n),{plr_definition:e,connectionState:this.deriveConnectionState(n.status),stateSource:n.is_simulation_override?"simulated":"live",alerts:this.computeAlerts(n),lastStateUpdate:n.updated_at?new Date(n.updated_at):void 0})}deriveConnectionState(n){switch(n){case"offline":case"unknown":return"disconnected";default:return"connected"}}computeAlerts(n){let e=[];return n.status==="error"&&e.push({severity:"error",message:n.status_details||"Machine is in error state"}),n.status==="maintenance"&&e.push({severity:"warning",message:"Scheduled maintenance required"}),e}static \u0275fac=function(e){return new(e||t)};static \u0275prov=Oe({token:t,factory:t.\u0275fac,providedIn:"root"})};function bt(t,n){t&1&&q(0,"span",5)(1,"span",6)}function Mt(t,n){t&1&&q(0,"span",2)}var ue=class t{machine=Se.required();isSelected=Se(!1);machineSelect=T();onSelect(){this.machineSelect.emit(this.machine())}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-machine-tree-node"]],inputs:{machine:[1,"machine"],isSelected:[1,"isSelected"]},outputs:{machineSelect:"machineSelect"},decls:8,vars:7,consts:[[1,"group","flex","items-center","gap-3","rounded-md","px-2","py-2","text-sm","font-medium","text-sys-text-secondary","hover:bg-[var(--mat-sys-surface-variant)]","hover:text-sys-text-primary","cursor-pointer","transition-colors",3,"click"],[1,"relative","flex","h-2.5","w-2.5"],[1,"relative","inline-flex","rounded-full","h-2.5","w-2.5","bg-sys-text-tertiary"],[1,"truncate","flex-grow"],[1,"text-xs","text-sys-text-tertiary","opacity-0","group-hover:opacity-100","transition-opacity"],[1,"animate-ping","absolute","inline-flex","h-full","w-full","rounded-full","bg-[var(--mat-sys-success)]","opacity-75"],[1,"relative","inline-flex","rounded-full","h-2.5","w-2.5","bg-[var(--mat-sys-success)]"]],template:function(e,i){e&1&&(d(0,"div",0),Ne("click",function(){return i.onSelect()}),d(1,"span",1),u(2,bt,2,0)(3,Mt,1,0,"span",2),m(),d(4,"span",3),r(5),m(),d(6,"span",4),r(7),m()()),e&2&&(w("bg-[var(--mat-sys-primary-container)]",i.isSelected())("text-primary",i.isSelected()),c(2),f(i.machine().connectionState==="connected"?2:3),c(3),b(i.machine().name),c(2),x(" ",i.machine().machine_type," "))},dependencies:[k],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};var kt=(t,n)=>n.accession_id;function yt(t,n){if(t&1){let e=S();o(0,"app-machine-tree-node",8),h("machineSelect",function(l){_(e);let p=s(2);return C(p.onMachineSelect(l))}),a()}if(t&2){let e=n.$implicit;g("machine",e)}}function St(t,n){if(t&1&&(o(0,"div",6),P(1,yt,1,1,"app-machine-tree-node",7,kt),a()),t&2){let e=s();c(),D(e.group.machines)}}var fe=class t{set group(n){this.groupSignal.set(n)}get group(){return this.groupSignal()}groupSignal=E(null);machineSelect=T();isExpanded=E(!1);constructor(){Te(()=>{let n=this.groupSignal();if(n)if(n.isExpanded)this.isExpanded.set(!0);else{let e=n.workcell?.accession_id||"unassigned",i=localStorage.getItem(`workcell-expanded-${e}`);this.isExpanded.set(i==="true")}})}toggle(){this.isExpanded.update(e=>!e);let n=this.group.workcell?.accession_id||"unassigned";localStorage.setItem(`workcell-expanded-${n}`,String(this.isExpanded()))}onMachineSelect(n){this.machineSelect.emit(n)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-workcell-group"]],inputs:{group:"group"},outputs:{machineSelect:"machineSelect"},decls:10,vars:6,consts:[[1,"mb-2"],["type","button",1,"flex","w-full","items-center","justify-between","rounded-md","px-2","py-2","text-left","text-sm","font-semibold","text-sys-text-secondary","hover:bg-[var(--mat-sys-surface-variant)]","hover:text-sys-text-primary","transition-colors","focus:outline-none","focus:ring-2","focus:ring-primary","focus:ring-offset-2","dark:focus:ring-offset-slate-900",3,"click"],[1,"flex","items-center","gap-2"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","transform","transition-transform","duration-200"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"text-xs","font-normal","text-sys-text-tertiary"],["role","group",1,"mt-1","ml-2","space-y-1","border-l","border-[var(--theme-border)]","pl-2"],[3,"machine"],[3,"machineSelect","machine"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"button",1),h("click",function(){return i.toggle()}),o(2,"div",2),ie(),o(3,"svg",3),v(4,"path",4),a(),oe(),o(5,"span"),r(6),a()(),o(7,"span",5),r(8),a()(),u(9,St,3,0,"div",6),a()),e&2&&(c(),We("aria-expanded",i.isExpanded()),c(2),w("rotate-90",i.isExpanded()),c(3),b((i.group.workcell==null?null:i.group.workcell.name)||"Unassigned"),c(2),x(" ",i.group.machines.length," "),c(),f(i.isExpanded()?9:-1))},dependencies:[k,ue],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})};var wt=(t,n)=>(n.workcell==null?null:n.workcell.accession_id)||"unassigned";function Et(t,n){if(t&1&&(o(0,"div",8),r(1),a()),t&2){let e=s();c(),x(' No machines found matching "',e.searchQuery(),'" ')}}function Pt(t,n){if(t&1){let e=S();o(0,"app-workcell-group",10),h("machineSelect",function(l){_(e);let p=s(2);return C(p.onMachineSelect(l))}),a()}if(t&2){let e=n.$implicit;g("group",e)}}function Dt(t,n){if(t&1&&P(0,Pt,1,1,"app-workcell-group",9,wt),t&2){let e=s();D(e.filteredGroups())}}var ge=class t{set groups(n){this.groupsSignal.set(n)}get groups(){return this.groupsSignal()}groupsSignal=E([]);machineSelect=T();searchQuery=E("");filteredGroups=O(()=>{let n=this.searchQuery().toLowerCase().trim(),e=this.groupsSignal();return n?e.map(i=>{let p=(i.workcell?.name?.toLowerCase()||"unassigned").includes(n),y=i.machines.filter(G=>G.name.toLowerCase().includes(n)||G.machine_type?.toLowerCase().includes(n));return p?$(j({},i),{isExpanded:!0}):y.length>0?$(j({},i),{machines:y,isExpanded:!0}):null}).filter(i=>i!==null):e});updateSearch(n){let e=n.target;this.searchQuery.set(e.value)}onMachineSelect(n){this.machineSelect.emit(n)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-workcell-explorer"]],inputs:{groups:"groups"},outputs:{machineSelect:"machineSelect"},decls:10,vars:2,consts:[[1,"flex","flex-col","h-full","glass-panel","border-r","border-[var(--theme-border)]"],[1,"p-4","border-b","border-[var(--theme-border)]"],[1,"relative"],["type","text","placeholder","Search machines...",1,"w-full","rounded-md","border","border-[var(--theme-border)]","bg-[var(--mat-sys-surface-container)]","py-2","pl-9","pr-4","text-sm","text-sys-text-primary","placeholder-sys-text-tertiary","focus:border-primary","focus:outline-none","focus:ring-1","focus:ring-primary",3,"input","value"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","text-sys-text-tertiary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"],[1,"flex-grow","overflow-y-auto","p-2"],[1,"p-4","text-center","text-sm","text-sys-text-tertiary"],[3,"group"],[3,"machineSelect","group"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3),h("input",function(p){return i.updateSearch(p)}),a(),o(4,"div",4),ie(),o(5,"svg",5),v(6,"path",6),a()()()(),oe(),o(7,"div",7),u(8,Et,2,1,"div",8)(9,Dt,2,0),a()()),e&2&&(c(3),g("value",i.searchQuery()),c(5),f(i.filteredGroups().length===0?8:9))},dependencies:[k,fe],styles:["[_nghost-%COMP%]{display:block;height:100%}.glass-panel[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--mat-sys-surface-container-low) 85%,transparent);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}"],changeDetection:0})};function Ot(t,n){if(t&1&&(d(0,"span",2),r(1),m()),t&2){let e=s();c(),b(e.statusLabel())}}function Tt(t,n){if(t&1&&(d(0,"span",4),r(1),z(2,"uppercase"),m()),t&2){let e=s();W(e.stateSource),c(),b(re(2,3,e.stateSource))}}var ee=class t{status;stateSource="live";showLabel=!0;compact=!1;badgeClasses=O(()=>{let n=this.status;return{[n]:!!n,compact:this.compact}});statusLabel=O(()=>this.status?this.status.charAt(0).toUpperCase()+this.status.slice(1):"");static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-machine-status-badge"]],inputs:{status:"status",stateSource:"stateSource",showLabel:"showLabel",compact:"compact"},decls:4,vars:7,consts:[[1,"status-badge",3,"title"],[1,"status-dot"],[1,"status-label"],[1,"source-tag",3,"class"],[1,"source-tag"]],template:function(e,i){e&1&&(d(0,"div",0),q(1,"span",1),u(2,Ot,2,1,"span",2),u(3,Tt,3,5,"span",3),m()),e&2&&(W(i.badgeClasses()),Ve("title",i.statusLabel()),c(),w("pulse",i.status==="running"),c(),f(i.showLabel?2:-1),c(),f(i.stateSource!=="live"?3:-1))},dependencies:[k,ce],styles:["[_nghost-%COMP%]{display:inline-block}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:12px;font-size:12px;font-weight:500;white-space:nowrap;transition:all .2s ease;background:var(--mat-sys-surface-variant);color:var(--theme-text-primary);border:1px solid var(--theme-border-light)}.status-badge.compact[_ngcontent-%COMP%]{padding:2px 4px;gap:0}.status-badge.compact[_ngcontent-%COMP%]   .status-label[_ngcontent-%COMP%]{display:none}.status-badge.idle[_ngcontent-%COMP%]{border-color:#4ade8033}.status-badge.idle[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:var(--mat-sys-success, #4ade80)}.status-badge.running[_ngcontent-%COMP%]{border-color:#facc1533}.status-badge.running[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary, #facc15)}.status-badge.error[_ngcontent-%COMP%]{border-color:#ef444433}.status-badge.error[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:var(--mat-sys-error, #ef4444)}.status-badge.offline[_ngcontent-%COMP%]{border-color:var(--theme-border)}.status-badge.offline[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:var(--theme-text-tertiary, #94a3b8)}.status-badge.maintenance[_ngcontent-%COMP%]{border-color:#3b82f633}.status-badge.maintenance[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:#3b82f6}.status-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;flex-shrink:0}.status-dot.pulse[_ngcontent-%COMP%]{box-shadow:0 0 0 0 var(--mat-sys-tertiary-container, rgba(250, 204, 21, .4));animation:_ngcontent-%COMP%_pulse-animation 2s infinite}.source-tag[_ngcontent-%COMP%]{font-size:9px;font-weight:700;padding:1px 4px;border-radius:4px;margin-left:4px;text-transform:uppercase;opacity:.8}.source-tag.simulated[_ngcontent-%COMP%]{background:#3b82f633;color:#3b82f6}.source-tag.cached[_ngcontent-%COMP%]{background:#94a3b833;color:#94a3b8}.source-tag.definition[_ngcontent-%COMP%]{background:#a855f733;color:#a855f7}@keyframes _ngcontent-%COMP%_pulse-animation{0%{transform:scale(.95);box-shadow:0 0 0 0 var(--mat-sys-tertiary, rgba(250, 204, 21, .7))}70%{transform:scale(1);box-shadow:0 0 0 6px #facc1500}to{transform:scale(.95);box-shadow:0 0 #facc1500}}"],changeDetection:0})};var Wt=(t,n)=>n.message;function Vt(t,n){if(t&1&&(o(0,"div",11),v(1,"app-deck-view",21),a()),t&2){let e=s();c(),g("resource",e.deckResource())("state",e.deckState())}}function Nt(t,n){t&1&&(o(0,"div",12)(1,"mat-icon"),r(2,"grid_view"),a(),o(3,"span"),r(4,"No Deck Preview"),a()())}function Rt(t,n){if(t&1&&(o(0,"span",26)(1,"mat-icon"),r(2,"timer"),a(),r(3),a()),t&2){let e=s();c(3),x(" ~",e.estimatedRemaining,"m remaining ")}}function Ft(t,n){if(t&1&&(o(0,"div",13)(1,"div",22)(2,"span",23),r(3),a(),o(4,"span",24),r(5),a()(),v(6,"mat-progress-bar",25),u(7,Rt,4,1,"span",26),a()),t&2){let e=n;c(3),b(e.protocolName),c(2),H("Step ",e.currentStep,"/",e.totalSteps),c(),g("value",e.progress),c(),f(e.estimatedRemaining?7:-1)}}function zt(t,n){if(t&1&&(o(0,"div",28)(1,"mat-icon"),r(2),a(),o(3,"span"),r(4),a()()),t&2){let e=n.$implicit;W(e.severity),c(2),b(e.severity==="error"?"error":"warning"),c(2),b(e.message)}}function Gt(t,n){if(t&1&&(o(0,"div",14),P(1,zt,5,4,"div",27,Wt),a()),t&2){let e=s();c(),D(e.machine.alerts)}}function Bt(t,n){t&1&&(o(0,"button",19)(1,"mat-icon"),r(2,"pause_circle"),a(),o(3,"span"),r(4,"Pause Protocol"),a()())}var he=class t{machine;machineSelected=T();deckResource=O(()=>this.machine.plr_definition);deckState=O(()=>this.machine.plr_state);onCardClick(){this.machineSelected.emit(this.machine)}onFocus(){this.machineSelected.emit(this.machine)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-machine-card"]],inputs:{machine:"machine"},outputs:{machineSelected:"machineSelected"},decls:38,vars:14,consts:[["menu","matMenu"],[1,"machine-card",3,"click"],[1,"card-header"],[1,"machine-info"],[1,"machine-icon"],[1,"name-container"],[1,"machine-name"],[1,"machine-type"],[3,"status","stateSource","compact"],[1,"card-content"],[1,"deck-preview"],[1,"deck-scale-wrapper"],[1,"deck-placeholder"],[1,"progress-section"],[1,"alerts-section"],[1,"card-footer",3,"click"],["mat-button","","color","primary",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","","color","warn"],["mat-menu-item",""],[3,"resource","state"],[1,"progress-info"],[1,"protocol-name"],[1,"step-info"],["mode","determinate",3,"value"],[1,"time-remaining"],[1,"alert-item",3,"class"],[1,"alert-item"]],template:function(e,i){if(e&1){let l=S();o(0,"div",1),h("click",function(){return _(l),C(i.onCardClick())}),o(1,"header",2)(2,"div",3)(3,"mat-icon",4),r(4,"precision_manufacturing"),a(),o(5,"div",5)(6,"h3",6),r(7),a(),o(8,"span",7),r(9),a()()(),v(10,"app-machine-status-badge",8),a(),o(11,"div",9)(12,"div",10),u(13,Vt,2,2,"div",11)(14,Nt,5,0,"div",12),a(),u(15,Ft,8,5,"div",13),u(16,Gt,3,0,"div",14),a(),o(17,"footer",15),h("click",function(y){return _(l),C(y.stopPropagation())}),o(18,"button",16),h("click",function(){return _(l),C(i.onFocus())}),o(19,"mat-icon"),r(20,"fullscreen"),a(),r(21," Focus View "),a(),o(22,"button",17)(23,"mat-icon"),r(24,"more_vert"),a()(),o(25,"mat-menu",null,0)(27,"button",18),h("click",function(){return _(l),C(i.onFocus())}),o(28,"mat-icon"),r(29,"visibility"),a(),o(30,"span"),r(31,"View Details"),a()(),u(32,Bt,5,0,"button",19),o(33,"button",20)(34,"mat-icon"),r(35,"settings"),a(),o(36,"span"),r(37,"Configure"),a()()()()()}if(e&2){let l,p=U(26);w("running",i.machine.status==="running")("error",i.machine.status==="error"),c(7),b(i.machine.name),c(2),b(i.machine.machine_type),c(),g("status",i.machine.status)("stateSource",i.machine.stateSource)("compact",!0),c(3),f(i.deckResource()?13:14),c(2),f((l=i.machine.currentRun)?15:-1,l),c(),f(i.machine.alerts.length>0?16:-1),c(6),g("matMenuTriggerFor",p),c(10),f(i.machine.status==="running"?32:-1)}},dependencies:[k,B,K,Y,F,R,Z,X,J,L,me,se,ee,de],styles:["[_nghost-%COMP%]{display:block}.machine-card[_ngcontent-%COMP%]{background:var(--mat-sys-surface-container-low);border:1px solid var(--mat-sys-outline-variant);border-radius:12px;overflow:hidden;transition:all .3s cubic-bezier(.4,0,.2,1);cursor:pointer;display:flex;flex-direction:column;height:100%}.machine-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 12px 24px #0000001a;border-color:var(--mat-sys-primary)}.machine-card.running[_ngcontent-%COMP%]{border-bottom:3px solid var(--mat-sys-tertiary, #facc15)}.machine-card.error[_ngcontent-%COMP%]{border-color:var(--mat-sys-error)}.card-header[_ngcontent-%COMP%]{padding:16px;display:flex;justify-content:space-between;align-items:flex-start;border-bottom:1px solid var(--mat-sys-outline-variant)}.card-header[_ngcontent-%COMP%]   .machine-info[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.card-header[_ngcontent-%COMP%]   .machine-info[_ngcontent-%COMP%]   .machine-icon[_ngcontent-%COMP%]{color:var(--mat-sys-primary);background:var(--mat-sys-primary-container);padding:8px;border-radius:8px;width:24px;height:24px;font-size:24px}.card-header[_ngcontent-%COMP%]   .machine-info[_ngcontent-%COMP%]   .name-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.card-header[_ngcontent-%COMP%]   .machine-info[_ngcontent-%COMP%]   .name-container[_ngcontent-%COMP%]   .machine-name[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600;color:var(--mat-sys-on-surface);line-height:1.2}.card-header[_ngcontent-%COMP%]   .machine-info[_ngcontent-%COMP%]   .name-container[_ngcontent-%COMP%]   .machine-type[_ngcontent-%COMP%]{font-size:12px;color:var(--mat-sys-on-surface-variant)}.card-content[_ngcontent-%COMP%]{padding:16px;flex-grow:1;display:flex;flex-direction:column;gap:16px}.deck-preview[_ngcontent-%COMP%]{height:140px;background:var(--mat-sys-surface-container-low);border-radius:8px;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,.05)}.deck-preview[_ngcontent-%COMP%]   .deck-scale-wrapper[_ngcontent-%COMP%]{transform:scale(.35);transform-origin:top left;padding:10px}.deck-preview[_ngcontent-%COMP%]   .deck-placeholder[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#ffffff4d;gap:8px}.deck-preview[_ngcontent-%COMP%]   .deck-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px}.deck-preview[_ngcontent-%COMP%]   .deck-placeholder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.progress-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.progress-section[_ngcontent-%COMP%]   .progress-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px}.progress-section[_ngcontent-%COMP%]   .progress-info[_ngcontent-%COMP%]   .protocol-name[_ngcontent-%COMP%]{font-weight:500;color:var(--mat-sys-on-surface)}.progress-section[_ngcontent-%COMP%]   .progress-info[_ngcontent-%COMP%]   .step-info[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant)}.progress-section[_ngcontent-%COMP%]   .time-remaining[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;font-size:11px;color:var(--mat-sys-tertiary);margin-top:4px}.progress-section[_ngcontent-%COMP%]   .time-remaining[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px}.alerts-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.alerts-section[_ngcontent-%COMP%]   .alert-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:6px;font-size:12px}.alerts-section[_ngcontent-%COMP%]   .alert-item.warning[_ngcontent-%COMP%]{background:#facc151a;color:#854d0e}.alerts-section[_ngcontent-%COMP%]   .alert-item.warning[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#eab308}.alerts-section[_ngcontent-%COMP%]   .alert-item.error[_ngcontent-%COMP%]{background:#ef44441a;color:#991b1b}.alerts-section[_ngcontent-%COMP%]   .alert-item.error[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#ef4444}.alerts-section[_ngcontent-%COMP%]   .alert-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.card-footer[_ngcontent-%COMP%]{padding:8px 16px;background:var(--mat-sys-surface-container);display:flex;justify-content:space-between;align-items:center;border-top:1px solid var(--mat-sys-outline-variant)}.card-footer[_ngcontent-%COMP%]   button[mat-button][_ngcontent-%COMP%]{font-weight:500;font-size:13px}.card-footer[_ngcontent-%COMP%]   button[mat-button][_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px}"],changeDetection:0})};function Lt(t,n){if(t&1&&(o(0,"div",10)(1,"span",18),r(2),a(),o(3,"div",19),v(4,"mat-progress-bar",20),o(5,"span",21),r(6),a()()()),t&2){let e=n;c(2),b(e.protocolName),c(2),g("value",e.progress),c(2),x("",e.progress,"%")}}function jt(t,n){t&1&&(o(0,"span",11),r(1,"Idle"),a())}function $t(t,n){if(t&1&&(o(0,"div",22)(1,"mat-icon"),r(2),a(),o(3,"span",23),r(4),a()()),t&2){let e=s();W(e.machine.alerts[0].severity),c(2),b(e.machine.alerts[0].severity==="error"?"error":"warning"),c(2),b(e.machine.alerts.length)}}function At(t,n){t&1&&(o(0,"button",17)(1,"mat-icon"),r(2,"pause_circle"),a(),o(3,"span"),r(4,"Pause"),a()())}var _e=class t{machine;machineSelected=T();static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-machine-card-mini"]],inputs:{machine:"machine"},outputs:{machineSelected:"machineSelected"},decls:28,vars:13,consts:[["menu","matMenu"],[1,"machine-mini-card",3,"click"],[1,"main-info"],[1,"machine-icon"],[1,"name-container"],[1,"machine-name"],[1,"machine-type"],[1,"status-container"],[3,"status","stateSource","showLabel"],[1,"protocol-container"],[1,"progress-info"],[1,"idle-text"],[1,"alerts-container"],[1,"alert-indicator",3,"class"],[1,"actions-container",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","","color","warn"],[1,"protocol-name","truncate"],[1,"progress-bar-wrapper"],["mode","determinate",3,"value"],[1,"progress-text"],[1,"alert-indicator"],[1,"alert-count"]],template:function(e,i){if(e&1){let l=S();o(0,"div",1),h("click",function(){return _(l),C(i.machineSelected.emit(i.machine))}),o(1,"div",2)(2,"mat-icon",3),r(3,"precision_manufacturing"),a(),o(4,"div",4)(5,"h4",5),r(6),a(),o(7,"span",6),r(8),a()()(),o(9,"div",7),v(10,"app-machine-status-badge",8),a(),o(11,"div",9),u(12,Lt,7,3,"div",10)(13,jt,2,0,"span",11),a(),o(14,"div",12),u(15,$t,5,4,"div",13),a(),o(16,"div",14),h("click",function(y){return _(l),C(y.stopPropagation())}),o(17,"button",15)(18,"mat-icon"),r(19,"more_vert"),a()(),o(20,"mat-menu",null,0)(22,"button",16),h("click",function(){return _(l),C(i.machineSelected.emit(i.machine))}),o(23,"mat-icon"),r(24,"visibility"),a(),o(25,"span"),r(26,"View Details"),a()(),u(27,At,5,0,"button",17),a()()()}if(e&2){let l,p=U(21);w("running",i.machine.status==="running")("error",i.machine.status==="error"),c(6),b(i.machine.name),c(2),b(i.machine.machine_type),c(2),g("status",i.machine.status)("stateSource",i.machine.stateSource)("showLabel",!1),c(2),f((l=i.machine.currentRun)?12:13,l),c(3),f(i.machine.alerts.length>0?15:-1),c(2),g("matMenuTriggerFor",p),c(10),f(i.machine.status==="running"?27:-1)}},dependencies:[k,B,Y,F,R,Z,X,J,L,me,se,ee],styles:[".machine-mini-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:12px 16px;background:var(--mat-sys-surface-container-low);border:1px solid var(--mat-sys-outline-variant);border-radius:8px;cursor:pointer;transition:all .2s ease}.machine-mini-card[_ngcontent-%COMP%]:hover{background:var(--mat-sys-surface-container);border-color:var(--mat-sys-primary);box-shadow:0 2px 8px #0000000d}.machine-mini-card.running[_ngcontent-%COMP%]{border-left:4px solid var(--mat-sys-tertiary, #facc15)}.machine-mini-card.error[_ngcontent-%COMP%]{border-color:var(--mat-sys-error)}.main-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;width:250px;flex-shrink:0}.main-info[_ngcontent-%COMP%]   .machine-icon[_ngcontent-%COMP%]{color:var(--mat-sys-primary);font-size:20px;width:20px;height:20px}.main-info[_ngcontent-%COMP%]   .name-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.main-info[_ngcontent-%COMP%]   .name-container[_ngcontent-%COMP%]   .machine-name[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:500;color:var(--mat-sys-on-surface);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.main-info[_ngcontent-%COMP%]   .name-container[_ngcontent-%COMP%]   .machine-type[_ngcontent-%COMP%]{font-size:11px;color:var(--mat-sys-on-surface-variant)}.status-container[_ngcontent-%COMP%]{width:40px;display:flex;justify-content:center}.protocol-container[_ngcontent-%COMP%]{flex-grow:1;min-width:200px}.protocol-container[_ngcontent-%COMP%]   .idle-text[_ngcontent-%COMP%]{font-size:13px;color:var(--mat-sys-on-surface-variant);font-style:italic}.protocol-container[_ngcontent-%COMP%]   .progress-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.protocol-container[_ngcontent-%COMP%]   .progress-info[_ngcontent-%COMP%]   .protocol-name[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:var(--mat-sys-on-surface)}.protocol-container[_ngcontent-%COMP%]   .progress-info[_ngcontent-%COMP%]   .progress-bar-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.protocol-container[_ngcontent-%COMP%]   .progress-info[_ngcontent-%COMP%]   .progress-bar-wrapper[_ngcontent-%COMP%]   mat-progress-bar[_ngcontent-%COMP%]{height:4px;border-radius:2px}.protocol-container[_ngcontent-%COMP%]   .progress-info[_ngcontent-%COMP%]   .progress-bar-wrapper[_ngcontent-%COMP%]   .progress-text[_ngcontent-%COMP%]{font-size:10px;color:var(--mat-sys-on-surface-variant);width:30px}.alerts-container[_ngcontent-%COMP%]{width:60px;display:flex;justify-content:center}.alerts-container[_ngcontent-%COMP%]   .alert-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:2px 6px;border-radius:4px}.alerts-container[_ngcontent-%COMP%]   .alert-indicator[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.alerts-container[_ngcontent-%COMP%]   .alert-indicator[_ngcontent-%COMP%]   .alert-count[_ngcontent-%COMP%]{font-size:11px;font-weight:600}.alerts-container[_ngcontent-%COMP%]   .alert-indicator.warning[_ngcontent-%COMP%]{color:#854d0e;background:#facc151a}.alerts-container[_ngcontent-%COMP%]   .alert-indicator.error[_ngcontent-%COMP%]{color:#991b1b;background:#ef44441a}.actions-container[_ngcontent-%COMP%]{flex-shrink:0}"],changeDetection:0})};function qt(t,n){if(t&1&&(d(0,"div",10)(1,"span",11),r(2,"Est. Remaining"),m(),d(3,"span",12),r(4),m()()),t&2){let e=s(2);c(4),x(" ",e.formatDuration(e.run.estimatedRemaining)," ")}}function Qt(t,n){if(t&1&&(d(0,"div",2)(1,"div",4)(2,"span",5),r(3),m(),d(4,"span",6),r(5),m()(),d(6,"div",7),q(7,"div",8),m(),d(8,"div",9)(9,"div",10)(10,"span",11),r(11,"Step"),m(),d(12,"span",12),r(13),m()(),u(14,qt,5,1,"div",10),m()()),t&2){let e=s();c(3),x(" ",e.run.protocolName," "),c(2),x(" ",e.run.progress,"% "),c(2),ae("width",e.run.progress,"%"),c(6),H(" ",e.run.currentStep," / ",e.run.totalSteps," "),c(),f(e.run.estimatedRemaining?14:-1)}}function Ut(t,n){t&1&&(d(0,"div",3)(1,"p"),r(2,"No active protocol"),m()())}var Ce=class t{run;formatDuration(n){let e=Math.floor(n/60),i=n%60;return e>0?`${e}m ${i}s`:`${i}s`}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-protocol-progress-panel"]],inputs:{run:"run"},decls:5,vars:1,consts:[[1,"h-full","flex","flex-col","p-4","bg-[var(--mat-sys-surface-container)]","border-r","border-[var(--mat-sys-outline-variant)]"],[1,"text-sm","font-semibold","text-[var(--mat-sys-on-surface-variant)]","uppercase","tracking-wider","mb-4"],[1,"flex-grow","flex","flex-col","justify-center"],[1,"flex-grow","flex","flex-col","items-center","justify-center","text-[var(--mat-sys-on-surface-variant)]","italic","text-sm"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-base","font-bold","text-[var(--mat-sys-on-surface)]","truncate"],[1,"text-sm","font-medium","text-primary"],[1,"w-full","bg-[var(--mat-sys-surface-variant)]","rounded-full","h-2.5","mb-4","overflow-hidden"],[1,"bg-primary","h-full","transition-all","duration-500","ease-out"],[1,"grid","grid-cols-2","gap-4"],[1,"flex","flex-col"],[1,"text-xs","text-[var(--mat-sys-on-surface-variant)]"],[1,"text-sm","font-medium","text-[var(--mat-sys-on-surface)]"]],template:function(e,i){e&1&&(d(0,"div",0)(1,"h3",1),r(2," Protocol Progress "),m(),u(3,Qt,15,7,"div",2)(4,Ut,3,0,"div",3),m()),e&2&&(c(3),f(i.run?3:4))},dependencies:[k],styles:["[_nghost-%COMP%]{display:block;height:100%}"],changeDetection:0})};function Ht(t,n){if(t&1&&(d(0,"div",5)(1,"span",10),r(2,"Parent"),m(),d(3,"span",13),r(4),m()()),t&2){let e=s(2);c(4),x(" ",e.resource.parentName," ")}}function Yt(t,n){if(t&1&&(d(0,"div",5)(1,"span",10),r(2,"Volume"),m(),d(3,"div",14)(4,"span",15),r(5),z(6,"number"),m(),d(7,"span",16),r(8),m()()()),t&2){let e=s(3);c(5),x(" ",te(6,2,e.resource.volume,"1.0-1")," "),c(3),x("/ ",e.resource.maxVolume||"?"," \xB5L")}}function Kt(t,n){if(t&1&&(d(0,"div",5)(1,"span",10),r(2,"Tip Status"),m(),d(3,"span",17),r(4),m()()),t&2){let e=s(3);c(3),w("text-amber-500",e.resource.hasTip)("text-[var(--mat-sys-on-surface-variant)]",!e.resource.hasTip),c(),x(" ",e.resource.hasTip?"PRESENT":"EMPTY"," ")}}function Jt(t,n){if(t&1&&(d(0,"div",12)(1,"div",9),u(2,Yt,9,5,"div",5),u(3,Kt,5,5,"div",5),m()()),t&2){let e=s(2);c(2),f(e.resource.volume!==void 0?2:-1),c(),f(e.resource.hasTip!==void 0?3:-1)}}function Xt(t,n){if(t&1&&(d(0,"div",2)(1,"div",4)(2,"div",5)(3,"span",6),r(4),m(),d(5,"span",7),r(6),m()()(),d(7,"div",8)(8,"div",9)(9,"div",5)(10,"span",10),r(11,"Slot / Location"),m(),d(12,"span",11),r(13),m()(),u(14,Ht,5,1,"div",5),m(),d(15,"div",5)(16,"span",10),r(17,"Dimensions (mm)"),m(),d(18,"span",11),r(19),z(20,"number"),z(21,"number"),z(22,"number"),m()(),u(23,Jt,4,2,"div",12),m()()),t&2){let e=s();c(4),x(" ",e.resource.name," "),c(2),x(" ",e.resource.type," "),c(7),x(" ",e.resource.slotId||"None"," "),c(),f(e.resource.parentName?14:-1),c(5),Ge(" ",te(20,8,e.resource.dimensions.x,"1.1-1")," \xD7 ",te(21,11,e.resource.dimensions.y,"1.1-1")," \xD7 ",te(22,14,e.resource.dimensions.z,"1.1-1")," "),c(4),f(e.resource.volume!==void 0||e.resource.hasTip!==void 0?23:-1)}}function Zt(t,n){t&1&&(d(0,"div",3)(1,"p"),r(2,"Click a resource on the deck to inspect"),m()())}var ve=class t{resource;static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-resource-inspector-panel"]],inputs:{resource:"resource"},decls:5,vars:1,consts:[[1,"h-full","flex","flex-col","p-4","bg-[var(--mat-sys-surface-container)]"],[1,"text-sm","font-semibold","text-[var(--mat-sys-on-surface-variant)]","uppercase","tracking-wider","mb-4"],[1,"flex-grow","flex","flex-col","overflow-auto"],[1,"flex-grow","flex","flex-col","items-center","justify-center","text-[var(--mat-sys-on-surface-variant)]","italic","text-sm"],[1,"flex","items-start","justify-between","mb-4"],[1,"flex","flex-col"],[1,"text-lg","font-bold","text-[var(--mat-sys-on-surface)]","leading-tight"],[1,"text-xs","font-medium","text-[var(--mat-sys-on-surface-variant)]","uppercase","tracking-wide"],[1,"space-y-4"],[1,"grid","grid-cols-2","gap-4"],[1,"text-xs","text-[var(--mat-sys-on-surface-variant)]"],[1,"text-sm","font-medium","text-[var(--mat-sys-on-surface)]"],[1,"pt-4","border-t","border-[var(--mat-sys-outline-variant)]"],[1,"text-sm","font-medium","text-[var(--mat-sys-on-surface)]","truncate"],[1,"flex","items-baseline","gap-1"],[1,"text-sm","font-bold","text-primary"],[1,"text-[10px]","text-[var(--mat-sys-on-surface-variant)]"],[1,"text-sm","font-bold"]],template:function(e,i){e&1&&(d(0,"div",0)(1,"h3",1),r(2," Resource Inspector "),m(),u(3,Xt,24,17,"div",2)(4,Zt,3,0,"div",3),m()),e&2&&(c(3),f(i.resource?3:4))},dependencies:[k,je],styles:["[_nghost-%COMP%]{display:block;height:100%}"],changeDetection:0})};function en(t,n){t&1&&(d(0,"span",1),r(1,"\u{1F7E2}"),m(),r(2," LIVE "))}function tn(t,n){t&1&&(d(0,"span",1),r(1,"\u{1F535}"),m(),r(2," SIMULATED "))}function nn(t,n){t&1&&(d(0,"span",1),r(1,"\u26AA"),m(),r(2," OFFLINE "))}function on(t,n){t&1&&(d(0,"span",1),r(1,"\u{1F4D0}"),m(),r(2," STATIC "))}var be=class t{source;static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-deck-state-indicator"]],inputs:{source:"source"},decls:5,vars:3,consts:[[1,"state-indicator"],[1,"icon"]],template:function(e,i){if(e&1&&(d(0,"span",0),u(1,en,3,0)(2,tn,3,0)(3,nn,3,0)(4,on,3,0),m()),e&2){let l;W(i.source),c(),f((l=i.source)==="live"?1:l==="simulated"?2:l==="cached"?3:l==="definition"?4:-1)}},dependencies:[k],styles:["[_nghost-%COMP%]{display:inline-block;vertical-align:middle}.state-indicator[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:16px;font-size:11px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;transition:all .3s ease;white-space:nowrap;border:1px solid transparent}.state-indicator.live[_ngcontent-%COMP%]{background:#22c55e1a;color:#22c55e;border-color:#22c55e4d;box-shadow:0 0 12px #22c55e33;animation:_ngcontent-%COMP%_pulse-green 2s infinite}.state-indicator.simulated[_ngcontent-%COMP%]{background:#3b82f61a;color:#3b82f6;border-color:#3b82f64d}.state-indicator.cached[_ngcontent-%COMP%]{background:#ffffff0d;color:var(--theme-text-secondary, #94a3b8);border-color:var(--theme-border, rgba(255, 255, 255, .1))}.state-indicator.definition[_ngcontent-%COMP%]{background:transparent;color:var(--theme-text-tertiary, #64748b);border-color:var(--theme-border-light, rgba(255, 255, 255, .05));border-style:dashed}.state-indicator[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:8px;line-height:1;filter:drop-shadow(0 0 2px currentColor)}@keyframes _ngcontent-%COMP%_pulse-green{0%{box-shadow:0 0 #22c55e66}70%{box-shadow:0 0 0 6px #22c55e00}to{box-shadow:0 0 #22c55e00}}"],changeDetection:0})};var an=(t,n)=>n.message;function rn(t,n){if(t&1){let e=S();o(0,"div",16)(1,"app-deck-view",24),h("resourceSelected",function(l){_(e);let p=s();return C(p.onResourceSelected(l))}),a()()}if(t&2){let e=s();c(),g("resource",e.machine.plr_definition)("state",e.machine.plr_state)}}function cn(t,n){t&1&&(o(0,"div",17)(1,"mat-icon",25),r(2,"grid_off"),a(),o(3,"p",26),r(4,"No deck definition available for this machine"),a()())}function ln(t,n){if(t&1&&(o(0,"div",28)(1,"mat-icon",29),r(2),a(),o(3,"span",30),r(4),a()()),t&2){let e=n.$implicit;w("bg-amber-50",e.severity==="warning")("border-amber-200",e.severity==="warning")("text-amber-900",e.severity==="warning")("bg-rose-50",e.severity==="error")("border-rose-200",e.severity==="error")("text-rose-900",e.severity==="error")("bg-blue-50",e.severity==="info")("border-blue-200",e.severity==="info")("text-blue-900",e.severity==="info"),c(2),x(" ",e.severity==="error"?"error":e.severity==="warning"?"warning":"info"," "),c(2),b(e.message)}}function sn(t,n){if(t&1&&(o(0,"div",18),P(1,ln,5,20,"div",27,an),a()),t&2){let e=s();c(),D(e.machine.alerts)}}var Me=class t{machine;back=T();selectedResource=E(void 0);statusClass(){switch(this.machine.status.toLowerCase()){case"idle":return"text-emerald-600 dark:text-emerald-400";case"running":return"text-primary";case"error":return"text-rose-600 dark:text-rose-400";default:return"text-slate-500"}}onResourceSelected(n){this.selectedResource.set(n)}onEscapePressed(){this.back.emit()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-machine-focus-view"]],hostBindings:function(e,i){e&1&&h("keydown.escape",function(){return i.onEscapePressed()},Ie)},inputs:{machine:"machine"},outputs:{back:"back"},decls:31,vars:19,consts:[[1,"flex","flex-col","h-full","w-full","glass-container","overflow-hidden","animate-in","fade-in","duration-300"],[1,"flex","items-center","justify-between","px-6","py-4","glass-header","border-b","border-[var(--mat-sys-outline-variant)]","shrink-0","z-10"],[1,"flex","items-center","gap-4"],["title","Back to Dashboard (Esc)",1,"p-2","-ml-2","rounded-full","hover:bg-[var(--mat-sys-surface-variant)]","transition-colors","text-[var(--mat-sys-on-surface-variant)]",3,"click"],[1,"flex","flex-col"],[1,"text-xl","font-bold","text-[var(--mat-sys-on-surface)]","leading-tight"],[1,"flex","items-center","gap-2"],[1,"text-xs","font-medium","text-[var(--mat-sys-on-surface-variant)]","uppercase","tracking-wider"],[1,"w-1","h-1","rounded-full","bg-[var(--mat-sys-outline-variant)]"],[1,"text-xs","font-medium"],[1,"flex","items-center","gap-3"],[3,"source"],[1,"flex","items-center","gap-2","px-3","py-1.5","rounded-full","bg-[var(--mat-sys-surface-container-high)]","border","border-[var(--mat-sys-outline-variant)]"],[1,"w-2","h-2","rounded-full"],[1,"text-xs","font-semibold","text-[var(--mat-sys-on-surface)]","capitalize"],[1,"flex-grow","relative","bg-[var(--mat-sys-surface-container-low)]","overflow-hidden"],[1,"absolute","inset-0","flex","items-center","justify-center","p-8","overflow-auto"],[1,"flex","flex-col","items-center","justify-center","h-full","text-[var(--mat-sys-on-surface-variant)]","gap-4"],[1,"absolute","top-6","right-6","flex","flex-col","gap-2","max-w-sm","pointer-events-none","z-20"],[1,"h-64","shrink-0","glass-footer","border-t","border-[var(--mat-sys-outline-variant)]","grid","grid-cols-12","overflow-hidden","shadow-[0_-4px_20px_rgba(0,0,0,0.05)]","z-10"],[1,"col-span-12","md:col-span-5","lg:col-span-4","border-r","border-[var(--mat-sys-outline-variant)]"],[3,"run"],[1,"col-span-12","md:col-span-7","lg:col-span-8"],[3,"resource"],[1,"max-w-full","max-h-full",3,"resourceSelected","resource","state"],[1,"text-6xl"],[1,"text-lg"],[1,"pointer-events-auto","px-4","py-3","rounded-lg","border","shadow-lg","flex","gap-3","animate-in","slide-in-from-right-4",3,"bg-amber-50","border-amber-200","text-amber-900","bg-rose-50","border-rose-200","text-rose-900","bg-blue-50","border-blue-200","text-blue-900"],[1,"pointer-events-auto","px-4","py-3","rounded-lg","border","shadow-lg","flex","gap-3","animate-in","slide-in-from-right-4"],[1,"text-xl"],[1,"text-sm","font-medium"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"header",1)(2,"div",2)(3,"button",3),h("click",function(){return i.back.emit()}),o(4,"mat-icon"),r(5,"arrow_back"),a()(),o(6,"div",4)(7,"h1",5),r(8),a(),o(9,"div",6)(10,"span",7),r(11),a(),v(12,"span",8),o(13,"span",9),r(14),z(15,"uppercase"),a()()()(),o(16,"div",10),v(17,"app-deck-state-indicator",11),o(18,"div",12),v(19,"div",13),o(20,"span",14),r(21),a()()()(),o(22,"div",15),u(23,rn,2,2,"div",16)(24,cn,5,0,"div",17),u(25,sn,3,0,"div",18),a(),o(26,"footer",19)(27,"div",20),v(28,"app-protocol-progress-panel",21),a(),o(29,"div",22),v(30,"app-resource-inspector-panel",23),a()()()),e&2&&(c(8),x(" ",i.machine.name," "),c(3),x(" ",i.machine.model||i.machine.manufacturer||"Machine"," "),c(2),W(i.statusClass()),c(),x(" ",re(15,17,i.machine.status)," "),c(3),g("source",i.machine.stateSource),c(2),w("bg-emerald-500",i.machine.connectionState==="connected")("bg-amber-500",i.machine.connectionState==="connecting")("bg-rose-500",i.machine.connectionState==="disconnected"),c(2),x(" ",i.machine.connectionState," "),c(2),f(i.machine.plr_definition?23:24),c(2),f(i.machine.alerts.length>0?25:-1),c(3),g("run",i.machine.currentRun),c(2),g("resource",i.selectedResource()))},dependencies:[k,F,R,de,Ce,ve,be,ce],styles:["[_nghost-%COMP%]{display:block;height:100%}app-deck-view[_ngcontent-%COMP%]{transform-origin:center center}.glass-container[_ngcontent-%COMP%]{background:var(--mat-sys-surface-container-low)}.glass-header[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--mat-sys-surface-container) 85%,transparent);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}.glass-footer[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--mat-sys-surface-container) 90%,transparent);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)}"],changeDetection:0})};var mn=(t,n)=>n.fqn;function dn(t,n){t&1&&(o(0,"mat-error"),r(1,"Name is required"),a())}function pn(t,n){if(t&1&&(o(0,"mat-option",13),r(1),a()),t&2){let e=n.$implicit;g("value",e.fqn),c(),b(e.name)}}function un(t,n){if(t&1){let e=S();o(0,"button",34),h("click",function(){let l=_(e).$implicit,p=s(3);return C(p.addCarrier(l))}),o(1,"div",35)(2,"span",36),r(3),a(),o(4,"span",37),r(5),a()()()}if(t&2){let e=n.$implicit;c(3),b(e.name),c(2),H("",e.type," \u2022 ",e.numSlots," slots")}}function fn(t,n){if(t&1&&(o(0,"div",28)(1,"div",29),r(2,"Select a rail below, then click to add items."),a(),o(3,"mat-form-field",30)(4,"mat-label"),r(5,"Target Rail (1-30)"),a(),v(6,"input",31),a(),o(7,"div",32),A(8,un,6,3,"button",33),a()()),t&2){let e=s(2);c(6),g("formControl",e.targetRailControl),c(2),g("ngForOf",e.availableCarriers())}}function gn(t,n){t&1&&(o(0,"div",28)(1,"div",38),r(2," Slot-based layout editing is coming soon. For now, a standard layout is provided. "),a()())}function hn(t,n){if(t&1&&(o(0,"div",24)(1,"div",25)(2,"h3",26),r(3),a()(),A(4,fn,9,2,"div",27)(5,gn,3,0,"div",27),a()),t&2){let e=s();c(3),x(" ",e.isSlotBased()?"Labware":"Carriers"," "),c(),g("ngIf",!e.isSlotBased()),c(),g("ngIf",e.isSlotBased())}}function xn(t,n){t&1&&(o(0,"div",39)(1,"div",40)(2,"mat-icon",41),r(3,"grid_on"),a(),o(4,"h3",42),r(5,"Select a Deck Type"),a(),o(6,"p",43),r(7,"Choose a deck platform from the sidebar to start configuring."),a()()())}function _n(t,n){if(t&1&&(o(0,"span"),r(1),a()),t&2){let e,i=s();c(),x(" ",((e=i.currentDeckConfig())==null||e.carriers==null?null:e.carriers.length)||0," items placed ")}}var ke=class t{fb=N(it);dialogRef=N(Ae);deckService=N(le);configForm=this.fb.group({name:["",ne.required],deckType:["",ne.required]});targetRailControl=this.fb.control(10,[ne.min(1),ne.max(30)]);currentDeckConfig=E(null);availableCarriers=E([]);availableDecks=$e(this.deckService.loadDeckDefinitions(),{initialValue:[]});visualizationData=O(()=>{let n=this.currentDeckConfig();if(!n)return null;let e=this.deckService.getDeckDefinition(n.deckType);if(!e)return null;let i=this.deckService.createPlrResourceFromSpec(e);return n.carriers.forEach(l=>{let p=n.rails.find(Q=>Q.index===l.railPosition-1),y=p?p.xPosition:100,G={name:l.name,type:l.fqn.split(".").pop()||"Carrier",location:{x:y,y:0,z:0,type:"Coordinate"},size_x:l.dimensions.width,size_y:l.dimensions.height,size_z:l.dimensions.depth,children:[],rotation:{x:0,y:0,z:0}};l.slots.forEach(Q=>{G.children.push({name:Q.name,type:"Container",location:Q.position,size_x:Q.dimensions.width,size_y:Q.dimensions.height,size_z:10,children:[]})}),i.children.push(G)}),{resource:i,state:{}}});isSlotBased=O(()=>{let n=this.configForm.get("deckType")?.value;return n?.includes("OT")||n?.includes("Opentrons")});onDeckTypeChange(){let n=this.configForm.get("deckType")?.value;if(!n){this.currentDeckConfig.set(null);return}let e=this.deckService.getDeckDefinition(n);if(e){let i=this.deckService.createDeckConfiguration(e);this.currentDeckConfig.set(i),e.layoutType==="rail-based"?(this.availableCarriers.set(this.deckService.getCompatibleCarriers(n)),this.targetRailControl.setValue(10)):this.availableCarriers.set([])}}addCarrier(n){let e=this.currentDeckConfig(),i=this.targetRailControl.value||1;if(!e||!n)return;let l=`carrier_${Date.now()}`,p=this.deckService.createCarrierFromDefinition(n,l,i);this.currentDeckConfig.set($(j({},e),{carriers:[...e.carriers,p]}))}save(){if(this.configForm.invalid||!this.currentDeckConfig())return;let n=this.configForm.get("name")?.value||"Untitled Configuration",e=this.currentDeckConfig();this.deckService.saveUserDeckConfiguration(e,n).subscribe({next:i=>{console.log("Deck configuration saved",i),this.dialogRef.close(i)},error:i=>console.error("Failed to save config",i)})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-deck-simulation-dialog"]],decls:41,vars:8,consts:[[1,"h-full","flex","flex-col","overflow-hidden","bg-slate-50","dark:bg-slate-900"],[1,"px-6","py-4","bg-white","dark:bg-slate-950","border-b","border-slate-200","dark:border-slate-800","flex","items-center","justify-between","shrink-0"],[1,"text-xl","font-bold","text-slate-900","dark:text-white","m-0"],[1,"text-sm","text-slate-500","dark:text-slate-400","m-0"],["mat-icon-button","",3,"click"],[1,"flex-grow","flex","overflow-hidden"],[1,"w-80","flex","flex-col","border-r","border-slate-200","dark:border-slate-800","bg-white","dark:bg-slate-950","shrink-0"],[1,"p-4","space-y-6","overflow-y-auto"],[1,"flex","flex-col","gap-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name","placeholder","e.g. Standard PCR Setup"],[4,"ngIf"],["formControlName","deckType",3,"selectionChange"],[3,"value"],["class","flex flex-col gap-4",4,"ngIf"],[1,"p-4","border-t","border-slate-200","dark:border-slate-800","flex","gap-2","mt-auto"],["mat-stroked-button","",1,"flex-1",3,"click"],["mat-flat-button","","color","primary",1,"flex-1",3,"click","disabled"],[1,"flex-grow","bg-slate-100","dark:bg-slate-900","p-4","overflow-hidden","relative"],[1,"absolute","inset-4","bg-white","dark:bg-slate-950","rounded-xl","shadow-sm","border","border-slate-200","dark:border-slate-800","overflow-hidden","flex","flex-col"],[1,"flex-grow","overflow-hidden","relative"],[3,"layoutData"],["class","absolute inset-0 z-10 bg-white/50 dark:bg-black/50 backdrop-blur-sm flex items-center justify-center",4,"ngIf"],[1,"px-4","py-2","bg-slate-50","dark:bg-slate-900","border-t","border-slate-200","dark:border-slate-800","text-xs","text-slate-500","flex","justify-between"],[1,"flex","flex-col","gap-4"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-bold","text-slate-700","dark:text-slate-300","uppercase","tracking-wider","m-0"],["class","flex flex-col gap-2",4,"ngIf"],[1,"flex","flex-col","gap-2"],[1,"text-xs","text-slate-500","mb-2"],["appearance","outline",1,"w-full","text-sm"],["matInput","","type","number","min","1","max","30",3,"formControl"],[1,"grid","grid-cols-1","gap-2"],["mat-stroked-button","","class","justify-start !text-left h-auto py-2",3,"click",4,"ngFor","ngForOf"],["mat-stroked-button","",1,"justify-start","!text-left","h-auto","py-2",3,"click"],[1,"flex","flex-col","items-start","gap-1"],[1,"font-medium"],[1,"text-xs","text-slate-500"],[1,"p-3","bg-blue-50","dark:bg-blue-900/20","text-blue-700","dark:text-blue-300","text-sm","rounded-md"],[1,"absolute","inset-0","z-10","bg-white/50","dark:bg-black/50","backdrop-blur-sm","flex","items-center","justify-center"],[1,"bg-white","dark:bg-slate-800","p-6","rounded-xl","shadow-lg","border","border-slate-200","dark:border-slate-700","text-center","max-w-sm"],[1,"text-4xl","text-slate-400","mb-2"],[1,"text-lg","font-medium","text-slate-900","dark:text-white"],[1,"text-slate-500"]],template:function(e,i){if(e&1&&(o(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),r(4,"New Deck Simulation"),a(),o(5,"p",3),r(6,"Configure detailed deck layout for simulation"),a()(),o(7,"button",4),h("click",function(){return i.close()}),o(8,"mat-icon"),r(9,"close"),a()()(),o(10,"div",5)(11,"div",6)(12,"div",7)(13,"form",8)(14,"mat-form-field",9)(15,"mat-label"),r(16,"Configuration Name"),a(),v(17,"input",10),A(18,dn,2,0,"mat-error",11),a(),o(19,"mat-form-field",9)(20,"mat-label"),r(21,"Deck Type"),a(),o(22,"mat-select",12),h("selectionChange",function(){return i.onDeckTypeChange()}),P(23,pn,2,2,"mat-option",13,mn),a()()(),v(25,"mat-divider"),A(26,hn,6,3,"div",14),a(),o(27,"div",15)(28,"button",16),h("click",function(){return i.close()}),r(29,"Cancel"),a(),o(30,"button",17),h("click",function(){return i.save()}),r(31," Save Configuration "),a()()(),o(32,"div",18)(33,"div",19)(34,"div",20),v(35,"app-deck-visualizer",21),A(36,xn,8,0,"div",22),a(),o(37,"div",23)(38,"span"),r(39),a(),A(40,_n,2,1,"span",11),a()()()()()),e&2){let l,p;c(13),g("formGroup",i.configForm),c(5),g("ngIf",(l=i.configForm.get("name"))==null?null:l.hasError("required")),c(5),D(i.availableDecks()),c(3),g("ngIf",i.currentDeckConfig()),c(4),g("disabled",i.configForm.invalid||!i.currentDeckConfig()),c(5),g("layoutData",i.visualizationData()),c(),g("ngIf",!i.currentDeckConfig()),c(3),b(((p=i.currentDeckConfig())==null?null:p.deckName)||"No Deck"),c(),g("ngIf",i.currentDeckConfig())}},dependencies:[k,Be,Le,Qe,B,K,Y,F,R,xt,ct,at,rt,ht,gt,lt,mt,st,pt,_t,ut,ot,Ke,Ue,Je,He,Ye,nt,tt,Xe,et,Ze,ft],styles:["[_nghost-%COMP%]{display:block;height:85vh;width:90vw;max-width:1400px}"],changeDetection:0})};var vt=(t,n)=>n.accession_id;function Cn(t,n){t&1&&(o(0,"span",15),r(1,"Loading..."),a())}function vn(t,n){if(t&1){let e=S();o(0,"header",8)(1,"div",13)(2,"h1",14),r(3,"Workcell Dashboard"),a(),u(4,Cn,2,0,"span",15),a(),o(5,"div",16)(6,"button",17),h("click",function(){_(e);let l=s();return C(l.openSimulationDialog())}),o(7,"mat-icon"),r(8,"science"),a(),r(9," Simulate "),a(),v(10,"div",18),o(11,"div",19)(12,"button",20),h("click",function(){_(e);let l=s();return C(l.setViewMode("grid"))}),r(13," Grid "),a(),o(14,"button",20),h("click",function(){_(e);let l=s();return C(l.setViewMode("list"))}),r(15," List "),a()()()()}if(t&2){let e=s();c(4),f(e.isLoading()?4:-1),c(8),w("bg-white",e.viewMode()==="grid")("shadow-sm",e.viewMode()==="grid")("dark:bg-slate-700",e.viewMode()==="grid"),c(2),w("bg-white",e.viewMode()==="list")("shadow-sm",e.viewMode()==="list")("dark:bg-slate-700",e.viewMode()==="list")}}function bn(t,n){t&1&&(o(0,"div",10),v(1,"div",21),a())}function Mn(t,n){if(t&1){let e=S();o(0,"app-machine-card",26),h("machineSelected",function(l){_(e);let p=s(3);return C(p.onMachineSelected(l))}),a()}if(t&2){let e=n.$implicit;g("machine",e)}}function kn(t,n){if(t&1){let e=S();o(0,"div",25)(1,"mat-icon",27),r(2,"precision_manufacturing"),a(),o(3,"p"),r(4,"No machines found"),a(),o(5,"button",28),h("click",function(){_(e);let l=s(3);return C(l.openSimulationDialog())}),r(6," Create Simulation "),a()()}}function yn(t,n){if(t&1&&(o(0,"div",22),P(1,Mn,1,1,"app-machine-card",24,vt,!1,kn,7,0,"div",25),a()),t&2){let e=s(2);c(),D(e.allMachines())}}function Sn(t,n){if(t&1){let e=S();o(0,"app-machine-card-mini",26),h("machineSelected",function(l){_(e);let p=s(3);return C(p.onMachineSelected(l))}),a()}if(t&2){let e=n.$implicit;g("machine",e)}}function wn(t,n){t&1&&(o(0,"div",29)(1,"p"),r(2,"No machines found"),a()())}function En(t,n){if(t&1&&(o(0,"div",23),P(1,Sn,1,1,"app-machine-card-mini",24,vt,!1,wn,3,0,"div",29),a()),t&2){let e=s(2);c(),D(e.allMachines())}}function Pn(t,n){if(t&1){let e=S();o(0,"app-machine-focus-view",31),h("back",function(){_(e);let l=s(3);return C(l.clearSelection())}),a()}t&2&&g("machine",n)}function Dn(t,n){t&1&&(o(0,"div",30)(1,"mat-icon",32),r(2,"select_all"),a(),o(3,"p"),r(4,"Select a machine from the explorer to focus"),a()())}function On(t,n){if(t&1&&u(0,Pn,1,1,"app-machine-focus-view",24)(1,Dn,5,0,"div",30),t&2){let e,i=s(2);f((e=i.selectedMachine())?0:1,e)}}function Tn(t,n){if(t&1&&u(0,yn,4,1,"div",22)(1,En,4,1,"div",23)(2,On,2,1),t&2){let e,i=s();f((e=i.viewMode())==="grid"?0:e==="list"?1:e==="focus"?2:-1)}}var ye=class t{viewService=N(pe);dialog=N(qe);viewMode=E("grid");isLoading=E(!0);workcellGroups=this.viewService.workcellGroups;selectedMachine=this.viewService.selectedMachine;allMachines=O(()=>this.workcellGroups().flatMap(n=>n.machines));contextMenuTrigger;contextMenuPosition={x:"0px",y:"0px"};ngOnInit(){this.viewService.loadWorkcellGroups().subscribe({next:()=>this.isLoading.set(!1),error:n=>{console.error("Failed to load workcells",n),this.isLoading.set(!1)}})}setViewMode(n){this.viewMode.set(n)}onMachineSelected(n){this.selectedMachine.set(n),this.viewMode.set("focus")}clearSelection(){this.selectedMachine.set(null),this.viewMode.set("grid")}onContextMenu(n){n.preventDefault(),this.contextMenuPosition.x=n.clientX+"px",this.contextMenuPosition.y=n.clientY+"px",this.contextMenuTrigger.openMenu()}openSimulationDialog(){this.dialog.open(ke,{width:"90vw",maxWidth:"1400px",height:"85vh",panelClass:"simulation-dialog-panel"}).afterClosed().subscribe(n=>{n&&this.viewService.loadWorkcellGroups().subscribe()})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=M({type:t,selectors:[["app-workcell-dashboard"]],viewQuery:function(e,i){if(e&1&&Re(L,5),e&2){let l;Fe(l=ze())&&(i.contextMenuTrigger=l.first)}},decls:23,vars:10,consts:[["contextMenu","matMenu"],[1,"flex","h-full","w-full","overflow-hidden","bg-slate-50","dark:bg-slate-900"],[1,"w-[280px]","flex-shrink-0","border-r","border-slate-200","bg-white","dark:border-slate-800","dark:bg-slate-950"],[1,"flex","h-full","flex-col"],[1,"flex-grow","p-0","overflow-hidden"],[3,"machineSelect","groups"],[1,"flex","flex-col","flex-grow","relative","overflow-hidden",3,"contextmenu"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],[1,"flex","items-center","justify-between","px-6","py-4","bg-white","border-b","border-slate-200","dark:bg-slate-950","dark:border-slate-800"],[1,"flex","flex-col","flex-grow","overflow-auto"],[1,"flex","items-center","justify-center","h-full"],["mat-menu-item","",3,"click"],["mat-menu-item","","disabled",""],[1,"flex","items-center","gap-4"],[1,"text-xl","font-bold","text-slate-900","dark:text-white"],[1,"text-xs","text-slate-400","animate-pulse"],[1,"flex","items-center","gap-3"],["mat-stroked-button","","color","primary",3,"click"],[1,"h-6","w-px","bg-slate-200","dark:bg-slate-700","mx-1"],[1,"flex","items-center","bg-slate-100","dark:bg-slate-800","p-1","rounded-lg"],[1,"px-3","py-1","text-sm","rounded-md","transition-all",3,"click"],[1,"w-8","h-8","border-4","border-primary","border-t-transparent","rounded-full","animate-spin"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","gap-6","fade-in"],[1,"flex","flex-col","gap-4","fade-in"],[3,"machine"],[1,"col-span-full","flex","flex-col","items-center","justify-center","py-20","text-slate-400"],[3,"machineSelected","machine"],[1,"mb-4","text-slate-400","!w-16","!h-16","!text-[64px]"],["mat-flat-button","","color","primary",1,"mt-4",3,"click"],[1,"flex","flex-col","items-center","justify-center","py-10","text-slate-400"],[1,"flex","flex-col","items-center","justify-center","h-full","text-slate-400","fade-in"],[3,"back","machine"],[1,"text-6xl","mb-4"]],template:function(e,i){if(e&1){let l=S();o(0,"div",1)(1,"aside",2)(2,"div",3)(3,"div",4)(4,"app-workcell-explorer",5),h("machineSelect",function(y){return _(l),C(i.onMachineSelected(y))}),a()()()(),o(5,"main",6),h("contextmenu",function(y){return _(l),C(i.onContextMenu(y))}),v(6,"div",7),u(7,vn,16,13,"header",8),o(8,"div",9),u(9,bn,2,0,"div",10)(10,Tn,3,1),a()(),o(11,"mat-menu",null,0)(13,"button",11),h("click",function(){return _(l),C(i.openSimulationDialog())}),o(14,"mat-icon"),r(15,"add_box"),a(),o(16,"span"),r(17,"Add Simulated Deck"),a()(),o(18,"button",12)(19,"mat-icon"),r(20,"refresh"),a(),o(21,"span"),r(22,"Refresh View"),a()()()()}if(e&2){let l=U(12);c(4),g("groups",i.workcellGroups()),c(2),ae("left",i.contextMenuPosition.x)("top",i.contextMenuPosition.y),g("matMenuTriggerFor",l),c(),f(i.viewMode()!=="focus"?7:-1),c(),w("p-6",i.viewMode()!=="focus"),c(),f(i.isLoading()?9:10)}},dependencies:[k,F,R,B,K,Z,X,J,L,ge,he,_e,Me],styles:["[_nghost-%COMP%]{display:block;height:100%}.fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}"],changeDetection:0})};var Qo=[{path:"",component:ye}];export{Qo as WORKCELL_ROUTES};
