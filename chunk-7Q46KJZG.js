import{a as gt}from"./chunk-NIC47EBS.js";import"./chunk-JHMITVIR.js";import"./chunk-HXPSBJ7W.js";import{b as Re}from"./chunk-EIDTJXSK.js";import{a as st}from"./chunk-U2FQBRAF.js";import{a as tt,b as nt}from"./chunk-KHLMMB7R.js";import{h as it,i as ot}from"./chunk-GKGNTNFJ.js";import{e as mt}from"./chunk-WNYFH7QK.js";import{k as U}from"./chunk-BRQ7VCIS.js";import{a as ct,c as lt,d as dt,e as pt}from"./chunk-XG2SDX2Y.js";import{a as Qe}from"./chunk-OFJDRZ5L.js";import"./chunk-LAXWCL6A.js";import{a as Je,c as Xe}from"./chunk-ZERELBVC.js";import{c as Te}from"./chunk-JG6HUHEY.js";import{c as Oe}from"./chunk-VFPGQJKT.js";import"./chunk-GX2D2L2X.js";import{b as ut,k as ht}from"./chunk-ERJX7L3L.js";import"./chunk-5XV7PTQI.js";import{a as Ye,b as Ze}from"./chunk-FFXGIJC7.js";import{f as et}from"./chunk-7F4BNMQ6.js";import{a as ke,b as De}from"./chunk-HJ4PUJUU.js";import"./chunk-GW7MQSL6.js";import"./chunk-F4M4TAIC.js";import{f as qe,j as He,m as Ge,p as N,q as Ke,r as $}from"./chunk-FGBSBVHW.js";import"./chunk-5R36QA5Q.js";import{a as rt,h as at}from"./chunk-SJZ6P2DA.js";import"./chunk-SKMC2KSJ.js";import{P as Ee,R as A,S as L,U as Be,Z as Fe,_ as Ae,aa as K,da as Le,ga as Ne,ha as $e,na as Ue,oa as We,sa as je,ta as ze,ua as Ve}from"./chunk-YMB734HE.js";import"./chunk-HUJ7WYYJ.js";import{b as B,c as F}from"./chunk-M6LIKZVL.js";import{E as Ie,e as xe,f as Ce,g as we,h as Me,i as Pe,s as Se}from"./chunk-Q6UYEA4T.js";import{$b as P,Aa as se,Ac as ye,Bb as T,Bc as c,Cc as g,Dc as O,Ga as b,Hb as v,Ja as ce,Ma as le,Sb as S,Tb as I,Wb as pe,Xb as me,Yb as u,Zb as r,Zc as be,_b as a,dc as ue,e as oe,ec as he,gc as w,ha as E,hb as de,hd as ve,j as re,kc as _,l as ae,lb as l,ma as y,mc as p,qc as ge,rc as fe,sa as x,sc as _e,ta as C,yc as R}from"./chunk-ZXFVGPYG.js";import{a as ne,b as ie}from"./chunk-RNQFGQA5.js";var bt=(function(o){return o[o.UsbCdcAcm=0]="UsbCdcAcm",o})(bt||{}),Pt=32,St=34,It=35,ft=255,Ot=8,kt="none",Dt=1,Et=[16,8,7,6,5],Tt=[1,2],Rt=["none","even","odd"],Bt=["none","odd","even"],Ft=[1,1.5,2],Q={protocol:bt.UsbCdcAcm,usbControlInterfaceClass:2,usbTransferInterfaceClass:10};function _t(o,e){let t=o.configurations[0];for(let n of t.interfaces)if(n.alternates[0].interfaceClass===e)return n;throw new TypeError(`Unable to find interface with class ${e}.`)}function yt(o,e){let t=o.alternates[0];for(let n of t.endpoints)if(n.direction==e)return n;throw new TypeError(`Interface ${o.interfaceNumber} does not have an ${e} endpoint.`)}var J=class{constructor(e,t,n){this.type="bytes",this.device_=e,this.endpoint_=t,this.onError_=n}pull(e){(async()=>{var t;let n;if(e.desiredSize){let i=e.desiredSize/this.endpoint_.packetSize;n=Math.ceil(i)*this.endpoint_.packetSize}else n=this.endpoint_.packetSize;try{let i=await this.device_.transferIn(this.endpoint_.endpointNumber,n);if(i.status!="ok"&&(e.error(`USB error: ${i.status}`),this.onError_()),!((t=i.data)===null||t===void 0)&&t.buffer){let s=new Uint8Array(i.data.buffer,i.data.byteOffset,i.data.byteLength);e.enqueue(s)}}catch(i){e.error(i.toString()),this.onError_()}})()}},X=class{constructor(e,t,n){this.device_=e,this.endpoint_=t,this.onError_=n}async write(e,t){try{let n=await this.device_.transferOut(this.endpoint_.endpointNumber,e);n.status!="ok"&&(t.error(n.status),this.onError_())}catch(n){t.error(n.toString()),this.onError_()}}},W=class{constructor(e,t){this.polyfillOptions_=Object.assign(Object.assign({},Q),t),this.outputSignals_={dataTerminalReady:!1,requestToSend:!1,break:!1},this.device_=e,this.controlInterface_=_t(this.device_,this.polyfillOptions_.usbControlInterfaceClass),this.transferInterface_=_t(this.device_,this.polyfillOptions_.usbTransferInterfaceClass),this.inEndpoint_=yt(this.transferInterface_,"in"),this.outEndpoint_=yt(this.transferInterface_,"out")}get readable(){var e;return!this.readable_&&this.device_.opened&&(this.readable_=new ReadableStream(new J(this.device_,this.inEndpoint_,()=>{this.readable_=null}),{highWaterMark:(e=this.serialOptions_.bufferSize)!==null&&e!==void 0?e:ft})),this.readable_}get writable(){var e;return!this.writable_&&this.device_.opened&&(this.writable_=new WritableStream(new X(this.device_,this.outEndpoint_,()=>{this.writable_=null}),new ByteLengthQueuingStrategy({highWaterMark:(e=this.serialOptions_.bufferSize)!==null&&e!==void 0?e:ft}))),this.writable_}async open(e){this.serialOptions_=e,this.validateOptions();try{await this.device_.open(),this.device_.configuration===null&&await this.device_.selectConfiguration(1),await this.device_.claimInterface(this.controlInterface_.interfaceNumber),this.controlInterface_!==this.transferInterface_&&await this.device_.claimInterface(this.transferInterface_.interfaceNumber),await this.setLineCoding(),await this.setSignals({dataTerminalReady:!0})}catch(t){throw this.device_.opened&&await this.device_.close(),new Error("Error setting up device: "+t.toString())}}async close(){let e=[];this.readable_&&e.push(this.readable_.cancel()),this.writable_&&e.push(this.writable_.abort()),await Promise.all(e),this.readable_=null,this.writable_=null,this.device_.opened&&(await this.setSignals({dataTerminalReady:!1,requestToSend:!1}),await this.device_.close())}async forget(){return this.device_.forget()}getInfo(){return{usbVendorId:this.device_.vendorId,usbProductId:this.device_.productId}}reconfigure(e){return this.serialOptions_=Object.assign(Object.assign({},this.serialOptions_),e),this.validateOptions(),this.setLineCoding()}async setSignals(e){if(this.outputSignals_=Object.assign(Object.assign({},this.outputSignals_),e),e.dataTerminalReady!==void 0||e.requestToSend!==void 0){let t=(this.outputSignals_.dataTerminalReady?1:0)|(this.outputSignals_.requestToSend?2:0);await this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:St,value:t,index:this.controlInterface_.interfaceNumber})}if(e.break!==void 0){let t=this.outputSignals_.break?65535:0;await this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:It,value:t,index:this.controlInterface_.interfaceNumber})}}validateOptions(){if(!this.isValidBaudRate(this.serialOptions_.baudRate))throw new RangeError("invalid Baud Rate "+this.serialOptions_.baudRate);if(!this.isValidDataBits(this.serialOptions_.dataBits))throw new RangeError("invalid dataBits "+this.serialOptions_.dataBits);if(!this.isValidStopBits(this.serialOptions_.stopBits))throw new RangeError("invalid stopBits "+this.serialOptions_.stopBits);if(!this.isValidParity(this.serialOptions_.parity))throw new RangeError("invalid parity "+this.serialOptions_.parity)}isValidBaudRate(e){return e%1===0}isValidDataBits(e){return typeof e>"u"?!0:Et.includes(e)}isValidStopBits(e){return typeof e>"u"?!0:Tt.includes(e)}isValidParity(e){return typeof e>"u"?!0:Rt.includes(e)}async setLineCoding(){var e,t,n;let i=new ArrayBuffer(7),s=new DataView(i);if(s.setUint32(0,this.serialOptions_.baudRate,!0),s.setUint8(4,Ft.indexOf((e=this.serialOptions_.stopBits)!==null&&e!==void 0?e:Dt)),s.setUint8(5,Bt.indexOf((t=this.serialOptions_.parity)!==null&&t!==void 0?t:kt)),s.setUint8(6,(n=this.serialOptions_.dataBits)!==null&&n!==void 0?n:Ot),(await this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:Pt,value:0,index:this.controlInterface_.interfaceNumber},i)).status!="ok")throw new DOMException("NetworkError","Failed to set line coding.")}},Y=class{async requestPort(e,t){t=Object.assign(Object.assign({},Q),t);let n=[];if(e&&e.filters)for(let d of e.filters){let m={classCode:t.usbControlInterfaceClass};d.usbVendorId!==void 0&&(m.vendorId=d.usbVendorId),d.usbProductId!==void 0&&(m.productId=d.usbProductId),n.push(m)}n.length===0&&n.push({classCode:t.usbControlInterfaceClass});let i=await navigator.usb.requestDevice({filters:n});return new W(i,t)}async getPorts(e){e=Object.assign(Object.assign({},Q),e);let t=await navigator.usb.getDevices(),n=[];return t.forEach(i=>{try{let s=new W(i,e);n.push(s)}catch{}}),n}},vt=new Y;var k=1027,xt={9600:[16696,0],19200:[32924,0],38400:[49230,0],57600:[52,0],115200:[26,0],125e3:[24,0],230400:[13,0]},Z=class{device;_isOpen=!1;endpointIn=1;endpointOut=2;baudRate=9600;constructor(e){this.device=e}get isOpen(){return this._isOpen}async open(e){if(this._isOpen)throw new Error("FTDI port is already open");this.baudRate=e?.baudRate??9600;try{await this.device.open(),this.device.configuration===null&&await this.device.selectConfiguration(1),await this.device.claimInterface(0),await this.device.controlTransferOut({requestType:"vendor",recipient:"device",request:0,value:0,index:0}),await this.setBaudRate(this.baudRate),await this.setDataCharacteristics(e?.dataBits??8,e?.stopBits??1,e?.parity??"none"),this.discoverEndpoints(),this._isOpen=!0,console.log(`[FtdiSerial] Opened device at ${this.baudRate} baud`)}catch(t){try{await this.device.close()}catch{}throw new Error(`Failed to open FTDI device: ${t}`)}}async close(){if(this._isOpen)try{await this.device.releaseInterface(0),await this.device.close()}finally{this._isOpen=!1}}async read(e){if(!this._isOpen)throw new Error("Port is not open");try{let t=await this.device.transferIn(this.endpointIn,e+2);if(t.status==="ok"&&t.data&&t.data.byteLength>2){let n=t.data,i=new Uint8Array(n.byteLength-2);for(let s=2;s<n.byteLength;s++)i[s-2]=n.getUint8(s);return i}return new Uint8Array(0)}catch(t){return console.error("[FtdiSerial] Read error:",t),new Uint8Array(0)}}async write(e){if(!this._isOpen)throw new Error("Port is not open");try{let t=await this.device.transferOut(this.endpointOut,e);if(t.status!=="ok")throw new Error(`Write failed with status: ${t.status}`)}catch(t){throw new Error(`FTDI write failed: ${t}`)}}async setBaudRate(e){let t=xt[e]??xt[9600];await this.device.controlTransferOut({requestType:"vendor",recipient:"device",request:3,value:t[0],index:t[1]})}async setDataCharacteristics(e,t,n){let i=e;n==="odd"?i|=256:n==="even"&&(i|=512),t===2&&(i|=4096),await this.device.controlTransferOut({requestType:"vendor",recipient:"device",request:4,value:i,index:0})}discoverEndpoints(){let e=this.device.configuration;if(!e?.interfaces)return;let t=e.interfaces[0];if(t?.alternate?.endpoints)for(let n of t.alternate.endpoints)n.direction==="in"?this.endpointIn=n.endpointNumber:n.direction==="out"&&(this.endpointOut=n.endpointNumber)}},j=class{driverName="FTDI";supportedDevices=[{vendorId:k,productId:24577},{vendorId:k,productId:24592},{vendorId:k,productId:24596},{vendorId:k,productId:24597},{vendorId:k,productId:47976}];async connect(e){return new Z(e)}static isFtdiDevice(e){return e===k}};var ee=class{_isOpen=!1;responseQueue=[];writeLog=[];get isOpen(){return this._isOpen}async open(e){if(this._isOpen)throw new Error("Port is already open");this._isOpen=!0}async close(){if(!this._isOpen)throw new Error("Port is not open");this._isOpen=!1}async read(e){if(!this._isOpen)throw new Error("Port is not open");return this.responseQueue.length>0?this.responseQueue.shift().slice(0,e):new Uint8Array(0)}async write(e){if(!this._isOpen)throw new Error("Port is not open");this.writeLog.push(new Uint8Array(e)),console.debug("[MockSerial] Write:",e)}queueResponse(e){this.responseQueue.push(e)}queueResponses(e){this.responseQueue.push(...e)}getWriteLog(){return[...this.writeLog]}clearWriteLog(){this.writeLog=[]}clearResponseQueue(){this.responseQueue=[]}reset(){this._isOpen=!1,this.responseQueue=[],this.writeLog=[]}},z=class{driverName="MockSerial";supportedDevices=[{vendorId:65535,productId:65535}];mockSerial=null;async connect(e){return this.mockSerial=new ee,this.mockSerial}getLastMockSerial(){return this.mockSerial}};var V=[],Ct=!1;function At(){Ct||(V.push(new j),Lt()&&(V.push(new z),console.debug("[DriverRegistry] Test mode: MockSerialDriver registered")),Ct=!0,console.debug(`[DriverRegistry] Initialized with ${V.length} drivers`))}function Lt(){return typeof window>"u"?!1:!!window.__PRAXIS_TEST_MODE__}function wt(o,e){return At(),V.find(t=>t.supportedDevices.some(n=>n.vendorId===o&&n.productId===e))}var q=class o{connections=new Map;connectionStates=new Map;statusSubject=new re;status$=this.statusSubject.asObservable();connectionsSubject=new ae([]);connections$=this.connectionsSubject.asObservable();channel=null;constructor(){this.initializeChannel()}ngOnDestroy(){this.channel?.close();for(let e of this.connections.keys())this.disconnect(e).catch(console.error)}initializeChannel(){if(typeof BroadcastChannel>"u"){console.warn("[SerialManager] BroadcastChannel not available");return}this.channel=new BroadcastChannel("praxis_serial"),this.channel.onmessage=e=>{this.handleWorkerMessage(e.data)},console.log("[SerialManager] Initialized with BroadcastChannel")}async handleWorkerMessage(e){if(e?.type?.startsWith("serial:")){console.log("[SerialManager] Received request:",e.type,e.requestId);try{let t;switch(e.type){case"serial:open":await this.handleOpenRequest(e),t={type:"serial:response",requestId:e.requestId,success:!0,deviceId:e.deviceId};break;case"serial:close":await this.disconnect(e.deviceId),t={type:"serial:response",requestId:e.requestId,success:!0};break;case"serial:read":let n=await this.read(e.deviceId,e.length||64);t={type:"serial:response",requestId:e.requestId,success:!0,data:Array.from(n)};break;case"serial:write":await this.write(e.deviceId,new Uint8Array(e.data||[])),t={type:"serial:response",requestId:e.requestId,success:!0};break;default:t={type:"serial:response",requestId:e.requestId,success:!1,error:`Unknown request type: ${e.type}`}}this.sendResponse(t)}catch(t){let n=t instanceof Error?t.message:String(t);console.error("[SerialManager] Request failed:",n),this.sendResponse({type:"serial:response",requestId:e.requestId,success:!1,error:n})}}}async handleOpenRequest(e){let{vendorId:t,productId:n,options:i}=e;if(!t||!n)throw new Error("vendorId and productId are required for open");let s=e.deviceId||`usb-${t.toString(16)}-${n.toString(16)}`;if(this.connections.has(s)){console.log(`[SerialManager] Device ${s} already connected`);return}let d=wt(t,n);if(!d)throw new Error(`No driver found for device VID=${t.toString(16)} PID=${n.toString(16)}`);let f=(await navigator.usb.getDevices()).find(h=>h.vendorId===t&&h.productId===n);if(!f)throw new Error("USB device not found. Make sure it's authorized via the UI.");this.updateConnectionState(s,"connecting",t,n);let M=await d.connect(f);await M.open({baudRate:i?.baudRate??9600,dataBits:i?.dataBits??8,stopBits:i?.stopBits??1,parity:i?.parity??"none"}),this.connections.set(s,M),this.updateConnectionState(s,"connected",t,n),console.log(`[SerialManager] Connected to ${s} via ${d.driverName}`)}sendResponse(e){if(!this.channel){console.error("[SerialManager] Cannot send response: no channel");return}this.channel.postMessage(e)}updateConnectionState(e,t,n,i,s){let d={deviceId:e,status:t,vendorId:n,productId:i,errorMessage:s};t==="disconnected"?this.connectionStates.delete(e):this.connectionStates.set(e,d),this.statusSubject.next({deviceId:e,status:t,errorMessage:s}),this.connectionsSubject.next(Array.from(this.connectionStates.values()))}async connect(e,t,n){let i=`usb-${e.toString(16)}-${t.toString(16)}`;return await this.handleOpenRequest({type:"serial:open",requestId:"direct-connect",deviceId:i,vendorId:e,productId:t,options:n}),i}async disconnect(e){let t=this.connections.get(e);if(!t){console.warn(`[SerialManager] Device ${e} not connected`);return}try{await t.close()}catch(n){console.error(`[SerialManager] Error closing ${e}:`,n)}finally{this.connections.delete(e),this.updateConnectionState(e,"disconnected")}}isConnected(e){return this.connections.get(e)?.isOpen??!1}async write(e,t){let n=this.connections.get(e);if(!n)throw new Error(`Device ${e} not connected`);if(!n.isOpen)throw new Error(`Device ${e} is not open`);await n.write(t)}async read(e,t){let n=this.connections.get(e);if(!n)throw new Error(`Device ${e} not connected`);if(!n.isOpen)throw new Error(`Device ${e} is not open`);return n.read(t)}getActiveConnections(){return Array.from(this.connectionStates.values())}getConnectionState(e){return this.connectionStates.get(e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=E({token:o,factory:o.\u0275fac,providedIn:"root"})};function Wt(o,e){if(o&1){let t=w();r(0,"button",15),_("click",function(){let i=x(t).$implicit,s=p(2);return C(s.onMethodSelected(i))}),r(1,"mat-icon",16),c(2),a(),c(3),a()}if(o&2){let t=e.$implicit,n=p(2);R("lifecycle",n.isLifecycleMethod(t.name))("selected",(n.selectedMethod==null?null:n.selectedMethod.name)===t.name),l(2),g(n.getMethodIcon(t.name)),l(),O(" ",n.formatMethodName(t.name)," ")}}function jt(o,e){if(o&1&&(r(0,"p",27),c(1),a()),o&2){let t=p(3);l(),g(t.selectedMethod==null?null:t.selectedMethod.doc)}}function zt(o,e){o&1&&(r(0,"div",28)(1,"mat-icon"),c(2,"check_circle"),a(),r(3,"span"),c(4,"No parameters required"),a()())}function Vt(o,e){if(o&1&&(r(0,"div",35)(1,"mat-checkbox",36),c(2),a(),r(3,"span",37),c(4),a()()),o&2){let t=p().$implicit,n=p(4);l(),u("formControlName",t.name),l(),O(" ",n.formatArgName(t.name)," "),l(2),g(t.type)}}function qt(o,e){if(o&1&&(r(0,"mat-form-field",38)(1,"mat-label"),c(2),a(),P(3,"input",39),r(4,"span",40),c(5),a()()),o&2){let t=p().$implicit,n=p(4);l(2),g(n.formatArgName(t.name)),l(),u("formControlName",t.name)("placeholder",t.default!==null?""+t.default:"Optional"),l(2),g(t.type)}}function Ht(o,e){if(o&1&&(r(0,"mat-form-field",38)(1,"mat-label"),c(2),a(),P(3,"input",41),r(4,"span",40),c(5),a()()),o&2){let t=p().$implicit,n=p(4);l(2),g(n.formatArgName(t.name)),l(),u("formControlName",t.name)("placeholder",t.default!==void 0?""+t.default:"Required"),l(2),g(t.type)}}function Gt(o,e){if(o&1&&(ue(0),r(1,"div",31),v(2,Vt,5,3,"div",32)(3,qt,6,4,"mat-form-field",33)(4,Ht,6,4,"mat-form-field",34),a(),he()),o&2){let t=e.$implicit,n=p(4);l(),u("ngSwitch",n.getArgType(t)),l(),u("ngSwitchCase","checkbox"),l(),u("ngSwitchCase","number")}}function Kt(o,e){if(o&1&&(r(0,"div",29),v(1,Gt,5,3,"ng-container",30),a()),o&2){let t=p(3);l(),u("ngForOf",t.selectedMethod.args)}}function Qt(o,e){if(o&1){let t=w();r(0,"div",17)(1,"div",18)(2,"div",19)(3,"mat-icon",20),c(4),a(),r(5,"div")(6,"h4"),c(7),a(),v(8,jt,2,1,"p",21),a()()(),r(9,"form",22),v(10,zt,5,0,"div",23)(11,Kt,2,1,"div",24),r(12,"div",25)(13,"button",26),_("click",function(){x(t);let i=p(2);return C(i.runCommand())}),r(14,"mat-icon"),c(15,"play_arrow"),a(),c(16),a()()()()}if(o&2){let t=p(2);l(4),g(t.getMethodIcon(t.selectedMethod.name)),l(3),g(t.formatMethodName(t.selectedMethod.name)),l(),u("ngIf",t.selectedMethod==null?null:t.selectedMethod.doc),l(),u("formGroup",t.form),l(),u("ngIf",t.selectedMethod.args.length===0),l(),u("ngIf",t.selectedMethod.args.length>0),l(2),u("disabled",!t.form.valid),l(3),O(" Execute ",t.formatMethodName(t.selectedMethod.name)," ")}}function Jt(o,e){o&1&&(r(0,"div",42)(1,"mat-icon",43),c(2,"touch_app"),a(),r(3,"p"),c(4,"Select a method to configure and execute"),a()())}function Xt(o,e){o&1&&(r(0,"div",44)(1,"mat-icon",43),c(2,"warning"),a(),r(3,"p"),c(4,"No methods available for this machine"),a()())}function Yt(o,e){if(o&1&&(r(0,"div",7)(1,"div",8)(2,"h4",9)(3,"mat-icon"),c(4,"play_arrow"),a(),c(5," Quick Actions "),a(),r(6,"div",10),v(7,Wt,4,6,"button",11),a()(),v(8,Qt,17,8,"div",12)(9,Jt,5,0,"div",13)(10,Xt,5,0,"div",14),a()),o&2){let t=p();l(7),u("ngForOf",t.methods),l(),u("ngIf",t.selectedMethod),l(),u("ngIf",!t.selectedMethod&&t.methods.length>0),l(),u("ngIf",t.methods.length===0)}}var H=class o{machine=null;executeCommand=new se;methods=[];selectedMethod=null;form=new K({});fb=y(je);ngOnChanges(e){e.machine&&this.machine&&this.loadMethods()}loadMethods(){if(!this.machine)return;let t=this.machine.machine_category||"Other";this.methods=this.getMockMethodsForCategory(t),this.selectedMethod=null,this.form=new K({})}getMockMethodsForCategory(e){let t=[{name:"setup",doc:"Initialize and connect to the machine",args:[]},{name:"stop",doc:"Disconnect and cleanup machine resources",args:[]}],n=(()=>{switch(e){case"LiquidHandler":return[{name:"aspirate",doc:"Aspirate liquid from wells",args:[{name:"volume",type:"float",default:100},{name:"flow_rate",type:"float",default:null}]},{name:"dispense",doc:"Dispense liquid to wells",args:[{name:"volume",type:"float",default:100},{name:"flow_rate",type:"float",default:null}]},{name:"pick_up_tips",doc:"Pick up tips from a tip rack",args:[{name:"use_channels",type:"list[int]",default:null}]},{name:"drop_tips",doc:"Drop tips to trash or rack",args:[]},{name:"move_to",doc:"Move pipetting head to a position",args:[{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}];case"PlateReader":return[{name:"open",doc:"Open the plate reader lid for plate loading",args:[]},{name:"close",doc:"Close the plate reader lid",args:[]},{name:"read_absorbance",doc:"Read absorbance at wavelength",args:[{name:"wavelength",type:"int",default:450}]},{name:"read_fluorescence",doc:"Read fluorescence intensity",args:[{name:"excitation",type:"int",default:485},{name:"emission",type:"int",default:528}]},{name:"read_luminescence",doc:"Read luminescence",args:[]}];case"Shaker":return[{name:"shake",doc:"Start shaking at specified speed",args:[{name:"speed",type:"int",default:300},{name:"duration",type:"float",default:null}]},{name:"stop",doc:"Stop shaking",args:[]},{name:"set_temperature",doc:"Set heater temperature",args:[{name:"temperature",type:"float",default:37}]}];case"Centrifuge":return[{name:"spin",doc:"Spin at specified speed",args:[{name:"speed",type:"int",default:3e3},{name:"duration",type:"float",default:60},{name:"acceleration",type:"int",default:null}]},{name:"open_lid",doc:"Open the centrifuge lid",args:[]},{name:"close_lid",doc:"Close the centrifuge lid",args:[]}];case"Incubator":return[{name:"set_temperature",doc:"Set incubation temperature",args:[{name:"temperature",type:"float",default:37}]},{name:"set_co2",doc:"Set CO2 percentage",args:[{name:"co2_percent",type:"float",default:5}]},{name:"set_humidity",doc:"Set humidity percentage",args:[{name:"humidity_percent",type:"float",default:95}]}];default:return[{name:"get_status",doc:"Get current machine status",args:[]}]}})();return[...t,...n]}onMethodSelected(e){this.selectedMethod=e,this.buildForm(e)}buildForm(e){let t={};(e.args||[]).forEach(n=>{let i=n.default!==void 0?n.default:"";t[n.name]=new Le(i)}),this.form=this.fb.group(t)}getArgType(e){if(!e.type)return"text";let t=e.type.toLowerCase();return t.includes("int")||t.includes("float")?"number":t.includes("bool")?"checkbox":"text"}runCommand(){if(!this.machine||!this.selectedMethod)return;let e=this.form.value;(this.selectedMethod.args||[]).forEach(t=>{this.getArgType(t)==="number"&&e[t.name]!==void 0&&(e[t.name]=Number(e[t.name]))}),this.executeCommand.emit({machineName:this.machine.name,methodName:this.selectedMethod.name,args:e})}getMachineCategory(){return this.machine?.machine_category||"Machine"}isLifecycleMethod(e){return["setup","stop"].includes(e)}getMethodIcon(e){return{setup:"power_settings_new",stop:"power_off",aspirate:"arrow_upward",dispense:"arrow_downward",pick_up_tips:"upload",drop_tips:"download",move_to:"open_with",open:"eject",close:"input",read_absorbance:"wb_sunny",read_fluorescence:"flare",read_luminescence:"light_mode",shake:"vibration",spin:"loop",open_lid:"vertical_align_top",close_lid:"vertical_align_bottom",set_temperature:"thermostat",set_co2:"air",set_humidity:"water_drop",get_status:"info"}[e]||"play_arrow"}formatMethodName(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}formatArgName(e){return e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=T({type:o,selectors:[["app-direct-control"]],inputs:{machine:"machine"},outputs:{executeCommand:"executeCommand"},features:[le],decls:11,vars:3,consts:[[1,"direct-control-container"],[1,"header"],[1,"title-row"],[1,"machine-icon"],[1,"title-info"],[1,"category-badge"],["class","content",4,"ngIf"],[1,"content"],[1,"method-grid"],[1,"section-title"],[1,"method-chips"],["mat-stroked-button","","class","method-chip",3,"lifecycle","selected","click",4,"ngFor","ngForOf"],["class","method-panel",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","empty-state error",4,"ngIf"],["mat-stroked-button","",1,"method-chip",3,"click"],[1,"method-icon"],[1,"method-panel"],[1,"method-header"],[1,"method-title"],[1,"method-icon-lg"],["class","method-doc",4,"ngIf"],[1,"args-form",3,"formGroup"],["class","no-args",4,"ngIf"],["class","args-grid",4,"ngIf"],[1,"actions"],["mat-flat-button","","color","primary",1,"execute-btn",3,"click","disabled"],[1,"method-doc"],[1,"no-args"],[1,"args-grid"],[4,"ngFor","ngForOf"],[1,"arg-item",3,"ngSwitch"],["class","checkbox-field",4,"ngSwitchCase"],["appearance","outline","class","w-full",4,"ngSwitchCase"],["appearance","outline","class","w-full",4,"ngSwitchDefault"],[1,"checkbox-field"],["color","primary",3,"formControlName"],[1,"type-badge"],["appearance","outline",1,"w-full"],["matInput","","type","number",3,"formControlName","placeholder"],["matSuffix","",1,"type-badge"],["matInput","","type","text",3,"formControlName","placeholder"],[1,"empty-state"],[1,"empty-icon"],[1,"empty-state","error"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),c(4,"precision_manufacturing"),a(),r(5,"div",4)(6,"h3"),c(7),a(),r(8,"span",5),c(9),a()()()(),v(10,Yt,11,4,"div",6),a()),t&2&&(l(7),g(n.machine==null?null:n.machine.name),l(2),g(n.getMachineCategory()),l(),u("ngIf",n.machine))},dependencies:[Se,xe,Ce,we,Me,Pe,Ve,Ne,Be,$e,Fe,Ae,We,Ue,N,Ge,qe,He,U,$,Ke,L,A,nt,tt,F,B],styles:[".direct-control-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:var(--mat-sys-surface-container-lowest);border-radius:12px;overflow:hidden}.direct-control-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{padding:16px 20px;background:linear-gradient(135deg,var(--mat-sys-primary-container) 0%,var(--mat-sys-surface-container) 100%);border-bottom:1px solid var(--mat-sys-outline-variant)}.direct-control-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.direct-control-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .machine-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px;color:var(--mat-sys-primary)}.direct-control-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.direct-control-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;font-weight:600;color:var(--mat-sys-on-surface);line-height:1.2}.direct-control-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-info[_ngcontent-%COMP%]   .category-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;font-size:.75rem;font-weight:500;color:var(--mat-sys-on-primary-container);background:var(--mat-sys-primary-container);padding:2px 8px;border-radius:4px;width:fit-content}.direct-control-container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:16px;padding:16px 20px;overflow-y:auto}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:0 0 12px;font-size:.875rem;font-weight:600;color:var(--mat-sys-on-surface-variant);text-transform:uppercase;letter-spacing:.5px}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .method-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .method-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;font-size:.8125rem;font-weight:500;border-radius:20px;transition:all .2s ease;cursor:pointer}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .method-chip[_ngcontent-%COMP%]   .method-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .method-chip.lifecycle[_ngcontent-%COMP%]{border-color:var(--mat-sys-tertiary);color:var(--mat-sys-tertiary)}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .method-chip.lifecycle[_ngcontent-%COMP%]:hover{background:var(--mat-sys-tertiary-container)}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .method-chip.selected[_ngcontent-%COMP%]{background:var(--mat-sys-primary);color:var(--mat-sys-on-primary);border-color:var(--mat-sys-primary)}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .method-chip.selected.lifecycle[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary);color:var(--mat-sys-on-tertiary);border-color:var(--mat-sys-tertiary)}.direct-control-container[_ngcontent-%COMP%]   .method-grid[_ngcontent-%COMP%]   .method-chip[_ngcontent-%COMP%]:hover:not(.selected){background:var(--mat-sys-surface-container-high)}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:var(--mat-sys-surface-container);border-radius:12px;overflow:hidden;border:1px solid var(--mat-sys-outline-variant)}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .method-header[_ngcontent-%COMP%]{padding:16px;background:var(--mat-sys-surface-container-high);border-bottom:1px solid var(--mat-sys-outline-variant)}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .method-header[_ngcontent-%COMP%]   .method-title[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .method-header[_ngcontent-%COMP%]   .method-title[_ngcontent-%COMP%]   .method-icon-lg[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px;color:var(--mat-sys-primary);margin-top:2px}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .method-header[_ngcontent-%COMP%]   .method-title[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:600;color:var(--mat-sys-on-surface)}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .method-header[_ngcontent-%COMP%]   .method-title[_ngcontent-%COMP%]   .method-doc[_ngcontent-%COMP%]{margin:4px 0 0;font-size:.875rem;color:var(--mat-sys-on-surface-variant)}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .args-form[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;padding:16px;gap:16px}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .no-args[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px 16px;background:var(--mat-sys-surface-container-lowest);border-radius:8px;color:var(--mat-sys-on-surface-variant);font-size:.875rem}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .no-args[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--mat-sys-primary);font-size:20px;width:20px;height:20px}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .args-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .arg-item[_ngcontent-%COMP%]   .checkbox-field[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px;background:var(--mat-sys-surface-container-lowest);border-radius:8px;border:1px solid var(--mat-sys-outline-variant)}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .type-badge[_ngcontent-%COMP%]{font-size:.6875rem;font-weight:500;color:var(--mat-sys-outline);background:var(--mat-sys-surface-container-high);padding:2px 6px;border-radius:4px;font-family:JetBrains Mono,Fira Code,monospace}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:auto;padding-top:8px}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .execute-btn[_ngcontent-%COMP%]{width:100%;height:48px;font-size:.9375rem;font-weight:600;border-radius:8px}.direct-control-container[_ngcontent-%COMP%]   .method-panel[_ngcontent-%COMP%]   .execute-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.direct-control-container[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:12px;padding:32px;color:var(--mat-sys-on-surface-variant);text-align:center}.direct-control-container[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;opacity:.5}.direct-control-container[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.9375rem}.direct-control-container[_ngcontent-%COMP%]   .empty-state.error[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.direct-control-container[_ngcontent-%COMP%]   .w-full[_ngcontent-%COMP%]{width:100%}"]})};var G=class o{pyodide=null;bootPromise=null;instantiatedMachines=new Map;isReady=b(!1);isBooting=b(!1);bootError=b(null);lastOutput=b("");async boot(){if(!this.pyodide){if(this.bootPromise)return this.bootPromise;this.isBooting.set(!0),this.bootError.set(null),this.bootPromise=this.performBoot();try{await this.bootPromise}finally{this.isBooting.set(!1)}}}async performBoot(){try{window.loadPyodide||await this.loadPyodideScript(),console.log("[DirectControlKernel] Loading Pyodide..."),this.pyodide=await window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.29.0/full/"}),console.log("[DirectControlKernel] Installing pylabrobot..."),await this.pyodide.loadPackage(["micropip"]),await this.pyodide.runPythonAsync(`
import micropip
# Install from local wheel to get all modules including backends
await micropip.install('/assets/wheels/pylabrobot-0.1.6-py3-none-any.whl')
print("PyLabRobot installed from local wheel")
`),await this.pyodide.runPythonAsync(`
import sys
from unittest.mock import MagicMock

# Mock pylibftdi (not supported in browser/Pyodide)
sys.modules["pylibftdi"] = MagicMock()

# Mock other native dependencies that may cause issues
sys.modules["usb"] = MagicMock()
sys.modules["usb.core"] = MagicMock()
sys.modules["usb.util"] = MagicMock()
sys.modules["serial"] = MagicMock()
sys.modules["serial.tools"] = MagicMock()
sys.modules["serial.tools.list_ports"] = MagicMock()

print("Browser mocks installed")
`);let e=Date.now();console.log("[DirectControlKernel] Loading browser shims..."),await this.pyodide.runPythonAsync(`
import pyodide.http
import builtins

# Load WebSerial shim
print("Loading WebSerial shim...")
try:
    _shim_code = await (await pyodide.http.pyfetch('/assets/shims/web_serial_shim.py?v=${e}')).string()
    exec(_shim_code, globals())
    builtins.WebSerial = WebSerial
    print("\u2713 WebSerial shim loaded and added to builtins")
except Exception as e:
    print(f"! Failed to load WebSerial shim: {e}")

# Load WebUSB shim
print("Loading WebUSB shim...")
try:
    _shim_code = await (await pyodide.http.pyfetch('/assets/shims/web_usb_shim.py?v=${e}')).string()
    exec(_shim_code, globals())
    builtins.WebUSB = WebUSB
    print("\u2713 WebUSB shim loaded and added to builtins")
except Exception as e:
    print(f"! Failed to load WebUSB shim: {e}")

# Load WebFTDI shim (CRITICAL for CLARIOstarBackend!)
print("Loading WebFTDI shim...")
try:
    _shim_code = await (await pyodide.http.pyfetch('/assets/shims/web_ftdi_shim.py?v=${e}')).string()
    exec(_shim_code, globals())
    builtins.WebFTDI = WebFTDI
    print("\u2713 WebFTDI shim loaded and added to builtins")
except Exception as e:
    print(f"! Failed to load WebFTDI shim: {e}")
`),await this.pyodide.runPythonAsync(`
# Patch pylabrobot.io to use browser shims (BEFORE importing backends!)
import pylabrobot.io.serial as _ser
import pylabrobot.io.usb as _usb
import pylabrobot.io.ftdi as _ftdi

# Patch Serial and USB
_ser.Serial = WebSerial
_usb.USB = WebUSB 
print("\u2713 pylabrobot.io.serial patched with WebSerial")
print("\u2713 pylabrobot.io.usb patched with WebUSB")

# CRITICAL: Patch FTDI - this is what CLARIOstarBackend actually uses!
_ftdi.FTDI = WebFTDI
_ftdi.HAS_PYLIBFTDI = True  # Prevent import error check
print("\u2713 pylabrobot.io.ftdi patched with WebFTDI")
print("[DIAG] CLARIOstarBackend will now use WebFTDI for USB-to-Serial!")

# Verify the patches took effect
print(f"[DIAG] pylabrobot.io.usb.USB = {_usb.USB}")
print(f"[DIAG] pylabrobot.io.ftdi.FTDI = {_ftdi.FTDI}")
print(f"[DIAG] FTDI is WebFTDI? {_ftdi.FTDI is WebFTDI}")
`),await this.pyodide.runPythonAsync(`
import pylabrobot
from pylabrobot.resources import *
print(f"PyLabRobot {pylabrobot.__version__} ready for Direct Control")

# Verify what the plate_reading backend will use
from pylabrobot.plate_reading.clario_star_backend import CLARIOstarBackend
# Check what FTDI class it imports
import pylabrobot.io.ftdi as verify_ftdi
print(f"[DIAG] After backend import, pylabrobot.io.ftdi.FTDI = {verify_ftdi.FTDI}")
print(f"[DIAG] FTDI is WebFTDI? {verify_ftdi.FTDI is WebFTDI}")

# Check CLARIOstarBackend's __init__ to see what it uses
import inspect
try:
    src = inspect.getsource(CLARIOstarBackend.__init__)
    if 'FTDI' in src:
        print("[DIAG] CLARIOstarBackend uses FTDI in __init__ - CORRECT!")
    elif 'USB' in src or 'usb' in src:
        print("[DIAG] CLARIOstarBackend uses USB in __init__")
except:
    print("[DIAG] Could not inspect CLARIOstarBackend")
`),this.isReady.set(!0),console.log("[DirectControlKernel] Ready!")}catch(e){throw console.error("[DirectControlKernel] Boot failed:",e),this.bootError.set(e instanceof Error?e.message:String(e)),this.pyodide=null,this.bootPromise=null,e}}loadPyodideScript(){return new Promise((e,t)=>{let n=document.createElement("script");n.src="https://cdn.jsdelivr.net/pyodide/v0.29.0/full/pyodide.js",n.onload=()=>e(),n.onerror=()=>t(new Error("Failed to load Pyodide script")),document.head.appendChild(n)})}async execute(e){this.pyodide||await this.boot();try{await this.pyodide.runPythonAsync(`
import sys
from io import StringIO
_stdout_capture = StringIO()
_old_stdout = sys.stdout
sys.stdout = _stdout_capture
`);let t=await this.pyodide.runPythonAsync(e),i=await this.pyodide.runPythonAsync(`
sys.stdout = _old_stdout
_output = _stdout_capture.getvalue()
_stdout_capture.close()
_output
`)+(t!=null?String(t):"");return this.lastOutput.set(i),i}catch(t){let n=t instanceof Error?t.message:String(t);throw this.lastOutput.set(`Error: ${n}`),t}}async ensureMachineInstantiated(e,t,n,i,s){if(this.instantiatedMachines.has(e))return this.instantiatedMachines.get(e);this.pyodide||await this.boot(),console.log(`[DirectControlKernel] Instantiating ${t} as ${n}...`);let m={PlateReader:{module:"pylabrobot.plate_reading",cls:"PlateReader"},LiquidHandler:{module:"pylabrobot.liquid_handling",cls:"LiquidHandler"},Shaker:{module:"pylabrobot.shaking",cls:"Shaker"},HeaterShaker:{module:"pylabrobot.heating_shaking",cls:"HeaterShaker"},Centrifuge:{module:"pylabrobot.centrifuge",cls:"Centrifuge"},Incubator:{module:"pylabrobot.incubator",cls:"Incubator"}}[s]||{module:"pylabrobot.liquid_handling",cls:"LiquidHandler"},f=i.split(".").pop()||"Backend",M=i.substring(0,i.lastIndexOf(".")),h;s==="PlateReader"?h=`name="${t}", size_x=400.0, size_y=400.0, size_z=200.0, backend=${f}()`:s==="LiquidHandler"?h=`name="${t}", backend=${f}()`:h=`name="${t}", backend=${f}()`;let D=`
# Initialize: ${t}
from ${M} import ${f}
from ${m.module} import ${m.cls}

${n} = ${m.cls}(${h})
print("Created: ${n} (${t})")

# DIAGNOSTIC: Check what USB type the backend is using
backend = ${n}.backend
print(f"[DIAG-INST] Backend type: {type(backend)}")
print(f"[DIAG-INST] Backend __dict__:")
for k, v in backend.__dict__.items():
    print(f"  {k}: {type(v).__name__} = {repr(v)[:100]}")
`;return await this.execute(D),this.instantiatedMachines.set(e,n),n}async executeMethod(e,t,n){let i=Object.entries(n).filter(([,d])=>d!=null&&d!=="").map(([d,m])=>{let f=typeof m=="string"?`"${m}"`:m;return`${d}=${f}`}).join(", "),s=`await ${e}.${t}(${i})`;return console.log(`[DirectControlKernel] Executing: ${s}`),this.execute(s)}getState(){return{isReady:this.isReady(),isBooting:this.isBooting(),instantiatedMachines:Array.from(this.instantiatedMachines.entries()),hasError:!!this.bootError()}}reset(){this.pyodide=null,this.bootPromise=null,this.instantiatedMachines.clear(),this.isReady.set(!1),this.isBooting.set(!1),this.bootError.set(null),this.lastOutput.set(""),console.log("[DirectControlKernel] Reset")}static \u0275fac=function(t){return new(t||o)};static \u0275prov=E({token:o,factory:o.\u0275fac,providedIn:"root"})};var Zt=["notebookFrame"],en=(o,e)=>e.accession_id;function tn(o,e){if(o&1){let t=w();r(0,"iframe",18,0),_("load",function(){x(t);let i=p(2);return C(i.onIframeLoad())}),a()}if(o&2){let t=p(2);u("src",t.jupyterliteUrl,de)}}function nn(o,e){if(o&1){let t=w();r(0,"button",22),_("click",function(){x(t);let i=p(3);return C(i.reloadNotebook())}),r(1,"mat-icon"),c(2,"refresh"),a(),c(3," Retry Loading "),a()}}function on(o,e){if(o&1&&(r(0,"div",17)(1,"div",19),P(2,"mat-spinner",20),r(3,"p"),c(4,"Initializing Pyodide Environment..."),a(),S(5,nn,4,0,"button",21),a()()),o&2){let t=p(2);l(5),I(t.loadingError()?5:-1)}}function rn(o,e){if(o&1&&(r(0,"div",15),S(1,tn,2,1,"iframe",16),S(2,on,6,1,"div",17),a()),o&2){let t=p();l(),I(t.jupyterliteUrl?1:-1),l(),I(t.isLoading()?2:-1)}}function an(o,e){if(o&1){let t=w();r(0,"div",27)(1,"mat-icon"),c(2,"precision_manufacturing"),a(),r(3,"p"),c(4,"No machines registered"),a(),r(5,"button",32),_("click",function(){x(t);let i=p(2);return C(i.openAssetWizard("MACHINE"))}),r(6,"mat-icon"),c(7,"add"),a(),c(8," Add Machine "),a()()}}function sn(o,e){if(o&1){let t=w();r(0,"div",34),_("click",function(){let i=x(t).$implicit,s=p(3);return C(s.selectMachineForControl(i))}),r(1,"div",35)(2,"mat-icon"),c(3),a()(),r(4,"div",36)(5,"span",37),c(6),a(),r(7,"span",38),c(8),a()(),r(9,"div",39),P(10,"span",40),a()()}if(o&2){let t,n=e.$implicit,i=p(3);R("selected",((t=i.selectedMachine())==null?null:t.accession_id)===n.accession_id),l(3),g(i.getMachineIcon(n.machine_category)),l(3),g(n.name),l(2),g(n.machine_category||"Machine"),l(),ye((n.status==null?null:n.status.toLowerCase())||"offline")}}function cn(o,e){if(o&1&&(r(0,"div",28),pe(1,sn,11,7,"div",33,en),a()),o&2){let t=p(2);l(),me(t.availableMachines())}}function ln(o,e){if(o&1){let t=w();r(0,"app-direct-control",41),_("executeCommand",function(i){x(t);let s=p(2);return C(s.onExecuteCommand(i))}),a()}if(o&2){let t=p(2);u("machine",t.selectedMachine())}}function dn(o,e){o&1&&(r(0,"div",31)(1,"mat-icon"),c(2,"settings_remote"),a(),r(3,"p"),c(4,"Select a machine from the list to control it"),a()())}function pn(o,e){if(o&1){let t=w();r(0,"div",23)(1,"div",24)(2,"div",25)(3,"h3"),c(4,"Available Machines"),a(),r(5,"button",26),_("click",function(){x(t);let i=p();return C(i.loadMachinesForDirectControl())}),r(6,"mat-icon"),c(7,"refresh"),a()()(),S(8,an,9,0,"div",27)(9,cn,3,0,"div",28),a(),r(10,"div",29),S(11,ln,1,1,"app-direct-control",30)(12,dn,5,0,"div",31),a()()}if(o&2){let t=p();l(8),I(t.availableMachines().length===0?8:9),l(3),I(t.selectedMachine()?11:12)}}var Mt=class o{notebookFrame;modeService=y(Oe);store=y(Re);snackBar=y(it);cdr=y(ve);assetService=y(Xe);deckService=y(Je);sanitizer=y(Ie);dialog=y(Te);interactionService=y(Qe);serialManager=y(q);directControlKernel=y(G);modeLabel=be(()=>this.modeService.modeLabel());jupyterliteUrl;currentTheme="";isLoading=b(!0);loadingError=b(!1);loadingTimeout;viewInitialized=!1;subscription=new oe;selectedMachine=b(null);availableMachines=b([]);selectedTabIndex=b(0);machineRegisteredHandler=()=>{console.log("[Playground] machine-registered event received, refreshing list..."),this.loadMachinesForDirectControl()};replChannel=null;constructor(){if(ce(()=>{let e=this.store.theme();this.viewInitialized&&this.updateJupyterliteTheme(e)}),typeof navigator<"u"&&"usb"in navigator)try{window.polyfillSerial=vt,console.log("[REPL] WebSerial Polyfill loaded and exposed as window.polyfillSerial")}catch(e){console.warn("[REPL] Failed to load WebSerial polyfill",e)}console.log("[REPL] SerialManager ready for main-thread serial I/O")}ngOnInit(){this.setupReadyListener(),this.loadMachinesForDirectControl(),window.addEventListener("machine-registered",this.machineRegisteredHandler)}ngAfterViewInit(){this.viewInitialized=!0,this.updateJupyterliteTheme(this.store.theme()),this.cdr.detectChanges()}setupReadyListener(){this.replChannel&&this.replChannel.close(),this.replChannel=new BroadcastChannel("praxis_repl"),this.replChannel.onmessage=e=>{let t=e.data;t?.type==="praxis:ready"?(console.log("[REPL] Received kernel ready signal"),this.isLoading.set(!1),this.loadingTimeout&&(clearTimeout(this.loadingTimeout),this.loadingTimeout=void 0),this.cdr.detectChanges()):t?.type==="USER_INTERACTION"&&(console.log("[REPL] USER_INTERACTION received via BroadcastChannel:",t.payload),this.handleUserInteraction(t.payload))}}async handleUserInteraction(e){console.log("[REPL] Opening interaction dialog:",e.interaction_type);let t=await this.interactionService.handleInteraction({interaction_type:e.interaction_type,payload:e.payload});console.log("[REPL] Interaction result obtained:",t),this.replChannel&&this.replChannel.postMessage({type:"praxis:interaction_response",id:e.id,value:t})}ngOnDestroy(){this.subscription.unsubscribe(),window.removeEventListener("machine-registered",this.machineRegisteredHandler),this.replChannel&&(this.replChannel.close(),this.replChannel=null),this.loadingTimeout&&clearTimeout(this.loadingTimeout)}loadMachinesForDirectControl(){this.subscription.add(this.assetService.getMachines().subscribe({next:e=>{console.log("[Playground] Loaded machines for Direct Control:",e.length,e);let t=[...e].sort((n,i)=>{let s=n.created_at?new Date(n.created_at).getTime():0;return(i.created_at?new Date(i.created_at).getTime():0)-s});this.availableMachines.set(t),!this.selectedMachine()&&t.length>0&&(this.selectedMachine.set(t[0]),console.log("[Playground] Auto-selected machine for Direct Control:",t[0].name))},error:e=>{console.error("[Playground] Failed to load machines:",e)}}))}selectMachineForControl(e){this.selectedMachine.set(e)}getMachineIcon(e){return{LiquidHandler:"science",PlateReader:"visibility",Shaker:"vibration",Centrifuge:"loop",Incubator:"thermostat",Other:"precision_manufacturing"}[e]||"precision_manufacturing"}openAddMachine(){this.openAssetWizard("MACHINE")}openAddResource(){this.openAssetWizard("RESOURCE")}openInventory(){this.openAssetWizard()}openAssetWizard(e){this.dialog.open(gt,{minWidth:"600px",maxWidth:"1000px",width:"80vw",height:"auto",minHeight:"400px",maxHeight:"90vh",data:ie(ne({},e?{preselectedType:e}:{}),{context:"playground"})}).afterClosed().subscribe(n=>{if(n&&typeof n=="object"){let i=n.asset_type==="MACHINE"?"machine":"resource";this.insertAsset(i,n)}})}getIsDarkMode(){return document.body.classList.contains("dark-theme")}async buildJupyterliteUrl(){this.loadingTimeout&&clearTimeout(this.loadingTimeout),this.isLoading.set(!0),this.loadingError.set(!1),this.jupyterliteUrl=void 0,this.cdr.detectChanges();let e=this.getIsDarkMode();this.currentTheme=e?"dark":"light";let t=await this.getOptimizedBootstrap();console.log("[REPL] Building JupyterLite URL. Calculated isDark:",e,"Effective Theme Class:",this.currentTheme);let n="./assets/jupyterlite/repl/index.html",i=new URLSearchParams({kernel:"python",toolbar:"1",theme:e?"JupyterLab Dark":"JupyterLab Light"});console.log("[REPL] Generated Params:",i.toString()),t&&i.set("code",t);let s=`${n}?${i.toString()}`;this.jupyterliteUrl=this.sanitizer.bypassSecurityTrustResourceUrl(s),this.loadingTimeout=setTimeout(()=>{this.isLoading()&&(console.warn("[REPL] Loading timeout (30s) reached - Pyodide kernel may still be booting"),console.warn("[REPL] Tip: Check browser console in the iframe for bootstrap errors"),this.isLoading.set(!1),this.cdr.detectChanges())},3e4),this.cdr.detectChanges()}async updateJupyterliteTheme(e){let n=this.getIsDarkMode()?"dark":"light";this.currentTheme!==n&&(console.log("[REPL] Theme changed from",this.currentTheme,"to",n,"- rebuilding URL"),this.currentTheme=n,await this.buildJupyterliteUrl())}generateBootstrapCode(){return["# PyLabRobot Interactive Notebook","# Installing pylabrobot from local wheel...","import micropip","await micropip.install('/assets/wheels/pylabrobot-0.1.6-py3-none-any.whl')","","# Ensure WebSerial, WebUSB, and WebFTDI are in builtins for all cells","import builtins",'if "WebSerial" in globals():',"    builtins.WebSerial = WebSerial",'if "WebUSB" in globals():',"    builtins.WebUSB = WebUSB",'if "WebFTDI" in globals():',"    builtins.WebFTDI = WebFTDI","","# Mock pylibftdi (not supported in browser/Pyodide)","import sys","from unittest.mock import MagicMock",'sys.modules["pylibftdi"] = MagicMock()',"","# Load WebSerial/WebUSB/WebFTDI shims for browser I/O","# Note: These are pre-loaded to avoid extra network requests","try:","    import pyodide_js","    from pyodide.ffi import to_js","except ImportError:","    pass","","# Shims will be injected directly via code to avoid 404s","# Patching is done in the bootstrap below","","# Patch pylabrobot.io to use browser shims","import pylabrobot.io.serial as _ser","import pylabrobot.io.usb as _usb","import pylabrobot.io.ftdi as _ftdi","_ser.Serial = WebSerial","_usb.USB = WebUSB","","# CRITICAL: Patch FTDI for backends like CLARIOstarBackend","_ftdi.FTDI = WebFTDI","_ftdi.HAS_PYLIBFTDI = True",'print("\u2713 Patched pylabrobot.io with WebSerial/WebUSB/WebFTDI")',"","# Import pylabrobot","import pylabrobot","from pylabrobot.resources import *","","# Message listener for asset injection via BroadcastChannel","# We use BroadcastChannel because it works across Window/Worker contexts","import js","import json","","def _praxis_message_handler(event):","    try:","        data = event.data","        # Convert JsProxy to dict if needed",'        if hasattr(data, "to_py"):',"            data = data.to_py()","        ",'        if isinstance(data, dict) and data.get("type") == "praxis:execute":','            code = data.get("code", "")','            print(f"Executing: {code}")',"            # Handle async code (contains await)",'            if "await " in code:',"                import asyncio","                # Wrap in async function and schedule","                async def _run_async():",'                    exec(f"async def __praxis_async__(): return {code}", globals())',"                    result = await __praxis_async__()","                    if result is not None:","                        print(result)","                asyncio.ensure_future(_run_async())","            else:","                exec(code, globals())",'        elif isinstance(data, dict) and data.get("type") == "praxis:interaction_response":',"            try:","                import web_bridge",'                web_bridge.handle_interaction_response(data.get("id"), data.get("value"))',"            except ImportError:",'                print("! web_bridge not found for interaction response")',"    except Exception as e:","        import traceback",'        print(f"Error executing injected code: {e}")',"        print(traceback.format_exc())","","# Setup BroadcastChannel","try:",'    if hasattr(js, "BroadcastChannel"):',"        # Try .new() first (Pyodide convention)",'        if hasattr(js.BroadcastChannel, "new"):','            _praxis_channel = js.BroadcastChannel.new("praxis_repl")',"        else:","            # Fallback to direct constructor",'            _praxis_channel = js.BroadcastChannel("praxis_repl")',"        ","        _praxis_channel.onmessage = _praxis_message_handler","        ","        # Register channel with web_bridge for interactive protocols","        try:","            import web_bridge","            web_bridge.register_broadcast_channel(_praxis_channel)",'            print("\u2713 Interactive protocols enabled (channel registered)")',"        except ImportError:",'            print("! web_bridge not available for channel registration")',"        ",'        print("\u2713 Asset injection ready (channel created)")',"    else:",'        print("! BroadcastChannel not available")',"except Exception as e:",'    print(f"! Failed to setup injection channel: {e}")',"",'print("\u2713 pylabrobot loaded with browser I/O shims (including FTDI)!")','print(f"  Version: {pylabrobot.__version__}")','print("Use the Inventory button to insert asset variables.")',"","# Send ready signal to Angular host","try:","    # Must convert dict to JS Object for structured clone in BroadcastChannel","    from pyodide.ffi import to_js",'    ready_msg = to_js({"type": "praxis:ready"}, dict_converter=js.Object.fromEntries)',"    _praxis_channel.postMessage(ready_msg)",'    print("\u2713 Ready signal sent")',"except Exception as e:",'    print(f"! Ready signal failed: {e}")'].join(`
`)}async getOptimizedBootstrap(){let e=["web_serial_shim.py","web_usb_shim.py","web_ftdi_shim.py"],t=`# --- Browser Hardware Shims --- 
`;t+=`import pyodide.http
`;for(let i of e)t+=`
print("PylibPraxis: Loading ${i}...")
try:
    _shim_code = await (await pyodide.http.pyfetch('/assets/shims/${i}')).string()
    exec(_shim_code, globals())
    print("PylibPraxis: Loaded ${i}")
except Exception as e:
    print(f"PylibPraxis: Failed to load ${i}: {e}")
`;t+=`
print("PylibPraxis: Loading web_bridge.py...")
try:
    _bridge_code = await (await pyodide.http.pyfetch('/assets/python/web_bridge.py')).string()
    with open('web_bridge.py', 'w') as f:
        f.write(_bridge_code)
    print("PylibPraxis: Loaded web_bridge.py")
except Exception as e:
    print(f"PylibPraxis: Failed to load web_bridge.py: {e}")

# Load praxis package
import os
if not os.path.exists('praxis'):
    os.makedirs('praxis')
    
for _p_file in ['__init__.py', 'interactive.py']:
    try:
        print(f"PylibPraxis: Loading praxis/{_p_file}...")
        _p_code = await (await pyodide.http.pyfetch(f'/assets/python/praxis/{_p_file}')).string()
        with open(f'praxis/{_p_file}', 'w') as f:
            f.write(_p_code)
        print(f"PylibPraxis: Loaded praxis/{_p_file}")
    except Exception as e:
        print(f"PylibPraxis: Failed to load praxis/{_p_file}: {e}")
`;let n=this.generateBootstrapCode();return t+`
`+n}assetToVarName(e){let t=e.name.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,""),n=e.accession_id.slice(0,6);return`${t}_${n}`}onIframeLoad(){console.log("[REPL] Iframe loaded event fired");let e=this.notebookFrame?.nativeElement,t=!1;try{t=(e?.contentDocument?.body?.childNodes?.length??0)>0}catch(n){console.warn("[REPL] Cannot access iframe content (possibly 431 error or cross-origin):",n),t=!1}if(t){console.log("[REPL] Iframe content detected");try{let n=e.contentWindow?.document.createElement("script");n&&(n.textContent=`
            (function() {
              const originalFetch = window.fetch;
              window.fetch = function(input, init) {
                const url = typeof input === 'string' ? input : (input instanceof URL ? input.href : input.url);
                // Suppress network requests for pylabrobot modules that are already in VFS
                if (url.includes('pylabrobot') && (url.endsWith('.py') || url.endsWith('.so') || url.includes('/__init__.py'))) {
                  // We could return a fake response here, but Pyodide might need a real network 404 
                  // to move to the next finder. However, we can log it gracefully.
                }
                return originalFetch(input, init);
              };
            })();
          `,e.contentWindow?.document.head.appendChild(n),console.log("[REPL] Fetch interceptor injected into iframe"))}catch(n){console.warn("[REPL] Could not inject interceptor (likely cross-origin):",n)}}else console.warn("[REPL] Iframe load event fired but no content detected (or access denied)")}reloadNotebook(){this.jupyterliteUrl=void 0,this.cdr.detectChanges(),setTimeout(async()=>{await this.buildJupyterliteUrl(),this.cdr.detectChanges()},100)}generateResourceCode(e,t){let n=t||this.assetToVarName(e),i=e.fqn||e.plr_definition?.fqn;if(!i)return`# Resource: ${e.name} (no FQN available)`;let s=i.split("."),d=s[s.length-1];return[`# Resource: ${e.name}`,`from pylabrobot.resources import ${d}`,`${n} = ${d}(name="${n}")`,`print(f"Created: {${n}}")`].join(`
`)}async generateMachineCode(e,t,n){let i=t||this.assetToVarName(e),s=e.plr_definition?.frontend_fqn||e.frontend_definition?.fqn,d=e.plr_definition?.fqn||e.backend_definition?.fqn||e.simulation_backend_name,m=!!(e.is_simulation_override||e.simulation_backend_name);if(!s)return`# Machine: ${e.name} (Missing Frontend FQN)`;let f=s.split(".").pop(),M=s.substring(0,s.lastIndexOf(".")),h={backend_fqn:d||"pylabrobot.liquid_handling.backends.simulation.SimulatorBackend",port_id:e.connection_info?.address||e.connection_info?.port_id||"",is_simulated:m,baudrate:e.connection_info?.baudrate||9600};return[`# Machine: ${e.name}`,"from web_bridge import create_configured_backend",`from ${M} import ${f}`,"",`config = ${JSON.stringify(h,null,2)}`,"backend = create_configured_backend(config)",`${i} = ${f}(backend=backend)`,`await ${i}.setup()`,`print(f"Created: {${i}}")`].join(`
`)}isMachineInUse(e){return e.status==="running"}async insertAsset(e,t,n,i){let s=n||this.assetToVarName(t);if(e==="machine"){let m=t;this.selectedMachine.set(m),m.is_simulation_override}let d;e==="machine"?d=await this.generateMachineCode(t,s,i):d=this.generateResourceCode(t,s);try{let m=new BroadcastChannel("praxis_repl");m.postMessage({type:"praxis:execute",code:d}),setTimeout(()=>m.close(),100),this.snackBar.open(`Inserted ${s}`,"OK",{duration:2e3})}catch(m){console.error("Failed to send asset to REPL:",m),navigator.clipboard.writeText(d).then(()=>{this.snackBar.open("Code copied to clipboard (BroadcastChannel failed)","OK",{duration:2e3})})}}async onExecuteCommand(e){let{methodName:t,args:n}=e,i=this.selectedMachine();if(!i)return;let s=this.assetToVarName(i),d=i.accession_id,f=(i.connection_info||{}).plr_backend||"",M=i.machine_category||"LiquidHandler";try{this.directControlKernel.isReady()||(this.snackBar.open("Booting Python kernel...","OK",{duration:3e3}),await this.directControlKernel.boot()),await this.directControlKernel.ensureMachineInstantiated(d,i.name,s,f,M),this.snackBar.open(`Executing ${t}...`,"OK",{duration:2e3});let h=await this.directControlKernel.executeMethod(s,t,n);h.trim()&&(console.log("[DirectControl] Output:",h),this.snackBar.open(h.split(`
`)[0].substring(0,80),"OK",{duration:5e3}))}catch(h){console.error("[DirectControl] Command failed:",h);let D=h instanceof Error?h.message:String(h);this.snackBar.open(`Error: ${D.substring(0,80)}`,"Dismiss",{duration:5e3})}}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=T({type:o,selectors:[["app-playground"]],viewQuery:function(t,n){if(t&1&&ge(Zt,5),t&2){let i;fe(i=_e())&&(n.notebookFrame=i.first)}},decls:28,vars:2,consts:[["notebookFrame",""],[1,"repl-container"],[1,"notebook-area"],[1,"repl-card"],[1,"repl-header"],[1,"header-title"],[1,"header-actions","flex","items-center","gap-2"],["mat-icon-button","","matTooltip","Restart Kernel (reload notebook)","aria-label","Restart Kernel (reload notebook)",3,"click"],["mat-icon-button","","matTooltip","Add Machine","aria-label","Add Machine","color","primary",3,"click"],["mat-icon-button","","matTooltip","Add Resource","aria-label","Add Resource","color","primary",3,"click"],["mat-icon-button","","matTooltip","Browse Inventory","aria-label","Browse Inventory","color","primary",3,"click"],[1,"repl-tabs",3,"selectedIndexChange","selectedIndex"],["label","REPL Notebook"],["matTabContent",""],["label","Direct Control"],["data-tour-id","repl-notebook",1,"repl-notebook-wrapper"],["allow","cross-origin-isolated; usb; serial","sandbox","allow-scripts allow-same-origin allow-popups allow-forms allow-modals",1,"notebook-frame",3,"src"],[1,"loading-overlay"],["allow","cross-origin-isolated; usb; serial","sandbox","allow-scripts allow-same-origin allow-popups allow-forms allow-modals",1,"notebook-frame",3,"load","src"],[1,"loading-content"],["diameter","48"],["mat-flat-button","","color","warn"],["mat-flat-button","","color","warn",3,"click"],[1,"direct-control-dashboard"],[1,"machine-selector-panel"],[1,"panel-header"],["mat-icon-button","","matTooltip","Refresh machines",3,"click"],[1,"empty-machines"],[1,"machine-list"],[1,"control-panel"],[3,"machine"],[1,"empty-state"],["mat-stroked-button","",3,"click"],[1,"machine-card",3,"selected"],[1,"machine-card",3,"click"],[1,"machine-icon"],[1,"machine-info"],[1,"machine-name"],[1,"machine-category"],[1,"machine-status"],[1,"status-dot"],[3,"executeCommand","machine"]],template:function(t,n){t&1&&(r(0,"div",1)(1,"div",2)(2,"mat-card",3)(3,"div",4)(4,"div",5)(5,"mat-icon"),c(6,"auto_stories"),a(),r(7,"h2"),c(8),a()(),r(9,"div",6),P(10,"app-hardware-discovery-button"),r(11,"button",7),_("click",function(){return n.reloadNotebook()}),r(12,"mat-icon"),c(13,"restart_alt"),a()(),r(14,"button",8),_("click",function(){return n.openAddMachine()}),r(15,"mat-icon"),c(16,"precision_manufacturing"),a()(),r(17,"button",9),_("click",function(){return n.openAddResource()}),r(18,"mat-icon"),c(19,"science"),a()(),r(20,"button",10),_("click",function(){return n.openInventory()}),r(21,"mat-icon"),c(22,"inventory_2"),a()()()(),r(23,"mat-tab-group",11),_("selectedIndexChange",function(s){return n.selectedTabIndex.set(s)}),r(24,"mat-tab",12),v(25,rn,3,2,"ng-template",13),a(),r(26,"mat-tab",14),v(27,pn,13,2,"ng-template",13),a()()()()()),t&2&&(l(8),O("Playground (",n.modeLabel(),")"),l(15),u("selectedIndex",n.selectedTabIndex()))},dependencies:[ze,at,rt,F,B,L,A,Ee,De,ke,ht,ot,N,$,mt,ut,U,et,Ze,Ye,pt,ct,lt,dt,st,H],styles:[".repl-container[_ngcontent-%COMP%]{height:100%;width:100%;box-sizing:border-box;display:flex;flex-direction:column;overflow:hidden;padding:16px;gap:0}.notebook-area[_ngcontent-%COMP%]{height:100%;min-width:0;display:flex;flex-direction:column}.repl-card[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;padding:0;background:var(--mat-sys-surface-container);border:1px solid var(--mat-sys-outline-variant);color:var(--mat-sys-on-surface);border-radius:8px;overflow:hidden}.repl-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background:var(--mat-sys-surface-container-high);border-bottom:1px solid var(--mat-sys-outline-variant);flex-shrink:0;height:56px;box-sizing:border-box}.header-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.repl-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--mat-sys-primary)}.repl-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.repl-tabs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;min-height:0}[_nghost-%COMP%]     .repl-tabs .mat-mdc-tab-body-wrapper{flex:1}.repl-notebook-wrapper[_ngcontent-%COMP%]{height:100%;position:relative;background:var(--mat-sys-surface-container-low)}.direct-control-wrapper[_ngcontent-%COMP%]{height:100%;padding:24px;overflow-y:auto;background:var(--mat-sys-surface-container-low)}.notebook-frame[_ngcontent-%COMP%]{width:100%;height:100%;border:none}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:16px;color:var(--mat-sys-on-surface-variant);text-align:center}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:var(--mat-sys-surface-container-low);display:flex;align-items:center;justify-content:center;z-index:100;transition:opacity .5s ease-out}.loading-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;color:var(--mat-sys-on-surface-variant)}.loading-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-weight:500;letter-spacing:.02em}.direct-control-dashboard[_ngcontent-%COMP%]{display:flex;height:100%;background:var(--mat-sys-surface-container-low)}.machine-selector-panel[_ngcontent-%COMP%]{width:280px;min-width:280px;border-right:1px solid var(--mat-sys-outline-variant);background:var(--mat-sys-surface-container);display:flex;flex-direction:column;overflow:hidden}.panel-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--mat-sys-outline-variant);background:var(--mat-sys-surface-container-high)}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:.875rem;font-weight:500;color:var(--mat-sys-on-surface)}.machine-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:8px}.machine-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;border-radius:8px;cursor:pointer;transition:background-color .15s ease,box-shadow .15s ease;margin-bottom:4px;background:var(--mat-sys-surface);border:1px solid transparent}.machine-card[_ngcontent-%COMP%]:hover{background:var(--mat-sys-surface-container-highest)}.machine-card.selected[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--mat-sys-primary) 12%,var(--mat-sys-surface));border-color:var(--mat-sys-primary)}.machine-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:8px;background:var(--mat-sys-primary-container);display:flex;align-items:center;justify-content:center;flex-shrink:0}.machine-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--mat-sys-on-primary-container)}.machine-info[_ngcontent-%COMP%]{flex:1;min-width:0;display:flex;flex-direction:column;gap:2px}.machine-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--mat-sys-on-surface);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.machine-category[_ngcontent-%COMP%]{font-size:.75rem;color:var(--mat-sys-on-surface-variant)}.machine-status[_ngcontent-%COMP%]{flex-shrink:0}.status-dot[_ngcontent-%COMP%]{display:block;width:8px;height:8px;border-radius:50%;background:var(--mat-sys-outline)}.machine-status.idle[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary)}.machine-status.running[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%], .machine-status.connected[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:var(--mat-sys-primary);animation:_ngcontent-%COMP%_pulse 2s infinite}.machine-status.error[_ngcontent-%COMP%]   .status-dot[_ngcontent-%COMP%]{background:var(--mat-sys-error)}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.empty-machines[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:24px;gap:12px;color:var(--mat-sys-on-surface-variant);text-align:center}.empty-machines[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:40px;width:40px;height:40px;opacity:.5}.empty-machines[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.875rem}.control-panel[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:24px;min-width:0}"]})};export{Mt as PlaygroundComponent};
